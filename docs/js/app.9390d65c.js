(function(t){function e(e){for(var s,r,o=e[0],l=e[1],u=e[2],_=0,h=[];_<o.length;_++)r=o[_],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&h.push(n[r][0]),n[r]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(t[s]=l[s]);m&&m(e);while(h.length)h.shift()();return a.push.apply(a,u||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],s=!0,o=1;o<i.length;o++){var l=i[o];0!==n[l]&&(s=!1)}s&&(a.splice(e--,1),t=r(r.s=i[0]))}return t}var s={},n={app:0},a=[];function r(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=s,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(i,s,function(e){return t[e]}.bind(null,s));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var u=0;u<o.length;u++)e(o[u]);var m=l;a.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("cd49")},"15c6":function(t,e,i){},"1a85":function(t,e,i){},2305:function(t,e,i){"use strict";i("15c6")},"26b7":function(t,e,i){},"2be6":function(t,e,i){},"7dd7":function(t,e,i){"use strict";i("b9ad")},a9ea:function(t,e,i){"use strict";i("2be6")},b5c5:function(t,e,i){"use strict";i("26b7")},b8a1:function(t,e,i){},b9ad:function(t,e,i){},bc4e:function(t,e,i){"use strict";i("1a85")},cd49:function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var s=i("2b0e"),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("aspect-ratio-letterbox")],1)},a=[],r=(i("a434"),i("159b"),i("d4ec")),o=i("bee2"),l=function t(){Object(r["a"])(this,t);var e=document.getElementById("game-canvas");this.context=e.getContext("2d"),this.displayWidth=e.getBoundingClientRect().width,this.displayHeight=e.getBoundingClientRect().height,e.width=this.displayWidth,e.height=this.displayHeight,this.pixelWidth=e.width,this.pixelHeight=e.height,this.context.transform(1,0,0,-1,0,e.height)};var u=1e37,m=1e-5,_=m*m,h=3.14159265359,c=2,f=8,d=.1,v=2,y=.008,p=2/180*h,x=2*y,B=8,S=32,A=.2,C=.2,b=8/180*h,V=2,g=V*V,w=.5*h,k=w*w,M=.2,I=.75,P=-1,G=2147483647,D=.75,j=1,O=.25,F=.5,L=2,R=L*L,T=256,q=2.5,z=.5,N=.01,E=2/180*h;var J=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(r["a"])(this,t),this.major=0,this.minor=0,this.revision=0,this.major=e,this.minor=i,this.revision=s}return Object(o["a"])(t,[{key:"toString",value:function(){return this.major+"."+this.minor+"."+this.revision}}]),t}();new J(2,3,2);function X(t,e){for(var i=[],s=0;s<t;++s)i.push(e(s));return i}function U(t){for(var e=[],i=0;i<t;++i)e.push(null);return e}function W(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=[],s=0;s<t;++s)i.push(e);return i}var Z=2*h;function H(t){return t<0?-t:t}function Y(t,e){return t<e?t:e}function K(t,e){return t>e?t:e}function Q(t,e,i){return t<e?e:t>i?i:t}function $(t){return t*t}function tt(t){return 1/Math.sqrt(t)}function et(t){return Math.sqrt(t)}function it(t,e){return Math.pow(t,e)}function st(t){return Math.asin(t)}function nt(t,e){return Math.atan2(t,e)}var at=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(r["a"])(this,t),this.x=e,this.y=i}return Object(o["a"])(t,[{key:"Clone",value:function(){return new t(this.x,this.y)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this}},{key:"Set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"SelfAddXY",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"SelfSubXY",value:function(t,e){return this.x-=t,this.y-=e,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this}},{key:"SelfMulAdd",value:function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}},{key:"SelfMulSub",value:function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}},{key:"Dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"Cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"Length",value:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}},{key:"LengthSquared",value:function(){var t=this.x,e=this.y;return t*t+e*e}},{key:"Normalize",value:function(){var t=this.Length();if(t>=m){var e=1/t;this.x*=e,this.y*=e}return t}},{key:"SelfNormalize",value:function(){var t=this.Length();if(t>=m){var e=1/t;this.x*=e,this.y*=e}return this}},{key:"SelfRotate",value:function(t){var e=Math.cos(t),i=Math.sin(t),s=this.x;return this.x=e*s-i*this.y,this.y=i*s+e*this.y,this}},{key:"IsValid",value:function(){return isFinite(this.x)&&isFinite(this.y)}},{key:"SelfCrossVS",value:function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this}},{key:"SelfCrossSV",value:function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this}},{key:"SelfMinV",value:function(t){return this.x=Y(this.x,t.x),this.y=Y(this.y,t.y),this}},{key:"SelfMaxV",value:function(t){return this.x=K(this.x,t.x),this.y=K(this.y,t.y),this}},{key:"SelfAbs",value:function(){return this.x=H(this.x),this.y=H(this.y),this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"SelfSkew",value:function(){var t=this.x;return this.x=-this.y,this.y=t,this}}],[{key:"MakeArray",value:function(e){return X(e,(function(e){return new t}))}},{key:"AbsV",value:function(t,e){return rt(t,e)}},{key:"MinV",value:function(t,e,i){return ot(t,e,i)}},{key:"MaxV",value:function(t,e,i){return lt(t,e,i)}},{key:"ClampV",value:function(t,e,i,s){return ut(t,e,i,s)}},{key:"RotateV",value:function(t,e,i){return mt(t,e,i)}},{key:"DotVV",value:function(t,e){return _t(t,e)}},{key:"CrossVV",value:function(t,e){return ht(t,e)}},{key:"CrossVS",value:function(t,e,i){return ct(t,e,i)}},{key:"CrossVOne",value:function(t,e){return ft(t,e)}},{key:"CrossSV",value:function(t,e,i){return dt(t,e,i)}},{key:"CrossOneV",value:function(t,e){return vt(t,e)}},{key:"AddVV",value:function(t,e,i){return yt(t,e,i)}},{key:"SubVV",value:function(t,e,i){return pt(t,e,i)}},{key:"MulSV",value:function(t,e,i){return xt(t,e,i)}},{key:"MulVS",value:function(t,e,i){return Bt(t,e,i)}},{key:"AddVMulSV",value:function(t,e,i,s){return St(t,e,i,s)}},{key:"SubVMulSV",value:function(t,e,i,s){return At(t,e,i,s)}},{key:"AddVCrossSV",value:function(t,e,i,s){return Ct(t,e,i,s)}},{key:"MidVV",value:function(t,e,i){return bt(t,e,i)}},{key:"ExtVV",value:function(t,e,i){return Vt(t,e,i)}},{key:"IsEqualToV",value:function(t,e){return gt(t,e)}},{key:"DistanceVV",value:function(t,e){return wt(t,e)}},{key:"DistanceSquaredVV",value:function(t,e){return kt(t,e)}},{key:"NegV",value:function(t,e){return Mt(t,e)}}]),t}();at.ZERO=new at(0,0),at.UNITX=new at(1,0),at.UNITY=new at(0,1),at.s_t0=new at,at.s_t1=new at,at.s_t2=new at,at.s_t3=new at;new at(0,0);function rt(t,e){return e.x=H(t.x),e.y=H(t.y),e}function ot(t,e,i){return i.x=Y(t.x,e.x),i.y=Y(t.y,e.y),i}function lt(t,e,i){return i.x=K(t.x,e.x),i.y=K(t.y,e.y),i}function ut(t,e,i,s){return s.x=Q(t.x,e.x,i.x),s.y=Q(t.y,e.y,i.y),s}function mt(t,e,i){var s=t.x,n=t.y,a=Math.cos(e),r=Math.sin(e);return i.x=a*s-r*n,i.y=r*s+a*n,i}function _t(t,e){return t.x*e.x+t.y*e.y}function ht(t,e){return t.x*e.y-t.y*e.x}function ct(t,e,i){var s=t.x;return i.x=e*t.y,i.y=-e*s,i}function ft(t,e){var i=t.x;return e.x=t.y,e.y=-i,e}function dt(t,e,i){var s=e.x;return i.x=-t*e.y,i.y=t*s,i}function vt(t,e){var i=t.x;return e.x=-t.y,e.y=i,e}function yt(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i}function pt(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i}function xt(t,e,i){return i.x=e.x*t,i.y=e.y*t,i}function Bt(t,e,i){return i.x=t.x*e,i.y=t.y*e,i}function St(t,e,i,s){return s.x=t.x+e*i.x,s.y=t.y+e*i.y,s}function At(t,e,i,s){return s.x=t.x-e*i.x,s.y=t.y-e*i.y,s}function Ct(t,e,i,s){var n=i.x;return s.x=t.x-e*i.y,s.y=t.y+e*n,s}function bt(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i}function Vt(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i}function gt(t,e){return t.x===e.x&&t.y===e.y}function wt(t,e){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}function kt(t,e){var i=t.x-e.x,s=t.y-e.y;return i*i+s*s}function Mt(t,e){return e.x=-t.x,e.y=-t.y,e}var It=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(r["a"])(this,t),this.x=e,this.y=i,this.z=s}return Object(o["a"])(t,[{key:"Clone",value:function(){return new t(this.x,this.y,this.z)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this.z=0,this}},{key:"SetXYZ",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"SelfAddXYZ",value:function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"SelfSubXYZ",value:function(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}}],[{key:"DotV3V3",value:function(t,e){return Pt(t,e)}},{key:"CrossV3V3",value:function(t,e,i){return Gt(t,e,i)}}]),t}();function Pt(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function Gt(t,e,i){var s=t.x,n=t.y,a=t.z,r=e.x,o=e.y,l=e.z;return i.x=n*l-a*o,i.y=a*r-s*l,i.z=s*o-n*r,i}It.ZERO=new It(0,0,0),It.s_t0=new It;var Dt=function(){function t(){Object(r["a"])(this,t),this.ex=new at(1,0),this.ey=new at(0,1)}return Object(o["a"])(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"SetSSSS",value:function(t,e,i,s){return this.ex.Set(t,i),this.ey.Set(e,s),this}},{key:"SetVV",value:function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this}},{key:"SetAngle",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.ex.Set(e,i),this.ey.Set(-i,e),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}},{key:"SetIdentity",value:function(){return this.ex.Set(1,0),this.ey.Set(0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this}},{key:"GetAngle",value:function(){return Math.atan2(this.ex.y,this.ex.x)}},{key:"GetInverse",value:function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,n=this.ey.y,a=e*n-i*s;return 0!==a&&(a=1/a),t.ex.x=a*n,t.ey.x=-a*i,t.ex.y=-a*s,t.ey.y=a*e,t}},{key:"Solve",value:function(t,e,i){var s=this.ex.x,n=this.ey.x,a=this.ex.y,r=this.ey.y,o=s*r-n*a;return 0!==o&&(o=1/o),i.x=o*(r*t-n*e),i.y=o*(s*e-a*t),i}},{key:"SelfAbs",value:function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this}},{key:"SelfInv",value:function(){return this.GetInverse(this)}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this}},{key:"SelfSubM",value:function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this}}],[{key:"FromVV",value:function(e,i){return(new t).SetVV(e,i)}},{key:"FromSSSS",value:function(e,i,s,n){return(new t).SetSSSS(e,i,s,n)}},{key:"FromAngle",value:function(e){return(new t).SetAngle(e)}},{key:"AbsM",value:function(t,e){return jt(t,e)}},{key:"MulMV",value:function(t,e,i){return Ot(t,e,i)}},{key:"MulTMV",value:function(t,e,i){return Ft(t,e,i)}},{key:"AddMM",value:function(t,e,i){return Lt(t,e,i)}},{key:"MulMM",value:function(t,e,i){return Rt(t,e,i)}},{key:"MulTMM",value:function(t,e,i){return Tt(t,e,i)}}]),t}();function jt(t,e){var i=t.ex,s=t.ey;return e.ex.x=H(i.x),e.ex.y=H(i.y),e.ey.x=H(s.x),e.ey.y=H(s.y),e}function Ot(t,e,i){var s=t.ex,n=t.ey,a=e.x,r=e.y;return i.x=s.x*a+n.x*r,i.y=s.y*a+n.y*r,i}function Ft(t,e,i){var s=t.ex,n=t.ey,a=e.x,r=e.y;return i.x=s.x*a+s.y*r,i.y=n.x*a+n.y*r,i}function Lt(t,e,i){var s=t.ex,n=t.ey,a=e.ex,r=e.ey;return i.ex.x=s.x+a.x,i.ex.y=s.y+a.y,i.ey.x=n.x+r.x,i.ey.y=n.y+r.y,i}function Rt(t,e,i){var s=t.ex.x,n=t.ex.y,a=t.ey.x,r=t.ey.y,o=e.ex.x,l=e.ex.y,u=e.ey.x,m=e.ey.y;return i.ex.x=s*o+a*l,i.ex.y=n*o+r*l,i.ey.x=s*u+a*m,i.ey.y=n*u+r*m,i}function Tt(t,e,i){var s=t.ex.x,n=t.ex.y,a=t.ey.x,r=t.ey.y,o=e.ex.x,l=e.ex.y,u=e.ey.x,m=e.ey.y;return i.ex.x=s*o+n*l,i.ex.y=a*o+r*l,i.ey.x=s*u+n*m,i.ey.y=a*u+r*m,i}Dt.IDENTITY=new Dt;var qt=function(){function t(){Object(r["a"])(this,t),this.ex=new It(1,0,0),this.ey=new It(0,1,0),this.ez=new It(0,0,1)}return Object(o["a"])(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"SetVVV",value:function(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}},{key:"SetIdentity",value:function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this}},{key:"Solve33",value:function(t,e,i,s){var n=this.ex.x,a=this.ex.y,r=this.ex.z,o=this.ey.x,l=this.ey.y,u=this.ey.z,m=this.ez.x,_=this.ez.y,h=this.ez.z,c=n*(l*h-u*_)+a*(u*m-o*h)+r*(o*_-l*m);return 0!==c&&(c=1/c),s.x=c*(t*(l*h-u*_)+e*(u*m-o*h)+i*(o*_-l*m)),s.y=c*(n*(e*h-i*_)+a*(i*m-t*h)+r*(t*_-e*m)),s.z=c*(n*(l*i-u*e)+a*(u*t-o*i)+r*(o*e-l*t)),s}},{key:"Solve22",value:function(t,e,i){var s=this.ex.x,n=this.ey.x,a=this.ex.y,r=this.ey.y,o=s*r-n*a;return 0!==o&&(o=1/o),i.x=o*(r*t-n*e),i.y=o*(s*e-a*t),i}},{key:"GetInverse22",value:function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,n=this.ey.y,a=e*n-i*s;0!==a&&(a=1/a),t.ex.x=a*n,t.ey.x=-a*i,t.ex.z=0,t.ex.y=-a*s,t.ey.y=a*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}},{key:"GetSymInverse33",value:function(t){var e=Pt(this.ex,Gt(this.ey,this.ez,It.s_t0));0!==e&&(e=1/e);var i=this.ex.x,s=this.ey.x,n=this.ez.x,a=this.ey.y,r=this.ez.y,o=this.ez.z;t.ex.x=e*(a*o-r*r),t.ex.y=e*(n*r-s*o),t.ex.z=e*(s*r-n*a),t.ey.x=t.ex.y,t.ey.y=e*(i*o-n*n),t.ey.z=e*(n*s-i*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*a-s*s)}}],[{key:"MulM33V3",value:function(t,e,i){return zt(t,e,i)}},{key:"MulM33XYZ",value:function(t,e,i,s,n){return Nt(t,e,i,s,n)}},{key:"MulM33V2",value:function(t,e,i){return Et(t,e,i)}},{key:"MulM33XY",value:function(t,e,i,s){return Jt(t,e,i,s)}}]),t}();function zt(t,e,i){var s=e.x,n=e.y,a=e.z;return i.x=t.ex.x*s+t.ey.x*n+t.ez.x*a,i.y=t.ex.y*s+t.ey.y*n+t.ez.y*a,i.z=t.ex.z*s+t.ey.z*n+t.ez.z*a,i}function Nt(t,e,i,s,n){return n.x=t.ex.x*e+t.ey.x*i+t.ez.x*s,n.y=t.ex.y*e+t.ey.y*i+t.ez.y*s,n.z=t.ex.z*e+t.ey.z*i+t.ez.z*s,n}function Et(t,e,i){var s=e.x,n=e.y;return i.x=t.ex.x*s+t.ey.x*n,i.y=t.ex.y*s+t.ey.y*n,i}function Jt(t,e,i,s){return s.x=t.ex.x*e+t.ey.x*i,s.y=t.ex.y*e+t.ey.y*i,s}qt.IDENTITY=new qt;var Xt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(r["a"])(this,t),this.s=0,this.c=1,e&&(this.s=Math.sin(e),this.c=Math.cos(e))}return Object(o["a"])(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.s=t.s,this.c=t.c,this}},{key:"SetAngle",value:function(t){return this.s=Math.sin(t),this.c=Math.cos(t),this}},{key:"SetIdentity",value:function(){return this.s=0,this.c=1,this}},{key:"GetAngle",value:function(){return Math.atan2(this.s,this.c)}},{key:"GetXAxis",value:function(t){return t.x=this.c,t.y=this.s,t}},{key:"GetYAxis",value:function(t){return t.x=-this.s,t.y=this.c,t}}],[{key:"MulRR",value:function(t,e,i){return Ut(t,e,i)}},{key:"MulTRR",value:function(t,e,i){return Wt(t,e,i)}},{key:"MulRV",value:function(t,e,i){return Zt(t,e,i)}},{key:"MulTRV",value:function(t,e,i){return Ht(t,e,i)}}]),t}();function Ut(t,e,i){var s=t.c,n=t.s,a=e.c,r=e.s;return i.s=n*a+s*r,i.c=s*a-n*r,i}function Wt(t,e,i){var s=t.c,n=t.s,a=e.c,r=e.s;return i.s=s*r-n*a,i.c=s*a+n*r,i}function Zt(t,e,i){var s=t.c,n=t.s,a=e.x,r=e.y;return i.x=s*a-n*r,i.y=n*a+s*r,i}function Ht(t,e,i){var s=t.c,n=t.s,a=e.x,r=e.y;return i.x=s*a+n*r,i.y=-n*a+s*r,i}Xt.IDENTITY=new Xt;var Yt=function(){function t(){Object(r["a"])(this,t),this.p=new at,this.q=new Xt}return Object(o["a"])(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}},{key:"SetIdentity",value:function(){return this.p.SetZero(),this.q.SetIdentity(),this}},{key:"SetPositionRotation",value:function(t,e){return this.p.Copy(t),this.q.Copy(e),this}},{key:"SetPositionAngle",value:function(t,e){return this.p.Copy(t),this.q.SetAngle(e),this}},{key:"SetPosition",value:function(t){return this.p.Copy(t),this}},{key:"SetPositionXY",value:function(t,e){return this.p.Set(t,e),this}},{key:"SetRotation",value:function(t){return this.q.Copy(t),this}},{key:"SetRotationAngle",value:function(t){return this.q.SetAngle(t),this}},{key:"GetPosition",value:function(){return this.p}},{key:"GetRotation",value:function(){return this.q}},{key:"GetRotationAngle",value:function(){return this.q.GetAngle()}},{key:"GetAngle",value:function(){return this.q.GetAngle()}}],[{key:"MulXV",value:function(t,e,i){return Kt(t,e,i)}},{key:"MulTXV",value:function(t,e,i){return Qt(t,e,i)}},{key:"MulXX",value:function(t,e,i){return $t(t,e,i)}},{key:"MulTXX",value:function(t,e,i){return te(t,e,i)}}]),t}();function Kt(t,e,i){var s=t.q.c,n=t.q.s,a=e.x,r=e.y;return i.x=s*a-n*r+t.p.x,i.y=n*a+s*r+t.p.y,i}function Qt(t,e,i){var s=t.q.c,n=t.q.s,a=e.x-t.p.x,r=e.y-t.p.y;return i.x=s*a+n*r,i.y=-n*a+s*r,i}function $t(t,e,i){return Ut(t.q,e.q,i.q),yt(Zt(t.q,e.p,i.p),t.p,i.p),i}function te(t,e,i){return Wt(t.q,e.q,i.q),Ht(t.q,pt(e.p,t.p,i.p),i.p),i}Yt.IDENTITY=new Yt;var ee,ie=function(){function t(){Object(r["a"])(this,t),this.localCenter=new at,this.c0=new at,this.c=new at,this.a0=0,this.a=0,this.alpha0=0}return Object(o["a"])(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}},{key:"GetTransform",value:function(t,e){var i=1-e;t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y;var s=i*this.a0+e*this.a;return t.q.SetAngle(s),t.p.SelfSub(Zt(t.q,this.localCenter,at.s_t0)),t}},{key:"Advance",value:function(t){var e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t}},{key:"Normalize",value:function(){var t=Z*Math.floor(this.a0/Z);this.a0-=t,this.a-=t}}]),t}(),se=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(r["a"])(this,t),this.r=e,this.g=i,this.b=s,this.a=n}return Object(o["a"])(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"IsEqual",value:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}},{key:"IsZero",value:function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}},{key:"GetColor",value:function(t){return t.Copy(this),t}},{key:"SetColor",value:function(t){this.Copy(t)}},{key:"Set",value:function(e,i,s){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e instanceof t?this.Copy(e):this.SetRGBA(e,i,s,n)}},{key:"SetRGB",value:function(t,e,i){return this.r=t,this.g=e,this.b=i,this}},{key:"SetRGBA",value:function(t,e,i,s){return this.r=t,this.g=e,this.b=i,this.a=s,this}},{key:"SelfAdd",value:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}},{key:"Add",value:function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e}},{key:"SelfSub",value:function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}},{key:"Sub",value:function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e}},{key:"SelfMul_0_1",value:function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}},{key:"Mul_0_1",value:function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,this}},{key:"Mix",value:function(e,i){t.MixColors(this,e,i)}},{key:"MakeStyleString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.a;return t.MakeStyleString(this.r,this.g,this.b,e)}}],[{key:"MixColors",value:function(t,e,i){var s=i*(e.r-t.r),n=i*(e.g-t.g),a=i*(e.b-t.b),r=i*(e.a-t.a);t.r+=s,t.g+=n,t.b+=a,t.a+=r,e.r-=s,e.g-=n,e.b-=a,e.a-=r}},{key:"MakeStyleString",value:function(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return t=Math.round(Math.max(0,Math.min(255,255*t))),e=Math.round(Math.max(0,Math.min(255,255*e))),i=Math.round(Math.max(0,Math.min(255,255*i))),s=Math.max(0,Math.min(1,s)),s<1?"rgba("+t+","+e+","+i+","+s+")":"rgb("+t+","+e+","+i+")"}}]),t}();se.RED=new se(1,0,0),se.GREEN=new se(0,1,0),se.BLUE=new se(0,0,1),function(t){t[t["e_none"]=0]="e_none",t[t["e_shapeBit"]=1]="e_shapeBit",t[t["e_jointBit"]=2]="e_jointBit",t[t["e_aabbBit"]=4]="e_aabbBit",t[t["e_pairBit"]=8]="e_pairBit",t[t["e_centerOfMassBit"]=16]="e_centerOfMassBit",t[t["e_particleBit"]=32]="e_particleBit",t[t["e_controllerBit"]=64]="e_controllerBit",t[t["e_all"]=63]="e_all"}(ee||(ee={}));var ne=function(){function t(){Object(r["a"])(this,t),this.m_start=Date.now()}return Object(o["a"])(t,[{key:"Reset",value:function(){return this.m_start=Date.now(),this}},{key:"GetMilliseconds",value:function(){return Date.now()-this.m_start}}]),t}(),ae=function(){function t(e){Object(r["a"])(this,t),this.m_stack=[],this.m_count=0,this.m_stack=[],this.m_count=0}return Object(o["a"])(t,[{key:"Reset",value:function(){return this.m_count=0,this}},{key:"Push",value:function(t){this.m_stack[this.m_count]=t,this.m_count++}},{key:"Pop",value:function(){this.m_count--;var t=this.m_stack[this.m_count];return this.m_stack[this.m_count]=null,t}},{key:"GetCount",value:function(){return this.m_count}}]),t}(),re=function(){function t(){Object(r["a"])(this,t),this.m_buffer=at.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}return Object(o["a"])(t,[{key:"Reset",value:function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}},{key:"SetShape",value:function(t,e){t.SetupDistanceProxy(this,e)}},{key:"GetSupport",value:function(t){for(var e=0,i=at.DotVV(this.m_vertices[0],t),s=1;s<this.m_count;++s){var n=at.DotVV(this.m_vertices[s],t);n>i&&(e=s,i=n)}return e}},{key:"GetSupportVertex",value:function(t){for(var e=0,i=at.DotVV(this.m_vertices[0],t),s=1;s<this.m_count;++s){var n=at.DotVV(this.m_vertices[s],t);n>i&&(e=s,i=n)}return this.m_vertices[e]}},{key:"GetVertexCount",value:function(){return this.m_count}},{key:"GetVertex",value:function(t){return this.m_vertices[t]}}]),t}(),oe=function(){function t(){Object(r["a"])(this,t),this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}return Object(o["a"])(t,[{key:"Reset",value:function(){return this.metric=0,this.count=0,this}}]),t}(),le=function(){function t(){Object(r["a"])(this,t),this.proxyA=new re,this.proxyB=new re,this.transformA=new Yt,this.transformB=new Yt,this.useRadii=!1}return Object(o["a"])(t,[{key:"Reset",value:function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}}]),t}(),ue=function(){function t(){Object(r["a"])(this,t),this.pointA=new at,this.pointB=new at,this.distance=0,this.iterations=0}return Object(o["a"])(t,[{key:"Reset",value:function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}}]),t}(),me=0,_e=function(){function t(){Object(r["a"])(this,t),this.wA=new at,this.wB=new at,this.w=new at,this.a=0,this.indexA=0,this.indexB=0}return Object(o["a"])(t,[{key:"Copy",value:function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}}]),t}(),he=function(){function t(){Object(r["a"])(this,t),this.m_v1=new _e,this.m_v2=new _e,this.m_v3=new _e,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}return Object(o["a"])(t,[{key:"ReadCache",value:function(t,e,i,s,n){this.m_count=t.count;for(var a=this.m_vertices,r=0;r<this.m_count;++r){var o=a[r];o.indexA=t.indexA[r],o.indexB=t.indexB[r];var l=e.GetVertex(o.indexA),u=s.GetVertex(o.indexB);Yt.MulXV(i,l,o.wA),Yt.MulXV(n,u,o.wB),at.SubVV(o.wB,o.wA,o.w),o.a=0}if(this.m_count>1){var _=t.metric,h=this.GetMetric();(h<.5*_||2*_<h||h<m)&&(this.m_count=0)}if(0===this.m_count){var c=a[0];c.indexA=0,c.indexB=0;var f=e.GetVertex(0),d=s.GetVertex(0);Yt.MulXV(i,f,c.wA),Yt.MulXV(n,d,c.wB),at.SubVV(c.wB,c.wA,c.w),c.a=1,this.m_count=1}}},{key:"WriteCache",value:function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB}},{key:"GetSearchDirection",value:function(t){switch(this.m_count){case 1:return at.NegV(this.m_v1.w,t);case 2:var e=at.SubVV(this.m_v2.w,this.m_v1.w,t),i=at.CrossVV(e,at.NegV(this.m_v1.w,at.s_t0));return i>0?at.CrossOneV(e,t):at.CrossVOne(e,t);default:return t.SetZero()}}},{key:"GetClosestPoint",value:function(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:return t.SetZero();default:return t.SetZero()}}},{key:"GetWitnessPoints",value:function(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:break}}},{key:"GetMetric",value:function(){switch(this.m_count){case 0:return 0;case 1:return 0;case 2:return at.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return at.CrossVV(at.SubVV(this.m_v2.w,this.m_v1.w,at.s_t0),at.SubVV(this.m_v3.w,this.m_v1.w,at.s_t1));default:return 0}}},{key:"Solve2",value:function(){var e=this.m_v1.w,i=this.m_v2.w,s=at.SubVV(i,e,t.s_e12),n=-at.DotVV(e,s);if(n<=0)return this.m_v1.a=1,void(this.m_count=1);var a=at.DotVV(i,s);if(a<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);var r=1/(a+n);this.m_v1.a=a*r,this.m_v2.a=n*r,this.m_count=2}},{key:"Solve3",value:function(){var e=this.m_v1.w,i=this.m_v2.w,s=this.m_v3.w,n=at.SubVV(i,e,t.s_e12),a=at.DotVV(e,n),r=at.DotVV(i,n),o=r,l=-a,u=at.SubVV(s,e,t.s_e13),m=at.DotVV(e,u),_=at.DotVV(s,u),h=_,c=-m,f=at.SubVV(s,i,t.s_e23),d=at.DotVV(i,f),v=at.DotVV(s,f),y=v,p=-d,x=at.CrossVV(n,u),B=x*at.CrossVV(i,s),S=x*at.CrossVV(s,e),A=x*at.CrossVV(e,i);if(l<=0&&c<=0)return this.m_v1.a=1,void(this.m_count=1);if(o>0&&l>0&&A<=0){var C=1/(o+l);return this.m_v1.a=o*C,this.m_v2.a=l*C,void(this.m_count=2)}if(h>0&&c>0&&S<=0){var b=1/(h+c);return this.m_v1.a=h*b,this.m_v3.a=c*b,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(o<=0&&p<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(h<=0&&y<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(y>0&&p>0&&B<=0){var V=1/(y+p);return this.m_v2.a=y*V,this.m_v3.a=p*V,this.m_count=2,void this.m_v1.Copy(this.m_v3)}var g=1/(B+S+A);this.m_v1.a=B*g,this.m_v2.a=S*g,this.m_v3.a=A*g,this.m_count=3}}]),t}();he.s_e12=new at,he.s_e13=new at,he.s_e23=new at;var ce,fe=new he,de=[0,0,0],ve=[0,0,0],ye=new at,pe=new at,xe=new at,Be=new at,Se=new at;function Ae(t,e,i){0;var s=i.proxyA,n=i.proxyB,a=i.transformA,r=i.transformB,o=fe;o.ReadCache(e,s,a,n,r);var l=o.m_vertices,h=20,c=de,f=ve,d=0,v=u,y=v,p=0;while(p<h){d=o.m_count;for(var x=0;x<d;++x)c[x]=l[x].indexA,f[x]=l[x].indexB;switch(o.m_count){case 1:break;case 2:o.Solve2();break;case 3:o.Solve3();break;default:break}if(3===o.m_count)break;var B=o.GetClosestPoint(ye);y=B.LengthSquared(),v=y;var S=o.GetSearchDirection(pe);if(S.LengthSquared()<_)break;var A=l[o.m_count];A.indexA=s.GetSupport(Xt.MulTRV(a.q,at.NegV(S,at.s_t0),Be)),Yt.MulXV(a,s.GetVertex(A.indexA),A.wA),A.indexB=n.GetSupport(Xt.MulTRV(r.q,S,Se)),Yt.MulXV(r,n.GetVertex(A.indexB),A.wB),at.SubVV(A.wB,A.wA,A.w),++p;for(var C=!1,b=0;b<d;++b)if(A.indexA===c[b]&&A.indexB===f[b]){C=!0;break}if(C)break;++o.m_count}if(me=K(me,p),o.GetWitnessPoints(t.pointA,t.pointB),t.distance=at.DistanceVV(t.pointA,t.pointB),t.iterations=p,o.WriteCache(e),i.useRadii){var V=s.m_radius,g=n.m_radius;if(t.distance>V+g&&t.distance>m){t.distance-=V+g;var w=at.SubVV(t.pointB,t.pointA,xe);w.Normalize(),t.pointA.SelfMulAdd(V,w),t.pointB.SelfMulSub(g,w)}else{var k=at.MidVV(t.pointA,t.pointB,ye);t.pointA.Copy(k),t.pointB.Copy(k),t.distance=0}}}(function(t){t[t["e_vertex"]=0]="e_vertex",t[t["e_face"]=1]="e_face"})(ce||(ce={}));var Ce,be=function(){function t(){Object(r["a"])(this,t),this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}return Object(o["a"])(t,[{key:"key",get:function(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key},set:function(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255}},{key:"indexA",get:function(){return this._indexA},set:function(t){this._indexA=t,this._key_invalid=!0}},{key:"indexB",get:function(){return this._indexB},set:function(t){this._indexB=t,this._key_invalid=!0}},{key:"typeA",get:function(){return this._typeA},set:function(t){this._typeA=t,this._key_invalid=!0}},{key:"typeB",get:function(){return this._typeB},set:function(t){this._typeB=t,this._key_invalid=!0}}]),t}(),Ve=function(){function t(){Object(r["a"])(this,t),this.cf=new be}return Object(o["a"])(t,[{key:"Copy",value:function(t){return this.key=t.key,this}},{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"key",get:function(){return this.cf.key},set:function(t){this.cf.key=t}}]),t}(),ge=function(){function t(){Object(r["a"])(this,t),this.localPoint=new at,this.normalImpulse=0,this.tangentImpulse=0,this.id=new Ve}return Object(o["a"])(t,[{key:"Reset",value:function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}},{key:"Copy",value:function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(e){return X(e,(function(e){return new t}))}}]),t}();(function(t){t[t["e_unknown"]=-1]="e_unknown",t[t["e_circles"]=0]="e_circles",t[t["e_faceA"]=1]="e_faceA",t[t["e_faceB"]=2]="e_faceB"})(Ce||(Ce={}));var we,ke=function(){function t(){Object(r["a"])(this,t),this.points=ge.MakeArray(c),this.localNormal=new at,this.localPoint=new at,this.type=Ce.e_unknown,this.pointCount=0}return Object(o["a"])(t,[{key:"Reset",value:function(){for(var t=0;t<c;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=Ce.e_unknown,this.pointCount=0}},{key:"Copy",value:function(t){this.pointCount=t.pointCount;for(var e=0;e<c;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}},{key:"Clone",value:function(){return(new t).Copy(this)}}]),t}(),Me=function(){function t(){Object(r["a"])(this,t),this.normal=new at,this.points=at.MakeArray(c),this.separations=W(c)}return Object(o["a"])(t,[{key:"Initialize",value:function(e,i,s,n,a){if(0!==e.pointCount)switch(e.type){case Ce.e_circles:this.normal.Set(1,0);var r=Yt.MulXV(i,e.localPoint,t.Initialize_s_pointA),o=Yt.MulXV(n,e.points[0].localPoint,t.Initialize_s_pointB);at.DistanceSquaredVV(r,o)>_&&at.SubVV(o,r,this.normal).SelfNormalize();var l=at.AddVMulSV(r,s,this.normal,t.Initialize_s_cA),u=at.SubVMulSV(o,a,this.normal,t.Initialize_s_cB);at.MidVV(l,u,this.points[0]),this.separations[0]=at.DotVV(at.SubVV(u,l,at.s_t0),this.normal);break;case Ce.e_faceA:Xt.MulRV(i.q,e.localNormal,this.normal);for(var m=Yt.MulXV(i,e.localPoint,t.Initialize_s_planePoint),h=0;h<e.pointCount;++h){var c=Yt.MulXV(n,e.points[h].localPoint,t.Initialize_s_clipPoint),f=s-at.DotVV(at.SubVV(c,m,at.s_t0),this.normal),d=at.AddVMulSV(c,f,this.normal,t.Initialize_s_cA),v=at.SubVMulSV(c,a,this.normal,t.Initialize_s_cB);at.MidVV(d,v,this.points[h]),this.separations[h]=at.DotVV(at.SubVV(v,d,at.s_t0),this.normal)}break;case Ce.e_faceB:Xt.MulRV(n.q,e.localNormal,this.normal);for(var y=Yt.MulXV(n,e.localPoint,t.Initialize_s_planePoint),p=0;p<e.pointCount;++p){var x=Yt.MulXV(i,e.points[p].localPoint,t.Initialize_s_clipPoint),B=a-at.DotVV(at.SubVV(x,y,at.s_t0),this.normal),S=at.AddVMulSV(x,B,this.normal,t.Initialize_s_cB),A=at.SubVMulSV(x,s,this.normal,t.Initialize_s_cA);at.MidVV(A,S,this.points[p]),this.separations[p]=at.DotVV(at.SubVV(A,S,at.s_t0),this.normal)}this.normal.SelfNeg();break}}}]),t}();Me.Initialize_s_pointA=new at,Me.Initialize_s_pointB=new at,Me.Initialize_s_cA=new at,Me.Initialize_s_cB=new at,Me.Initialize_s_planePoint=new at,Me.Initialize_s_clipPoint=new at,function(t){t[t["b2_nullState"]=0]="b2_nullState",t[t["b2_addState"]=1]="b2_addState",t[t["b2_persistState"]=2]="b2_persistState",t[t["b2_removeState"]=3]="b2_removeState"}(we||(we={}));var Ie=function(){function t(){Object(r["a"])(this,t),this.v=new at,this.id=new Ve}return Object(o["a"])(t,[{key:"Copy",value:function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(e){return X(e,(function(e){return new t}))}}]),t}(),Pe=function(){function t(){Object(r["a"])(this,t),this.p1=new at,this.p2=new at,this.maxFraction=1}return Object(o["a"])(t,[{key:"Copy",value:function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}}]),t}(),Ge=function(){function t(){Object(r["a"])(this,t),this.normal=new at,this.fraction=0}return Object(o["a"])(t,[{key:"Copy",value:function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}}]),t}(),De=function(){function t(){Object(r["a"])(this,t),this.lowerBound=new at,this.upperBound=new at,this.m_cache_center=new at,this.m_cache_extent=new at}return Object(o["a"])(t,[{key:"Copy",value:function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}},{key:"IsValid",value:function(){var t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y,i=t>=0&&e>=0;return i=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid(),i}},{key:"GetCenter",value:function(){return at.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)}},{key:"GetExtents",value:function(){return at.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)}},{key:"GetPerimeter",value:function(){var t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y;return 2*(t+e)}},{key:"Combine1",value:function(t){return this.lowerBound.x=Y(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Y(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=K(this.upperBound.x,t.upperBound.x),this.upperBound.y=K(this.upperBound.y,t.upperBound.y),this}},{key:"Combine2",value:function(t,e){return this.lowerBound.x=Y(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=Y(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=K(t.upperBound.x,e.upperBound.x),this.upperBound.y=K(t.upperBound.y,e.upperBound.y),this}},{key:"Contains",value:function(t){var e=!0;return e=e&&this.lowerBound.x<=t.lowerBound.x,e=e&&this.lowerBound.y<=t.lowerBound.y,e=e&&t.upperBound.x<=this.upperBound.x,e=e&&t.upperBound.y<=this.upperBound.y,e}},{key:"RayCast",value:function(t,e){var i=-u,s=u,n=e.p1.x,a=e.p1.y,r=e.p2.x-e.p1.x,o=e.p2.y-e.p1.y,l=H(r),_=H(o),h=t.normal;if(l<m){if(n<this.lowerBound.x||this.upperBound.x<n)return!1}else{var c=1/r,f=(this.lowerBound.x-n)*c,d=(this.upperBound.x-n)*c,v=-1;if(f>d){var y=f;f=d,d=y,v=1}if(f>i&&(h.x=v,h.y=0,i=f),s=Y(s,d),i>s)return!1}if(_<m){if(a<this.lowerBound.y||this.upperBound.y<a)return!1}else{var p=1/o,x=(this.lowerBound.y-a)*p,B=(this.upperBound.y-a)*p,S=-1;if(x>B){var A=x;x=B,B=A,S=1}if(x>i&&(h.x=0,h.y=S,i=x),s=Y(s,B),i>s)return!1}return!(i<0||e.maxFraction<i)&&(t.fraction=i,!0)}},{key:"TestOverlap",value:function(t){var e=t.lowerBound.x-this.upperBound.x,i=t.lowerBound.y-this.upperBound.y,s=this.lowerBound.x-t.upperBound.x,n=this.lowerBound.y-t.upperBound.y;return!(e>0||i>0)&&!(s>0||n>0)}}],[{key:"Combine",value:function(t,e,i){return i.Combine2(t,e),i}}]),t}();function je(t,e){var i=e.lowerBound.x-t.upperBound.x,s=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.x-e.upperBound.x,a=t.lowerBound.y-e.upperBound.y;return!(i>0||s>0)&&!(n>0||a>0)}function Oe(t,e,i,s,n){var a=0,r=e[0],o=e[1],l=at.DotVV(i,r.v)-s,u=at.DotVV(i,o.v)-s;if(l<=0&&t[a++].Copy(r),u<=0&&t[a++].Copy(o),l*u<0){var m=l/(l-u),_=t[a].v;_.x=r.v.x+m*(o.v.x-r.v.x),_.y=r.v.y+m*(o.v.y-r.v.y);var h=t[a].id;h.cf.indexA=n,h.cf.indexB=r.id.cf.indexB,h.cf.typeA=ce.e_vertex,h.cf.typeB=ce.e_face,++a}return a}var Fe=new le,Le=new oe,Re=new ue;function Te(t,e,i,s,n,a){var r=Fe.Reset();r.proxyA.SetShape(t,e),r.proxyB.SetShape(i,s),r.transformA.Copy(n),r.transformB.Copy(a),r.useRadii=!0;var o=Le.Reset();o.count=0;var l=Re.Reset();return Ae(l,o,r),l.distance<10*m}var qe=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(r["a"])(this,t),this.m_id=0,this.aabb=new De,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.m_id=e}return Object(o["a"])(t,[{key:"IsLeaf",value:function(){return null===this.child1}}]),t}(),ze=function(){function t(){Object(r["a"])(this,t),this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0}return Object(o["a"])(t,[{key:"GetUserData",value:function(t){return t.userData}},{key:"GetFatAABB",value:function(t){return t.aabb}},{key:"Query",value:function(e,i){if(null!==this.m_root){var s=t.s_stack.Reset();s.Push(this.m_root);while(s.GetCount()>0){var n=s.Pop();if(null!==n&&n.aabb.TestOverlap(i))if(n.IsLeaf()){var a=e(n);if(!a)return}else s.Push(n.child1),s.Push(n.child2)}}}},{key:"RayCast",value:function(e,i){if(null!==this.m_root){var s=i.p1,n=i.p2,a=at.SubVV(n,s,t.s_r);a.Normalize();var r=at.CrossOneV(a,t.s_v),o=at.AbsV(r,t.s_abs_v),l=i.maxFraction,u=t.s_segmentAABB,m=s.x+l*(n.x-s.x),_=s.y+l*(n.y-s.y);u.lowerBound.x=Y(s.x,m),u.lowerBound.y=Y(s.y,_),u.upperBound.x=K(s.x,m),u.upperBound.y=K(s.y,_);var h=t.s_stack.Reset();h.Push(this.m_root);while(h.GetCount()>0){var c=h.Pop();if(null!==c&&je(c.aabb,u)){var f=c.aabb.GetCenter(),d=c.aabb.GetExtents(),v=H(at.DotVV(r,at.SubVV(s,f,at.s_t0)))-at.DotVV(o,d);if(!(v>0))if(c.IsLeaf()){var y=t.s_subInput;y.p1.Copy(i.p1),y.p2.Copy(i.p2),y.maxFraction=l;var p=e(y,c);if(0===p)return;p>0&&(l=p,m=s.x+l*(n.x-s.x),_=s.y+l*(n.y-s.y),u.lowerBound.x=Y(s.x,m),u.lowerBound.y=Y(s.y,_),u.upperBound.x=K(s.x,m),u.upperBound.y=K(s.y,_))}else h.Push(c.child1),h.Push(c.child2)}}}}},{key:"AllocateNode",value:function(){if(this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e.height=0,e.userData=null,e}return new qe(t.s_node_id++)}},{key:"FreeNode",value:function(t){t.parent=this.m_freeList,t.height=-1,this.m_freeList=t}},{key:"CreateProxy",value:function(t,e){var i=this.AllocateNode(),s=d,n=d;return i.aabb.lowerBound.x=t.lowerBound.x-s,i.aabb.lowerBound.y=t.lowerBound.y-n,i.aabb.upperBound.x=t.upperBound.x+s,i.aabb.upperBound.y=t.upperBound.y+n,i.userData=e,i.height=0,this.InsertLeaf(i),i}},{key:"DestroyProxy",value:function(t){this.RemoveLeaf(t),this.FreeNode(t)}},{key:"MoveProxy",value:function(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var s=d+v*(i.x>0?i.x:-i.x),n=d+v*(i.y>0?i.y:-i.y);return t.aabb.lowerBound.x=e.lowerBound.x-s,t.aabb.lowerBound.y=e.lowerBound.y-n,t.aabb.upperBound.x=e.upperBound.x+s,t.aabb.upperBound.y=e.upperBound.y+n,this.InsertLeaf(t),!0}},{key:"InsertLeaf",value:function(e){if(++this.m_insertionCount,null===this.m_root)return this.m_root=e,void(this.m_root.parent=null);var i,s,n=e.aabb,a=this.m_root;while(!a.IsLeaf()){i=a.child1,s=a.child2;var r=a.aabb.GetPerimeter(),o=t.s_combinedAABB;o.Combine2(a.aabb,n);var l=o.GetPerimeter(),u=2*l,m=2*(l-r),_=void 0,h=t.s_aabb,c=void 0,f=void 0;i.IsLeaf()?(h.Combine2(n,i.aabb),_=h.GetPerimeter()+m):(h.Combine2(n,i.aabb),c=i.aabb.GetPerimeter(),f=h.GetPerimeter(),_=f-c+m);var d=void 0;if(s.IsLeaf()?(h.Combine2(n,s.aabb),d=h.GetPerimeter()+m):(h.Combine2(n,s.aabb),c=s.aabb.GetPerimeter(),f=h.GetPerimeter(),d=f-c+m),u<_&&u<d)break;a=_<d?i:s}var v=a,y=v.parent,p=this.AllocateNode();p.parent=y,p.userData=null,p.aabb.Combine2(n,v.aabb),p.height=v.height+1,y?(y.child1===v?y.child1=p:y.child2=p,p.child1=v,p.child2=e,v.parent=p,e.parent=p):(p.child1=v,p.child2=e,v.parent=p,e.parent=p,this.m_root=p),a=e.parent;while(null!==a)a=this.Balance(a),i=a.child1,s=a.child2,a.height=1+K(i.height,s.height),a.aabb.Combine2(i.aabb,s.aabb),a=a.parent}},{key:"RemoveLeaf",value:function(t){if(t!==this.m_root){var e,i=t.parent,s=i.parent;if(e=i.child1===t?i.child2:i.child1,s){s.child1===i?s.child1=e:s.child2=e,e.parent=s,this.FreeNode(i);var n=s;while(n){n=this.Balance(n);var a=n.child1,r=n.child2;n.aabb.Combine2(a.aabb,r.aabb),n.height=1+K(a.height,r.height),n=n.parent}}else this.m_root=e,e.parent=null,this.FreeNode(i)}else this.m_root=null}},{key:"Balance",value:function(t){if(t.IsLeaf()||t.height<2)return t;var e=t.child1,i=t.child2,s=i.height-e.height;if(s>1){var n=i.child1,a=i.child2;return i.child1=t,i.parent=t.parent,t.parent=i,null!==i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,n.height>a.height?(i.child2=n,t.child2=a,a.parent=t,t.aabb.Combine2(e.aabb,a.aabb),i.aabb.Combine2(t.aabb,n.aabb),t.height=1+K(e.height,a.height),i.height=1+K(t.height,n.height)):(i.child2=a,t.child2=n,n.parent=t,t.aabb.Combine2(e.aabb,n.aabb),i.aabb.Combine2(t.aabb,a.aabb),t.height=1+K(e.height,n.height),i.height=1+K(t.height,a.height)),i}if(s<-1){var r=e.child1,o=e.child2;return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,r.height>o.height?(e.child2=r,t.child1=o,o.parent=t,t.aabb.Combine2(i.aabb,o.aabb),e.aabb.Combine2(t.aabb,r.aabb),t.height=1+K(i.height,o.height),e.height=1+K(t.height,r.height)):(e.child2=o,t.child1=r,r.parent=t,t.aabb.Combine2(i.aabb,r.aabb),e.aabb.Combine2(t.aabb,o.aabb),t.height=1+K(i.height,r.height),e.height=1+K(t.height,o.height)),e}return t}},{key:"GetHeight",value:function(){return null===this.m_root?0:this.m_root.height}},{key:"GetAreaRatio",value:function(){if(null===this.m_root)return 0;var e=this.m_root,i=e.aabb.GetPerimeter(),s=t.GetAreaNode(this.m_root);return s/i}},{key:"ComputeHeightNode",value:function(t){if(t.IsLeaf())return 0;var e=this.ComputeHeightNode(t.child1),i=this.ComputeHeightNode(t.child2);return 1+K(e,i)}},{key:"ComputeHeight",value:function(){var t=this.ComputeHeightNode(this.m_root);return t}},{key:"ValidateStructure",value:function(t){if(null!==t){this.m_root;var e=t,i=e.child1,s=e.child2;e.IsLeaf()||(this.ValidateStructure(i),this.ValidateStructure(s))}}},{key:"ValidateMetrics",value:function(e){if(null!==e){var i=e,s=i.child1,n=i.child2;if(!i.IsLeaf()){var a=t.s_aabb;a.Combine2(s.aabb,n.aabb),this.ValidateMetrics(s),this.ValidateMetrics(n)}}}},{key:"Validate",value:function(){this.ValidateStructure(this.m_root),this.ValidateMetrics(this.m_root);var t=this.m_freeList;while(null!==t)t=t.parent}},{key:"GetMaxBalance",value:function(){var e=t.GetMaxBalanceNode(this.m_root,0);return e}},{key:"RebuildBottomUp",value:function(){this.Validate()}},{key:"ShiftOrigin",value:function(e){t.ShiftOriginNode(this.m_root,e)}}],[{key:"GetAreaNode",value:function(e){if(null===e)return 0;if(e.IsLeaf())return 0;var i=e.aabb.GetPerimeter();return i+=t.GetAreaNode(e.child1),i+=t.GetAreaNode(e.child2),i}},{key:"GetMaxBalanceNode",value:function(t,e){if(null===t)return e;if(t.height<=1)return e;var i=t.child1,s=t.child2,n=H(s.height-i.height);return K(e,n)}},{key:"ShiftOriginNode",value:function(e,i){if(null!==e&&!(e.height<=1)){var s=e.child1,n=e.child2;t.ShiftOriginNode(s,i),t.ShiftOriginNode(n,i),e.aabb.lowerBound.SelfSub(i),e.aabb.upperBound.SelfSub(i)}}}]),t}();ze.s_stack=new ae(256),ze.s_r=new at,ze.s_v=new at,ze.s_abs_v=new at,ze.s_segmentAABB=new De,ze.s_subInput=new Pe,ze.s_combinedAABB=new De,ze.s_aabb=new De,ze.s_node_id=0;var Ne=function t(){Object(r["a"])(this,t),this.proxyA=null,this.proxyB=null},Ee=function(){function t(){Object(r["a"])(this,t),this.m_tree=new ze,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}return Object(o["a"])(t,[{key:"CreateProxy",value:function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i}},{key:"DestroyProxy",value:function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}},{key:"MoveProxy",value:function(t,e,i){var s=this.m_tree.MoveProxy(t,e,i);s&&this.BufferMove(t)}},{key:"TouchProxy",value:function(t){this.BufferMove(t)}},{key:"GetFatAABB",value:function(t){return this.m_tree.GetFatAABB(t)}},{key:"GetUserData",value:function(t){return this.m_tree.GetUserData(t)}},{key:"TestOverlap",value:function(t,e){var i=this.m_tree.GetFatAABB(t),s=this.m_tree.GetFatAABB(e);return je(i,s)}},{key:"GetProxyCount",value:function(){return this.m_proxyCount}},{key:"UpdatePairs",value:function(t){var e=this;this.m_pairCount=0;for(var i=function(t){var i=e.m_moveBuffer[t];if(null===i)return"continue";var s=e;function n(t){if(t.m_id===i.m_id)return!0;s.m_pairCount===s.m_pairBuffer.length&&(s.m_pairBuffer[s.m_pairCount]=new Ne);var e=s.m_pairBuffer[s.m_pairCount];return t.m_id<i.m_id?(e.proxyA=t,e.proxyB=i):(e.proxyA=i,e.proxyB=t),++s.m_pairCount,!0}var a=e.m_tree.GetFatAABB(i);e.m_tree.Query(n,a)},s=0;s<this.m_moveCount;++s)i(s);this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(Je);var n=0;while(n<this.m_pairCount){var a=this.m_pairBuffer[n],r=this.m_tree.GetUserData(a.proxyA),o=this.m_tree.GetUserData(a.proxyB);t.AddPair(r,o),++n;while(n<this.m_pairCount){var l=this.m_pairBuffer[n];if(l.proxyA.m_id!==a.proxyA.m_id||l.proxyB.m_id!==a.proxyB.m_id)break;++n}}}},{key:"Query",value:function(t,e){this.m_tree.Query(t,e)}},{key:"RayCast",value:function(t,e){this.m_tree.RayCast(t,e)}},{key:"GetTreeHeight",value:function(){return this.m_tree.GetHeight()}},{key:"GetTreeBalance",value:function(){return this.m_tree.GetMaxBalance()}},{key:"GetTreeQuality",value:function(){return this.m_tree.GetAreaRatio()}},{key:"ShiftOrigin",value:function(t){this.m_tree.ShiftOrigin(t)}},{key:"BufferMove",value:function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}},{key:"UnBufferMove",value:function(t){var e=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[e]=null}}]),t}();function Je(t,e){return t.proxyA.m_id===e.proxyA.m_id?t.proxyB.m_id-e.proxyB.m_id:t.proxyA.m_id-e.proxyA.m_id}var Xe,Ue=0,We=0,Ze=0,He=new Yt,Ye=new Yt,Ke=new at,Qe=new at,$e=new at,ti=new at,ei=new at,ii=function t(){Object(r["a"])(this,t),this.proxyA=new re,this.proxyB=new re,this.sweepA=new ie,this.sweepB=new ie,this.tMax=0};(function(t){t[t["e_unknown"]=0]="e_unknown",t[t["e_failed"]=1]="e_failed",t[t["e_overlapped"]=2]="e_overlapped",t[t["e_touching"]=3]="e_touching",t[t["e_separated"]=4]="e_separated"})(Xe||(Xe={}));var si,ni=function t(){Object(r["a"])(this,t),this.state=Xe.e_unknown,this.t=0};(function(t){t[t["e_unknown"]=-1]="e_unknown",t[t["e_points"]=0]="e_points",t[t["e_faceA"]=1]="e_faceA",t[t["e_faceB"]=2]="e_faceB"})(si||(si={}));var ai=function(){function t(){Object(r["a"])(this,t),this.m_sweepA=new ie,this.m_sweepB=new ie,this.m_type=si.e_unknown,this.m_localPoint=new at,this.m_axis=new at}return Object(o["a"])(t,[{key:"Initialize",value:function(t,e,i,s,n,a){this.m_proxyA=e,this.m_proxyB=s;var r=t.count;this.m_sweepA.Copy(i),this.m_sweepB.Copy(n);var o=He,l=Ye;if(this.m_sweepA.GetTransform(o,a),this.m_sweepB.GetTransform(l,a),1===r){this.m_type=si.e_points;var u=this.m_proxyA.GetVertex(t.indexA[0]),m=this.m_proxyB.GetVertex(t.indexB[0]),_=Yt.MulXV(o,u,Ke),h=Yt.MulXV(l,m,Qe);at.SubVV(h,_,this.m_axis);var c=this.m_axis.Normalize();return this.m_localPoint.SetZero(),c}if(t.indexA[0]===t.indexA[1]){this.m_type=si.e_faceB;var f=this.m_proxyB.GetVertex(t.indexB[0]),d=this.m_proxyB.GetVertex(t.indexB[1]);at.CrossVOne(at.SubVV(d,f,at.s_t0),this.m_axis).SelfNormalize();var v=Xt.MulRV(l.q,this.m_axis,$e);at.MidVV(f,d,this.m_localPoint);var y=Yt.MulXV(l,this.m_localPoint,Qe),p=this.m_proxyA.GetVertex(t.indexA[0]),x=Yt.MulXV(o,p,Ke),B=at.DotVV(at.SubVV(x,y,at.s_t0),v);return B<0&&(this.m_axis.SelfNeg(),B=-B),B}this.m_type=si.e_faceA;var S=this.m_proxyA.GetVertex(t.indexA[0]),A=this.m_proxyA.GetVertex(t.indexA[1]);at.CrossVOne(at.SubVV(A,S,at.s_t0),this.m_axis).SelfNormalize();var C=Xt.MulRV(o.q,this.m_axis,$e);at.MidVV(S,A,this.m_localPoint);var b=Yt.MulXV(o,this.m_localPoint,Ke),V=this.m_proxyB.GetVertex(t.indexB[0]),g=Yt.MulXV(l,V,Qe),w=at.DotVV(at.SubVV(g,b,at.s_t0),C);return w<0&&(this.m_axis.SelfNeg(),w=-w),w}},{key:"FindMinSeparation",value:function(t,e,i){var s=He,n=Ye;switch(this.m_sweepA.GetTransform(s,i),this.m_sweepB.GetTransform(n,i),this.m_type){case si.e_points:var a=Xt.MulTRV(s.q,this.m_axis,ti),r=Xt.MulTRV(n.q,at.NegV(this.m_axis,at.s_t0),ei);t[0]=this.m_proxyA.GetSupport(a),e[0]=this.m_proxyB.GetSupport(r);var o=this.m_proxyA.GetVertex(t[0]),l=this.m_proxyB.GetVertex(e[0]),u=Yt.MulXV(s,o,Ke),m=Yt.MulXV(n,l,Qe),_=at.DotVV(at.SubVV(m,u,at.s_t0),this.m_axis);return _;case si.e_faceA:var h=Xt.MulRV(s.q,this.m_axis,$e),c=Yt.MulXV(s,this.m_localPoint,Ke),f=Xt.MulTRV(n.q,at.NegV(h,at.s_t0),ei);t[0]=-1,e[0]=this.m_proxyB.GetSupport(f);var d=this.m_proxyB.GetVertex(e[0]),v=Yt.MulXV(n,d,Qe),y=at.DotVV(at.SubVV(v,c,at.s_t0),h);return y;case si.e_faceB:var p=Xt.MulRV(n.q,this.m_axis,$e),x=Yt.MulXV(n,this.m_localPoint,Qe),B=Xt.MulTRV(s.q,at.NegV(p,at.s_t0),ti);e[0]=-1,t[0]=this.m_proxyA.GetSupport(B);var S=this.m_proxyA.GetVertex(t[0]),A=Yt.MulXV(s,S,Ke),C=at.DotVV(at.SubVV(A,x,at.s_t0),p);return C;default:return t[0]=-1,e[0]=-1,0}}},{key:"Evaluate",value:function(t,e,i){var s=He,n=Ye;switch(this.m_sweepA.GetTransform(s,i),this.m_sweepB.GetTransform(n,i),this.m_type){case si.e_points:var a=this.m_proxyA.GetVertex(t),r=this.m_proxyB.GetVertex(e),o=Yt.MulXV(s,a,Ke),l=Yt.MulXV(n,r,Qe),u=at.DotVV(at.SubVV(l,o,at.s_t0),this.m_axis);return u;case si.e_faceA:var m=Xt.MulRV(s.q,this.m_axis,$e),_=Yt.MulXV(s,this.m_localPoint,Ke),h=this.m_proxyB.GetVertex(e),c=Yt.MulXV(n,h,Qe),f=at.DotVV(at.SubVV(c,_,at.s_t0),m);return f;case si.e_faceB:var d=Xt.MulRV(n.q,this.m_axis,$e),v=Yt.MulXV(n,this.m_localPoint,Qe),y=this.m_proxyA.GetVertex(t),p=Yt.MulXV(s,y,Ke),x=at.DotVV(at.SubVV(p,v,at.s_t0),d);return x;default:return 0}}}]),t}(),ri=new ne,oi=new oe,li=new le,ui=new ue,mi=new ai,_i=[0],hi=[0],ci=new ie,fi=new ie;function di(t,e){var i=ri.Reset();t.state=Xe.e_unknown,t.t=e.tMax;var s=e.proxyA,n=e.proxyB,a=ci.Copy(e.sweepA),r=fi.Copy(e.sweepB);a.Normalize(),r.Normalize();var o=e.tMax,l=s.m_radius+n.m_radius,u=K(y,l-3*y),m=.25*y,_=0,h=20,c=0,d=oi;d.count=0;var v=li;for(v.proxyA=e.proxyA,v.proxyB=e.proxyB,v.useRadii=!1;;){var p=He,x=Ye;a.GetTransform(p,_),r.GetTransform(x,_),v.transformA.Copy(p),v.transformB.Copy(x);var B=ui;if(Ae(B,d,v),B.distance<=0){t.state=Xe.e_overlapped,t.t=0;break}if(B.distance<u+m){t.state=Xe.e_touching,t.t=_;break}var S=mi;S.Initialize(d,s,a,n,r,_);for(var A=!1,C=o,b=0;;){var V=_i,g=hi,w=S.FindMinSeparation(V,g,C);if(w>u+m){t.state=Xe.e_separated,t.t=o,A=!0;break}if(w>u-m){_=C;break}var k=S.Evaluate(V[0],g[0],_);if(k<u-m){t.state=Xe.e_failed,t.t=_,A=!0;break}if(k<=u+m){t.state=Xe.e_touching,t.t=_,A=!0;break}for(var M=0,I=_,P=C;;){var G=0;G=1&M?I+(u-k)*(P-I)/(w-k):.5*(I+P),++M;var D=S.Evaluate(V[0],g[0],G);if(H(D-u)<m){C=G;break}if(D>u?(I=G,k=D):(P=G,w=D),50===M)break}if(Ze=K(Ze,M),++b,b===f)break}if(++c,A)break;if(c===h){t.state=Xe.e_failed,t.t=_;break}}We=K(We,c);var j=i.GetMilliseconds();Ue=K(Ue,j),j}var vi=new at,yi=new at;function pi(t,e,i,s,n){t.pointCount=0;var a=Yt.MulXV(i,e.m_p,vi),r=Yt.MulXV(n,s.m_p,yi),o=at.DistanceSquaredVV(a,r),l=e.m_radius+s.m_radius;o>l*l||(t.type=Ce.e_circles,t.localPoint.Copy(e.m_p),t.localNormal.SetZero(),t.pointCount=1,t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0)}var xi=new at,Bi=new at,Si=new at;function Ai(t,e,i,s,n){t.pointCount=0;for(var a=Yt.MulXV(n,s.m_p,xi),r=Yt.MulTXV(i,a,Bi),o=0,l=-u,_=e.m_radius+s.m_radius,h=e.m_count,c=e.m_vertices,f=e.m_normals,d=0;d<h;++d){var v=at.DotVV(f[d],at.SubVV(r,c[d],at.s_t0));if(v>_)return;v>l&&(l=v,o=d)}var y=o,p=(y+1)%h,x=c[y],B=c[p];if(l<m)return t.pointCount=1,t.type=Ce.e_faceA,t.localNormal.Copy(f[o]),at.MidVV(x,B,t.localPoint),t.points[0].localPoint.Copy(s.m_p),void(t.points[0].id.key=0);var S=at.DotVV(at.SubVV(r,x,at.s_t0),at.SubVV(B,x,at.s_t1)),A=at.DotVV(at.SubVV(r,B,at.s_t0),at.SubVV(x,B,at.s_t1));if(S<=0){if(at.DistanceSquaredVV(r,x)>_*_)return;t.pointCount=1,t.type=Ce.e_faceA,at.SubVV(r,x,t.localNormal).SelfNormalize(),t.localPoint.Copy(x),t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0}else if(A<=0){if(at.DistanceSquaredVV(r,B)>_*_)return;t.pointCount=1,t.type=Ce.e_faceA,at.SubVV(r,B,t.localNormal).SelfNormalize(),t.localPoint.Copy(B),t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0}else{var C=at.MidVV(x,B,Si);if(l=at.DotVV(at.SubVV(r,C,at.s_t1),f[y]),l>_)return;t.pointCount=1,t.type=Ce.e_faceA,t.localNormal.Copy(f[y]).SelfNormalize(),t.localPoint.Copy(C),t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0}}var Ci=new at,bi=new at,Vi=new at,gi=new at;function wi(t,e,i,s,n){for(var a=t.m_vertices,r=t.m_normals,o=s.m_count,l=s.m_vertices,m=Xt.MulRV(e.q,r[i],Ci),_=Xt.MulTRV(n.q,m,bi),h=0,c=u,f=0;f<o;++f){var d=at.DotVV(l[f],_);d<c&&(c=d,h=f)}var v=Yt.MulXV(e,a[i],Vi),y=Yt.MulXV(n,l[h],gi),p=at.DotVV(at.SubVV(y,v,at.s_t0),m);return p}var ki=new at,Mi=new at;function Ii(t,e,i,s,n){for(var a=e.m_count,r=e.m_normals,o=at.SubVV(Yt.MulXV(n,s.m_centroid,at.s_t0),Yt.MulXV(i,e.m_centroid,at.s_t1),ki),l=Xt.MulTRV(i.q,o,Mi),m=0,_=-u,h=0;h<a;++h){var c=at.DotVV(r[h],l);c>_&&(_=c,m=h)}var f=wi(e,i,m,s,n),d=(m+a-1)%a,v=wi(e,i,d,s,n),y=(m+1)%a,p=wi(e,i,y,s,n),x=0,B=0,S=0;if(v>f&&v>p)S=-1,x=d,B=v;else{if(!(p>f))return t[0]=m,f;S=1,x=y,B=p}while(1){if(m=-1===S?(x+a-1)%a:(x+1)%a,f=wi(e,i,m,s,n),!(f>B))break;x=m,B=f}return t[0]=x,B}var Pi=new at;function Gi(t,e,i,s,n,a){for(var r=e.m_normals,o=n.m_count,l=n.m_vertices,m=n.m_normals,_=Xt.MulTRV(a.q,Xt.MulRV(i.q,r[s],at.s_t0),Pi),h=0,c=u,f=0;f<o;++f){var d=at.DotVV(_,m[f]);d<c&&(c=d,h=f)}var v=h,y=(v+1)%o,p=t[0];Yt.MulXV(a,l[v],p.v);var x=p.id.cf;x.indexA=s,x.indexB=v,x.typeA=ce.e_face,x.typeB=ce.e_vertex;var B=t[1];Yt.MulXV(a,l[y],B.v);var S=B.id.cf;S.indexA=s,S.indexB=y,S.typeA=ce.e_face,S.typeB=ce.e_vertex}var Di=Ie.MakeArray(2),ji=Ie.MakeArray(2),Oi=Ie.MakeArray(2),Fi=[0],Li=[0],Ri=new at,Ti=new at,qi=new at,zi=new at,Ni=new at,Ei=new at,Ji=new at,Xi=new at;function Ui(t,e,i,s,n){t.pointCount=0;var a=e.m_radius+s.m_radius,r=Fi;r[0]=0;var o=Ii(r,e,i,s,n);if(!(o>a)){var l=Li;l[0]=0;var u=Ii(l,s,n,e,i);if(!(u>a)){var m,_,h,f,d=0,v=0,y=.98,p=.001;u>y*o+p?(m=s,_=e,h=n,f=i,d=l[0],t.type=Ce.e_faceB,v=1):(m=e,_=s,h=i,f=n,d=r[0],t.type=Ce.e_faceA,v=0);var x=Di;Gi(x,m,h,d,_,f);var B=m.m_count,S=m.m_vertices,A=d,C=(d+1)%B,b=S[A],V=S[C],g=at.SubVV(V,b,Ri);g.Normalize();var w,k=at.CrossVOne(g,Ti),M=at.MidVV(b,V,qi),I=Xt.MulRV(h.q,g,Ni),P=at.CrossVOne(I,zi),G=Yt.MulXV(h,b,Ji),D=Yt.MulXV(h,V,Xi),j=at.DotVV(P,G),O=-at.DotVV(I,G)+a,F=at.DotVV(I,D)+a,L=ji,R=Oi,T=at.NegV(I,Ei);if(w=Oe(L,x,T,O,A),!(w<2)&&(w=Oe(R,L,I,F,C),!(w<2))){t.localNormal.Copy(k),t.localPoint.Copy(M);for(var q=0,z=0;z<c;++z){var N=R[z],E=at.DotVV(P,N.v)-j;if(E<=a){var J=t.points[q];if(Yt.MulTXV(f,N.v,J.localPoint),J.id.Copy(N.id),v){var X=J.id.cf;J.id.cf.indexA=X.indexB,J.id.cf.indexB=X.indexA,J.id.cf.typeA=X.typeB,J.id.cf.typeB=X.typeA}++q}}t.pointCount=q}}}}var Wi,Zi=new at,Hi=new at,Yi=new at,Ki=new at,Qi=new at,$i=new at,ts=new at,es=new Ve;function is(t,e,i,s,n){t.pointCount=0;var a=Yt.MulTXV(i,Yt.MulXV(n,s.m_p,at.s_t0),Zi),r=e.m_vertex1,o=e.m_vertex2,l=at.SubVV(o,r,Hi),u=at.DotVV(l,at.SubVV(o,a,at.s_t0)),m=at.DotVV(l,at.SubVV(a,r,at.s_t0)),_=e.m_radius+s.m_radius,h=es;if(h.cf.indexB=0,h.cf.typeB=ce.e_vertex,m<=0){var c=r,f=at.SubVV(a,c,Yi),d=at.DotVV(f,f);if(d>_*_)return;if(e.m_hasVertex0){var v=e.m_vertex0,y=r,p=at.SubVV(y,v,Ki),x=at.DotVV(p,at.SubVV(y,a,at.s_t0));if(x>0)return}return h.cf.indexA=0,h.cf.typeA=ce.e_vertex,t.pointCount=1,t.type=Ce.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(c),t.points[0].id.Copy(h),void t.points[0].localPoint.Copy(s.m_p)}if(u<=0){var B=o,S=at.SubVV(a,B,Yi),A=at.DotVV(S,S);if(A>_*_)return;if(e.m_hasVertex3){var C=e.m_vertex3,b=o,V=at.SubVV(C,b,Qi),g=at.DotVV(V,at.SubVV(a,b,at.s_t0));if(g>0)return}return h.cf.indexA=1,h.cf.typeA=ce.e_vertex,t.pointCount=1,t.type=Ce.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(B),t.points[0].id.Copy(h),void t.points[0].localPoint.Copy(s.m_p)}var w=at.DotVV(l,l),k=$i;k.x=1/w*(u*r.x+m*o.x),k.y=1/w*(u*r.y+m*o.y);var M=at.SubVV(a,k,Yi),I=at.DotVV(M,M);if(!(I>_*_)){var P=ts.Set(-l.y,l.x);at.DotVV(P,at.SubVV(a,r,at.s_t0))<0&&P.Set(-P.x,-P.y),P.Normalize(),h.cf.indexA=0,h.cf.typeA=ce.e_face,t.pointCount=1,t.type=Ce.e_faceA,t.localNormal.Copy(P),t.localPoint.Copy(r),t.points[0].id.Copy(h),t.points[0].localPoint.Copy(s.m_p)}}(function(t){t[t["e_unknown"]=0]="e_unknown",t[t["e_edgeA"]=1]="e_edgeA",t[t["e_edgeB"]=2]="e_edgeB"})(Wi||(Wi={}));var ss,ns=function t(){Object(r["a"])(this,t),this.type=Wi.e_unknown,this.index=0,this.separation=0},as=function t(){Object(r["a"])(this,t),this.vertices=at.MakeArray(f),this.normals=at.MakeArray(f),this.count=0},rs=function t(){Object(r["a"])(this,t),this.i1=0,this.i2=0,this.v1=new at,this.v2=new at,this.normal=new at,this.sideNormal1=new at,this.sideOffset1=0,this.sideNormal2=new at,this.sideOffset2=0};(function(t){t[t["e_isolated"]=0]="e_isolated",t[t["e_concave"]=1]="e_concave",t[t["e_convex"]=2]="e_convex"})(ss||(ss={}));var os=function(){function t(){Object(r["a"])(this,t),this.m_polygonB=new as,this.m_xf=new Yt,this.m_centroidB=new at,this.m_v0=new at,this.m_v1=new at,this.m_v2=new at,this.m_v3=new at,this.m_normal0=new at,this.m_normal1=new at,this.m_normal2=new at,this.m_normal=new at,this.m_type1=ss.e_isolated,this.m_type2=ss.e_isolated,this.m_lowerLimit=new at,this.m_upperLimit=new at,this.m_radius=0,this.m_front=!1}return Object(o["a"])(t,[{key:"Collide",value:function(e,i,s,n,a){Yt.MulTXX(s,a,this.m_xf),Yt.MulXV(this.m_xf,n.m_centroid,this.m_centroidB),this.m_v0.Copy(i.m_vertex0),this.m_v1.Copy(i.m_vertex1),this.m_v2.Copy(i.m_vertex2),this.m_v3.Copy(i.m_vertex3);var r=i.m_hasVertex0,o=i.m_hasVertex3,l=at.SubVV(this.m_v2,this.m_v1,t.s_edge1);l.Normalize(),this.m_normal1.Set(l.y,-l.x);var u=at.DotVV(this.m_normal1,at.SubVV(this.m_centroidB,this.m_v1,at.s_t0)),m=0,_=0,h=!1,f=!1;if(r){var d=at.SubVV(this.m_v1,this.m_v0,t.s_edge0);d.Normalize(),this.m_normal0.Set(d.y,-d.x),h=at.CrossVV(d,l)>=0,m=at.DotVV(this.m_normal0,at.SubVV(this.m_centroidB,this.m_v0,at.s_t0))}if(o){var v=at.SubVV(this.m_v3,this.m_v2,t.s_edge2);v.Normalize(),this.m_normal2.Set(v.y,-v.x),f=at.CrossVV(l,v)>0,_=at.DotVV(this.m_normal2,at.SubVV(this.m_centroidB,this.m_v2,at.s_t0))}r&&o?h&&f?(this.m_front=m>=0||u>=0||_>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):h?(this.m_front=m>=0||u>=0&&_>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):f?(this.m_front=_>=0||m>=0&&u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=m>=0&&u>=0&&_>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):r?h?(this.m_front=m>=0||u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=m>=0&&u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):o?f?(this.m_front=u>=0||_>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=u>=0&&_>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=n.m_count;for(var y=0;y<n.m_count;++y)Yt.MulXV(this.m_xf,n.m_vertices[y],this.m_polygonB.vertices[y]),Xt.MulRV(this.m_xf.q,n.m_normals[y],this.m_polygonB.normals[y]);this.m_radius=2*x,e.pointCount=0;var p=this.ComputeEdgeSeparation(t.s_edgeAxis);if(p.type!==Wi.e_unknown&&!(p.separation>this.m_radius)){var B=this.ComputePolygonSeparation(t.s_polygonAxis);if(!(B.type!==Wi.e_unknown&&B.separation>this.m_radius)){var S,A=.98,C=.001;S=B.type===Wi.e_unknown?p:B.separation>A*p.separation+C?B:p;var b=t.s_ie,V=t.s_rf;if(S.type===Wi.e_edgeA){e.type=Ce.e_faceA;for(var g=0,w=at.DotVV(this.m_normal,this.m_polygonB.normals[0]),k=1;k<this.m_polygonB.count;++k){var M=at.DotVV(this.m_normal,this.m_polygonB.normals[k]);M<w&&(w=M,g=k)}var I=g,P=(I+1)%this.m_polygonB.count,G=b[0];G.v.Copy(this.m_polygonB.vertices[I]),G.id.cf.indexA=0,G.id.cf.indexB=I,G.id.cf.typeA=ce.e_face,G.id.cf.typeB=ce.e_vertex;var D=b[1];D.v.Copy(this.m_polygonB.vertices[P]),D.id.cf.indexA=0,D.id.cf.indexB=P,D.id.cf.typeA=ce.e_face,D.id.cf.typeB=ce.e_vertex,this.m_front?(V.i1=0,V.i2=1,V.v1.Copy(this.m_v1),V.v2.Copy(this.m_v2),V.normal.Copy(this.m_normal1)):(V.i1=1,V.i2=0,V.v1.Copy(this.m_v2),V.v2.Copy(this.m_v1),V.normal.Copy(this.m_normal1).SelfNeg())}else{e.type=Ce.e_faceB;var j=b[0];j.v.Copy(this.m_v1),j.id.cf.indexA=0,j.id.cf.indexB=S.index,j.id.cf.typeA=ce.e_vertex,j.id.cf.typeB=ce.e_face;var O=b[1];O.v.Copy(this.m_v2),O.id.cf.indexA=0,O.id.cf.indexB=S.index,O.id.cf.typeA=ce.e_vertex,O.id.cf.typeB=ce.e_face,V.i1=S.index,V.i2=(V.i1+1)%this.m_polygonB.count,V.v1.Copy(this.m_polygonB.vertices[V.i1]),V.v2.Copy(this.m_polygonB.vertices[V.i2]),V.normal.Copy(this.m_polygonB.normals[V.i1])}V.sideNormal1.Set(V.normal.y,-V.normal.x),V.sideNormal2.Copy(V.sideNormal1).SelfNeg(),V.sideOffset1=at.DotVV(V.sideNormal1,V.v1),V.sideOffset2=at.DotVV(V.sideNormal2,V.v2);var F=t.s_clipPoints1,L=t.s_clipPoints2,R=0;if(R=Oe(F,b,V.sideNormal1,V.sideOffset1,V.i1),!(R<c)&&(R=Oe(L,F,V.sideNormal2,V.sideOffset2,V.i2),!(R<c))){S.type===Wi.e_edgeA?(e.localNormal.Copy(V.normal),e.localPoint.Copy(V.v1)):(e.localNormal.Copy(n.m_normals[V.i1]),e.localPoint.Copy(n.m_vertices[V.i1]));for(var T=0,q=0;q<c;++q){var z=void 0;if(z=at.DotVV(V.normal,at.SubVV(L[q].v,V.v1,at.s_t0)),z<=this.m_radius){var N=e.points[T];S.type===Wi.e_edgeA?(Yt.MulTXV(this.m_xf,L[q].v,N.localPoint),N.id=L[q].id):(N.localPoint.Copy(L[q].v),N.id.cf.typeA=L[q].id.cf.typeB,N.id.cf.typeB=L[q].id.cf.typeA,N.id.cf.indexA=L[q].id.cf.indexB,N.id.cf.indexB=L[q].id.cf.indexA),++T}}e.pointCount=T}}}}},{key:"ComputeEdgeSeparation",value:function(t){var e=t;e.type=Wi.e_edgeA,e.index=this.m_front?0:1,e.separation=u;for(var i=0;i<this.m_polygonB.count;++i){var s=at.DotVV(this.m_normal,at.SubVV(this.m_polygonB.vertices[i],this.m_v1,at.s_t0));s<e.separation&&(e.separation=s)}return e}},{key:"ComputePolygonSeparation",value:function(e){var i=e;i.type=Wi.e_unknown,i.index=-1,i.separation=-u;for(var s=t.s_perp.Set(-this.m_normal.y,this.m_normal.x),n=0;n<this.m_polygonB.count;++n){var a=at.NegV(this.m_polygonB.normals[n],t.s_n),r=at.DotVV(a,at.SubVV(this.m_polygonB.vertices[n],this.m_v1,at.s_t0)),o=at.DotVV(a,at.SubVV(this.m_polygonB.vertices[n],this.m_v2,at.s_t0)),l=Y(r,o);if(l>this.m_radius)return i.type=Wi.e_edgeB,i.index=n,i.separation=l,i;if(at.DotVV(a,s)>=0){if(at.DotVV(at.SubVV(a,this.m_upperLimit,at.s_t0),this.m_normal)<-p)continue}else if(at.DotVV(at.SubVV(a,this.m_lowerLimit,at.s_t0),this.m_normal)<-p)continue;l>i.separation&&(i.type=Wi.e_edgeB,i.index=n,i.separation=l)}return i}}]),t}();os.s_edge1=new at,os.s_edge0=new at,os.s_edge2=new at,os.s_ie=Ie.MakeArray(2),os.s_rf=new rs,os.s_clipPoints1=Ie.MakeArray(2),os.s_clipPoints2=Ie.MakeArray(2),os.s_edgeAxis=new ns,os.s_polygonAxis=new ns,os.s_n=new at,os.s_perp=new at;var ls=new os;function us(t,e,i,s,n){var a=ls;a.Collide(t,e,i,s,n)}var ms,_s=function t(){Object(r["a"])(this,t),this.mass=0,this.center=new at(0,0),this.I=0};(function(t){t[t["e_unknown"]=-1]="e_unknown",t[t["e_circleShape"]=0]="e_circleShape",t[t["e_edgeShape"]=1]="e_edgeShape",t[t["e_polygonShape"]=2]="e_polygonShape",t[t["e_chainShape"]=3]="e_chainShape",t[t["e_shapeTypeCount"]=4]="e_shapeTypeCount"})(ms||(ms={}));var hs=function(){function t(e,i){Object(r["a"])(this,t),this.m_type=ms.e_unknown,this.m_radius=0,this.m_type=e,this.m_radius=i}return Object(o["a"])(t,[{key:"Copy",value:function(t){return this.m_radius=t.m_radius,this}},{key:"GetType",value:function(){return this.m_type}}]),t}(),cs=i("45eb"),fs=i("7e84"),ds=i("262e"),vs=i("2caf"),ys=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(){var t,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object(r["a"])(this,i),t=e.call(this,ms.e_circleShape,s),t.m_p=new at,t}return Object(o["a"])(i,[{key:"Clone",value:function(){return(new i).Copy(this)}},{key:"Copy",value:function(t){return Object(cs["a"])(Object(fs["a"])(i.prototype),"Copy",this).call(this,t),this.m_p.Copy(t.m_p),this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){var s=Yt.MulXV(t,this.m_p,i.TestPoint_s_center),n=at.SubVV(e,s,i.TestPoint_s_d);return at.DotVV(n,n)<=$(this.m_radius)}},{key:"ComputeDistance",value:function(t,e,s,n){var a=Yt.MulXV(t,this.m_p,i.ComputeDistance_s_center);return at.SubVV(e,a,s),s.Normalize()-this.m_radius}},{key:"RayCast",value:function(t,e,s,n){var a=Yt.MulXV(s,this.m_p,i.RayCast_s_position),r=at.SubVV(e.p1,a,i.RayCast_s_s),o=at.DotVV(r,r)-$(this.m_radius),l=at.SubVV(e.p2,e.p1,i.RayCast_s_r),u=at.DotVV(r,l),_=at.DotVV(l,l),h=u*u-_*o;if(h<0||_<m)return!1;var c=-(u+et(h));return 0<=c&&c<=e.maxFraction*_&&(c/=_,t.fraction=c,at.AddVMulSV(r,c,l,t.normal).SelfNormalize(),!0)}},{key:"ComputeAABB",value:function(t,e,s){var n=Yt.MulXV(e,this.m_p,i.ComputeAABB_s_p);t.lowerBound.Set(n.x-this.m_radius,n.y-this.m_radius),t.upperBound.Set(n.x+this.m_radius,n.y+this.m_radius)}},{key:"ComputeMass",value:function(t,e){var i=$(this.m_radius);t.mass=e*h*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+at.DotVV(this.m_p,this.m_p))}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,s){var n=Yt.MulXV(i,this.m_p,new at),a=-(at.DotVV(t,n)-e);if(a<-this.m_radius+m)return 0;if(a>this.m_radius)return s.Copy(n),h*this.m_radius*this.m_radius;var r=this.m_radius*this.m_radius,o=a*a,l=r*(st(a/this.m_radius)+h/2)+a*et(r-o),u=-2/3*it(r-o,1.5)/l;return s.x=n.x+t.x*u,s.y=n.y+t.y*u,l}},{key:"Dump",value:function(t){t("    const shape: b2CircleShape = new b2CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)}}]),i}(hs);ys.TestPoint_s_center=new at,ys.TestPoint_s_d=new at,ys.ComputeDistance_s_center=new at,ys.RayCast_s_position=new at,ys.RayCast_s_s=new at,ys.RayCast_s_r=new at,ys.ComputeAABB_s_p=new at;var ps=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(){var t;return Object(r["a"])(this,i),t=e.call(this,ms.e_polygonShape,x),t.m_centroid=new at(0,0),t.m_vertices=at.MakeArray(f),t.m_normals=at.MakeArray(f),t.m_count=0,t}return Object(o["a"])(i,[{key:"Clone",value:function(){return(new i).Copy(this)}},{key:"Copy",value:function(t){Object(cs["a"])(Object(fs["a"])(i.prototype),"Copy",this).call(this,t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count;for(var e=0;e<this.m_count;++e)this.m_vertices[e].Copy(t.m_vertices[e]),this.m_normals[e].Copy(t.m_normals[e]);return this}},{key:"GetChildCount",value:function(){return 1}},{key:"Set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e<3)return this.SetAsBox(1,1);for(var n=Y(e,f),a=i.Set_s_ps,r=0,o=0;o<n;++o){for(var l=t[s+o],u=!0,m=0;m<r;++m)if(at.DistanceSquaredVV(l,a[m])<.5*y*(.5*y)){u=!1;break}u&&a[r++].Copy(l)}if(n=r,n<3)return this.SetAsBox(1,1);for(var _=0,h=a[0].x,c=1;c<n;++c){var d=a[c].x;(d>h||d===h&&a[c].y<a[_].y)&&(_=c,h=d)}for(var v=i.Set_s_hull,p=0,x=_;;){v[p]=x;for(var B=0,S=1;S<n;++S)if(B!==x){var A=at.SubVV(a[B],a[v[p]],i.Set_s_r),C=at.SubVV(a[S],a[v[p]],i.Set_s_v),b=at.CrossVV(A,C);b<0&&(B=S),0===b&&C.LengthSquared()>A.LengthSquared()&&(B=S)}else B=S;if(++p,x=B,B===_)break}this.m_count=p;for(var V=0;V<p;++V)this.m_vertices[V].Copy(a[v[V]]);for(var g=0;g<p;++g){var w=this.m_vertices[g],k=this.m_vertices[(g+1)%p],M=at.SubVV(k,w,at.s_t0);at.CrossVOne(M,this.m_normals[g]).SelfNormalize()}return i.ComputeCentroid(this.m_vertices,p,this.m_centroid),this}},{key:"SetAsArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length;return this.Set(t,e)}},{key:"SetAsBox",value:function(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(this.m_count=4,this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i instanceof at){this.m_centroid.Copy(i);var n=new Yt;n.SetPosition(i),n.SetRotationAngle(s);for(var a=0;a<this.m_count;++a)Yt.MulXV(n,this.m_vertices[a],this.m_vertices[a]),Xt.MulRV(n.q,this.m_normals[a],this.m_normals[a])}return this}},{key:"TestPoint",value:function(t,e){for(var s=Yt.MulTXV(t,e,i.TestPoint_s_pLocal),n=0;n<this.m_count;++n){var a=at.DotVV(this.m_normals[n],at.SubVV(s,this.m_vertices[n],at.s_t0));if(a>0)return!1}return!0}},{key:"ComputeDistance",value:function(t,e,s,n){for(var a=Yt.MulTXV(t,e,i.ComputeDistance_s_pLocal),r=-u,o=i.ComputeDistance_s_normalForMaxDistance.Copy(a),l=0;l<this.m_count;++l){var m=at.DotVV(this.m_normals[l],at.SubVV(a,this.m_vertices[l],at.s_t0));m>r&&(r=m,o.Copy(this.m_normals[l]))}if(r>0){for(var _=i.ComputeDistance_s_minDistance.Copy(o),h=r*r,c=0;c<this.m_count;++c){var f=at.SubVV(a,this.m_vertices[c],i.ComputeDistance_s_distance),d=f.LengthSquared();h>d&&(_.Copy(f),h=d)}return Xt.MulRV(t.q,_,s),s.Normalize(),Math.sqrt(h)}return Xt.MulRV(t.q,o,s),r}},{key:"RayCast",value:function(t,e,s,n){for(var a=Yt.MulTXV(s,e.p1,i.RayCast_s_p1),r=Yt.MulTXV(s,e.p2,i.RayCast_s_p2),o=at.SubVV(r,a,i.RayCast_s_d),l=0,u=e.maxFraction,m=-1,_=0;_<this.m_count;++_){var h=at.DotVV(this.m_normals[_],at.SubVV(this.m_vertices[_],a,at.s_t0)),c=at.DotVV(this.m_normals[_],o);if(0===c){if(h<0)return!1}else c<0&&h<l*c?(l=h/c,m=_):c>0&&h<u*c&&(u=h/c);if(u<l)return!1}return m>=0&&(t.fraction=l,Xt.MulRV(s.q,this.m_normals[m],t.normal),!0)}},{key:"ComputeAABB",value:function(t,e,s){for(var n=Yt.MulXV(e,this.m_vertices[0],t.lowerBound),a=t.upperBound.Copy(n),r=0;r<this.m_count;++r){var o=Yt.MulXV(e,this.m_vertices[r],i.ComputeAABB_s_v);at.MinV(o,n,n),at.MaxV(o,a,a)}var l=this.m_radius;n.SelfSubXY(l,l),a.SelfAddXY(l,l)}},{key:"ComputeMass",value:function(t,e){for(var s=i.ComputeMass_s_center.SetZero(),n=0,a=0,r=i.ComputeMass_s_s.SetZero(),o=0;o<this.m_count;++o)r.SelfAdd(this.m_vertices[o]);r.SelfMul(1/this.m_count);for(var l=1/3,u=0;u<this.m_count;++u){var m=at.SubVV(this.m_vertices[u],r,i.ComputeMass_s_e1),_=at.SubVV(this.m_vertices[(u+1)%this.m_count],r,i.ComputeMass_s_e2),h=at.CrossVV(m,_),c=.5*h;n+=c,s.SelfAdd(at.MulSV(c*l,at.AddVV(m,_,at.s_t0),at.s_t1));var f=m.x,d=m.y,v=_.x,y=_.y,p=f*f+v*f+v*v,x=d*d+y*d+y*y;a+=.25*l*h*(p+x)}t.mass=e*n,s.SelfMul(1/n),at.AddVV(s,r,t.center),t.I=e*a,t.I+=t.mass*(at.DotVV(t.center,t.center)-at.DotVV(s,s))}},{key:"Validate",value:function(){for(var t=0;t<this.m_count;++t)for(var e=t,s=(t+1)%this.m_count,n=this.m_vertices[e],a=at.SubVV(this.m_vertices[s],n,i.Validate_s_e),r=0;r<this.m_count;++r)if(r!==e&&r!==s){var o=at.SubVV(this.m_vertices[r],n,i.Validate_s_v),l=at.CrossVV(a,o);if(l<0)return!1}return!0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,s,n){for(var a=Xt.MulTRV(s.q,t,i.ComputeSubmergedArea_s_normalL),r=e-at.DotVV(t,s.p),o=i.ComputeSubmergedArea_s_depths,l=0,u=-1,_=-1,h=!1,c=0;c<this.m_count;++c){o[c]=at.DotVV(a,this.m_vertices[c])-r;var f=o[c]<-m;c>0&&(f?h||(u=c-1,l++):h&&(_=c-1,l++)),h=f}switch(l){case 0:if(h){var d=i.ComputeSubmergedArea_s_md;return this.ComputeMass(d,1),Yt.MulXV(s,d.center,n),d.mass}return 0;case 1:-1===u?u=this.m_count-1:_=this.m_count-1;break}var v,y=(u+1)%this.m_count,p=(_+1)%this.m_count,x=(0-o[u])/(o[y]-o[u]),B=(0-o[_])/(o[p]-o[_]),S=i.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[u].x*(1-x)+this.m_vertices[y].x*x,this.m_vertices[u].y*(1-x)+this.m_vertices[y].y*x),A=i.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[_].x*(1-B)+this.m_vertices[p].x*B,this.m_vertices[_].y*(1-B)+this.m_vertices[p].y*B),C=0,b=i.ComputeSubmergedArea_s_center.SetZero(),V=this.m_vertices[y],g=y;while(g!==p){g=(g+1)%this.m_count,v=g===p?A:this.m_vertices[g];var w=.5*((V.x-S.x)*(v.y-S.y)-(V.y-S.y)*(v.x-S.x));C+=w,b.x+=w*(S.x+V.x+v.x)/3,b.y+=w*(S.y+V.y+v.y)/3,V=v}return b.SelfMul(1/C),Yt.MulXV(s,b,n),C}},{key:"Dump",value:function(t){t("    const shape: b2PolygonShape = new b2PolygonShape();\n"),t("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",f);for(var e=0;e<this.m_count;++e)t("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.Set(vs, %d);\n",this.m_count)}}],[{key:"ComputeCentroid",value:function(t,e,s){var n=s;n.SetZero();for(var a=0,r=i.ComputeCentroid_s_pRef.SetZero(),o=1/3,l=0;l<e;++l){var u=r,m=t[l],_=t[(l+1)%e],h=at.SubVV(m,u,i.ComputeCentroid_s_e1),c=at.SubVV(_,u,i.ComputeCentroid_s_e2),f=at.CrossVV(h,c),d=.5*f;a+=d,n.x+=d*o*(u.x+m.x+_.x),n.y+=d*o*(u.y+m.y+_.y)}return n.SelfMul(1/a),n}}]),i}(hs);ps.Set_s_ps=at.MakeArray(f),ps.Set_s_hull=W(f),ps.Set_s_r=new at,ps.Set_s_v=new at,ps.TestPoint_s_pLocal=new at,ps.ComputeDistance_s_pLocal=new at,ps.ComputeDistance_s_normalForMaxDistance=new at,ps.ComputeDistance_s_minDistance=new at,ps.ComputeDistance_s_distance=new at,ps.RayCast_s_p1=new at,ps.RayCast_s_p2=new at,ps.RayCast_s_d=new at,ps.ComputeAABB_s_v=new at,ps.ComputeMass_s_center=new at,ps.ComputeMass_s_s=new at,ps.ComputeMass_s_e1=new at,ps.ComputeMass_s_e2=new at,ps.Validate_s_e=new at,ps.Validate_s_v=new at,ps.ComputeSubmergedArea_s_normalL=new at,ps.ComputeSubmergedArea_s_depths=W(f),ps.ComputeSubmergedArea_s_md=new _s,ps.ComputeSubmergedArea_s_intoVec=new at,ps.ComputeSubmergedArea_s_outoVec=new at,ps.ComputeSubmergedArea_s_center=new at,ps.ComputeCentroid_s_pRef=new at,ps.ComputeCentroid_s_e1=new at,ps.ComputeCentroid_s_e2=new at;var xs=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(){var t;return Object(r["a"])(this,i),t=e.call(this,ms.e_edgeShape,x),t.m_vertex1=new at,t.m_vertex2=new at,t.m_vertex0=new at,t.m_vertex3=new at,t.m_hasVertex0=!1,t.m_hasVertex3=!1,t}return Object(o["a"])(i,[{key:"Set",value:function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this}},{key:"Clone",value:function(){return(new i).Copy(this)}},{key:"Copy",value:function(t){return Object(cs["a"])(Object(fs["a"])(i.prototype),"Copy",this).call(this,t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex3=t.m_hasVertex3,this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){return!1}},{key:"ComputeDistance",value:function(t,e,s,n){var a=Yt.MulXV(t,this.m_vertex1,i.ComputeDistance_s_v1),r=Yt.MulXV(t,this.m_vertex2,i.ComputeDistance_s_v2),o=at.SubVV(e,a,i.ComputeDistance_s_d),l=at.SubVV(r,a,i.ComputeDistance_s_s),u=at.DotVV(o,l);if(u>0){var m=at.DotVV(l,l);u>m?at.SubVV(e,r,o):o.SelfMulSub(u/m,l)}return s.Copy(o),s.Normalize()}},{key:"RayCast",value:function(t,e,s,n){var a=Yt.MulTXV(s,e.p1,i.RayCast_s_p1),r=Yt.MulTXV(s,e.p2,i.RayCast_s_p2),o=at.SubVV(r,a,i.RayCast_s_d),l=this.m_vertex1,u=this.m_vertex2,m=at.SubVV(u,l,i.RayCast_s_e),_=t.normal.Set(m.y,-m.x).SelfNormalize(),h=at.DotVV(_,at.SubVV(l,a,at.s_t0)),c=at.DotVV(_,o);if(0===c)return!1;var f=h/c;if(f<0||e.maxFraction<f)return!1;var d=at.AddVMulSV(a,f,o,i.RayCast_s_q),v=at.SubVV(u,l,i.RayCast_s_r),y=at.DotVV(v,v);if(0===y)return!1;var p=at.DotVV(at.SubVV(d,l,at.s_t0),v)/y;return!(p<0||1<p)&&(t.fraction=f,Xt.MulRV(s.q,t.normal,t.normal),h>0&&t.normal.SelfNeg(),!0)}},{key:"ComputeAABB",value:function(t,e,s){var n=Yt.MulXV(e,this.m_vertex1,i.ComputeAABB_s_v1),a=Yt.MulXV(e,this.m_vertex2,i.ComputeAABB_s_v2);at.MinV(n,a,t.lowerBound),at.MaxV(n,a,t.upperBound);var r=this.m_radius;t.lowerBound.SelfSubXY(r,r),t.upperBound.SelfAddXY(r,r)}},{key:"ComputeMass",value:function(t,e){t.mass=0,at.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,s){return s.SetZero(),0}},{key:"Dump",value:function(t){t("    const shape: b2EdgeShape = new b2EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),t("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)}}]),i}(hs);xs.ComputeDistance_s_v1=new at,xs.ComputeDistance_s_v2=new at,xs.ComputeDistance_s_d=new at,xs.ComputeDistance_s_s=new at,xs.RayCast_s_p1=new at,xs.RayCast_s_p2=new at,xs.RayCast_s_d=new at,xs.RayCast_s_e=new at,xs.RayCast_s_q=new at,xs.RayCast_s_r=new at,xs.ComputeAABB_s_v1=new at,xs.ComputeAABB_s_v2=new at;var Bs=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(){var t;return Object(r["a"])(this,i),t=e.call(this,ms.e_chainShape,x),t.m_count=0,t.m_prevVertex=new at,t.m_nextVertex=new at,t.m_hasPrevVertex=!1,t.m_hasNextVertex=!1,t}return Object(o["a"])(i,[{key:"CreateLoop",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length;this.m_count=e+1,this.m_vertices=at.MakeArray(this.m_count);for(var i=0;i<e;++i)this.m_vertices[i].Copy(t[i]);return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}},{key:"CreateChain",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length;this.m_count=e,this.m_vertices=at.MakeArray(e);for(var i=0;i<e;++i)this.m_vertices[i].Copy(t[i]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this}},{key:"SetPrevVertex",value:function(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this}},{key:"SetNextVertex",value:function(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this}},{key:"Clone",value:function(){return(new i).Copy(this)}},{key:"Copy",value:function(t){return Object(cs["a"])(Object(fs["a"])(i.prototype),"Copy",this).call(this,t),this.CreateChain(t.m_vertices,t.m_count),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasNextVertex=t.m_hasNextVertex,this}},{key:"GetChildCount",value:function(){return this.m_count-1}},{key:"GetChildEdge",value:function(t,e){t.m_type=ms.e_edgeShape,t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),e>0?(t.m_vertex0.Copy(this.m_vertices[e-1]),t.m_hasVertex0=!0):(t.m_vertex0.Copy(this.m_prevVertex),t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3.Copy(this.m_vertices[e+2]),t.m_hasVertex3=!0):(t.m_vertex3.Copy(this.m_nextVertex),t.m_hasVertex3=this.m_hasNextVertex)}},{key:"TestPoint",value:function(t,e){return!1}},{key:"ComputeDistance",value:function(t,e,s,n){var a=i.ComputeDistance_s_edgeShape;return this.GetChildEdge(a,n),a.ComputeDistance(t,e,s,0)}},{key:"RayCast",value:function(t,e,s,n){var a=i.RayCast_s_edgeShape;return a.m_vertex1.Copy(this.m_vertices[n]),a.m_vertex2.Copy(this.m_vertices[(n+1)%this.m_count]),a.RayCast(t,e,s,0)}},{key:"ComputeAABB",value:function(t,e,s){var n=this.m_vertices[s],a=this.m_vertices[(s+1)%this.m_count],r=Yt.MulXV(e,n,i.ComputeAABB_s_v1),o=Yt.MulXV(e,a,i.ComputeAABB_s_v2);at.MinV(r,o,t.lowerBound),at.MaxV(r,o,t.upperBound)}},{key:"ComputeMass",value:function(t,e){t.mass=0,t.center.SetZero(),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,s){return s.SetZero(),0}},{key:"Dump",value:function(t){t("    const shape: b2ChainShape = new b2ChainShape();\n"),t("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",f);for(var e=0;e<this.m_count;++e)t("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),t("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),t("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")}}]),i}(hs);Bs.ComputeDistance_s_edgeShape=new xs,Bs.RayCast_s_edgeShape=new xs,Bs.ComputeAABB_s_v1=new at,Bs.ComputeAABB_s_v2=new at;i("4de4");var Ss,As=function(){function t(){Object(r["a"])(this,t),this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}return Object(o["a"])(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex,this}}]),t}(),Cs=function t(){Object(r["a"])(this,t),this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new As},bs=function(){function t(){Object(r["a"])(this,t),this.aabb=new De,this.fixture=null,this.childIndex=0,this.proxy=null}return Object(o["a"])(t,null,[{key:"MakeArray",value:function(e){return X(e,(function(e){return new t}))}}]),t}(),Vs=function(){function t(){Object(r["a"])(this,t),this.m_density=0,this.m_next=null,this.m_body=null,this.m_shape=null,this.m_friction=0,this.m_restitution=0,this.m_proxies=null,this.m_proxyCount=0,this.m_filter=new As,this.m_isSensor=!1,this.m_userData=null}return Object(o["a"])(t,[{key:"GetType",value:function(){return this.m_shape.GetType()}},{key:"GetShape",value:function(){return this.m_shape}},{key:"SetSensor",value:function(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}},{key:"IsSensor",value:function(){return this.m_isSensor}},{key:"SetFilterData",value:function(t){this.m_filter.Copy(t),this.Refilter()}},{key:"GetFilterData",value:function(){return this.m_filter}},{key:"Refilter",value:function(){if(!this.m_body){var t=this.m_body.GetContactList();while(t){var e=t.contact,i=e.GetFixtureA(),s=e.GetFixtureB();i!==this&&s!==this||e.FlagForFiltering(),t=t.next}var n=this.m_body.GetWorld();if(null!==n)for(var a=n.m_contactManager.m_broadPhase,r=0;r<this.m_proxyCount;++r)a.TouchProxy(this.m_proxies[r].proxy)}}},{key:"GetBody",value:function(){return this.m_body}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"TestPoint",value:function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}},{key:"ComputeDistance",value:function(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i)}},{key:"RayCast",value:function(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)}},{key:"GetMassData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _s;return this.m_shape.ComputeMass(t,this.m_density),t}},{key:"SetDensity",value:function(t){this.m_density=t}},{key:"GetDensity",value:function(){return this.m_density}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetAABB",value:function(t){return this.m_proxies[t].aabb}},{key:"Dump",value:function(t,e){t("    const fd: b2FixtureDef = new b2FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",e)}},{key:"Create",value:function(t,e){this.m_userData=e.userData,this.m_friction=e.friction,this.m_restitution=e.restitution,this.m_body=t,this.m_next=null,this.m_filter.Copy(e.filter),this.m_isSensor=e.isSensor,this.m_shape=e.shape.Clone(),this.m_proxies=bs.MakeArray(this.m_shape.GetChildCount()),this.m_proxyCount=0,this.m_density=e.density}},{key:"Destroy",value:function(){this.m_shape=null}},{key:"CreateProxies",value:function(t,e){this.m_proxyCount=this.m_shape.GetChildCount();for(var i=0;i<this.m_proxyCount;++i){var s=this.m_proxies[i];this.m_shape.ComputeAABB(s.aabb,e,i),s.proxy=t.CreateProxy(s.aabb,s),s.fixture=this,s.childIndex=i}}},{key:"DestroyProxies",value:function(t){for(var e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];t.DestroyProxy(i.proxy),i.proxy=null}this.m_proxyCount=0}},{key:"Synchronize",value:function(e,i,s){if(0!==this.m_proxyCount)for(var n=0;n<this.m_proxyCount;++n){var a=this.m_proxies[n],r=t.Synchronize_s_aabb1,o=t.Synchronize_s_aabb2;this.m_shape.ComputeAABB(r,i,n),this.m_shape.ComputeAABB(o,s,n),a.aabb.Combine2(r,o);var l=at.SubVV(s.p,i.p,t.Synchronize_s_displacement);e.MoveProxy(a.proxy,a.aabb,l)}}}]),t}();Vs.Synchronize_s_aabb1=new De,Vs.Synchronize_s_aabb2=new De,Vs.Synchronize_s_displacement=new at,function(t){t[t["b2_unknown"]=-1]="b2_unknown",t[t["b2_staticBody"]=0]="b2_staticBody",t[t["b2_kinematicBody"]=1]="b2_kinematicBody",t[t["b2_dynamicBody"]=2]="b2_dynamicBody"}(Ss||(Ss={}));var gs,ws,ks=function t(){Object(r["a"])(this,t),this.type=Ss.b2_staticBody,this.position=new at(0,0),this.angle=0,this.linearVelocity=new at(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1},Ms=function(){function t(e,i){Object(r["a"])(this,t),this.m_type=Ss.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new Yt,this.m_xf0=new Yt,this.m_sweep=new ie,this.m_linearVelocity=new at,this.m_angularVelocity=0,this.m_force=new at,this.m_torque=0,this.m_world=null,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,e.bullet&&(this.m_bulletFlag=!0),e.fixedRotation&&(this.m_fixedRotationFlag=!0),e.allowSleep&&(this.m_autoSleepFlag=!0),e.awake&&(this.m_awakeFlag=!0),e.active&&(this.m_activeFlag=!0),this.m_world=i,this.m_xf.p.Copy(e.position),this.m_xf.q.SetAngle(e.angle),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=e.angle,this.m_sweep.a=e.angle,this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=e.type,e.type===Ss.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0}return Object(o["a"])(t,[{key:"CreateFixture",value:function(t,e){if(t instanceof Cs)return this.CreateFixtureDef(t);if(t instanceof hs&&"number"===typeof e)return this.CreateFixtureShapeDensity(t,e);throw new Error}},{key:"CreateFixtureDef",value:function(t){if(this.m_world.IsLocked())return null;var e=new Vs;if(e.Create(this,t),this.m_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;e.CreateProxies(i,this.m_xf)}return e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_body=this,e.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,e}},{key:"CreateFixtureShapeDensity",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=t.CreateFixtureShapeDensity_s_def;return s.shape=e,s.density=i,this.CreateFixtureDef(s)}},{key:"DestroyFixture",value:function(t){if(!this.m_world.IsLocked()){var e=this.m_fixtureList,i=null;while(null!==e){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next,!0;break}i=e,e=e.m_next}var s=this.m_contactList;while(s){var n=s.contact;s=s.next;var a=n.GetFixtureA(),r=n.GetFixtureB();t!==a&&t!==r||this.m_world.m_contactManager.Destroy(n)}if(this.m_activeFlag){var o=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxies(o)}t.Destroy(),t.m_body=null,t.m_next=null,--this.m_fixtureCount,this.ResetMassData()}}},{key:"SetTransformVec",value:function(t,e){this.SetTransformXY(t.x,t.y,e)}},{key:"SetTransformXY",value:function(t,e,i){if(!this.m_world.IsLocked()){this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),Yt.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var s=this.m_world.m_contactManager.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(s,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}}},{key:"SetTransform",value:function(t){this.SetTransformVec(t.p,t.GetAngle())}},{key:"GetTransform",value:function(){return this.m_xf}},{key:"GetPosition",value:function(){return this.m_xf.p}},{key:"SetPosition",value:function(t){this.SetTransformVec(t,this.GetAngle())}},{key:"SetPositionXY",value:function(t,e){this.SetTransformXY(t,e,this.GetAngle())}},{key:"GetAngle",value:function(){return this.m_sweep.a}},{key:"SetAngle",value:function(t){this.SetTransformVec(this.GetPosition(),t)}},{key:"GetWorldCenter",value:function(){return this.m_sweep.c}},{key:"GetLocalCenter",value:function(){return this.m_sweep.localCenter}},{key:"SetLinearVelocity",value:function(t){this.m_type!==Ss.b2_staticBody&&(at.DotVV(t,t)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(t))}},{key:"GetLinearVelocity",value:function(){return this.m_linearVelocity}},{key:"SetAngularVelocity",value:function(t){this.m_type!==Ss.b2_staticBody&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)}},{key:"GetAngularVelocity",value:function(){return this.m_angularVelocity}},{key:"GetDefinition",value:function(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t}},{key:"ApplyForce",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.m_type===Ss.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))}},{key:"ApplyForceToCenter",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===Ss.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))}},{key:"ApplyTorque",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===Ss.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))}},{key:"ApplyLinearImpulse",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.m_type===Ss.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))}},{key:"ApplyLinearImpulseToCenter",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===Ss.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))}},{key:"ApplyAngularImpulse",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===Ss.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))}},{key:"GetMass",value:function(){return this.m_mass}},{key:"GetInertia",value:function(){return this.m_I+this.m_mass*at.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)}},{key:"GetMassData",value:function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*at.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}},{key:"SetMassData",value:function(e){if(!this.m_world.IsLocked()&&this.m_type===Ss.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&!this.m_fixedRotationFlag&&(this.m_I=e.I-this.m_mass*at.DotVV(e.center,e.center),this.m_invI=1/this.m_I);var i=t.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e.center),Yt.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),at.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,at.SubVV(this.m_sweep.c,i,at.s_t0),this.m_linearVelocity)}}},{key:"ResetMassData",value:function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===Ss.b2_staticBody||this.m_type===Ss.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var e=t.ResetMassData_s_localCenter.SetZero(),i=this.m_fixtureList;i;i=i.m_next)if(0!==i.m_density){var s=i.GetMassData(t.ResetMassData_s_massData);this.m_mass+=s.mass,e.x+=s.center.x*s.mass,e.y+=s.center.y*s.mass,this.m_I+=s.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*at.DotVV(e,e),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var n=t.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e),Yt.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),at.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,at.SubVV(this.m_sweep.c,n,at.s_t0),this.m_linearVelocity)}},{key:"GetWorldPoint",value:function(t,e){return Yt.MulXV(this.m_xf,t,e)}},{key:"GetWorldVector",value:function(t,e){return Xt.MulRV(this.m_xf.q,t,e)}},{key:"GetLocalPoint",value:function(t,e){return Yt.MulTXV(this.m_xf,t,e)}},{key:"GetLocalVector",value:function(t,e){return Xt.MulTRV(this.m_xf.q,t,e)}},{key:"GetLinearVelocityFromWorldPoint",value:function(t,e){return at.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,at.SubVV(t,this.m_sweep.c,at.s_t0),e)}},{key:"GetLinearVelocityFromLocalPoint",value:function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}},{key:"GetLinearDamping",value:function(){return this.m_linearDamping}},{key:"SetLinearDamping",value:function(t){this.m_linearDamping=t}},{key:"GetAngularDamping",value:function(){return this.m_angularDamping}},{key:"SetAngularDamping",value:function(t){this.m_angularDamping=t}},{key:"GetGravityScale",value:function(){return this.m_gravityScale}},{key:"SetGravityScale",value:function(t){this.m_gravityScale=t}},{key:"SetType",value:function(t){if(!this.m_world.IsLocked()&&this.m_type!==t){this.m_type=t,this.ResetMassData(),this.m_type===Ss.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;var e=this.m_contactList;while(e){var i=e;e=e.next,this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null;for(var s=this.m_world.m_contactManager.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)for(var a=n.m_proxyCount,r=0;r<a;++r)s.TouchProxy(n.m_proxies[r].proxy)}}},{key:"GetType",value:function(){return this.m_type}},{key:"SetBullet",value:function(t){this.m_bulletFlag=t}},{key:"IsBullet",value:function(){return this.m_bulletFlag}},{key:"SetSleepingAllowed",value:function(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}},{key:"IsSleepingAllowed",value:function(){return this.m_autoSleepFlag}},{key:"SetAwake",value:function(t){t?this.m_awakeFlag||(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)}},{key:"IsAwake",value:function(){return this.m_awakeFlag}},{key:"SetActive",value:function(t){if(t!==this.IsActive())if(this.m_activeFlag=t,t)for(var e=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.CreateProxies(e,this.m_xf);else{for(var s=this.m_world.m_contactManager.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.DestroyProxies(s);var a=this.m_contactList;while(a){var r=a;a=a.next,this.m_world.m_contactManager.Destroy(r.contact)}this.m_contactList=null}}},{key:"IsActive",value:function(){return this.m_activeFlag}},{key:"SetFixedRotation",value:function(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}},{key:"IsFixedRotation",value:function(){return this.m_fixedRotationFlag}},{key:"GetFixtureList",value:function(){return this.m_fixtureList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetContactList",value:function(){return this.m_contactList}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"GetWorld",value:function(){return this.m_world}},{key:"Dump",value:function(t){var e=this.m_islandIndex;t("{\n"),t("  const bd: b2BodyDef = new b2BodyDef();\n");var i="";switch(this.m_type){case Ss.b2_staticBody:i="b2BodyType.b2_staticBody";break;case Ss.b2_kinematicBody:i="b2BodyType.b2_kinematicBody";break;case Ss.b2_dynamicBody:i="b2BodyType.b2_dynamicBody";break;default:break}t("  bd.type = %s;\n",i),t("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),t("  bd.angle = %.15f;\n",this.m_sweep.a),t("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),t("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),t("  bd.linearDamping = %.15f;\n",this.m_linearDamping),t("  bd.angularDamping = %.15f;\n",this.m_angularDamping),t("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),t("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),t("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),t("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),t("  bd.active = %s;\n",this.m_activeFlag?"true":"false"),t("  bd.gravityScale = %.15f;\n",this.m_gravityScale),t("\n"),t("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),t("\n");for(var s=this.m_fixtureList;s;s=s.m_next)t("  {\n"),s.Dump(t,e),t("  }\n");t("}\n")}},{key:"SynchronizeFixtures",value:function(){var e=t.SynchronizeFixtures_s_xf1;e.q.SetAngle(this.m_sweep.a0),Xt.MulRV(e.q,this.m_sweep.localCenter,e.p),at.SubVV(this.m_sweep.c0,e.p,e.p);for(var i=this.m_world.m_contactManager.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)s.Synchronize(i,e,this.m_xf)}},{key:"SynchronizeTransform",value:function(){this.m_xf.q.SetAngle(this.m_sweep.a),Xt.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),at.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}},{key:"ShouldCollide",value:function(t){return(this.m_type!==Ss.b2_staticBody||t.m_type!==Ss.b2_staticBody)&&this.ShouldCollideConnected(t)}},{key:"ShouldCollideConnected",value:function(t){for(var e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}},{key:"Advance",value:function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),Xt.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),at.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}}]),t}();Ms.CreateFixtureShapeDensity_s_def=new Cs,Ms.SetMassData_s_oldCenter=new at,Ms.ResetMassData_s_localCenter=new at,Ms.ResetMassData_s_oldCenter=new at,Ms.ResetMassData_s_massData=new _s,Ms.SynchronizeFixtures_s_xf1=new Yt,function(t){t[t["e_unknownJoint"]=0]="e_unknownJoint",t[t["e_revoluteJoint"]=1]="e_revoluteJoint",t[t["e_prismaticJoint"]=2]="e_prismaticJoint",t[t["e_distanceJoint"]=3]="e_distanceJoint",t[t["e_pulleyJoint"]=4]="e_pulleyJoint",t[t["e_mouseJoint"]=5]="e_mouseJoint",t[t["e_gearJoint"]=6]="e_gearJoint",t[t["e_wheelJoint"]=7]="e_wheelJoint",t[t["e_weldJoint"]=8]="e_weldJoint",t[t["e_frictionJoint"]=9]="e_frictionJoint",t[t["e_ropeJoint"]=10]="e_ropeJoint",t[t["e_motorJoint"]=11]="e_motorJoint",t[t["e_areaJoint"]=12]="e_areaJoint"}(gs||(gs={})),function(t){t[t["e_inactiveLimit"]=0]="e_inactiveLimit",t[t["e_atLowerLimit"]=1]="e_atLowerLimit",t[t["e_atUpperLimit"]=2]="e_atUpperLimit",t[t["e_equalLimits"]=3]="e_equalLimits"}(ws||(ws={}));var Is=function t(){Object(r["a"])(this,t),this.other=null,this.joint=null,this.prev=null,this.next=null},Ps=function t(e){Object(r["a"])(this,t),this.type=gs.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1,this.type=e},Gs=function(){function t(e){Object(r["a"])(this,t),this.m_type=gs.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_edgeA=new Is,this.m_edgeB=new Is,this.m_bodyA=null,this.m_bodyB=null,this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=e.type,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=e.collideConnected,this.m_userData=e.userData}return Object(o["a"])(t,[{key:"GetType",value:function(){return this.m_type}},{key:"GetBodyA",value:function(){return this.m_bodyA}},{key:"GetBodyB",value:function(){return this.m_bodyB}},{key:"GetAnchorA",value:function(t){return t.SetZero()}},{key:"GetAnchorB",value:function(t){return t.SetZero()}},{key:"GetReactionForce",value:function(t,e){return e.SetZero()}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"IsActive",value:function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()}},{key:"GetCollideConnected",value:function(){return this.m_collideConnected}},{key:"Dump",value:function(t){t("// Dump is not supported for this joint type.\n")}},{key:"ShiftOrigin",value:function(t){}},{key:"InitVelocityConstraints",value:function(t){}},{key:"SolveVelocityConstraints",value:function(t){}},{key:"SolvePositionConstraints",value:function(t){return!1}}]),t}(),Ds=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(){var t;return Object(r["a"])(this,i),t=e.call(this,gs.e_distanceJoint),t.localAnchorA=new at,t.localAnchorB=new at,t.length=1,t.frequencyHz=0,t.dampingRatio=0,t}return Object(o["a"])(i,[{key:"Initialize",value:function(t,e,i,s){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(s,this.localAnchorB),this.length=at.DistanceVV(i,s),this.frequencyHz=0,this.dampingRatio=0}}]),i}(Ps),js=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this,t),s.m_frequencyHz=0,s.m_dampingRatio=0,s.m_bias=0,s.m_localAnchorA=new at,s.m_localAnchorB=new at,s.m_gamma=0,s.m_impulse=0,s.m_length=0,s.m_indexA=0,s.m_indexB=0,s.m_u=new at,s.m_rA=new at,s.m_rB=new at,s.m_localCenterA=new at,s.m_localCenterB=new at,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_mass=0,s.m_qA=new Xt,s.m_qB=new Xt,s.m_lalcA=new at,s.m_lalcB=new at,s.m_frequencyHz=t.frequencyHz,s.m_dampingRatio=t.dampingRatio,s.m_localAnchorA.Copy(t.localAnchorA),s.m_localAnchorB.Copy(t.localAnchorB),s.m_length=t.length,s}return Object(o["a"])(i,[{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.Set(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetLength",value:function(t){this.m_length=t}},{key:"Length",value:function(){return this.m_length}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(s),_=this.m_qB.SetAngle(o);at.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Xt.MulRV(m,this.m_lalcA,this.m_rA),at.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Xt.MulRV(_,this.m_lalcB,this.m_rB),this.m_u.x=r.x+this.m_rB.x-e.x-this.m_rA.x,this.m_u.y=r.y+this.m_rB.y-e.y-this.m_rA.y;var c=this.m_u.Length();c>y?this.m_u.SelfMul(1/c):this.m_u.SetZero();var f=at.CrossVV(this.m_rA,this.m_u),d=at.CrossVV(this.m_rB,this.m_u),v=this.m_invMassA+this.m_invIA*f*f+this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=0!==v?1/v:0,this.m_frequencyHz>0){var p=c-this.m_length,x=2*h*this.m_frequencyHz,B=2*this.m_mass*this.m_dampingRatio*x,S=this.m_mass*x*x,A=t.step.dt;this.m_gamma=A*(B+A*S),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=p*A*S*this.m_gamma,v+=this.m_gamma,this.m_mass=0!==v?1/v:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var C=at.MulSV(this.m_impulse,this.m_u,i.InitVelocityConstraints_s_P);n.SelfMulSub(this.m_invMassA,C),a-=this.m_invIA*at.CrossVV(this.m_rA,C),l.SelfMulAdd(this.m_invMassB,C),u+=this.m_invIB*at.CrossVV(this.m_rB,C)}else this.m_impulse=0;t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,r=at.AddVCrossSV(e,s,this.m_rA,i.SolveVelocityConstraints_s_vpA),o=at.AddVCrossSV(n,a,this.m_rB,i.SolveVelocityConstraints_s_vpB),l=at.DotVV(this.m_u,at.SubVV(o,r,at.s_t0)),u=-this.m_mass*(l+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=u;var m=at.MulSV(u,this.m_u,i.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,m),s-=this.m_invIA*at.CrossVV(this.m_rA,m),n.SelfMulAdd(this.m_invMassB,m),a+=this.m_invIB*at.CrossVV(this.m_rB,m),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a}},{key:"SolvePositionConstraints",value:function(t){if(this.m_frequencyHz>0)return!0;var e=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,r=Xt.MulRV(this.m_qA,this.m_lalcA,this.m_rA),o=Xt.MulRV(this.m_qB,this.m_lalcB,this.m_rB),l=this.m_u;l.x=n.x+o.x-e.x-r.x,l.y=n.y+o.y-e.y-r.y;var u=this.m_u.Normalize(),m=u-this.m_length;m=Q(m,-C,C);var _=-this.m_mass*m,h=at.MulSV(_,l,i.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,h),s-=this.m_invIA*at.CrossVV(r,h),n.SelfMulAdd(this.m_invMassB,h),a+=this.m_invIB*at.CrossVV(o,h),t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=a,H(m)<y}}]),i}(Gs);js.InitVelocityConstraints_s_P=new at,js.SolveVelocityConstraints_s_vpA=new at,js.SolveVelocityConstraints_s_vpB=new at,js.SolveVelocityConstraints_s_P=new at,js.SolvePositionConstraints_s_P=new at;var Os=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;Object(r["a"])(this,i),s=e.call(this,t),s.m_bodies=null,s.m_frequencyHz=0,s.m_dampingRatio=0,s.m_impulse=0,s.m_targetLengths=null,s.m_targetArea=0,s.m_normals=null,s.m_joints=null,s.m_deltas=null,s.m_delta=null,s.m_bodies=t.bodies,s.m_frequencyHz=t.frequencyHz,s.m_dampingRatio=t.dampingRatio,s.m_targetLengths=W(t.bodies.length),s.m_normals=at.MakeArray(t.bodies.length),s.m_joints=U(t.bodies.length),s.m_deltas=at.MakeArray(t.bodies.length),s.m_delta=new at;var n=new Ds;n.frequencyHz=t.frequencyHz,n.dampingRatio=t.dampingRatio,s.m_targetArea=0;for(var a=0;a<s.m_bodies.length;++a){var o=s.m_bodies[a],l=s.m_bodies[(a+1)%s.m_bodies.length],u=o.GetWorldCenter(),m=l.GetWorldCenter();s.m_targetLengths[a]=at.DistanceVV(u,m),s.m_targetArea+=at.CrossVV(u,m),n.Initialize(o,l,u,m),s.m_joints[a]=t.world.CreateJoint(n)}return s.m_targetArea*=.5,s}return Object(o["a"])(i,[{key:"GetAnchorA",value:function(t){return t.SetZero()}},{key:"GetAnchorB",value:function(t){return t.SetZero()}},{key:"GetReactionForce",value:function(t,e){return e.SetZero()}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetFrequency(t)}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDampingRatio(t)}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"Dump",value:function(t){t("Area joint dumping is not supported.\n")}},{key:"InitVelocityConstraints",value:function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],s=this.m_bodies[(e+1)%this.m_bodies.length],n=t.positions[i.m_islandIndex].c,a=t.positions[s.m_islandIndex].c,r=this.m_deltas[e];at.SubVV(a,n,r)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(var o=0;o<this.m_bodies.length;++o){var l=this.m_bodies[o],u=t.velocities[l.m_islandIndex].v,m=this.m_deltas[o];u.x+=l.m_invMass*m.y*.5*this.m_impulse,u.y+=l.m_invMass*-m.x*.5*this.m_impulse}}else this.m_impulse=0}},{key:"SolveVelocityConstraints",value:function(t){for(var e=0,i=0,s=0;s<this.m_bodies.length;++s){var n=this.m_bodies[s],a=t.velocities[n.m_islandIndex].v,r=this.m_deltas[s];e+=r.LengthSquared()/n.GetMass(),i+=at.CrossVV(a,r)}var o=-2*i/e;this.m_impulse+=o;for(var l=0;l<this.m_bodies.length;++l){var u=this.m_bodies[l],m=t.velocities[u.m_islandIndex].v,_=this.m_deltas[l];m.x+=u.m_invMass*_.y*.5*o,m.y+=u.m_invMass*-_.x*.5*o}}},{key:"SolvePositionConstraints",value:function(t){for(var e=0,i=0,s=0;s<this.m_bodies.length;++s){var n=this.m_bodies[s],a=this.m_bodies[(s+1)%this.m_bodies.length],r=t.positions[n.m_islandIndex].c,o=t.positions[a.m_islandIndex].c,l=at.SubVV(o,r,this.m_delta),u=l.Length();u<m&&(u=1),this.m_normals[s].x=l.y/u,this.m_normals[s].y=-l.x/u,e+=u,i+=at.CrossVV(r,o)}i*=.5;for(var _=this.m_targetArea-i,h=.5*_/e,c=!0,f=0;f<this.m_bodies.length;++f){var d=this.m_bodies[f],v=t.positions[d.m_islandIndex].c,p=(f+1)%this.m_bodies.length,x=at.AddVV(this.m_normals[f],this.m_normals[p],this.m_delta);x.SelfMul(h);var B=x.LengthSquared();B>$(C)&&x.SelfMul(C/et(B)),B>$(y)&&(c=!1),v.x+=x.x,v.y+=x.y}return c}}]),i}(Gs),Fs=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this,t),s.m_localAnchorA=new at,s.m_localAnchorB=new at,s.m_linearImpulse=new at,s.m_angularImpulse=0,s.m_maxForce=0,s.m_maxTorque=0,s.m_indexA=0,s.m_indexB=0,s.m_rA=new at,s.m_rB=new at,s.m_localCenterA=new at,s.m_localCenterB=new at,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_linearMass=new Dt,s.m_angularMass=0,s.m_qA=new Xt,s.m_qB=new Xt,s.m_lalcA=new at,s.m_lalcB=new at,s.m_K=new Dt,s.m_localAnchorA.Copy(t.localAnchorA),s.m_localAnchorB.Copy(t.localAnchorB),s.m_linearImpulse.SetZero(),s.m_maxForce=t.maxForce,s.m_maxTorque=t.maxTorque,s.m_linearMass.SetZero(),s}return Object(o["a"])(i,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,o=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(n);at.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var u=Xt.MulRV(o,this.m_lalcA,this.m_rA);at.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var m=Xt.MulRV(l,this.m_lalcB,this.m_rB),_=this.m_invMassA,h=this.m_invMassB,c=this.m_invIA,f=this.m_invIB,d=this.m_K;if(d.ex.x=_+h+c*u.y*u.y+f*m.y*m.y,d.ex.y=-c*u.x*u.y-f*m.x*m.y,d.ey.x=d.ex.y,d.ey.y=_+h+c*u.x*u.x+f*m.x*m.x,d.GetInverse(this.m_linearMass),this.m_angularMass=c+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var v=this.m_linearImpulse;i.SelfMulSub(_,v),s-=c*(at.CrossVV(this.m_rA,v)+this.m_angularImpulse),a.SelfMulAdd(h,v),r+=f*(at.CrossVV(this.m_rB,v)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=r}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,r=this.m_invMassA,o=this.m_invMassB,l=this.m_invIA,u=this.m_invIB,m=t.step.dt,_=a-s,h=-this.m_angularMass*_,c=this.m_angularImpulse,f=m*this.m_maxTorque;this.m_angularImpulse=Q(this.m_angularImpulse+h,-f,f),h=this.m_angularImpulse-c,s-=l*h,a+=u*h;var d=at.SubVV(at.AddVCrossSV(n,a,this.m_rB,at.s_t0),at.AddVCrossSV(e,s,this.m_rA,at.s_t1),i.SolveVelocityConstraints_s_Cdot_v2),v=Dt.MulMV(this.m_linearMass,d,i.SolveVelocityConstraints_s_impulseV).SelfNeg(),y=i.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(v);var p=m*this.m_maxForce;this.m_linearImpulse.LengthSquared()>p*p&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(p)),at.SubVV(this.m_linearImpulse,y,v),e.SelfMulSub(r,v),s-=l*at.CrossVV(this.m_rA,v),n.SelfMulAdd(o,v),a+=u*at.CrossVV(this.m_rB,v),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.Set(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),i}(Gs);Fs.SolveVelocityConstraints_s_Cdot_v2=new at,Fs.SolveVelocityConstraints_s_impulseV=new at,Fs.SolveVelocityConstraints_s_oldImpulseV=new at;var Ls=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s,n,a;Object(r["a"])(this,i),s=e.call(this,t),s.m_joint1=null,s.m_joint2=null,s.m_typeA=gs.e_unknownJoint,s.m_typeB=gs.e_unknownJoint,s.m_bodyC=null,s.m_bodyD=null,s.m_localAnchorA=new at,s.m_localAnchorB=new at,s.m_localAnchorC=new at,s.m_localAnchorD=new at,s.m_localAxisC=new at,s.m_localAxisD=new at,s.m_referenceAngleA=0,s.m_referenceAngleB=0,s.m_constant=0,s.m_ratio=0,s.m_impulse=0,s.m_indexA=0,s.m_indexB=0,s.m_indexC=0,s.m_indexD=0,s.m_lcA=new at,s.m_lcB=new at,s.m_lcC=new at,s.m_lcD=new at,s.m_mA=0,s.m_mB=0,s.m_mC=0,s.m_mD=0,s.m_iA=0,s.m_iB=0,s.m_iC=0,s.m_iD=0,s.m_JvAC=new at,s.m_JvBD=new at,s.m_JwA=0,s.m_JwB=0,s.m_JwC=0,s.m_JwD=0,s.m_mass=0,s.m_qA=new Xt,s.m_qB=new Xt,s.m_qC=new Xt,s.m_qD=new Xt,s.m_lalcA=new at,s.m_lalcB=new at,s.m_lalcC=new at,s.m_lalcD=new at,s.m_joint1=t.joint1,s.m_joint2=t.joint2,s.m_typeA=s.m_joint1.GetType(),s.m_typeB=s.m_joint2.GetType(),s.m_bodyC=s.m_joint1.GetBodyA(),s.m_bodyA=s.m_joint1.GetBodyB();var o=s.m_bodyA.m_xf,l=s.m_bodyA.m_sweep.a,u=s.m_bodyC.m_xf,m=s.m_bodyC.m_sweep.a;if(s.m_typeA===gs.e_revoluteJoint){var _=t.joint1;s.m_localAnchorC.Copy(_.m_localAnchorA),s.m_localAnchorA.Copy(_.m_localAnchorB),s.m_referenceAngleA=_.m_referenceAngle,s.m_localAxisC.SetZero(),n=l-m-s.m_referenceAngleA}else{var h=t.joint1;s.m_localAnchorC.Copy(h.m_localAnchorA),s.m_localAnchorA.Copy(h.m_localAnchorB),s.m_referenceAngleA=h.m_referenceAngle,s.m_localAxisC.Copy(h.m_localXAxisA);var c=s.m_localAnchorC,f=Xt.MulTRV(u.q,at.AddVV(Xt.MulRV(o.q,s.m_localAnchorA,at.s_t0),at.SubVV(o.p,u.p,at.s_t1),at.s_t0),at.s_t0);n=at.DotVV(at.SubVV(f,c,at.s_t0),s.m_localAxisC)}s.m_bodyD=s.m_joint2.GetBodyA(),s.m_bodyB=s.m_joint2.GetBodyB();var d=s.m_bodyB.m_xf,v=s.m_bodyB.m_sweep.a,y=s.m_bodyD.m_xf,p=s.m_bodyD.m_sweep.a;if(s.m_typeB===gs.e_revoluteJoint){var x=t.joint2;s.m_localAnchorD.Copy(x.m_localAnchorA),s.m_localAnchorB.Copy(x.m_localAnchorB),s.m_referenceAngleB=x.m_referenceAngle,s.m_localAxisD.SetZero(),a=v-p-s.m_referenceAngleB}else{var B=t.joint2;s.m_localAnchorD.Copy(B.m_localAnchorA),s.m_localAnchorB.Copy(B.m_localAnchorB),s.m_referenceAngleB=B.m_referenceAngle,s.m_localAxisD.Copy(B.m_localXAxisA);var S=s.m_localAnchorD,A=Xt.MulTRV(y.q,at.AddVV(Xt.MulRV(d.q,s.m_localAnchorB,at.s_t0),at.SubVV(d.p,y.p,at.s_t1),at.s_t0),at.s_t0);a=at.DotVV(at.SubVV(A,S,at.s_t0),s.m_localAxisD)}return s.m_ratio=t.ratio,s.m_constant=n+s.m_ratio*a,s.m_impulse=0,s}return Object(o["a"])(i,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,a=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,l=t.positions[this.m_indexC].a,u=t.velocities[this.m_indexC].v,m=t.velocities[this.m_indexC].w,_=t.positions[this.m_indexD].a,h=t.velocities[this.m_indexD].v,c=t.velocities[this.m_indexD].w,f=this.m_qA.SetAngle(e),d=this.m_qB.SetAngle(a),v=this.m_qC.SetAngle(l),y=this.m_qD.SetAngle(_);if(this.m_mass=0,this.m_typeA===gs.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var p=Xt.MulRV(v,this.m_localAxisC,i.InitVelocityConstraints_s_u);at.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var x=Xt.MulRV(v,this.m_lalcC,i.InitVelocityConstraints_s_rC);at.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var B=Xt.MulRV(f,this.m_lalcA,i.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(p),this.m_JwC=at.CrossVV(x,p),this.m_JwA=at.CrossVV(B,p),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===gs.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var S=Xt.MulRV(y,this.m_localAxisD,i.InitVelocityConstraints_s_u);at.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var A=Xt.MulRV(y,this.m_lalcD,i.InitVelocityConstraints_s_rD);at.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var C=Xt.MulRV(d,this.m_lalcB,i.InitVelocityConstraints_s_rB);at.MulSV(this.m_ratio,S,this.m_JvBD),this.m_JwD=this.m_ratio*at.CrossVV(A,S),this.m_JwB=this.m_ratio*at.CrossVV(C,S),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.step.warmStarting?(s.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),n+=this.m_iA*this.m_impulse*this.m_JwA,r.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),o+=this.m_iB*this.m_impulse*this.m_JwB,u.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),m-=this.m_iC*this.m_impulse*this.m_JwC,h.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),c-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=o,t.velocities[this.m_indexC].w=m,t.velocities[this.m_indexD].w=c}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,a=t.velocities[this.m_indexC].v,r=t.velocities[this.m_indexC].w,o=t.velocities[this.m_indexD].v,l=t.velocities[this.m_indexD].w,u=at.DotVV(this.m_JvAC,at.SubVV(e,a,at.s_t0))+at.DotVV(this.m_JvBD,at.SubVV(s,o,at.s_t0));u+=this.m_JwA*i-this.m_JwC*r+(this.m_JwB*n-this.m_JwD*l);var m=-this.m_mass*u;this.m_impulse+=m,e.SelfMulAdd(this.m_mA*m,this.m_JvAC),i+=this.m_iA*m*this.m_JwA,s.SelfMulAdd(this.m_mB*m,this.m_JvBD),n+=this.m_iB*m*this.m_JwB,a.SelfMulSub(this.m_mC*m,this.m_JvAC),r-=this.m_iC*m*this.m_JwC,o.SelfMulSub(this.m_mD*m,this.m_JvBD),l-=this.m_iD*m*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n,t.velocities[this.m_indexC].w=r,t.velocities[this.m_indexD].w=l}},{key:"SolvePositionConstraints",value:function(t){var e,s,n,a,r,o,l=t.positions[this.m_indexA].c,u=t.positions[this.m_indexA].a,m=t.positions[this.m_indexB].c,_=t.positions[this.m_indexB].a,h=t.positions[this.m_indexC].c,c=t.positions[this.m_indexC].a,f=t.positions[this.m_indexD].c,d=t.positions[this.m_indexD].a,v=this.m_qA.SetAngle(u),p=this.m_qB.SetAngle(_),x=this.m_qC.SetAngle(c),B=this.m_qD.SetAngle(d),S=0,A=this.m_JvAC,C=this.m_JvBD,b=0;if(this.m_typeA===gs.e_revoluteJoint)A.SetZero(),n=1,r=1,b+=this.m_iA+this.m_iC,e=u-c-this.m_referenceAngleA;else{var V=Xt.MulRV(x,this.m_localAxisC,i.SolvePositionConstraints_s_u),g=Xt.MulRV(x,this.m_lalcC,i.SolvePositionConstraints_s_rC),w=Xt.MulRV(v,this.m_lalcA,i.SolvePositionConstraints_s_rA);A.Copy(V),r=at.CrossVV(g,V),n=at.CrossVV(w,V),b+=this.m_mC+this.m_mA+this.m_iC*r*r+this.m_iA*n*n;var k=this.m_lalcC,M=Xt.MulTRV(x,at.AddVV(w,at.SubVV(l,h,at.s_t0),at.s_t0),at.s_t0);e=at.DotVV(at.SubVV(M,k,at.s_t0),this.m_localAxisC)}if(this.m_typeB===gs.e_revoluteJoint)C.SetZero(),a=this.m_ratio,o=this.m_ratio,b+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),s=_-d-this.m_referenceAngleB;else{var I=Xt.MulRV(B,this.m_localAxisD,i.SolvePositionConstraints_s_u),P=Xt.MulRV(B,this.m_lalcD,i.SolvePositionConstraints_s_rD),G=Xt.MulRV(p,this.m_lalcB,i.SolvePositionConstraints_s_rB);at.MulSV(this.m_ratio,I,C),o=this.m_ratio*at.CrossVV(P,I),a=this.m_ratio*at.CrossVV(G,I),b+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*o*o+this.m_iB*a*a;var D=this.m_lalcD,j=Xt.MulTRV(B,at.AddVV(G,at.SubVV(m,f,at.s_t0),at.s_t0),at.s_t0);s=at.DotVV(at.SubVV(j,D,at.s_t0),this.m_localAxisD)}var O=e+this.m_ratio*s-this.m_constant,F=0;return b>0&&(F=-O/b),l.SelfMulAdd(this.m_mA*F,A),u+=this.m_iA*F*n,m.SelfMulAdd(this.m_mB*F,C),_+=this.m_iB*F*a,h.SelfMulSub(this.m_mC*F,A),c-=this.m_iC*F*r,f.SelfMulSub(this.m_mD*F,C),d-=this.m_iD*F*o,t.positions[this.m_indexA].a=u,t.positions[this.m_indexB].a=_,t.positions[this.m_indexC].a=c,t.positions[this.m_indexD].a=d,S<y}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return at.MulSV(t*this.m_impulse,this.m_JvAC,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse*this.m_JwA}},{key:"GetJoint1",value:function(){return this.m_joint1}},{key:"GetJoint2",value:function(){return this.m_joint2}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"SetRatio",value:function(t){this.m_ratio=t}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex,s=this.m_joint1.m_index,n=this.m_joint2.m_index;t("  const jd: b2GearJointDef = new b2GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",s),t("  jd.joint2 = joints[%d];\n",n),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),i}(Gs);Ls.InitVelocityConstraints_s_u=new at,Ls.InitVelocityConstraints_s_rA=new at,Ls.InitVelocityConstraints_s_rB=new at,Ls.InitVelocityConstraints_s_rC=new at,Ls.InitVelocityConstraints_s_rD=new at,Ls.SolvePositionConstraints_s_u=new at,Ls.SolvePositionConstraints_s_rA=new at,Ls.SolvePositionConstraints_s_rB=new at,Ls.SolvePositionConstraints_s_rC=new at,Ls.SolvePositionConstraints_s_rD=new at;var Rs=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this,t),s.m_linearOffset=new at,s.m_angularOffset=0,s.m_linearImpulse=new at,s.m_angularImpulse=0,s.m_maxForce=0,s.m_maxTorque=0,s.m_correctionFactor=.3,s.m_indexA=0,s.m_indexB=0,s.m_rA=new at,s.m_rB=new at,s.m_localCenterA=new at,s.m_localCenterB=new at,s.m_linearError=new at,s.m_angularError=0,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_linearMass=new Dt,s.m_angularMass=0,s.m_qA=new Xt,s.m_qB=new Xt,s.m_K=new Dt,s.m_linearOffset.Copy(t.linearOffset),s.m_linearImpulse.SetZero(),s.m_maxForce=t.maxForce,s.m_maxTorque=t.maxTorque,s.m_correctionFactor=t.correctionFactor,s}return Object(o["a"])(i,[{key:"GetAnchorA",value:function(){return this.m_bodyA.GetPosition()}},{key:"GetAnchorB",value:function(){return this.m_bodyB.GetPosition()}},{key:"GetReactionForce",value:function(t,e){return at.MulSV(t,this.m_linearImpulse,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"SetLinearOffset",value:function(t){at.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))}},{key:"GetLinearOffset",value:function(){return this.m_linearOffset}},{key:"SetAngularOffset",value:function(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)}},{key:"GetAngularOffset",value:function(){return this.m_angularOffset}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,a=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngle(i),m=this.m_qB.SetAngle(r),_=Xt.MulRV(u,at.NegV(this.m_localCenterA,at.s_t0),this.m_rA),h=Xt.MulRV(m,at.NegV(this.m_localCenterB,at.s_t0),this.m_rB),c=this.m_invMassA,f=this.m_invMassB,d=this.m_invIA,v=this.m_invIB,y=this.m_K;if(y.ex.x=c+f+d*_.y*_.y+v*h.y*h.y,y.ex.y=-d*_.x*_.y-v*h.x*h.y,y.ey.x=y.ex.y,y.ey.y=c+f+d*_.x*_.x+v*h.x*h.x,y.GetInverse(this.m_linearMass),this.m_angularMass=d+v,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),at.SubVV(at.SubVV(at.AddVV(a,h,at.s_t0),at.AddVV(e,_,at.s_t1),at.s_t2),Xt.MulRV(u,this.m_linearOffset,at.s_t3),this.m_linearError),this.m_angularError=r-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var p=this.m_linearImpulse;s.SelfMulSub(c,p),n-=d*(at.CrossVV(_,p)+this.m_angularImpulse),o.SelfMulAdd(f,p),l+=v*(at.CrossVV(h,p)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=l}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,r=this.m_invMassA,o=this.m_invMassB,l=this.m_invIA,u=this.m_invIB,m=t.step.dt,_=t.step.inv_dt,h=a-s+_*this.m_correctionFactor*this.m_angularError,c=-this.m_angularMass*h,f=this.m_angularImpulse,d=m*this.m_maxTorque;this.m_angularImpulse=Q(this.m_angularImpulse+c,-d,d),c=this.m_angularImpulse-f,s-=l*c,a+=u*c;var v=this.m_rA,y=this.m_rB,p=at.AddVV(at.SubVV(at.AddVV(n,at.CrossSV(a,y,at.s_t0),at.s_t0),at.AddVV(e,at.CrossSV(s,v,at.s_t1),at.s_t1),at.s_t2),at.MulSV(_*this.m_correctionFactor,this.m_linearError,at.s_t3),i.SolveVelocityConstraints_s_Cdot_v2),x=Dt.MulMV(this.m_linearMass,p,i.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),B=i.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(x);var S=m*this.m_maxForce;this.m_linearImpulse.LengthSquared()>S*S&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(S)),at.SubVV(this.m_linearImpulse,B,x),e.SelfMulSub(r,x),s-=l*at.CrossVV(v,x),n.SelfMulAdd(o,x),a+=u*at.CrossVV(y,x),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),i}(Gs);Rs.SolveVelocityConstraints_s_Cdot_v2=new at,Rs.SolveVelocityConstraints_s_impulse_v2=new at,Rs.SolveVelocityConstraints_s_oldImpulse_v2=new at;var Ts=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this,t),s.m_localAnchorB=null,s.m_targetA=null,s.m_frequencyHz=0,s.m_dampingRatio=0,s.m_beta=0,s.m_impulse=null,s.m_maxForce=0,s.m_gamma=0,s.m_indexA=0,s.m_indexB=0,s.m_rB=null,s.m_localCenterB=null,s.m_invMassB=0,s.m_invIB=0,s.m_mass=null,s.m_C=null,s.m_qB=null,s.m_lalcB=null,s.m_K=null,s.m_localAnchorB=new at,s.m_targetA=new at,s.m_impulse=new at,s.m_rB=new at,s.m_localCenterB=new at,s.m_mass=new Dt,s.m_C=new at,s.m_qB=new Xt,s.m_lalcB=new at,s.m_K=new Dt,s.m_targetA.Copy(t.target),Yt.MulTXV(s.m_bodyB.GetTransform(),s.m_targetA,s.m_localAnchorB),s.m_maxForce=t.maxForce,s.m_impulse.SetZero(),s.m_frequencyHz=t.frequencyHz,s.m_dampingRatio=t.dampingRatio,s.m_beta=0,s.m_gamma=0,s}return Object(o["a"])(i,[{key:"SetTarget",value:function(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)}},{key:"GetTarget",value:function(){return this.m_targetA}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,a=this.m_qB.SetAngle(i),r=this.m_bodyB.GetMass(),o=2*h*this.m_frequencyHz,l=2*r*this.m_dampingRatio*o,u=r*(o*o),m=t.step.dt;this.m_gamma=m*(l+m*u),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=m*u*this.m_gamma,at.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Xt.MulRV(a,this.m_lalcB,this.m_rB);var _=this.m_K;_.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,_.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,_.ey.x=_.ex.y,_.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,_.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),n*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),s.x+=this.m_invMassB*this.m_impulse.x,s.y+=this.m_invMassB*this.m_impulse.y,n+=this.m_invIB*at.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=n}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,n=at.AddVCrossSV(e,s,this.m_rB,i.SolveVelocityConstraints_s_Cdot),a=Dt.MulMV(this.m_mass,at.AddVV(n,at.AddVV(this.m_C,at.MulSV(this.m_gamma,this.m_impulse,at.s_t0),at.s_t0),at.s_t0).SelfNeg(),i.SolveVelocityConstraints_s_impulse),r=i.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(a);var o=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>o*o&&this.m_impulse.SelfMul(o/this.m_impulse.Length()),at.SubVV(this.m_impulse,r,a),e.SelfMulAdd(this.m_invMassB,a),s+=this.m_invIB*at.CrossVV(this.m_rB,a),t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return t.Copy(this.m_targetA)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return at.MulSV(t,this.m_impulse,e)}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"Dump",value:function(t){t("Mouse joint dumping is not supported.\n")}},{key:"ShiftOrigin",value:function(t){this.m_targetA.SelfSub(t)}}]),i}(Gs);Ts.SolveVelocityConstraints_s_Cdot=new at,Ts.SolveVelocityConstraints_s_impulse=new at,Ts.SolveVelocityConstraints_s_oldImpulse=new at;var qs=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this,t),s.m_localAnchorA=new at,s.m_localAnchorB=new at,s.m_localXAxisA=new at,s.m_localYAxisA=new at,s.m_referenceAngle=0,s.m_impulse=new It(0,0,0),s.m_motorImpulse=0,s.m_lowerTranslation=0,s.m_upperTranslation=0,s.m_maxMotorForce=0,s.m_motorSpeed=0,s.m_enableLimit=!1,s.m_enableMotor=!1,s.m_limitState=ws.e_inactiveLimit,s.m_indexA=0,s.m_indexB=0,s.m_localCenterA=new at,s.m_localCenterB=new at,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_axis=new at(0,0),s.m_perp=new at(0,0),s.m_s1=0,s.m_s2=0,s.m_a1=0,s.m_a2=0,s.m_K=new qt,s.m_K3=new qt,s.m_K2=new Dt,s.m_motorMass=0,s.m_qA=new Xt,s.m_qB=new Xt,s.m_lalcA=new at,s.m_lalcB=new at,s.m_rA=new at,s.m_rB=new at,s.m_localAnchorA.Copy(t.localAnchorA),s.m_localAnchorB.Copy(t.localAnchorB),s.m_localXAxisA.Copy(t.localAxisA).SelfNormalize(),at.CrossOneV(s.m_localXAxisA,s.m_localYAxisA),s.m_referenceAngle=t.referenceAngle,s.m_lowerTranslation=t.lowerTranslation,s.m_upperTranslation=t.upperTranslation,s.m_maxMotorForce=t.maxMotorForce,s.m_motorSpeed=t.motorSpeed,s.m_enableLimit=t.enableLimit,s.m_enableMotor=t.enableMotor,s}return Object(o["a"])(i,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(s),_=this.m_qB.SetAngle(o);at.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var h=Xt.MulRV(m,this.m_lalcA,this.m_rA);at.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var c=Xt.MulRV(_,this.m_lalcB,this.m_rB),f=at.AddVV(at.SubVV(r,e,at.s_t0),at.SubVV(c,h,at.s_t1),i.InitVelocityConstraints_s_d),d=this.m_invMassA,v=this.m_invMassB,p=this.m_invIA,x=this.m_invIB;if(Xt.MulRV(m,this.m_localXAxisA,this.m_axis),this.m_a1=at.CrossVV(at.AddVV(f,h,at.s_t0),this.m_axis),this.m_a2=at.CrossVV(c,this.m_axis),this.m_motorMass=d+v+p*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),Xt.MulRV(m,this.m_localYAxisA,this.m_perp),this.m_s1=at.CrossVV(at.AddVV(f,h,at.s_t0),this.m_perp),this.m_s2=at.CrossVV(c,this.m_perp),this.m_K.ex.x=d+v+p*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,this.m_K.ex.y=p*this.m_s1+x*this.m_s2,this.m_K.ex.z=p*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=p+x,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=p*this.m_a1+x*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=d+v+p*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_enableLimit){var B=at.DotVV(this.m_axis,f);H(this.m_upperTranslation-this.m_lowerTranslation)<2*y?this.m_limitState=ws.e_equalLimits:B<=this.m_lowerTranslation?this.m_limitState!==ws.e_atLowerLimit&&(this.m_limitState=ws.e_atLowerLimit,this.m_impulse.z=0):B>=this.m_upperTranslation?this.m_limitState!==ws.e_atUpperLimit&&(this.m_limitState=ws.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=ws.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=ws.e_inactiveLimit,this.m_impulse.z=0;if(this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var S=at.AddVV(at.MulSV(this.m_impulse.x,this.m_perp,at.s_t0),at.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,at.s_t1),i.InitVelocityConstraints_s_P),A=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,C=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.SelfMulSub(d,S),a-=p*A,l.SelfMulAdd(v,S),u+=x*C}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,r=this.m_invMassA,o=this.m_invMassB,l=this.m_invIA,u=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!==ws.e_equalLimits){var m=at.DotVV(this.m_axis,at.SubVV(n,e,at.s_t0))+this.m_a2*a-this.m_a1*s,_=this.m_motorMass*(this.m_motorSpeed-m),h=this.m_motorImpulse,c=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=Q(this.m_motorImpulse+_,-c,c),_=this.m_motorImpulse-h;var f=at.MulSV(_,this.m_axis,i.SolveVelocityConstraints_s_P),d=_*this.m_a1,v=_*this.m_a2;e.SelfMulSub(r,f),s-=l*d,n.SelfMulAdd(o,f),a+=u*v}var y=at.DotVV(this.m_perp,at.SubVV(n,e,at.s_t0))+this.m_s2*a-this.m_s1*s,p=a-s;if(this.m_enableLimit&&this.m_limitState!==ws.e_inactiveLimit){var x=at.DotVV(this.m_axis,at.SubVV(n,e,at.s_t0))+this.m_a2*a-this.m_a1*s,B=i.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),S=this.m_K.Solve33(-y,-p,-x,i.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(S),this.m_limitState===ws.e_atLowerLimit?this.m_impulse.z=K(this.m_impulse.z,0):this.m_limitState===ws.e_atUpperLimit&&(this.m_impulse.z=Y(this.m_impulse.z,0));var A=-y-(this.m_impulse.z-B.z)*this.m_K.ez.x,C=-p-(this.m_impulse.z-B.z)*this.m_K.ez.y,b=this.m_K.Solve22(A,C,i.SolveVelocityConstraints_s_f2r);b.x+=B.x,b.y+=B.y,this.m_impulse.x=b.x,this.m_impulse.y=b.y,S.x=this.m_impulse.x-B.x,S.y=this.m_impulse.y-B.y,S.z=this.m_impulse.z-B.z;var V=at.AddVV(at.MulSV(S.x,this.m_perp,at.s_t0),at.MulSV(S.z,this.m_axis,at.s_t1),i.SolveVelocityConstraints_s_P),g=S.x*this.m_s1+S.y+S.z*this.m_a1,w=S.x*this.m_s2+S.y+S.z*this.m_a2;e.SelfMulSub(r,V),s-=l*g,n.SelfMulAdd(o,V),a+=u*w}else{var k=this.m_K.Solve22(-y,-p,i.SolveVelocityConstraints_s_df2);this.m_impulse.x+=k.x,this.m_impulse.y+=k.y;var M=at.MulSV(k.x,this.m_perp,i.SolveVelocityConstraints_s_P),I=k.x*this.m_s1+k.y,P=k.x*this.m_s2+k.y;e.SelfMulSub(r,M),s-=l*I,n.SelfMulAdd(o,M),a+=u*P}t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,r=this.m_qA.SetAngle(s),o=this.m_qB.SetAngle(a),l=this.m_invMassA,u=this.m_invMassB,m=this.m_invIA,_=this.m_invIB,h=Xt.MulRV(r,this.m_lalcA,this.m_rA),c=Xt.MulRV(o,this.m_lalcB,this.m_rB),f=at.SubVV(at.AddVV(n,c,at.s_t0),at.AddVV(e,h,at.s_t1),i.SolvePositionConstraints_s_d),d=Xt.MulRV(r,this.m_localXAxisA,this.m_axis),v=at.CrossVV(at.AddVV(f,h,at.s_t0),d),x=at.CrossVV(c,d),B=Xt.MulRV(r,this.m_localYAxisA,this.m_perp),S=at.CrossVV(at.AddVV(f,h,at.s_t0),B),A=at.CrossVV(c,B),b=i.SolvePositionConstraints_s_impulse,V=at.DotVV(B,f),g=a-s-this.m_referenceAngle,w=H(V),k=H(g),M=!1,I=0;if(this.m_enableLimit){var P=at.DotVV(d,f);H(this.m_upperTranslation-this.m_lowerTranslation)<2*y?(I=Q(P,-C,C),w=K(w,H(P)),M=!0):P<=this.m_lowerTranslation?(I=Q(P-this.m_lowerTranslation+y,-C,0),w=K(w,this.m_lowerTranslation-P),M=!0):P>=this.m_upperTranslation&&(I=Q(P-this.m_upperTranslation-y,0,C),w=K(w,P-this.m_upperTranslation),M=!0)}if(M){var G=l+u+m*S*S+_*A*A,D=m*S+_*A,j=m*S*v+_*A*x,O=m+_;0===O&&(O=1);var F=m*v+_*x,L=l+u+m*v*v+_*x*x,R=this.m_K3;R.ex.SetXYZ(G,D,j),R.ey.SetXYZ(D,O,F),R.ez.SetXYZ(j,F,L),b=R.Solve33(-V,-g,-I,b)}else{var T=l+u+m*S*S+_*A*A,q=m*S+_*A,z=m+_;0===z&&(z=1);var N=this.m_K2;N.ex.Set(T,q),N.ey.Set(q,z);var E=N.Solve(-V,-g,i.SolvePositionConstraints_s_impulse1);b.x=E.x,b.y=E.y,b.z=0}var J=at.AddVV(at.MulSV(b.x,B,at.s_t0),at.MulSV(b.z,d,at.s_t1),i.SolvePositionConstraints_s_P),X=b.x*S+b.y+b.z*v,U=b.x*A+b.y+b.z*x;return e.SelfMulSub(l,J),s-=m*X,n.SelfMulAdd(u,J),a+=_*U,t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=a,w<=y&&k<=p}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.Set(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.y}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointTranslation",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,i.GetJointTranslation_s_pA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,i.GetJointTranslation_s_pB),s=at.SubVV(e,t,i.GetJointTranslation_s_d),n=this.m_bodyA.GetWorldVector(this.m_localXAxisA,i.GetJointTranslation_s_axis),a=at.DotVV(s,n);return a}},{key:"GetJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;at.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=Xt.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);at.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var s=Xt.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=at.AddVV(t.m_sweep.c,i,at.s_t0),a=at.AddVV(e.m_sweep.c,s,at.s_t1),r=at.SubVV(a,n,at.s_t2),o=t.GetWorldVector(this.m_localXAxisA,this.m_axis),l=t.m_linearVelocity,u=e.m_linearVelocity,m=t.m_angularVelocity,_=e.m_angularVelocity,h=at.DotVV(r,at.CrossSV(m,o,at.s_t0))+at.DotVV(o,at.SubVV(at.AddVCrossSV(u,_,s,at.s_t0),at.AddVCrossSV(l,m,i,at.s_t1),at.s_t0));return h}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerTranslation}},{key:"GetUpperLimit",value:function(){return this.m_upperTranslation}},{key:"SetLimits",value:function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t}},{key:"SetMotorSpeed",value:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorForce",value:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t}},{key:"GetMaxMotorForce",value:function(){return this.m_maxMotorForce}},{key:"GetMotorForce",value:function(t){return t*this.m_motorImpulse}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),i}(Gs);qs.InitVelocityConstraints_s_d=new at,qs.InitVelocityConstraints_s_P=new at,qs.SolveVelocityConstraints_s_P=new at,qs.SolveVelocityConstraints_s_f2r=new at,qs.SolveVelocityConstraints_s_f1=new It,qs.SolveVelocityConstraints_s_df3=new It,qs.SolveVelocityConstraints_s_df2=new at,qs.SolvePositionConstraints_s_d=new at,qs.SolvePositionConstraints_s_impulse=new It,qs.SolvePositionConstraints_s_impulse1=new at,qs.SolvePositionConstraints_s_P=new at,qs.GetJointTranslation_s_pA=new at,qs.GetJointTranslation_s_pB=new at,qs.GetJointTranslation_s_d=new at,qs.GetJointTranslation_s_axis=new at;var zs=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this,t),s.m_groundAnchorA=new at,s.m_groundAnchorB=new at,s.m_lengthA=0,s.m_lengthB=0,s.m_localAnchorA=new at,s.m_localAnchorB=new at,s.m_constant=0,s.m_ratio=0,s.m_impulse=0,s.m_indexA=0,s.m_indexB=0,s.m_uA=new at,s.m_uB=new at,s.m_rA=new at,s.m_rB=new at,s.m_localCenterA=new at,s.m_localCenterB=new at,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_mass=0,s.m_qA=new Xt,s.m_qB=new Xt,s.m_lalcA=new at,s.m_lalcB=new at,s.m_groundAnchorA.Copy(t.groundAnchorA),s.m_groundAnchorB.Copy(t.groundAnchorB),s.m_localAnchorA.Copy(t.localAnchorA),s.m_localAnchorB.Copy(t.localAnchorB),s.m_lengthA=t.lengthA,s.m_lengthB=t.lengthB,s.m_ratio=t.ratio,s.m_constant=t.lengthA+s.m_ratio*t.lengthB,s.m_impulse=0,s}return Object(o["a"])(i,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(s),_=this.m_qB.SetAngle(o);at.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Xt.MulRV(m,this.m_lalcA,this.m_rA),at.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Xt.MulRV(_,this.m_lalcB,this.m_rB),this.m_uA.Copy(e).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(r).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var h=this.m_uA.Length(),c=this.m_uB.Length();h>10*y?this.m_uA.SelfMul(1/h):this.m_uA.SetZero(),c>10*y?this.m_uB.SelfMul(1/c):this.m_uB.SetZero();var f=at.CrossVV(this.m_rA,this.m_uA),d=at.CrossVV(this.m_rB,this.m_uB),v=this.m_invMassA+this.m_invIA*f*f,p=this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=v+this.m_ratio*this.m_ratio*p,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var x=at.MulSV(-this.m_impulse,this.m_uA,i.InitVelocityConstraints_s_PA),B=at.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,i.InitVelocityConstraints_s_PB);n.SelfMulAdd(this.m_invMassA,x),a+=this.m_invIA*at.CrossVV(this.m_rA,x),l.SelfMulAdd(this.m_invMassB,B),u+=this.m_invIB*at.CrossVV(this.m_rB,B)}else this.m_impulse=0;t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,r=at.AddVCrossSV(e,s,this.m_rA,i.SolveVelocityConstraints_s_vpA),o=at.AddVCrossSV(n,a,this.m_rB,i.SolveVelocityConstraints_s_vpB),l=-at.DotVV(this.m_uA,r)-this.m_ratio*at.DotVV(this.m_uB,o),u=-this.m_mass*l;this.m_impulse+=u;var m=at.MulSV(-u,this.m_uA,i.SolveVelocityConstraints_s_PA),_=at.MulSV(-this.m_ratio*u,this.m_uB,i.SolveVelocityConstraints_s_PB);e.SelfMulAdd(this.m_invMassA,m),s+=this.m_invIA*at.CrossVV(this.m_rA,m),n.SelfMulAdd(this.m_invMassB,_),a+=this.m_invIB*at.CrossVV(this.m_rB,_),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,r=this.m_qA.SetAngle(s),o=this.m_qB.SetAngle(a);at.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=Xt.MulRV(r,this.m_lalcA,this.m_rA);at.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u=Xt.MulRV(o,this.m_lalcB,this.m_rB),m=this.m_uA.Copy(e).SelfAdd(l).SelfSub(this.m_groundAnchorA),_=this.m_uB.Copy(n).SelfAdd(u).SelfSub(this.m_groundAnchorB),h=m.Length(),c=_.Length();h>10*y?m.SelfMul(1/h):m.SetZero(),c>10*y?_.SelfMul(1/c):_.SetZero();var f=at.CrossVV(l,m),d=at.CrossVV(u,_),v=this.m_invMassA+this.m_invIA*f*f,p=this.m_invMassB+this.m_invIB*d*d,x=v+this.m_ratio*this.m_ratio*p;x>0&&(x=1/x);var B=this.m_constant-h-this.m_ratio*c,S=H(B),A=-x*B,C=at.MulSV(-A,m,i.SolvePositionConstraints_s_PA),b=at.MulSV(-this.m_ratio*A,_,i.SolvePositionConstraints_s_PB);return e.SelfMulAdd(this.m_invMassA,C),s+=this.m_invIA*at.CrossVV(l,C),n.SelfMulAdd(this.m_invMassB,b),a+=this.m_invIB*at.CrossVV(u,b),t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=a,S<y}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.Set(t*this.m_impulse*this.m_uB.x,t*this.m_impulse*this.m_uB.y)}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetGroundAnchorA",value:function(){return this.m_groundAnchorA}},{key:"GetGroundAnchorB",value:function(){return this.m_groundAnchorB}},{key:"GetLengthA",value:function(){return this.m_lengthA}},{key:"GetLengthB",value:function(){return this.m_lengthB}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"GetCurrentLengthA",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,i.GetCurrentLengthA_s_p),e=this.m_groundAnchorA;return at.DistanceVV(t,e)}},{key:"GetCurrentLengthB",value:function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,i.GetCurrentLengthB_s_p),e=this.m_groundAnchorB;return at.DistanceVV(t,e)}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"ShiftOrigin",value:function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)}}]),i}(Gs);zs.InitVelocityConstraints_s_PA=new at,zs.InitVelocityConstraints_s_PB=new at,zs.SolveVelocityConstraints_s_vpA=new at,zs.SolveVelocityConstraints_s_vpB=new at,zs.SolveVelocityConstraints_s_PA=new at,zs.SolveVelocityConstraints_s_PB=new at,zs.SolvePositionConstraints_s_PA=new at,zs.SolvePositionConstraints_s_PB=new at,zs.GetCurrentLengthA_s_p=new at,zs.GetCurrentLengthB_s_p=new at;var Ns=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this,t),s.m_localAnchorA=new at,s.m_localAnchorB=new at,s.m_impulse=new It,s.m_motorImpulse=0,s.m_enableMotor=!1,s.m_maxMotorTorque=0,s.m_motorSpeed=0,s.m_enableLimit=!1,s.m_referenceAngle=0,s.m_lowerAngle=0,s.m_upperAngle=0,s.m_indexA=0,s.m_indexB=0,s.m_rA=new at,s.m_rB=new at,s.m_localCenterA=new at,s.m_localCenterB=new at,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_mass=new qt,s.m_motorMass=0,s.m_limitState=ws.e_inactiveLimit,s.m_qA=new Xt,s.m_qB=new Xt,s.m_lalcA=new at,s.m_lalcB=new at,s.m_K=new Dt,s.m_localAnchorA.Copy(t.localAnchorA),s.m_localAnchorB.Copy(t.localAnchorB),s.m_referenceAngle=t.referenceAngle,s.m_impulse.SetZero(),s.m_motorImpulse=0,s.m_lowerAngle=t.lowerAngle,s.m_upperAngle=t.upperAngle,s.m_maxMotorTorque=t.maxMotorTorque,s.m_motorSpeed=t.motorSpeed,s.m_enableLimit=t.enableLimit,s.m_enableMotor=t.enableMotor,s.m_limitState=ws.e_inactiveLimit,s}return Object(o["a"])(i,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,a=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngle(e),u=this.m_qB.SetAngle(a);at.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Xt.MulRV(l,this.m_lalcA,this.m_rA),at.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Xt.MulRV(u,this.m_lalcB,this.m_rB);var m=this.m_invMassA,_=this.m_invMassB,h=this.m_invIA,c=this.m_invIB,f=h+c===0;if(this.m_mass.ex.x=m+_+this.m_rA.y*this.m_rA.y*h+this.m_rB.y*this.m_rB.y*c,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*h-this.m_rB.y*this.m_rB.x*c,this.m_mass.ez.x=-this.m_rA.y*h-this.m_rB.y*c,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=m+_+this.m_rA.x*this.m_rA.x*h+this.m_rB.x*this.m_rB.x*c,this.m_mass.ez.y=this.m_rA.x*h+this.m_rB.x*c,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=h+c,this.m_motorMass=h+c,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!f||(this.m_motorImpulse=0),this.m_enableLimit&&!f){var d=a-e-this.m_referenceAngle;H(this.m_upperAngle-this.m_lowerAngle)<2*p?this.m_limitState=ws.e_equalLimits:d<=this.m_lowerAngle?(this.m_limitState!==ws.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=ws.e_atLowerLimit):d>=this.m_upperAngle?(this.m_limitState!==ws.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=ws.e_atUpperLimit):(this.m_limitState=ws.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=ws.e_inactiveLimit;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var v=i.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);s.SelfMulSub(m,v),n-=h*(at.CrossVV(this.m_rA,v)+this.m_motorImpulse+this.m_impulse.z),r.SelfMulAdd(_,v),o+=c*(at.CrossVV(this.m_rB,v)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=o}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,r=this.m_invMassA,o=this.m_invMassB,l=this.m_invIA,u=this.m_invIB,m=l+u===0;if(this.m_enableMotor&&this.m_limitState!==ws.e_equalLimits&&!m){var _=a-s-this.m_motorSpeed,h=-this.m_motorMass*_,c=this.m_motorImpulse,f=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=Q(this.m_motorImpulse+h,-f,f),h=this.m_motorImpulse-c,s-=l*h,a+=u*h}if(this.m_enableLimit&&this.m_limitState!==ws.e_inactiveLimit&&!m){var d=at.SubVV(at.AddVCrossSV(n,a,this.m_rB,at.s_t0),at.AddVCrossSV(e,s,this.m_rA,at.s_t1),i.SolveVelocityConstraints_s_Cdot1),v=a-s,y=this.m_mass.Solve33(d.x,d.y,v,i.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(this.m_limitState===ws.e_equalLimits)this.m_impulse.SelfAdd(y);else if(this.m_limitState===ws.e_atLowerLimit){var p=this.m_impulse.z+y.z;if(p<0){var x=-d.x+this.m_impulse.z*this.m_mass.ez.x,B=-d.y+this.m_impulse.z*this.m_mass.ez.y,S=this.m_mass.Solve22(x,B,i.SolveVelocityConstraints_s_reduced_v2);y.x=S.x,y.y=S.y,y.z=-this.m_impulse.z,this.m_impulse.x+=S.x,this.m_impulse.y+=S.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(y)}else if(this.m_limitState===ws.e_atUpperLimit){var A=this.m_impulse.z+y.z;if(A>0){var C=-d.x+this.m_impulse.z*this.m_mass.ez.x,b=-d.y+this.m_impulse.z*this.m_mass.ez.y,V=this.m_mass.Solve22(C,b,i.SolveVelocityConstraints_s_reduced_v2);y.x=V.x,y.y=V.y,y.z=-this.m_impulse.z,this.m_impulse.x+=V.x,this.m_impulse.y+=V.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(y)}var g=i.SolveVelocityConstraints_s_P.Set(y.x,y.y);e.SelfMulSub(r,g),s-=l*(at.CrossVV(this.m_rA,g)+y.z),n.SelfMulAdd(o,g),a+=u*(at.CrossVV(this.m_rB,g)+y.z)}else{var w=at.SubVV(at.AddVCrossSV(n,a,this.m_rB,at.s_t0),at.AddVCrossSV(e,s,this.m_rA,at.s_t1),i.SolveVelocityConstraints_s_Cdot_v2),k=this.m_mass.Solve22(-w.x,-w.y,i.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=k.x,this.m_impulse.y+=k.y,e.SelfMulSub(r,k),s-=l*at.CrossVV(this.m_rA,k),n.SelfMulAdd(o,k),a+=u*at.CrossVV(this.m_rB,k)}t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,r=this.m_qA.SetAngle(s),o=this.m_qB.SetAngle(a),l=0,u=0,m=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&this.m_limitState!==ws.e_inactiveLimit&&!m){var _=a-s-this.m_referenceAngle,h=0;if(this.m_limitState===ws.e_equalLimits){var c=Q(_-this.m_lowerAngle,-b,b);h=-this.m_motorMass*c,l=H(c)}else if(this.m_limitState===ws.e_atLowerLimit){var f=_-this.m_lowerAngle;l=-f,f=Q(f+p,-b,0),h=-this.m_motorMass*f}else if(this.m_limitState===ws.e_atUpperLimit){var d=_-this.m_upperAngle;l=d,d=Q(d-p,0,b),h=-this.m_motorMass*d}s-=this.m_invIA*h,a+=this.m_invIB*h}r.SetAngle(s),o.SetAngle(a),at.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var v=Xt.MulRV(r,this.m_lalcA,this.m_rA);at.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var x=Xt.MulRV(o,this.m_lalcB,this.m_rB),B=at.SubVV(at.AddVV(n,x,at.s_t0),at.AddVV(e,v,at.s_t1),i.SolvePositionConstraints_s_C_v2);u=B.Length();var S=this.m_invMassA,A=this.m_invMassB,C=this.m_invIA,V=this.m_invIB,g=this.m_K;g.ex.x=S+A+C*v.y*v.y+V*x.y*x.y,g.ex.y=-C*v.x*v.y-V*x.x*x.y,g.ey.x=g.ex.y,g.ey.y=S+A+C*v.x*v.x+V*x.x*x.x;var w=g.Solve(B.x,B.y,i.SolvePositionConstraints_s_impulse).SelfNeg();return e.SelfMulSub(S,w),s-=C*at.CrossVV(v,w),n.SelfMulAdd(A,w),a+=V*at.CrossVV(x,w),t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=a,u<=y&&l<=p}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.Set(t*this.m_impulse.x,t*this.m_impulse.y)}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.z}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}},{key:"GetJointSpeed",value:function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){this.m_enableMotor!==t&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorTorque",value:function(t){this.m_maxMotorTorque=t}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerAngle}},{key:"GetUpperLimit",value:function(){return this.m_upperAngle}},{key:"SetLimits",value:function(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)}},{key:"SetMotorSpeed",value:function(t){this.m_motorSpeed!==t&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),i}(Gs);Ns.InitVelocityConstraints_s_P=new at,Ns.SolveVelocityConstraints_s_P=new at,Ns.SolveVelocityConstraints_s_Cdot_v2=new at,Ns.SolveVelocityConstraints_s_Cdot1=new at,Ns.SolveVelocityConstraints_s_impulse_v3=new It,Ns.SolveVelocityConstraints_s_reduced_v2=new at,Ns.SolveVelocityConstraints_s_impulse_v2=new at,Ns.SolvePositionConstraints_s_C_v2=new at,Ns.SolvePositionConstraints_s_impulse=new at;var Es=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this,t),s.m_localAnchorA=new at,s.m_localAnchorB=new at,s.m_maxLength=0,s.m_length=0,s.m_impulse=0,s.m_indexA=0,s.m_indexB=0,s.m_u=new at,s.m_rA=new at,s.m_rB=new at,s.m_localCenterA=new at,s.m_localCenterB=new at,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_mass=0,s.m_state=ws.e_inactiveLimit,s.m_qA=new Xt,s.m_qB=new Xt,s.m_lalcA=new at,s.m_lalcB=new at,s.m_localAnchorA.Copy(t.localAnchorA),s.m_localAnchorB.Copy(t.localAnchorB),s.m_maxLength=t.maxLength,s}return Object(o["a"])(i,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(s),_=this.m_qB.SetAngle(o);at.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Xt.MulRV(m,this.m_lalcA,this.m_rA),at.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Xt.MulRV(_,this.m_lalcB,this.m_rB),this.m_u.Copy(r).SelfAdd(this.m_rB).SelfSub(e).SelfSub(this.m_rA),this.m_length=this.m_u.Length();var h=this.m_length-this.m_maxLength;if(this.m_state=h>0?ws.e_atUpperLimit:ws.e_inactiveLimit,!(this.m_length>y))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);var c=at.CrossVV(this.m_rA,this.m_u),f=at.CrossVV(this.m_rB,this.m_u),d=this.m_invMassA+this.m_invIA*c*c+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!==d?1/d:0,t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var v=at.MulSV(this.m_impulse,this.m_u,i.InitVelocityConstraints_s_P);n.SelfMulSub(this.m_invMassA,v),a-=this.m_invIA*at.CrossVV(this.m_rA,v),l.SelfMulAdd(this.m_invMassB,v),u+=this.m_invIB*at.CrossVV(this.m_rB,v)}else this.m_impulse=0;t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,r=at.AddVCrossSV(e,s,this.m_rA,i.SolveVelocityConstraints_s_vpA),o=at.AddVCrossSV(n,a,this.m_rB,i.SolveVelocityConstraints_s_vpB),l=this.m_length-this.m_maxLength,u=at.DotVV(this.m_u,at.SubVV(o,r,at.s_t0));l<0&&(u+=t.step.inv_dt*l);var m=-this.m_mass*u,_=this.m_impulse;this.m_impulse=Y(0,this.m_impulse+m),m=this.m_impulse-_;var h=at.MulSV(m,this.m_u,i.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,h),s-=this.m_invIA*at.CrossVV(this.m_rA,h),n.SelfMulAdd(this.m_invMassB,h),a+=this.m_invIB*at.CrossVV(this.m_rB,h),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,r=this.m_qA.SetAngle(s),o=this.m_qB.SetAngle(a);at.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=Xt.MulRV(r,this.m_lalcA,this.m_rA);at.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u=Xt.MulRV(o,this.m_lalcB,this.m_rB),m=this.m_u.Copy(n).SelfAdd(u).SelfSub(e).SelfSub(l),_=m.Normalize(),h=_-this.m_maxLength;h=Q(h,0,C);var c=-this.m_mass*h,f=at.MulSV(c,m,i.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,f),s-=this.m_invIA*at.CrossVV(l,f),n.SelfMulAdd(this.m_invMassB,f),a+=this.m_invIB*at.CrossVV(u,f),t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=a,_-this.m_maxLength<y}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){var i=at.MulSV(t*this.m_impulse,this.m_u,e);return i}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetMaxLength",value:function(t){this.m_maxLength=t}},{key:"GetMaxLength",value:function(){return this.m_maxLength}},{key:"GetLimitState",value:function(){return this.m_state}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RopeJointDef = new b2RopeJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),i}(Gs);Es.InitVelocityConstraints_s_P=new at,Es.SolveVelocityConstraints_s_vpA=new at,Es.SolveVelocityConstraints_s_vpB=new at,Es.SolveVelocityConstraints_s_P=new at,Es.SolvePositionConstraints_s_P=new at;var Js=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this,t),s.m_frequencyHz=0,s.m_dampingRatio=0,s.m_bias=0,s.m_localAnchorA=new at,s.m_localAnchorB=new at,s.m_referenceAngle=0,s.m_gamma=0,s.m_impulse=new It(0,0,0),s.m_indexA=0,s.m_indexB=0,s.m_rA=new at,s.m_rB=new at,s.m_localCenterA=new at,s.m_localCenterB=new at,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_mass=new qt,s.m_qA=new Xt,s.m_qB=new Xt,s.m_lalcA=new at,s.m_lalcB=new at,s.m_K=new qt,s.m_frequencyHz=t.frequencyHz,s.m_dampingRatio=t.dampingRatio,s.m_localAnchorA.Copy(t.localAnchorA),s.m_localAnchorB.Copy(t.localAnchorB),s.m_referenceAngle=t.referenceAngle,s.m_impulse.SetZero(),s}return Object(o["a"])(i,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,a=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngle(e),u=this.m_qB.SetAngle(a);at.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Xt.MulRV(l,this.m_lalcA,this.m_rA),at.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Xt.MulRV(u,this.m_lalcB,this.m_rB);var m=this.m_invMassA,_=this.m_invMassB,c=this.m_invIA,f=this.m_invIB,d=this.m_K;if(d.ex.x=m+_+this.m_rA.y*this.m_rA.y*c+this.m_rB.y*this.m_rB.y*f,d.ey.x=-this.m_rA.y*this.m_rA.x*c-this.m_rB.y*this.m_rB.x*f,d.ez.x=-this.m_rA.y*c-this.m_rB.y*f,d.ex.y=d.ey.x,d.ey.y=m+_+this.m_rA.x*this.m_rA.x*c+this.m_rB.x*this.m_rB.x*f,d.ez.y=this.m_rA.x*c+this.m_rB.x*f,d.ex.z=d.ez.x,d.ey.z=d.ez.y,d.ez.z=c+f,this.m_frequencyHz>0){d.GetInverse22(this.m_mass);var v=c+f,y=v>0?1/v:0,p=a-e-this.m_referenceAngle,x=2*h*this.m_frequencyHz,B=2*y*this.m_dampingRatio*x,S=y*x*x,A=t.step.dt;this.m_gamma=A*(B+A*S),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=p*A*S*this.m_gamma,v+=this.m_gamma,this.m_mass.ez.z=0!==v?1/v:0}else d.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);var C=i.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);s.SelfMulSub(m,C),n-=c*(at.CrossVV(this.m_rA,C)+this.m_impulse.z),r.SelfMulAdd(_,C),o+=f*(at.CrossVV(this.m_rB,C)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=o}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,r=this.m_invMassA,o=this.m_invMassB,l=this.m_invIA,u=this.m_invIB;if(this.m_frequencyHz>0){var m=a-s,_=-this.m_mass.ez.z*(m+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=_,s-=l*_,a+=u*_;var h=at.SubVV(at.AddVCrossSV(n,a,this.m_rB,at.s_t0),at.AddVCrossSV(e,s,this.m_rA,at.s_t1),i.SolveVelocityConstraints_s_Cdot1),c=qt.MulM33XY(this.m_mass,h.x,h.y,i.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=c.x,this.m_impulse.y+=c.y;var f=c;e.SelfMulSub(r,f),s-=l*at.CrossVV(this.m_rA,f),n.SelfMulAdd(o,f),a+=u*at.CrossVV(this.m_rB,f)}else{var d=at.SubVV(at.AddVCrossSV(n,a,this.m_rB,at.s_t0),at.AddVCrossSV(e,s,this.m_rA,at.s_t1),i.SolveVelocityConstraints_s_Cdot1),v=a-s,y=qt.MulM33XYZ(this.m_mass,d.x,d.y,v,i.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(y);var p=i.SolveVelocityConstraints_s_P.Set(y.x,y.y);e.SelfMulSub(r,p),s-=l*(at.CrossVV(this.m_rA,p)+y.z),n.SelfMulAdd(o,p),a+=u*(at.CrossVV(this.m_rB,p)+y.z)}t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,r=this.m_qA.SetAngle(s),o=this.m_qB.SetAngle(a),l=this.m_invMassA,u=this.m_invMassB,m=this.m_invIA,_=this.m_invIB;at.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var h=Xt.MulRV(r,this.m_lalcA,this.m_rA);at.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var c,f,d=Xt.MulRV(o,this.m_lalcB,this.m_rB),v=this.m_K;if(v.ex.x=l+u+h.y*h.y*m+d.y*d.y*_,v.ey.x=-h.y*h.x*m-d.y*d.x*_,v.ez.x=-h.y*m-d.y*_,v.ex.y=v.ey.x,v.ey.y=l+u+h.x*h.x*m+d.x*d.x*_,v.ez.y=h.x*m+d.x*_,v.ex.z=v.ez.x,v.ey.z=v.ez.y,v.ez.z=m+_,this.m_frequencyHz>0){var x=at.SubVV(at.AddVV(n,d,at.s_t0),at.AddVV(e,h,at.s_t1),i.SolvePositionConstraints_s_C1);c=x.Length(),f=0;var B=v.Solve22(x.x,x.y,i.SolvePositionConstraints_s_P).SelfNeg();e.SelfMulSub(l,B),s-=m*at.CrossVV(h,B),n.SelfMulAdd(u,B),a+=_*at.CrossVV(d,B)}else{var S=at.SubVV(at.AddVV(n,d,at.s_t0),at.AddVV(e,h,at.s_t1),i.SolvePositionConstraints_s_C1),A=a-s-this.m_referenceAngle;c=S.Length(),f=H(A);var C=v.Solve33(S.x,S.y,A,i.SolvePositionConstraints_s_impulse).SelfNeg(),b=i.SolvePositionConstraints_s_P.Set(C.x,C.y);e.SelfMulSub(l,b),s-=m*(at.CrossVV(this.m_rA,b)+C.z),n.SelfMulAdd(u,b),a+=_*(at.CrossVV(this.m_rB,b)+C.z)}return t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=a,c<=y&&f<=p}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.Set(t*this.m_impulse.x,t*this.m_impulse.y)}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.z}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),i}(Gs);Js.InitVelocityConstraints_s_P=new at,Js.SolveVelocityConstraints_s_Cdot1=new at,Js.SolveVelocityConstraints_s_impulse1=new at,Js.SolveVelocityConstraints_s_impulse=new It,Js.SolveVelocityConstraints_s_P=new at,Js.SolvePositionConstraints_s_C1=new at,Js.SolvePositionConstraints_s_P=new at,Js.SolvePositionConstraints_s_impulse=new It;var Xs=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this,t),s.m_frequencyHz=0,s.m_dampingRatio=0,s.m_localAnchorA=new at,s.m_localAnchorB=new at,s.m_localXAxisA=new at,s.m_localYAxisA=new at,s.m_impulse=0,s.m_motorImpulse=0,s.m_springImpulse=0,s.m_maxMotorTorque=0,s.m_motorSpeed=0,s.m_enableMotor=!1,s.m_indexA=0,s.m_indexB=0,s.m_localCenterA=new at,s.m_localCenterB=new at,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_ax=new at,s.m_ay=new at,s.m_sAx=0,s.m_sBx=0,s.m_sAy=0,s.m_sBy=0,s.m_mass=0,s.m_motorMass=0,s.m_springMass=0,s.m_bias=0,s.m_gamma=0,s.m_qA=new Xt,s.m_qB=new Xt,s.m_lalcA=new at,s.m_lalcB=new at,s.m_rA=new at,s.m_rB=new at,s.m_frequencyHz=t.frequencyHz,s.m_dampingRatio=t.dampingRatio,s.m_localAnchorA.Copy(t.localAnchorA),s.m_localAnchorB.Copy(t.localAnchorB),s.m_localXAxisA.Copy(t.localAxisA),at.CrossOneV(s.m_localXAxisA,s.m_localYAxisA),s.m_maxMotorTorque=t.maxMotorTorque,s.m_motorSpeed=t.motorSpeed,s.m_enableMotor=t.enableMotor,s.m_ax.SetZero(),s.m_ay.SetZero(),s}return Object(o["a"])(i,[{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"SetSpringFrequencyHz",value:function(t){this.m_frequencyHz=t}},{key:"GetSpringFrequencyHz",value:function(){return this.m_frequencyHz}},{key:"SetSpringDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetSpringDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,s=this.m_invMassB,n=this.m_invIA,a=this.m_invIB,r=t.positions[this.m_indexA].c,o=t.positions[this.m_indexA].a,l=t.velocities[this.m_indexA].v,u=t.velocities[this.m_indexA].w,m=t.positions[this.m_indexB].c,_=t.positions[this.m_indexB].a,c=t.velocities[this.m_indexB].v,f=t.velocities[this.m_indexB].w,d=this.m_qA.SetAngle(o),v=this.m_qB.SetAngle(_);at.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var y=Xt.MulRV(d,this.m_lalcA,this.m_rA);at.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var p=Xt.MulRV(v,this.m_lalcB,this.m_rB),x=at.SubVV(at.AddVV(m,p,at.s_t0),at.AddVV(r,y,at.s_t1),i.InitVelocityConstraints_s_d);if(Xt.MulRV(d,this.m_localYAxisA,this.m_ay),this.m_sAy=at.CrossVV(at.AddVV(x,y,at.s_t0),this.m_ay),this.m_sBy=at.CrossVV(p,this.m_ay),this.m_mass=e+s+n*this.m_sAy*this.m_sAy+a*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){Xt.MulRV(d,this.m_localXAxisA,this.m_ax),this.m_sAx=at.CrossVV(at.AddVV(x,y,at.s_t0),this.m_ax),this.m_sBx=at.CrossVV(p,this.m_ax);var B=e+s+n*this.m_sAx*this.m_sAx+a*this.m_sBx*this.m_sBx;if(B>0){this.m_springMass=1/B;var S=at.DotVV(x,this.m_ax),A=2*h*this.m_frequencyHz,C=2*this.m_springMass*this.m_dampingRatio*A,b=this.m_springMass*A*A,V=t.step.dt;this.m_gamma=V*(C+V*b),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=S*V*b*this.m_gamma,this.m_springMass=B+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=n+a,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;var g=at.AddVV(at.MulSV(this.m_impulse,this.m_ay,at.s_t0),at.MulSV(this.m_springImpulse,this.m_ax,at.s_t1),i.InitVelocityConstraints_s_P),w=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,k=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;l.SelfMulSub(this.m_invMassA,g),u-=this.m_invIA*w,c.SelfMulAdd(this.m_invMassB,g),f+=this.m_invIB*k}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].w=u,t.velocities[this.m_indexB].w=f}},{key:"SolveVelocityConstraints",value:function(t){var e=this.m_invMassA,s=this.m_invMassB,n=this.m_invIA,a=this.m_invIB,r=t.velocities[this.m_indexA].v,o=t.velocities[this.m_indexA].w,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,m=at.DotVV(this.m_ax,at.SubVV(l,r,at.s_t0))+this.m_sBx*u-this.m_sAx*o,_=-this.m_springMass*(m+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=_;var h=at.MulSV(_,this.m_ax,i.SolveVelocityConstraints_s_P),c=_*this.m_sAx,f=_*this.m_sBx;r.SelfMulSub(e,h),o-=n*c,l.SelfMulAdd(s,h),u+=a*f;var d=u-o-this.m_motorSpeed,v=-this.m_motorMass*d,y=this.m_motorImpulse,p=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=Q(this.m_motorImpulse+v,-p,p),v=this.m_motorImpulse-y,o-=n*v,u+=a*v;var x=at.DotVV(this.m_ay,at.SubVV(l,r,at.s_t0))+this.m_sBy*u-this.m_sAy*o,B=-this.m_mass*x;this.m_impulse+=B;var S=at.MulSV(B,this.m_ay,i.SolveVelocityConstraints_s_P),A=B*this.m_sAy,C=B*this.m_sBy;r.SelfMulSub(e,S),o-=n*A,l.SelfMulAdd(s,S),u+=a*C,t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=u}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,r=this.m_qA.SetAngle(s),o=this.m_qB.SetAngle(a);at.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=Xt.MulRV(r,this.m_lalcA,this.m_rA);at.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u,m=Xt.MulRV(o,this.m_lalcB,this.m_rB),_=at.AddVV(at.SubVV(n,e,at.s_t0),at.SubVV(m,l,at.s_t1),i.SolvePositionConstraints_s_d),h=Xt.MulRV(r,this.m_localYAxisA,this.m_ay),c=at.CrossVV(at.AddVV(_,l,at.s_t0),h),f=at.CrossVV(m,h),d=at.DotVV(_,this.m_ay),v=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;u=0!==v?-d/v:0;var p=at.MulSV(u,h,i.SolvePositionConstraints_s_P),x=u*c,B=u*f;return e.SelfMulSub(this.m_invMassA,p),s-=this.m_invIA*x,n.SelfMulAdd(this.m_invMassB,p),a+=this.m_invIB*B,t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=a,H(d)<=y}},{key:"GetDefinition",value:function(t){return t}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e}},{key:"GetReactionTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetJointTranslation",value:function(){return this.GetPrismaticJointTranslation()}},{key:"GetJointSpeed",value:function(){return this.GetRevoluteJointSpeed()}},{key:"GetPrismaticJointTranslation",value:function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new at),s=e.GetWorldPoint(this.m_localAnchorB,new at),n=at.SubVV(s,i,new at),a=t.GetWorldVector(this.m_localXAxisA,new at),r=at.DotVV(n,a);return r}},{key:"GetPrismaticJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;at.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=Xt.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);at.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var s=Xt.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=at.AddVV(t.m_sweep.c,i,at.s_t0),a=at.AddVV(e.m_sweep.c,s,at.s_t1),r=at.SubVV(a,n,at.s_t2),o=t.GetWorldVector(this.m_localXAxisA,new at),l=t.m_linearVelocity,u=e.m_linearVelocity,m=t.m_angularVelocity,_=e.m_angularVelocity,h=at.DotVV(r,at.CrossSV(m,o,at.s_t0))+at.DotVV(o,at.SubVV(at.AddVCrossSV(u,_,s,at.s_t0),at.AddVCrossSV(l,m,i,at.s_t1),at.s_t0));return h}},{key:"GetRevoluteJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}},{key:"GetRevoluteJointSpeed",value:function(){var t=this.m_bodyA.m_angularVelocity,e=this.m_bodyB.m_angularVelocity;return e-t}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t}},{key:"SetMotorSpeed",value:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t}},{key:"SetMaxMotorTorque",value:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),i}(Gs);Xs.InitVelocityConstraints_s_d=new at,Xs.InitVelocityConstraints_s_P=new at,Xs.SolveVelocityConstraints_s_P=new at,Xs.SolvePositionConstraints_s_d=new at,Xs.SolvePositionConstraints_s_P=new at;var Us=function(){function t(){Object(r["a"])(this,t)}return Object(o["a"])(t,null,[{key:"Create",value:function(t,e){var i=null;switch(t.type){case gs.e_distanceJoint:i=new js(t);break;case gs.e_mouseJoint:i=new Ts(t);break;case gs.e_prismaticJoint:i=new qs(t);break;case gs.e_revoluteJoint:i=new Ns(t);break;case gs.e_pulleyJoint:i=new zs(t);break;case gs.e_gearJoint:i=new Ls(t);break;case gs.e_wheelJoint:i=new Xs(t);break;case gs.e_weldJoint:i=new Js(t);break;case gs.e_frictionJoint:i=new Fs(t);break;case gs.e_ropeJoint:i=new Es(t);break;case gs.e_motorJoint:i=new Rs(t);break;case gs.e_areaJoint:i=new Os(t);break;default:break}return i}},{key:"Destroy",value:function(t,e){}}]),t}();function Ws(t,e){return et(t*e)}function Zs(t,e){return t>e?t:e}var Hs=function t(){Object(r["a"])(this,t),this.other=null,this.contact=null,this.prev=null,this.next=null},Ys=function(){function t(){Object(r["a"])(this,t),this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_nodeA=new Hs,this.m_nodeB=new Hs,this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=0,this.m_indexB=0,this.m_manifold=new ke,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_oldManifold=new ke}return Object(o["a"])(t,[{key:"GetManifold",value:function(){return this.m_manifold}},{key:"GetWorldManifold",value:function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),s=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),s.m_radius,i.GetTransform(),n.m_radius)}},{key:"IsTouching",value:function(){return this.m_touchingFlag}},{key:"SetEnabled",value:function(t){this.m_enabledFlag=t}},{key:"IsEnabled",value:function(){return this.m_enabledFlag}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetFixtureA",value:function(){return this.m_fixtureA}},{key:"GetChildIndexA",value:function(){return this.m_indexA}},{key:"GetFixtureB",value:function(){return this.m_fixtureB}},{key:"GetChildIndexB",value:function(){return this.m_indexB}},{key:"Evaluate",value:function(t,e,i){}},{key:"FlagForFiltering",value:function(){this.m_filterFlag=!0}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"ResetFriction",value:function(){this.m_friction=Ws(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"ResetRestitution",value:function(){this.m_restitution=Zs(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}},{key:"SetTangentSpeed",value:function(t){this.m_tangentSpeed=t}},{key:"GetTangentSpeed",value:function(){return this.m_tangentSpeed}},{key:"Reset",value:function(t,e,i,s){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=s,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null,this.m_toiCount=0,this.m_friction=Ws(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Zs(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}},{key:"Update",value:function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;var i=!1,s=this.m_touchingFlag,n=this.m_fixtureA.IsSensor(),a=this.m_fixtureB.IsSensor(),r=n||a,o=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody(),u=o.GetTransform(),m=l.GetTransform();if(r){var _=this.m_fixtureA.GetShape(),h=this.m_fixtureB.GetShape();i=Te(_,this.m_indexA,h,this.m_indexB,u,m),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,u,m),i=this.m_manifold.pointCount>0;for(var c=0;c<this.m_manifold.pointCount;++c){var f=this.m_manifold.points[c];f.normalImpulse=0,f.tangentImpulse=0;for(var d=f.id,v=0;v<this.m_oldManifold.pointCount;++v){var y=this.m_oldManifold.points[v];if(y.id.key===d.key){f.normalImpulse=y.normalImpulse,f.tangentImpulse=y.tangentImpulse;break}}}i!==s&&(o.SetAwake(!0),l.SetAwake(!0))}this.m_touchingFlag=i,!s&&i&&t&&t.BeginContact(this),s&&!i&&t&&t.EndContact(this),!r&&i&&t&&t.PreSolve(this,this.m_oldManifold)}},{key:"ComputeTOI",value:function(e,i){var s=t.ComputeTOI_s_input;s.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),s.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),s.sweepA.Copy(e),s.sweepB.Copy(i),s.tMax=y;var n=t.ComputeTOI_s_output;return di(n,s),n.t}}]),t}();Ys.ComputeTOI_s_input=new ii,Ys.ComputeTOI_s_output=new ni;var Ks=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(){return Object(r["a"])(this,i),e.call(this)}return Object(o["a"])(i,[{key:"Reset",value:function(t,e,s,n){Object(cs["a"])(Object(fs["a"])(i.prototype),"Reset",this).call(this,t,e,s,n)}},{key:"Evaluate",value:function(t,e,i){var s=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();pi(t,s,e,n,i)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Ys),Qs=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(){return Object(r["a"])(this,i),e.call(this)}return Object(o["a"])(i,[{key:"Reset",value:function(t,e,s,n){Object(cs["a"])(Object(fs["a"])(i.prototype),"Reset",this).call(this,t,e,s,n)}},{key:"Evaluate",value:function(t,e,i){var s=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();Ui(t,s,e,n,i)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Ys),$s=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(){return Object(r["a"])(this,i),e.call(this)}return Object(o["a"])(i,[{key:"Reset",value:function(t,e,s,n){Object(cs["a"])(Object(fs["a"])(i.prototype),"Reset",this).call(this,t,e,s,n)}},{key:"Evaluate",value:function(t,e,i){var s=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();Ai(t,s,e,n,i)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Ys),tn=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(){return Object(r["a"])(this,i),e.call(this)}return Object(o["a"])(i,[{key:"Reset",value:function(t,e,s,n){Object(cs["a"])(Object(fs["a"])(i.prototype),"Reset",this).call(this,t,e,s,n)}},{key:"Evaluate",value:function(t,e,i){var s=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();is(t,s,e,n,i)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Ys),en=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(){return Object(r["a"])(this,i),e.call(this)}return Object(o["a"])(i,[{key:"Reset",value:function(t,e,s,n){Object(cs["a"])(Object(fs["a"])(i.prototype),"Reset",this).call(this,t,e,s,n)}},{key:"Evaluate",value:function(t,e,i){var s=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();us(t,s,e,n,i)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Ys),sn=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(){return Object(r["a"])(this,i),e.call(this)}return Object(o["a"])(i,[{key:"Reset",value:function(t,e,s,n){Object(cs["a"])(Object(fs["a"])(i.prototype),"Reset",this).call(this,t,e,s,n)}},{key:"Evaluate",value:function(t,e,s){var n=this.m_fixtureA.GetShape(),a=this.m_fixtureB.GetShape(),r=n,o=i.Evaluate_s_edge;r.GetChildEdge(o,this.m_indexA),is(t,o,e,a,s)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Ys);sn.Evaluate_s_edge=new xs;var nn=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(){return Object(r["a"])(this,i),e.call(this)}return Object(o["a"])(i,[{key:"Reset",value:function(t,e,s,n){Object(cs["a"])(Object(fs["a"])(i.prototype),"Reset",this).call(this,t,e,s,n)}},{key:"Evaluate",value:function(t,e,s){var n=this.m_fixtureA.GetShape(),a=this.m_fixtureB.GetShape(),r=n,o=i.Evaluate_s_edge;r.GetChildEdge(o,this.m_indexA),us(t,o,e,a,s)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Ys);nn.Evaluate_s_edge=new xs;var an=function t(){Object(r["a"])(this,t),this.pool=null,this.createFcn=null,this.destroyFcn=null,this.primary=!1},rn=function(){function t(e){Object(r["a"])(this,t),this.m_allocator=null,this.m_allocator=e,this.InitializeRegisters()}return Object(o["a"])(t,[{key:"AddType",value:function(t,e,i,s){var n=this,a=X(256,(function(e){return t(n.m_allocator)}));function r(e){return a.length>0?a.pop():t(e)}function o(t,e){a.push(t)}this.m_registers[i][s].pool=a,this.m_registers[i][s].createFcn=r,this.m_registers[i][s].destroyFcn=o,this.m_registers[i][s].primary=!0,i!==s&&(this.m_registers[s][i].pool=a,this.m_registers[s][i].createFcn=r,this.m_registers[s][i].destroyFcn=o,this.m_registers[s][i].primary=!1)}},{key:"InitializeRegisters",value:function(){this.m_registers=[];for(var t=0;t<ms.e_shapeTypeCount;t++){this.m_registers[t]=[];for(var e=0;e<ms.e_shapeTypeCount;e++)this.m_registers[t][e]=new an}this.AddType(Ks.Create,Ks.Destroy,ms.e_circleShape,ms.e_circleShape),this.AddType($s.Create,$s.Destroy,ms.e_polygonShape,ms.e_circleShape),this.AddType(Qs.Create,Qs.Destroy,ms.e_polygonShape,ms.e_polygonShape),this.AddType(tn.Create,tn.Destroy,ms.e_edgeShape,ms.e_circleShape),this.AddType(en.Create,en.Destroy,ms.e_edgeShape,ms.e_polygonShape),this.AddType(sn.Create,sn.Destroy,ms.e_chainShape,ms.e_circleShape),this.AddType(nn.Create,nn.Destroy,ms.e_chainShape,ms.e_polygonShape)}},{key:"Create",value:function(t,e,i,s){var n=t.GetType(),a=i.GetType(),r=this.m_registers[n][a],o=r.createFcn(this.m_allocator);return r.primary?o.Reset(t,e,i,s):o.Reset(i,s,t,e),o}},{key:"Destroy",value:function(t){var e=t.m_fixtureA,i=t.m_fixtureB;t.m_manifold.pointCount>0&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0));var s=e.GetType(),n=i.GetType(),a=this.m_registers[s][n];a.destroyFcn(t,this.m_allocator)}}]),t}(),on=function(){function t(){Object(r["a"])(this,t)}return Object(o["a"])(t,[{key:"ShouldCollide",value:function(t,e){var i=t.GetBody(),s=e.GetBody();if(s.GetType()===Ss.b2_staticBody&&i.GetType()===Ss.b2_staticBody)return!1;if(!s.ShouldCollideConnected(i))return!1;var n=t.GetFilterData(),a=e.GetFilterData();if(n.groupIndex===a.groupIndex&&0!==n.groupIndex)return n.groupIndex>0;var r=0!==(n.maskBits&a.categoryBits)&&0!==(n.categoryBits&a.maskBits);return r}},{key:"ShouldCollideFixtureParticle",value:function(t,e,i){return!0}},{key:"ShouldCollideParticleParticle",value:function(t,e,i){return!0}}]),t}();on.b2_defaultFilter=new on;var ln=function t(){Object(r["a"])(this,t),this.normalImpulses=W(c),this.tangentImpulses=W(c),this.count=0},un=function(){function t(){Object(r["a"])(this,t)}return Object(o["a"])(t,[{key:"BeginContact",value:function(t){}},{key:"EndContact",value:function(t){}},{key:"BeginContactFixtureParticle",value:function(t,e){}},{key:"EndContactFixtureParticle",value:function(t,e){}},{key:"BeginContactParticleParticle",value:function(t,e){}},{key:"EndContactParticleParticle",value:function(t,e){}},{key:"PreSolve",value:function(t,e){}},{key:"PostSolve",value:function(t,e){}}]),t}();un.b2_defaultListener=new un;var mn=function(){function t(){Object(r["a"])(this,t)}return Object(o["a"])(t,[{key:"ReportFixture",value:function(t){return!0}},{key:"ReportParticle",value:function(t,e){return!1}},{key:"ShouldQueryParticleSystem",value:function(t){return!0}}]),t}(),_n=function(){function t(){Object(r["a"])(this,t)}return Object(o["a"])(t,[{key:"ReportFixture",value:function(t,e,i,s){return s}},{key:"ReportParticle",value:function(t,e,i,s,n){return 0}},{key:"ShouldQueryParticleSystem",value:function(t){return!0}}]),t}(),hn=function(){function t(){Object(r["a"])(this,t),this.m_broadPhase=new Ee,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=on.b2_defaultFilter,this.m_contactListener=un.b2_defaultListener,this.m_allocator=null,this.m_contactFactory=null,this.m_contactFactory=new rn(this.m_allocator)}return Object(o["a"])(t,[{key:"AddPair",value:function(t,e){var i=t,s=e,n=i.fixture,a=s.fixture,r=i.childIndex,o=s.childIndex,l=n.GetBody(),u=a.GetBody();if(l!==u){var m=u.GetContactList();while(m){if(m.other===l){var _=m.contact.GetFixtureA(),h=m.contact.GetFixtureB(),c=m.contact.GetChildIndexA(),f=m.contact.GetChildIndexB();if(_===n&&h===a&&c===r&&f===o)return;if(_===a&&h===n&&c===o&&f===r)return}m=m.next}if(!this.m_contactFilter||this.m_contactFilter.ShouldCollide(n,a)){var d=this.m_contactFactory.Create(n,r,a,o);null!==d&&(n=d.GetFixtureA(),a=d.GetFixtureB(),r=d.GetChildIndexA(),o=d.GetChildIndexB(),l=n.m_body,u=a.m_body,d.m_prev=null,d.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=d),this.m_contactList=d,d.m_nodeA.contact=d,d.m_nodeA.other=u,d.m_nodeA.prev=null,d.m_nodeA.next=l.m_contactList,null!==l.m_contactList&&(l.m_contactList.prev=d.m_nodeA),l.m_contactList=d.m_nodeA,d.m_nodeB.contact=d,d.m_nodeB.other=l,d.m_nodeB.prev=null,d.m_nodeB.next=u.m_contactList,null!==u.m_contactList&&(u.m_contactList.prev=d.m_nodeB),u.m_contactList=d.m_nodeB,n.IsSensor()||a.IsSensor()||(l.SetAwake(!0),u.SetAwake(!0)),++this.m_contactCount)}}}},{key:"FindNewContacts",value:function(){this.m_broadPhase.UpdatePairs(this)}},{key:"Destroy",value:function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),s=e.GetBody(),n=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===s.m_contactList&&(s.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===n.m_contactList&&(n.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount}},{key:"Collide",value:function(){var t=this.m_contactList;while(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),s=t.GetChildIndexA(),n=t.GetChildIndexB(),a=e.GetBody(),r=i.GetBody();if(t.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,i)){var o=t;t=o.m_next,this.Destroy(o);continue}t.m_filterFlag=!1}var l=a.IsAwake()&&a.m_type!==Ss.b2_staticBody,u=r.IsAwake()&&r.m_type!==Ss.b2_staticBody;if(l||u){var m=e.m_proxies[s].proxy,_=i.m_proxies[n].proxy,h=this.m_broadPhase.TestOverlap(m,_);if(h)t.Update(this.m_contactListener),t=t.m_next;else{var c=t;t=c.m_next,this.Destroy(c)}}else t=t.m_next}}}]),t}(),cn=function(){function t(){Object(r["a"])(this,t),this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}return Object(o["a"])(t,[{key:"Reset",value:function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}}]),t}(),fn=function(){function t(){Object(r["a"])(this,t),this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1}return Object(o["a"])(t,[{key:"Copy",value:function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this}}]),t}(),dn=function(){function t(){Object(r["a"])(this,t),this.c=new at,this.a=0}return Object(o["a"])(t,null,[{key:"MakeArray",value:function(e){return X(e,(function(e){return new t}))}}]),t}(),vn=function(){function t(){Object(r["a"])(this,t),this.v=new at,this.w=0}return Object(o["a"])(t,null,[{key:"MakeArray",value:function(e){return X(e,(function(e){return new t}))}}]),t}(),yn=function t(){Object(r["a"])(this,t),this.step=new fn,this.positions=null,this.velocities=null},pn=function(){function t(){Object(r["a"])(this,t),this.rA=new at,this.rB=new at,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return Object(o["a"])(t,null,[{key:"MakeArray",value:function(e){return X(e,(function(e){return new t}))}}]),t}(),xn=function(){function t(){Object(r["a"])(this,t),this.points=pn.MakeArray(c),this.normal=new at,this.tangent=new at,this.normalMass=new Dt,this.K=new Dt,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}return Object(o["a"])(t,null,[{key:"MakeArray",value:function(e){return X(e,(function(e){return new t}))}}]),t}(),Bn=function(){function t(){Object(r["a"])(this,t),this.localPoints=at.MakeArray(c),this.localNormal=new at,this.localPoint=new at,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new at,this.localCenterB=new at,this.invIA=0,this.invIB=0,this.type=Ce.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}return Object(o["a"])(t,null,[{key:"MakeArray",value:function(e){return X(e,(function(e){return new t}))}}]),t}(),Sn=function t(){Object(r["a"])(this,t),this.step=new fn,this.contacts=null,this.count=0,this.positions=null,this.velocities=null,this.allocator=null},An=function(){function t(){Object(r["a"])(this,t),this.normal=new at,this.point=new at,this.separation=0}return Object(o["a"])(t,[{key:"Initialize",value:function(e,i,s,n){var a=t.Initialize_s_pointA,r=t.Initialize_s_pointB,o=t.Initialize_s_planePoint,l=t.Initialize_s_clipPoint;switch(e.type){case Ce.e_circles:Yt.MulXV(i,e.localPoint,a),Yt.MulXV(s,e.localPoints[0],r),at.SubVV(r,a,this.normal).SelfNormalize(),at.MidVV(a,r,this.point),this.separation=at.DotVV(at.SubVV(r,a,at.s_t0),this.normal)-e.radiusA-e.radiusB;break;case Ce.e_faceA:Xt.MulRV(i.q,e.localNormal,this.normal),Yt.MulXV(i,e.localPoint,o),Yt.MulXV(s,e.localPoints[n],l),this.separation=at.DotVV(at.SubVV(l,o,at.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(l);break;case Ce.e_faceB:Xt.MulRV(s.q,e.localNormal,this.normal),Yt.MulXV(s,e.localPoint,o),Yt.MulXV(i,e.localPoints[n],l),this.separation=at.DotVV(at.SubVV(l,o,at.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(l),this.normal.SelfNeg();break}}}]),t}();An.Initialize_s_pointA=new at,An.Initialize_s_pointB=new at,An.Initialize_s_planePoint=new at,An.Initialize_s_clipPoint=new at;var Cn=function(){function t(){Object(r["a"])(this,t),this.m_step=new fn,this.m_positions=null,this.m_velocities=null,this.m_allocator=null,this.m_positionConstraints=Bn.MakeArray(1024),this.m_velocityConstraints=xn.MakeArray(1024),this.m_contacts=null,this.m_count=0}return Object(o["a"])(t,[{key:"Initialize",value:function(t){if(this.m_step.Copy(t.step),this.m_allocator=t.allocator,this.m_count=t.count,this.m_positionConstraints.length<this.m_count){var e=K(2*this.m_positionConstraints.length,this.m_count);while(this.m_positionConstraints.length<e)this.m_positionConstraints[this.m_positionConstraints.length]=new Bn}if(this.m_velocityConstraints.length<this.m_count){var i=K(2*this.m_velocityConstraints.length,this.m_count);while(this.m_velocityConstraints.length<i)this.m_velocityConstraints[this.m_velocityConstraints.length]=new xn}this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(var s=0;s<this.m_count;++s){var n=this.m_contacts[s],a=n.m_fixtureA,r=n.m_fixtureB,o=a.GetShape(),l=r.GetShape(),u=o.m_radius,m=l.m_radius,_=a.GetBody(),h=r.GetBody(),c=n.GetManifold(),f=c.pointCount,d=this.m_velocityConstraints[s];d.friction=n.m_friction,d.restitution=n.m_restitution,d.tangentSpeed=n.m_tangentSpeed,d.indexA=_.m_islandIndex,d.indexB=h.m_islandIndex,d.invMassA=_.m_invMass,d.invMassB=h.m_invMass,d.invIA=_.m_invI,d.invIB=h.m_invI,d.contactIndex=s,d.pointCount=f,d.K.SetZero(),d.normalMass.SetZero();var v=this.m_positionConstraints[s];v.indexA=_.m_islandIndex,v.indexB=h.m_islandIndex,v.invMassA=_.m_invMass,v.invMassB=h.m_invMass,v.localCenterA.Copy(_.m_sweep.localCenter),v.localCenterB.Copy(h.m_sweep.localCenter),v.invIA=_.m_invI,v.invIB=h.m_invI,v.localNormal.Copy(c.localNormal),v.localPoint.Copy(c.localPoint),v.pointCount=f,v.radiusA=u,v.radiusB=m,v.type=c.type;for(var y=0;y<f;++y){var p=c.points[y],x=d.points[y];this.m_step.warmStarting?(x.normalImpulse=this.m_step.dtRatio*p.normalImpulse,x.tangentImpulse=this.m_step.dtRatio*p.tangentImpulse):(x.normalImpulse=0,x.tangentImpulse=0),x.rA.SetZero(),x.rB.SetZero(),x.normalMass=0,x.tangentMass=0,x.velocityBias=0,v.localPoints[y].Copy(p.localPoint)}}return this}},{key:"InitializeVelocityConstraints",value:function(){for(var e=t.InitializeVelocityConstraints_s_xfA,i=t.InitializeVelocityConstraints_s_xfB,s=t.InitializeVelocityConstraints_s_worldManifold,n=1e3,a=0;a<this.m_count;++a){var r=this.m_velocityConstraints[a],o=this.m_positionConstraints[a],l=o.radiusA,u=o.radiusB,m=this.m_contacts[r.contactIndex].GetManifold(),_=r.indexA,h=r.indexB,c=r.invMassA,f=r.invMassB,d=r.invIA,v=r.invIB,y=o.localCenterA,p=o.localCenterB,x=this.m_positions[_].c,B=this.m_positions[_].a,S=this.m_velocities[_].v,C=this.m_velocities[_].w,b=this.m_positions[h].c,V=this.m_positions[h].a,g=this.m_velocities[h].v,w=this.m_velocities[h].w;e.q.SetAngle(B),i.q.SetAngle(V),at.SubVV(x,Xt.MulRV(e.q,y,at.s_t0),e.p),at.SubVV(b,Xt.MulRV(i.q,p,at.s_t0),i.p),s.Initialize(m,e,l,i,u),r.normal.Copy(s.normal),at.CrossVOne(r.normal,r.tangent);for(var k=r.pointCount,M=0;M<k;++M){var I=r.points[M];at.SubVV(s.points[M],x,I.rA),at.SubVV(s.points[M],b,I.rB);var P=at.CrossVV(I.rA,r.normal),G=at.CrossVV(I.rB,r.normal),D=c+f+d*P*P+v*G*G;I.normalMass=D>0?1/D:0;var j=r.tangent,O=at.CrossVV(I.rA,j),F=at.CrossVV(I.rB,j),L=c+f+d*O*O+v*F*F;I.tangentMass=L>0?1/L:0,I.velocityBias=0;var R=at.DotVV(r.normal,at.SubVV(at.AddVCrossSV(g,w,I.rB,at.s_t0),at.AddVCrossSV(S,C,I.rA,at.s_t1),at.s_t0));R<-A&&(I.velocityBias+=-r.restitution*R)}if(2===r.pointCount){var T=r.points[0],q=r.points[1],z=at.CrossVV(T.rA,r.normal),N=at.CrossVV(T.rB,r.normal),E=at.CrossVV(q.rA,r.normal),J=at.CrossVV(q.rB,r.normal),X=c+f+d*z*z+v*N*N,U=c+f+d*E*E+v*J*J,W=c+f+d*z*E+v*N*J;X*X<n*(X*U-W*W)?(r.K.ex.Set(X,W),r.K.ey.Set(W,U),r.K.GetInverse(r.normalMass)):r.pointCount=1}}}},{key:"WarmStart",value:function(){for(var e=t.WarmStart_s_P,i=0;i<this.m_count;++i){for(var s=this.m_velocityConstraints[i],n=s.indexA,a=s.indexB,r=s.invMassA,o=s.invIA,l=s.invMassB,u=s.invIB,m=s.pointCount,_=this.m_velocities[n].v,h=this.m_velocities[n].w,c=this.m_velocities[a].v,f=this.m_velocities[a].w,d=s.normal,v=s.tangent,y=0;y<m;++y){var p=s.points[y];at.AddVV(at.MulSV(p.normalImpulse,d,at.s_t0),at.MulSV(p.tangentImpulse,v,at.s_t1),e),h-=o*at.CrossVV(p.rA,e),_.SelfMulSub(r,e),f+=u*at.CrossVV(p.rB,e),c.SelfMulAdd(l,e)}this.m_velocities[n].w=h,this.m_velocities[a].w=f}}},{key:"SolveVelocityConstraints",value:function(){for(var e=t.SolveVelocityConstraints_s_dv,i=t.SolveVelocityConstraints_s_dv1,s=t.SolveVelocityConstraints_s_dv2,n=t.SolveVelocityConstraints_s_P,a=t.SolveVelocityConstraints_s_a,r=t.SolveVelocityConstraints_s_b,o=t.SolveVelocityConstraints_s_x,l=t.SolveVelocityConstraints_s_d,u=t.SolveVelocityConstraints_s_P1,m=t.SolveVelocityConstraints_s_P2,_=t.SolveVelocityConstraints_s_P1P2,h=0;h<this.m_count;++h){for(var c=this.m_velocityConstraints[h],f=c.indexA,d=c.indexB,v=c.invMassA,y=c.invIA,p=c.invMassB,x=c.invIB,B=c.pointCount,S=this.m_velocities[f].v,A=this.m_velocities[f].w,C=this.m_velocities[d].v,b=this.m_velocities[d].w,V=c.normal,g=c.tangent,w=c.friction,k=0;k<B;++k){var M=c.points[k];at.SubVV(at.AddVCrossSV(C,b,M.rB,at.s_t0),at.AddVCrossSV(S,A,M.rA,at.s_t1),e);var I=at.DotVV(e,g)-c.tangentSpeed,P=M.tangentMass*-I,G=w*M.normalImpulse,D=Q(M.tangentImpulse+P,-G,G);P=D-M.tangentImpulse,M.tangentImpulse=D,at.MulSV(P,g,n),S.SelfMulSub(v,n),A-=y*at.CrossVV(M.rA,n),C.SelfMulAdd(p,n),b+=x*at.CrossVV(M.rB,n)}if(1===c.pointCount){var j=c.points[0];at.SubVV(at.AddVCrossSV(C,b,j.rB,at.s_t0),at.AddVCrossSV(S,A,j.rA,at.s_t1),e);var O=at.DotVV(e,V),F=-j.normalMass*(O-j.velocityBias),L=K(j.normalImpulse+F,0);F=L-j.normalImpulse,j.normalImpulse=L,at.MulSV(F,V,n),S.SelfMulSub(v,n),A-=y*at.CrossVV(j.rA,n),C.SelfMulAdd(p,n),b+=x*at.CrossVV(j.rB,n)}else{var R=c.points[0],T=c.points[1];a.Set(R.normalImpulse,T.normalImpulse),at.SubVV(at.AddVCrossSV(C,b,R.rB,at.s_t0),at.AddVCrossSV(S,A,R.rA,at.s_t1),i),at.SubVV(at.AddVCrossSV(C,b,T.rB,at.s_t0),at.AddVCrossSV(S,A,T.rA,at.s_t1),s);var q=at.DotVV(i,V),z=at.DotVV(s,V);for(r.x=q-R.velocityBias,r.y=z-T.velocityBias,r.SelfSub(Dt.MulMV(c.K,a,at.s_t0));;){if(Dt.MulMV(c.normalMass,r,o).SelfNeg(),o.x>=0&&o.y>=0){at.SubVV(o,a,l),at.MulSV(l.x,V,u),at.MulSV(l.y,V,m),at.AddVV(u,m,_),S.SelfMulSub(v,_),A-=y*(at.CrossVV(R.rA,u)+at.CrossVV(T.rA,m)),C.SelfMulAdd(p,_),b+=x*(at.CrossVV(R.rB,u)+at.CrossVV(T.rB,m)),R.normalImpulse=o.x,T.normalImpulse=o.y;break}if(o.x=-R.normalMass*r.x,o.y=0,q=0,z=c.K.ex.y*o.x+r.y,o.x>=0&&z>=0){at.SubVV(o,a,l),at.MulSV(l.x,V,u),at.MulSV(l.y,V,m),at.AddVV(u,m,_),S.SelfMulSub(v,_),A-=y*(at.CrossVV(R.rA,u)+at.CrossVV(T.rA,m)),C.SelfMulAdd(p,_),b+=x*(at.CrossVV(R.rB,u)+at.CrossVV(T.rB,m)),R.normalImpulse=o.x,T.normalImpulse=o.y;break}if(o.x=0,o.y=-T.normalMass*r.y,q=c.K.ey.x*o.y+r.x,z=0,o.y>=0&&q>=0){at.SubVV(o,a,l),at.MulSV(l.x,V,u),at.MulSV(l.y,V,m),at.AddVV(u,m,_),S.SelfMulSub(v,_),A-=y*(at.CrossVV(R.rA,u)+at.CrossVV(T.rA,m)),C.SelfMulAdd(p,_),b+=x*(at.CrossVV(R.rB,u)+at.CrossVV(T.rB,m)),R.normalImpulse=o.x,T.normalImpulse=o.y;break}if(o.x=0,o.y=0,q=r.x,z=r.y,q>=0&&z>=0){at.SubVV(o,a,l),at.MulSV(l.x,V,u),at.MulSV(l.y,V,m),at.AddVV(u,m,_),S.SelfMulSub(v,_),A-=y*(at.CrossVV(R.rA,u)+at.CrossVV(T.rA,m)),C.SelfMulAdd(p,_),b+=x*(at.CrossVV(R.rB,u)+at.CrossVV(T.rB,m)),R.normalImpulse=o.x,T.normalImpulse=o.y;break}break}}this.m_velocities[f].w=A,this.m_velocities[d].w=b}}},{key:"StoreImpulses",value:function(){for(var t=0;t<this.m_count;++t)for(var e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold(),s=0;s<e.pointCount;++s)i.points[s].normalImpulse=e.points[s].normalImpulse,i.points[s].tangentImpulse=e.points[s].tangentImpulse}},{key:"SolvePositionConstraints",value:function(){for(var e=t.SolvePositionConstraints_s_xfA,i=t.SolvePositionConstraints_s_xfB,s=t.SolvePositionConstraints_s_psm,n=t.SolvePositionConstraints_s_rA,a=t.SolvePositionConstraints_s_rB,r=t.SolvePositionConstraints_s_P,o=0,l=0;l<this.m_count;++l){for(var u=this.m_positionConstraints[l],m=u.indexA,_=u.indexB,h=u.localCenterA,c=u.invMassA,f=u.invIA,d=u.localCenterB,v=u.invMassB,p=u.invIB,x=u.pointCount,B=this.m_positions[m].c,S=this.m_positions[m].a,A=this.m_positions[_].c,b=this.m_positions[_].a,V=0;V<x;++V){e.q.SetAngle(S),i.q.SetAngle(b),at.SubVV(B,Xt.MulRV(e.q,h,at.s_t0),e.p),at.SubVV(A,Xt.MulRV(i.q,d,at.s_t0),i.p),s.Initialize(u,e,i,V);var g=s.normal,w=s.point,k=s.separation;at.SubVV(w,B,n),at.SubVV(w,A,a),o=Y(o,k);var I=Q(M*(k+y),-C,0),P=at.CrossVV(n,g),G=at.CrossVV(a,g),D=c+v+f*P*P+p*G*G,j=D>0?-I/D:0;at.MulSV(j,g,r),B.SelfMulSub(c,r),S-=f*at.CrossVV(n,r),A.SelfMulAdd(v,r),b+=p*at.CrossVV(a,r)}this.m_positions[m].a=S,this.m_positions[_].a=b}return o>-3*y}},{key:"SolveTOIPositionConstraints",value:function(e,i){for(var s=t.SolveTOIPositionConstraints_s_xfA,n=t.SolveTOIPositionConstraints_s_xfB,a=t.SolveTOIPositionConstraints_s_psm,r=t.SolveTOIPositionConstraints_s_rA,o=t.SolveTOIPositionConstraints_s_rB,l=t.SolveTOIPositionConstraints_s_P,u=0,m=0;m<this.m_count;++m){var _=this.m_positionConstraints[m],h=_.indexA,c=_.indexB,f=_.localCenterA,d=_.localCenterB,v=_.pointCount,p=0,x=0;h!==e&&h!==i||(p=_.invMassA,x=_.invIA);var B=0,S=0;c!==e&&c!==i||(B=_.invMassB,S=_.invIB);for(var A=this.m_positions[h].c,b=this.m_positions[h].a,V=this.m_positions[c].c,g=this.m_positions[c].a,w=0;w<v;++w){s.q.SetAngle(b),n.q.SetAngle(g),at.SubVV(A,Xt.MulRV(s.q,f,at.s_t0),s.p),at.SubVV(V,Xt.MulRV(n.q,d,at.s_t0),n.p),a.Initialize(_,s,n,w);var k=a.normal,M=a.point,P=a.separation;at.SubVV(M,A,r),at.SubVV(M,V,o),u=Y(u,P);var G=Q(I*(P+y),-C,0),D=at.CrossVV(r,k),j=at.CrossVV(o,k),O=p+B+x*D*D+S*j*j,F=O>0?-G/O:0;at.MulSV(F,k,l),A.SelfMulSub(p,l),b-=x*at.CrossVV(r,l),V.SelfMulAdd(B,l),g+=S*at.CrossVV(o,l)}this.m_positions[h].a=b,this.m_positions[c].a=g}return u>=-1.5*y}}]),t}();Cn.InitializeVelocityConstraints_s_xfA=new Yt,Cn.InitializeVelocityConstraints_s_xfB=new Yt,Cn.InitializeVelocityConstraints_s_worldManifold=new Me,Cn.WarmStart_s_P=new at,Cn.SolveVelocityConstraints_s_dv=new at,Cn.SolveVelocityConstraints_s_dv1=new at,Cn.SolveVelocityConstraints_s_dv2=new at,Cn.SolveVelocityConstraints_s_P=new at,Cn.SolveVelocityConstraints_s_a=new at,Cn.SolveVelocityConstraints_s_b=new at,Cn.SolveVelocityConstraints_s_x=new at,Cn.SolveVelocityConstraints_s_d=new at,Cn.SolveVelocityConstraints_s_P1=new at,Cn.SolveVelocityConstraints_s_P2=new at,Cn.SolveVelocityConstraints_s_P1P2=new at,Cn.SolvePositionConstraints_s_xfA=new Yt,Cn.SolvePositionConstraints_s_xfB=new Yt,Cn.SolvePositionConstraints_s_psm=new An,Cn.SolvePositionConstraints_s_rA=new at,Cn.SolvePositionConstraints_s_rB=new at,Cn.SolvePositionConstraints_s_P=new at,Cn.SolveTOIPositionConstraints_s_xfA=new Yt,Cn.SolveTOIPositionConstraints_s_xfB=new Yt,Cn.SolveTOIPositionConstraints_s_psm=new An,Cn.SolveTOIPositionConstraints_s_rA=new at,Cn.SolveTOIPositionConstraints_s_rB=new at,Cn.SolveTOIPositionConstraints_s_P=new at;var bn=function(){function t(){Object(r["a"])(this,t),this.m_allocator=null,this.m_listener=null,this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=dn.MakeArray(1024),this.m_velocities=vn.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}return Object(o["a"])(t,[{key:"Initialize",value:function(t,e,i,s,n){this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=s,this.m_listener=n;while(this.m_bodies.length<t)this.m_bodies[this.m_bodies.length]=null;while(this.m_contacts.length<e)this.m_contacts[this.m_contacts.length]=null;while(this.m_joints.length<i)this.m_joints[this.m_joints.length]=null;if(this.m_positions.length<t){var a=K(2*this.m_positions.length,t);while(this.m_positions.length<a)this.m_positions[this.m_positions.length]=new dn}if(this.m_velocities.length<t){var r=K(2*this.m_velocities.length,t);while(this.m_velocities.length<r)this.m_velocities[this.m_velocities.length]=new vn}}},{key:"Clear",value:function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}},{key:"AddBody",value:function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t}},{key:"AddContact",value:function(t){this.m_contacts[this.m_contactCount++]=t}},{key:"AddJoint",value:function(t){this.m_joints[this.m_jointCount++]=t}},{key:"Solve",value:function(e,i,s,n){for(var a=t.s_timer.Reset(),r=i.dt,o=0;o<this.m_bodyCount;++o){var l=this.m_bodies[o];this.m_positions[o].c.Copy(l.m_sweep.c);var m=l.m_sweep.a,_=this.m_velocities[o].v.Copy(l.m_linearVelocity),h=l.m_angularVelocity;l.m_sweep.c0.Copy(l.m_sweep.c),l.m_sweep.a0=l.m_sweep.a,l.m_type===Ss.b2_dynamicBody&&(_.x+=r*(l.m_gravityScale*s.x+l.m_invMass*l.m_force.x),_.y+=r*(l.m_gravityScale*s.y+l.m_invMass*l.m_force.y),h+=r*l.m_invI*l.m_torque,_.SelfMul(1/(1+r*l.m_linearDamping)),h*=1/(1+r*l.m_angularDamping)),this.m_positions[o].a=m,this.m_velocities[o].w=h}a.Reset();var c=t.s_solverData;c.step.Copy(i),c.positions=this.m_positions,c.velocities=this.m_velocities;var f=t.s_contactSolverDef;f.step.Copy(i),f.contacts=this.m_contacts,f.count=this.m_contactCount,f.positions=this.m_positions,f.velocities=this.m_velocities,f.allocator=this.m_allocator;var d=t.s_contactSolver.Initialize(f);d.InitializeVelocityConstraints(),i.warmStarting&&d.WarmStart();for(var v=0;v<this.m_jointCount;++v)this.m_joints[v].InitVelocityConstraints(c);e.solveInit=a.GetMilliseconds(),a.Reset();for(var y=0;y<i.velocityIterations;++y){for(var p=0;p<this.m_jointCount;++p)this.m_joints[p].SolveVelocityConstraints(c);d.SolveVelocityConstraints()}d.StoreImpulses(),e.solveVelocity=a.GetMilliseconds();for(var x=0;x<this.m_bodyCount;++x){var B=this.m_positions[x].c,S=this.m_positions[x].a,A=this.m_velocities[x].v,C=this.m_velocities[x].w,b=at.MulSV(r,A,t.s_translation);if(at.DotVV(b,b)>g){var M=V/b.Length();A.SelfMul(M)}var I=r*C;if(I*I>k){var P=w/H(I);C*=P}B.x+=r*A.x,B.y+=r*A.y,S+=r*C,this.m_positions[x].a=S,this.m_velocities[x].w=C}a.Reset();for(var G=!1,D=0;D<i.positionIterations;++D){for(var j=d.SolvePositionConstraints(),O=!0,F=0;F<this.m_jointCount;++F){var L=this.m_joints[F].SolvePositionConstraints(c);O=O&&L}if(j&&O){G=!0;break}}for(var R=0;R<this.m_bodyCount;++R){var T=this.m_bodies[R];T.m_sweep.c.Copy(this.m_positions[R].c),T.m_sweep.a=this.m_positions[R].a,T.m_linearVelocity.Copy(this.m_velocities[R].v),T.m_angularVelocity=this.m_velocities[R].w,T.SynchronizeTransform()}if(e.solvePosition=a.GetMilliseconds(),this.Report(d.m_velocityConstraints),n){for(var q=u,J=N*N,X=E*E,U=0;U<this.m_bodyCount;++U){var W=this.m_bodies[U];W.GetType()!==Ss.b2_staticBody&&(!W.m_autoSleepFlag||W.m_angularVelocity*W.m_angularVelocity>X||at.DotVV(W.m_linearVelocity,W.m_linearVelocity)>J?(W.m_sleepTime=0,q=0):(W.m_sleepTime+=r,q=Y(q,W.m_sleepTime)))}if(q>=z&&G)for(var Z=0;Z<this.m_bodyCount;++Z){var K=this.m_bodies[Z];K.SetAwake(!1)}}}},{key:"SolveTOI",value:function(e,i,s){for(var n=0;n<this.m_bodyCount;++n){var a=this.m_bodies[n];this.m_positions[n].c.Copy(a.m_sweep.c),this.m_positions[n].a=a.m_sweep.a,this.m_velocities[n].v.Copy(a.m_linearVelocity),this.m_velocities[n].w=a.m_angularVelocity}var r=t.s_contactSolverDef;r.contacts=this.m_contacts,r.count=this.m_contactCount,r.allocator=this.m_allocator,r.step.Copy(e),r.positions=this.m_positions,r.velocities=this.m_velocities;for(var o=t.s_contactSolver.Initialize(r),l=0;l<e.positionIterations;++l){var u=o.SolveTOIPositionConstraints(i,s);if(u)break}this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,this.m_bodies[s].m_sweep.c0.Copy(this.m_positions[s].c),this.m_bodies[s].m_sweep.a0=this.m_positions[s].a,o.InitializeVelocityConstraints();for(var m=0;m<e.velocityIterations;++m)o.SolveVelocityConstraints();for(var _=e.dt,h=0;h<this.m_bodyCount;++h){var c=this.m_positions[h].c,f=this.m_positions[h].a,d=this.m_velocities[h].v,v=this.m_velocities[h].w,y=at.MulSV(_,d,t.s_translation);if(at.DotVV(y,y)>g){var p=V/y.Length();d.SelfMul(p)}var x=_*v;if(x*x>k){var B=w/H(x);v*=B}c.SelfMulAdd(_,d),f+=_*v,this.m_positions[h].a=f,this.m_velocities[h].w=v;var S=this.m_bodies[h];S.m_sweep.c.Copy(c),S.m_sweep.a=f,S.m_linearVelocity.Copy(d),S.m_angularVelocity=v,S.SynchronizeTransform()}this.Report(o.m_velocityConstraints)}},{key:"Report",value:function(e){if(null!==this.m_listener)for(var i=0;i<this.m_contactCount;++i){var s=this.m_contacts[i];if(s){var n=e[i],a=t.s_impulse;a.count=n.pointCount;for(var r=0;r<n.pointCount;++r)a.normalImpulses[r]=n.points[r].normalImpulse,a.tangentImpulses[r]=n.points[r].tangentImpulse;this.m_listener.PostSolve(s,a)}}}}]),t}();bn.s_timer=new ne,bn.s_solverData=new yn,bn.s_contactSolverDef=new Sn,bn.s_contactSolver=new Cn,bn.s_translation=new at,bn.s_impulse=new ln;var Vn;i("5377");(function(t){t[t["b2_waterParticle"]=0]="b2_waterParticle",t[t["b2_zombieParticle"]=2]="b2_zombieParticle",t[t["b2_wallParticle"]=4]="b2_wallParticle",t[t["b2_springParticle"]=8]="b2_springParticle",t[t["b2_elasticParticle"]=16]="b2_elasticParticle",t[t["b2_viscousParticle"]=32]="b2_viscousParticle",t[t["b2_powderParticle"]=64]="b2_powderParticle",t[t["b2_tensileParticle"]=128]="b2_tensileParticle",t[t["b2_colorMixingParticle"]=256]="b2_colorMixingParticle",t[t["b2_destructionListenerParticle"]=512]="b2_destructionListenerParticle",t[t["b2_barrierParticle"]=1024]="b2_barrierParticle",t[t["b2_staticPressureParticle"]=2048]="b2_staticPressureParticle",t[t["b2_reactiveParticle"]=4096]="b2_reactiveParticle",t[t["b2_repulsiveParticle"]=8192]="b2_repulsiveParticle",t[t["b2_fixtureContactListenerParticle"]=16384]="b2_fixtureContactListenerParticle",t[t["b2_particleContactListenerParticle"]=32768]="b2_particleContactListenerParticle",t[t["b2_fixtureContactFilterParticle"]=65536]="b2_fixtureContactFilterParticle",t[t["b2_particleContactFilterParticle"]=131072]="b2_particleContactFilterParticle"})(Vn||(Vn={}));var gn=function t(){Object(r["a"])(this,t),this.flags=0,this.position=new at,this.velocity=new at,this.color=new se,this.lifetime=0,this.userData=null,this.group=null};function wn(t,e,i){var s=8,n=.01,a=Math.ceil(Math.sqrt(t/(n*e))*i);return Q(a,1,s)}var kn,Mn=function(){function t(){Object(r["a"])(this,t),this.m_index=P}return Object(o["a"])(t,[{key:"GetIndex",value:function(){return this.m_index}},{key:"SetIndex",value:function(t){this.m_index=t}}]),t}();i("fb6a");(function(t){t[t["b2_solidParticleGroup"]=1]="b2_solidParticleGroup",t[t["b2_rigidParticleGroup"]=2]="b2_rigidParticleGroup",t[t["b2_particleGroupCanBeEmpty"]=4]="b2_particleGroupCanBeEmpty",t[t["b2_particleGroupWillBeDestroyed"]=8]="b2_particleGroupWillBeDestroyed",t[t["b2_particleGroupNeedsUpdateDepth"]=16]="b2_particleGroupNeedsUpdateDepth",t[t["b2_particleGroupInternalMask"]=24]="b2_particleGroupInternalMask"})(kn||(kn={}));var In=function t(){Object(r["a"])(this,t),this.flags=0,this.groupFlags=0,this.position=new at,this.angle=0,this.linearVelocity=new at,this.angularVelocity=0,this.color=new se,this.strength=1,this.shape=null,this.shapes=null,this.shapeCount=0,this.stride=0,this.particleCount=0,this.positionData=null,this.lifetime=0,this.userData=null,this.group=null},Pn=function(){function t(){Object(r["a"])(this,t),this.m_system=null,this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new at,this.m_linearVelocity=new at,this.m_angularVelocity=0,this.m_transform=new Yt,this.m_userData=null}return Object(o["a"])(t,[{key:"GetNext",value:function(){return this.m_next}},{key:"GetParticleSystem",value:function(){return this.m_system}},{key:"GetParticleCount",value:function(){return this.m_lastIndex-this.m_firstIndex}},{key:"GetBufferIndex",value:function(){return this.m_firstIndex}},{key:"ContainsParticle",value:function(t){return this.m_firstIndex<=t&&t<this.m_lastIndex}},{key:"GetAllParticleFlags",value:function(){for(var t=0,e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t}},{key:"GetGroupFlags",value:function(){return this.m_groupFlags}},{key:"SetGroupFlags",value:function(t){t|=this.m_groupFlags&kn.b2_particleGroupInternalMask,this.m_system.SetGroupFlags(this,t)}},{key:"GetMass",value:function(){return this.UpdateStatistics(),this.m_mass}},{key:"GetInertia",value:function(){return this.UpdateStatistics(),this.m_inertia}},{key:"GetCenter",value:function(){return this.UpdateStatistics(),this.m_center}},{key:"GetLinearVelocity",value:function(){return this.UpdateStatistics(),this.m_linearVelocity}},{key:"GetAngularVelocity",value:function(){return this.UpdateStatistics(),this.m_angularVelocity}},{key:"GetTransform",value:function(){return this.m_transform}},{key:"GetPosition",value:function(){return this.m_transform.p}},{key:"GetAngle",value:function(){return this.m_transform.q.GetAngle()}},{key:"GetLinearVelocityFromWorldPoint",value:function(e,i){var s=t.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),at.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,at.SubVV(e,this.m_center,s),i)}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"ApplyForce",value:function(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)}},{key:"ApplyLinearImpulse",value:function(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)}},{key:"DestroyParticles",value:function(t){if(!this.m_system.m_world.IsLocked())for(var e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)}},{key:"UpdateStatistics",value:function(){var t=new at,e=new at;if(this.m_timestamp!==this.m_system.m_timestamp){var i=this.m_system.GetParticleMass();this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(var s=this.m_firstIndex;s<this.m_lastIndex;s++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[s]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[s]);if(this.m_mass>0){var n=1/this.m_mass;this.m_center.SelfMul(n),this.m_linearVelocity.SelfMul(n)}this.m_inertia=0,this.m_angularVelocity=0;for(var a=this.m_firstIndex;a<this.m_lastIndex;a++)at.SubVV(this.m_system.m_positionBuffer.data[a],this.m_center,t),at.SubVV(this.m_system.m_velocityBuffer.data[a],this.m_linearVelocity,e),this.m_inertia+=i*at.DotVV(t,t),this.m_angularVelocity+=i*at.CrossVV(t,e);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}}}]),t}();Pn.GetLinearVelocityFromWorldPoint_s_t0=new at;i("99af");function Gn(t){}var Dn=function(){function t(e){Object(r["a"])(this,t),this.m_front=0,this.m_back=0,this.m_capacity=0,this.m_buffer=X(e,(function(t){return null})),this.m_capacity=e}return Object(o["a"])(t,[{key:"Push",value:function(t){if(this.m_back>=this.m_capacity){for(var e=this.m_front;e<this.m_back;e++)this.m_buffer[e-this.m_front]=this.m_buffer[e];this.m_back-=this.m_front,this.m_front=0,this.m_back>=this.m_capacity&&(this.m_capacity>0?(this.m_buffer.concat(X(this.m_capacity,(function(t){return null}))),this.m_capacity*=2):(this.m_buffer.concat(X(1,(function(t){return null}))),this.m_capacity=1))}this.m_buffer[this.m_back]=t,this.m_back++}},{key:"Pop",value:function(){Gn(this.m_front<this.m_back),delete this.m_buffer[this.m_front],this.m_front++}},{key:"Empty",value:function(){return Gn(this.m_front<=this.m_back),this.m_front===this.m_back}},{key:"Front",value:function(){return this.m_buffer[this.m_front]}}]),t}();function jn(t){}var On=function(){function t(e){Object(r["a"])(this,t),this.m_generatorBuffer=null,this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=null,this.m_generatorBuffer=X(e,(function(e){return new t.Generator})),this.m_generatorCapacity=e}return Object(o["a"])(t,[{key:"AddGenerator",value:function(t,e,i){jn(this.m_generatorCount<this.m_generatorCapacity);var s=this.m_generatorBuffer[this.m_generatorCount++];s.center.Copy(t),s.tag=e,s.necessary=i}},{key:"Generate",value:function(e,i){jn(null===this.m_diagram);for(var s=1/e,n=new at(+u,+u),a=new at(-u,-u),r=0,o=0;o<this.m_generatorCount;o++){var l=this.m_generatorBuffer[o];l.necessary&&(at.MinV(n,l.center,n),at.MaxV(a,l.center,a),++r)}if(0===r)return this.m_countX=0,void(this.m_countY=0);n.x-=i,n.y-=i,a.x+=i,a.y+=i,this.m_countX=1+Math.floor(s*(a.x-n.x)),this.m_countY=1+Math.floor(s*(a.y-n.y)),this.m_diagram=X(this.m_countX*this.m_countY,(function(t){return null}));for(var m=new Dn(4*this.m_countX*this.m_countY),_=0;_<this.m_generatorCount;_++){var h=this.m_generatorBuffer[_];h.center.SelfSub(n).SelfMul(s);var c=Math.floor(h.center.x),f=Math.floor(h.center.y);c>=0&&f>=0&&c<this.m_countX&&f<this.m_countY&&m.Push(new t.Task(c,f,c+f*this.m_countX,h))}while(!m.Empty()){var d=m.Front(),v=d.m_x,y=d.m_y,p=d.m_i,x=d.m_generator;m.Pop(),this.m_diagram[p]||(this.m_diagram[p]=x,v>0&&m.Push(new t.Task(v-1,y,p-1,x)),y>0&&m.Push(new t.Task(v,y-1,p-this.m_countX,x)),v<this.m_countX-1&&m.Push(new t.Task(v+1,y,p+1,x)),y<this.m_countY-1&&m.Push(new t.Task(v,y+1,p+this.m_countX,x)))}for(var B=0;B<this.m_countY;B++)for(var S=0;S<this.m_countX-1;S++){var A=S+B*this.m_countX,C=this.m_diagram[A],b=this.m_diagram[A+1];C!==b&&(m.Push(new t.Task(S,B,A,b)),m.Push(new t.Task(S+1,B,A+1,C)))}for(var V=0;V<this.m_countY-1;V++)for(var g=0;g<this.m_countX;g++){var w=g+V*this.m_countX,k=this.m_diagram[w],M=this.m_diagram[w+this.m_countX];k!==M&&(m.Push(new t.Task(g,V,w,M)),m.Push(new t.Task(g,V+1,w+this.m_countX,k)))}while(!m.Empty()){var I=m.Front(),P=I.m_x,G=I.m_y,D=I.m_i,j=I.m_generator;m.Pop();var O=this.m_diagram[D],F=j;if(O!==F){var L=O.center.x-P,R=O.center.y-G,T=F.center.x-P,q=F.center.y-G,z=L*L+R*R,N=T*T+q*q;z>N&&(this.m_diagram[D]=F,P>0&&m.Push(new t.Task(P-1,G,D-1,F)),G>0&&m.Push(new t.Task(P,G-1,D-this.m_countX,F)),P<this.m_countX-1&&m.Push(new t.Task(P+1,G,D+1,F)),G<this.m_countY-1&&m.Push(new t.Task(P,G+1,D+this.m_countX,F)))}}}},{key:"GetNodes",value:function(t){for(var e=0;e<this.m_countY-1;e++)for(var i=0;i<this.m_countX-1;i++){var s=i+e*this.m_countX,n=this.m_diagram[s],a=this.m_diagram[s+1],r=this.m_diagram[s+this.m_countX],o=this.m_diagram[s+1+this.m_countX];a!==r&&(n!==a&&n!==r&&(n.necessary||a.necessary||r.necessary)&&t(n.tag,a.tag,r.tag),o!==a&&o!==r&&(n.necessary||a.necessary||r.necessary)&&t(a.tag,o.tag,r.tag))}}}]),t}();function Fn(t){}function Ln(t,e,i){var s=t[e];t[e]=t[i],t[i]=s}function Rn(t,e){return t<e}function Tn(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Rn,n=e,a=[],r=0;;){for(;n+1<i;i++){var o=t[n+Math.floor(Math.random()*(i-n))];a[r++]=i;for(var l=n-1;;){while(s(t[++l],o));while(s(o,t[--i]));if(l>=i)break;Ln(t,l,i)}}if(0===r)break;n=i,i=a[--r]}return t}function qn(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Rn;return Tn(t,e,i,s)}function zn(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length,s=0,n=0;n<i;++n)e(t[n])||(n!==s?Ln(t,s++,n):++s);return s}function Nn(t,e,i,s){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Rn,a=i-e;while(a>0){var r=Math.floor(a/2),o=e+r;n(t[o],s)?(e=++o,a-=r+1):a=r}return e}function En(t,e,i,s){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Rn,a=i-e;while(a>0){var r=Math.floor(a/2),o=e+r;n(s,t[o])?a=r:(e=++o,a-=r+1)}return e}function Jn(t,e,i,s){var n=i;while(e!==n)Ln(t,e++,n++),n===s?n=i:e===i&&(i=n)}function Xn(t,e,i,s){if(e===i)return i;var n=e;while(++e!==i)s(t[n],t[e])||Ln(t,++n,e);return++n}(function(t){var e=function t(){Object(r["a"])(this,t),this.center=new at,this.tag=0,this.necessary=!1};t.Generator=e;var i=function t(e,i,s,n){Object(r["a"])(this,t),this.m_x=0,this.m_y=0,this.m_i=0,this.m_generator=null,this.m_x=e,this.m_y=i,this.m_i=s,this.m_generator=n};t.Task=i})(On||(On={}));var Un=function(){function t(e){Object(r["a"])(this,t),this.data=[],this.count=0,this.capacity=0,this.allocator=e}return Object(o["a"])(t,[{key:"Append",value:function(){return this.count>=this.capacity&&this.Grow(),this.count++}},{key:"Reserve",value:function(t){if(!(this.capacity>=t)){Fn(this.capacity===this.data.length);for(var e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}}},{key:"Grow",value:function(){var t=this.capacity?2*this.capacity:T;Fn(t>this.capacity),this.Reserve(t)}},{key:"Free",value:function(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)}},{key:"Shorten",value:function(t){Fn(!1)}},{key:"Data",value:function(){return this.data}},{key:"GetCount",value:function(){return this.count}},{key:"SetCount",value:function(t){this.count=t}},{key:"GetCapacity",value:function(){return this.capacity}},{key:"RemoveIf",value:function(t){for(var e=0,i=0;i<this.count;++i)t(this.data[i])||e++;this.count=zn(this.data,t,this.count),Fn(e===this.count)}},{key:"Unique",value:function(t){this.count=Xn(this.data,0,this.count,t)}}]),t}(),Wn=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this),s.m_system=t,s}return Object(o["a"])(i,[{key:"ShouldQueryParticleSystem",value:function(t){return!1}},{key:"ReportFixture",value:function(t){if(t.IsSensor())return!0;for(var e=t.GetShape(),i=e.GetChildCount(),s=0;s<i;s++){var n=t.GetAABB(s),a=this.m_system.GetInsideBoundsEnumerator(n),r=void 0;while((r=a.GetNext())>=0)this.ReportFixtureAndParticle(t,s,r)}return!0}},{key:"ReportParticle",value:function(t,e){return!1}},{key:"ReportFixtureAndParticle",value:function(t,e,i){Fn(!1)}}]),i}(mn),Zn=function(){function t(){Object(r["a"])(this,t),this.indexA=0,this.indexB=0,this.weight=0,this.normal=new at,this.flags=0}return Object(o["a"])(t,[{key:"SetIndices",value:function(t,e){Fn(t<=G&&e<=G),this.indexA=t,this.indexB=e}},{key:"SetWeight",value:function(t){this.weight=t}},{key:"SetNormal",value:function(t){this.normal.Copy(t)}},{key:"SetFlags",value:function(t){this.flags=t}},{key:"GetIndexA",value:function(){return this.indexA}},{key:"GetIndexB",value:function(){return this.indexB}},{key:"GetWeight",value:function(){return this.weight}},{key:"GetNormal",value:function(){return this.normal}},{key:"GetFlags",value:function(){return this.flags}},{key:"IsEqual",value:function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y}},{key:"IsNotEqual",value:function(t){return!this.IsEqual(t)}},{key:"ApproximatelyEqual",value:function(t){var e=.01,i=1e-4;return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&H(this.weight-t.weight)<e&&at.DistanceSquaredVV(this.normal,t.normal)<i}}]),t}(),Hn=function t(){Object(r["a"])(this,t),this.index=0,this.body=null,this.fixture=null,this.weight=0,this.normal=new at,this.mass=0},Yn=function t(){Object(r["a"])(this,t),this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0},Kn=function t(){Object(r["a"])(this,t),this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new at(0,0),this.pb=new at(0,0),this.pc=new at(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0},Qn=function(){function t(){Object(r["a"])(this,t),this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60}return Object(o["a"])(t,[{key:"Copy",value:function(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this}},{key:"Clone",value:function(){return(new t).Copy(this)}}]),t}(),$n=function(){function t(e,i){Object(r["a"])(this,t),this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new t.UserOverridableBuffer,this.m_flagsBuffer=new t.UserOverridableBuffer,this.m_positionBuffer=new t.UserOverridableBuffer,this.m_velocityBuffer=new t.UserOverridableBuffer,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new t.UserOverridableBuffer,this.m_groupBuffer=[],this.m_userDataBuffer=new t.UserOverridableBuffer,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new t.UserOverridableBuffer,this.m_bodyContactCountBuffer=new t.UserOverridableBuffer,this.m_consecutiveContactStepsBuffer=new t.UserOverridableBuffer,this.m_stuckParticleBuffer=new Un((function(){return 0})),this.m_proxyBuffer=new Un((function(){return new t.Proxy})),this.m_contactBuffer=new Un((function(){return new Zn})),this.m_bodyContactBuffer=new Un((function(){return new Hn})),this.m_pairBuffer=new Un((function(){return new Yn})),this.m_triadBuffer=new Un((function(){return new Kn})),this.m_expirationTimeBuffer=new t.UserOverridableBuffer,this.m_indexByExpirationTimeBuffer=new t.UserOverridableBuffer,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new Qn,this.m_world=null,this.m_prev=null,this.m_next=null,this.SetStrictContactCheck(e.strictContactCheck),this.SetDensity(e.density),this.SetGravityScale(e.gravityScale),this.SetRadius(e.radius),this.SetMaxParticleCount(e.maxCount),Fn(e.lifetimeGranularity>0),this.m_def=e.Clone(),this.m_world=i,this.SetDestructionByAge(this.m_def.destroyByAge)}return Object(o["a"])(t,[{key:"Drop",value:function(){while(this.m_groupList)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)}},{key:"CreateParticle",value:function(t){if(Fn(!1===this.m_world.IsLocked()),this.m_world.IsLocked())return 0;if(this.m_count>=this.m_internalAllocatedCapacity){var e=this.m_count?2*this.m_count:T;this.ReallocateInternalAllocatedBuffers(e)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return P;this.DestroyOldestParticle(0,!1),this.SolveZombie()}var i=this.m_count++;this.m_flagsBuffer.data[i]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[i]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[i]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[i]=0),this.m_positionBuffer.data[i]=(this.m_positionBuffer.data[i]||new at).Copy(t.position),this.m_velocityBuffer.data[i]=(this.m_velocityBuffer.data[i]||new at).Copy(t.velocity),this.m_weightBuffer[i]=0,this.m_forceBuffer[i]=(this.m_forceBuffer[i]||new at).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[i]=0),this.m_depthBuffer&&(this.m_depthBuffer[i]=0),!this.m_colorBuffer.data&&t.color.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[i]=(this.m_colorBuffer.data[i]||new se).Copy(t.color)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[i]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[i]=null);var s=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],n=t.lifetime>0;(this.m_expirationTimeBuffer.data||n)&&(this.SetParticleLifetime(i,n?t.lifetime:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),this.m_indexByExpirationTimeBuffer.data[i]=i),s.index=i;var a=t.group;return this.m_groupBuffer[i]=a,a&&(a.m_firstIndex<a.m_lastIndex?(this.RotateBuffer(a.m_firstIndex,a.m_lastIndex,i),Fn(a.m_lastIndex===i),a.m_lastIndex=i+1):(a.m_firstIndex=i,a.m_lastIndex=i+1)),this.SetParticleFlags(i,t.flags),i}},{key:"GetParticleHandleFromIndex",value:function(t){Fn(t>=0&&t<this.GetParticleCount()&&t!==P),this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);var e=this.m_handleIndexBuffer.data[t];return e||(e=new Mn,Fn(null!==e),e.SetIndex(t),this.m_handleIndexBuffer.data[t]=e,e)}},{key:"DestroyParticle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=Vn.b2_zombieParticle;e&&(i|=Vn.b2_destructionListenerParticle),this.SetParticleFlags(t,this.m_flagsBuffer.data[t]|i)}},{key:"DestroyOldestParticle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.GetParticleCount();Fn(t>=0&&t<i),Fn(null!==this.m_indexByExpirationTimeBuffer.data);var s=this.m_indexByExpirationTimeBuffer.data[i-(t+1)],n=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[s]>0?s:n,e)}},{key:"DestroyParticlesInShape",value:function(e,i){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.DestroyParticlesInShape_s_aabb;if(Fn(!1===this.m_world.IsLocked()),this.m_world.IsLocked())return 0;var a=new t.DestroyParticlesInShapeCallback(this,e,i,s),r=n;return e.ComputeAABB(r,i,0),this.m_world.QueryAABB(a,r),a.Destroyed()}},{key:"CreateParticleGroup",value:function(e){var i=t.CreateParticleGroup_s_transform;if(Fn(!1===this.m_world.IsLocked()),this.m_world.IsLocked())return null;var s=i;s.SetPositionAngle(e.position,e.angle);var n=this.m_count;if(e.shape&&this.CreateParticlesWithShapeForGroup(e.shape,e,s),e.shapes&&this.CreateParticlesWithShapesForGroup(e.shapes,e.shapeCount,e,s),e.particleCount){Fn(null!==e.positionData);for(var a=0;a<e.particleCount;a++){var r=e.positionData[a];this.CreateParticleForGroup(e,s,r)}}var o=this.m_count,l=new Pn;l.m_system=this,l.m_firstIndex=n,l.m_lastIndex=o,l.m_strength=e.strength,l.m_userData=e.userData,l.m_transform.Copy(s),l.m_prev=null,l.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=l),this.m_groupList=l,++this.m_groupCount;for(var u=n;u<o;u++)this.m_groupBuffer[u]=l;this.SetGroupFlags(l,e.groupFlags);var m=new t.ConnectionFilter;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(n,o,m),e.group&&(this.JoinParticleGroups(e.group,l),l=e.group),l}},{key:"JoinParticleGroups",value:function(e,i){if(Fn(!1===this.m_world.IsLocked()),!this.m_world.IsLocked()){Fn(e!==i),this.RotateBuffer(i.m_firstIndex,i.m_lastIndex,this.m_count),Fn(i.m_lastIndex===this.m_count),this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,i.m_firstIndex),Fn(e.m_lastIndex===i.m_firstIndex);var s=new t.JoinParticleGroupsFilter(i.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(e.m_firstIndex,i.m_lastIndex,s);for(var n=i.m_firstIndex;n<i.m_lastIndex;n++)this.m_groupBuffer[n]=e;var a=e.m_groupFlags|i.m_groupFlags;this.SetGroupFlags(e,a),e.m_lastIndex=i.m_lastIndex,i.m_firstIndex=i.m_lastIndex,this.DestroyParticleGroup(i)}}},{key:"SplitParticleGroup",value:function(e){this.UpdateContacts(!0);var i=e.GetParticleCount(),s=X(i,(function(e){return new t.ParticleListNode}));t.InitializeParticleLists(e,s),this.MergeParticleListsInContact(e,s);var n=t.FindLongestParticleList(e,s);this.MergeZombieParticleListNodes(e,s,n),this.CreateParticleGroupsFromParticleList(e,s,n),this.UpdatePairsAndTriadsWithParticleList(e,s)}},{key:"GetParticleGroupList",value:function(){return this.m_groupList}},{key:"GetParticleGroupCount",value:function(){return this.m_groupCount}},{key:"GetParticleCount",value:function(){return this.m_count}},{key:"GetMaxParticleCount",value:function(){return this.m_def.maxCount}},{key:"SetMaxParticleCount",value:function(t){Fn(this.m_count<=t),this.m_def.maxCount=t}},{key:"GetAllParticleFlags",value:function(){return this.m_allParticleFlags}},{key:"GetAllGroupFlags",value:function(){return this.m_allGroupFlags}},{key:"SetPaused",value:function(t){this.m_paused=t}},{key:"GetPaused",value:function(){return this.m_paused}},{key:"SetDensity",value:function(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density}},{key:"GetDensity",value:function(){return this.m_def.density}},{key:"SetGravityScale",value:function(t){this.m_def.gravityScale=t}},{key:"GetGravityScale",value:function(){return this.m_def.gravityScale}},{key:"SetDamping",value:function(t){this.m_def.dampingStrength=t}},{key:"GetDamping",value:function(){return this.m_def.dampingStrength}},{key:"SetStaticPressureIterations",value:function(t){this.m_def.staticPressureIterations=t}},{key:"GetStaticPressureIterations",value:function(){return this.m_def.staticPressureIterations}},{key:"SetRadius",value:function(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter}},{key:"GetRadius",value:function(){return this.m_particleDiameter/2}},{key:"GetPositionBuffer",value:function(){return this.m_positionBuffer.data}},{key:"GetVelocityBuffer",value:function(){return this.m_velocityBuffer.data}},{key:"GetColorBuffer",value:function(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data}},{key:"GetGroupBuffer",value:function(){return this.m_groupBuffer}},{key:"GetWeightBuffer",value:function(){return this.m_weightBuffer}},{key:"GetUserDataBuffer",value:function(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data}},{key:"GetFlagsBuffer",value:function(){return this.m_flagsBuffer.data}},{key:"SetParticleFlags",value:function(t,e){var i=this.m_flagsBuffer.data[t];i&~e&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&e&&(e&Vn.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),e&Vn.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=e),this.m_flagsBuffer.data[t]=e}},{key:"GetParticleFlags",value:function(t){return this.m_flagsBuffer.data[t]}},{key:"SetFlagsBuffer",value:function(t,e){this.SetUserOverridableBuffer(this.m_flagsBuffer,t,e)}},{key:"SetPositionBuffer",value:function(t,e){this.SetUserOverridableBuffer(this.m_positionBuffer,t,e)}},{key:"SetVelocityBuffer",value:function(t,e){this.SetUserOverridableBuffer(this.m_velocityBuffer,t,e)}},{key:"SetColorBuffer",value:function(t,e){this.SetUserOverridableBuffer(this.m_colorBuffer,t,e)}},{key:"SetUserDataBuffer",value:function(t,e){this.SetUserOverridableBuffer(this.m_userDataBuffer,t,e)}},{key:"GetContacts",value:function(){return this.m_contactBuffer.data}},{key:"GetContactCount",value:function(){return this.m_contactBuffer.count}},{key:"GetBodyContacts",value:function(){return this.m_bodyContactBuffer.data}},{key:"GetBodyContactCount",value:function(){return this.m_bodyContactBuffer.count}},{key:"GetPairs",value:function(){return this.m_pairBuffer.data}},{key:"GetPairCount",value:function(){return this.m_pairBuffer.count}},{key:"GetTriads",value:function(){return this.m_triadBuffer.data}},{key:"GetTriadCount",value:function(){return this.m_triadBuffer.count}},{key:"SetStuckThreshold",value:function(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))}},{key:"GetStuckCandidates",value:function(){return this.m_stuckParticleBuffer.Data()}},{key:"GetStuckCandidateCount",value:function(){return this.m_stuckParticleBuffer.GetCount()}},{key:"ComputeCollisionEnergy",value:function(){for(var e=t.ComputeCollisionEnergy_s_v,i=this.m_velocityBuffer.data,s=0,n=0;n<this.m_contactBuffer.count;n++){var a=this.m_contactBuffer.data[n],r=a.indexA,o=a.indexB,l=a.normal,u=at.SubVV(i[o],i[r],e),m=at.DotVV(u,l);m<0&&(s+=m*m)}return.5*this.GetParticleMass()*s}},{key:"SetStrictContactCheck",value:function(t){this.m_def.strictContactCheck=t}},{key:"GetStrictContactCheck",value:function(){return this.m_def.strictContactCheck}},{key:"SetParticleLifetime",value:function(t,e){Fn(this.ValidateParticleIndex(t));var i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i)for(var s=this.GetParticleCount(),n=0;n<s;++n)this.m_indexByExpirationTimeBuffer.data[n]=n;var a=e/this.m_def.lifetimeGranularity,r=a>0?this.GetQuantizedTimeElapsed()+a:a;r!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=r,this.m_expirationTimeBufferRequiresSorting=!0)}},{key:"GetParticleLifetime",value:function(t){return Fn(this.ValidateParticleIndex(t)),this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])}},{key:"SetDestructionByAge",value:function(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t}},{key:"GetDestructionByAge",value:function(){return this.m_def.destroyByAge}},{key:"GetExpirationTimeBuffer",value:function(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data}},{key:"ExpirationTimeToLifetime",value:function(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity}},{key:"GetIndexByExpirationTimeBuffer",value:function(){return this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data}},{key:"ParticleApplyLinearImpulse",value:function(t,e){this.ApplyLinearImpulse(t,t+1,e)}},{key:"ApplyLinearImpulse",value:function(t,e,i){for(var s=this.m_velocityBuffer.data,n=e-t,a=n*this.GetParticleMass(),r=i.Clone().SelfMul(1/a),o=t;o<e;o++)s[o].SelfAdd(r)}},{key:"ParticleApplyForce",value:function(e,i){t.IsSignificantForce(i)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[e])&&(this.PrepareForceBuffer(),this.m_forceBuffer[e].SelfAdd(i))}},{key:"ApplyForce",value:function(e,i,s){var n=s.Clone().SelfMul(1/(i-e));if(t.IsSignificantForce(n)){this.PrepareForceBuffer();for(var a=e;a<i;a++)this.m_forceBuffer[a].SelfAdd(n)}}},{key:"GetNext",value:function(){return this.m_next}},{key:"QueryAABB",value:function(e,i){if(0!==this.m_proxyBuffer.count)for(var s=0,n=this.m_proxyBuffer.count,a=Nn(this.m_proxyBuffer.data,s,n,t.computeTag(this.m_inverseDiameter*i.lowerBound.x,this.m_inverseDiameter*i.lowerBound.y),t.Proxy.CompareProxyTag),r=En(this.m_proxyBuffer.data,a,n,t.computeTag(this.m_inverseDiameter*i.upperBound.x,this.m_inverseDiameter*i.upperBound.y),t.Proxy.CompareTagProxy),o=this.m_positionBuffer.data,l=a;l<r;++l){var u=this.m_proxyBuffer.data[l],m=u.index,_=o[m];if(i.lowerBound.x<_.x&&_.x<i.upperBound.x&&i.lowerBound.y<_.y&&_.y<i.upperBound.y&&!e.ReportParticle(this,m))break}}},{key:"QueryShapeAABB",value:function(e,i,s){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=t.QueryShapeAABB_s_aabb,r=a;i.ComputeAABB(r,s,n),this.QueryAABB(e,r)}},{key:"QueryPointAABB",value:function(e,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y,n=t.QueryPointAABB_s_aabb,a=n;a.lowerBound.Set(i.x-s,i.y-s),a.upperBound.Set(i.x+s,i.y+s),this.QueryAABB(e,a)}},{key:"RayCast",value:function(e,i,s){var n=t.RayCast_s_aabb,a=t.RayCast_s_p,r=t.RayCast_s_v,o=t.RayCast_s_n,l=t.RayCast_s_point;if(0!==this.m_proxyBuffer.count){var u=this.m_positionBuffer.data,m=n;at.MinV(i,s,m.lowerBound),at.MaxV(i,s,m.upperBound);var _,h=1,c=at.SubVV(s,i,r),f=at.DotVV(c,c),d=this.GetInsideBoundsEnumerator(m);while((_=d.GetNext())>=0){var v=at.SubVV(i,u[_],a),y=at.DotVV(v,c),p=at.DotVV(v,v),x=y*y-f*(p-this.m_squaredDiameter);if(x>=0){var B=et(x),S=(-y-B)/f;if(S>h)continue;if(S<0&&(S=(-y+B)/f,S<0||S>h))continue;var A=at.AddVMulSV(v,S,c,o);A.Normalize();var C=e.ReportParticle(this,_,at.AddVMulSV(i,S,c,l),A,S);if(h=Y(h,C),h<=0)break}}}}},{key:"ComputeAABB",value:function(t){var e=this.GetParticleCount();Fn(null!==t),t.lowerBound.x=+u,t.lowerBound.y=+u,t.upperBound.x=-u,t.upperBound.y=-u;for(var i=this.m_positionBuffer.data,s=0;s<e;s++){var n=i[s];at.MinV(t.lowerBound,n,t.lowerBound),at.MaxV(t.upperBound,n,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter}},{key:"FreeBuffer",value:function(t,e){null!==t&&(t.length=0)}},{key:"FreeUserOverridableBuffer",value:function(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)}},{key:"ReallocateBuffer3",value:function(t,e,i){Fn(i>e);var s=t?t.slice():[];return s.length=i,s}},{key:"ReallocateBuffer5",value:function(t,e,i,s,n){return Fn(s>i),Fn(!e||s<=e),n&&!t||e||(t=this.ReallocateBuffer3(t,i,s)),t}},{key:"ReallocateBuffer4",value:function(t,e,i,s){return Fn(i>e),this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,s)}},{key:"RequestBuffer",value:function(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(T),t=[],t.length=this.m_internalAllocatedCapacity),t}},{key:"ReallocateHandleBuffers",value:function(t){Fn(t>this.m_internalAllocatedCapacity),this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)}},{key:"ReallocateInternalAllocatedBuffers",value:function(t){function e(t,e){return e&&t>e?e:t}if(t=e(t,this.m_def.maxCount),t=e(t,this.m_flagsBuffer.userSuppliedCapacity),t=e(t,this.m_positionBuffer.userSuppliedCapacity),t=e(t,this.m_velocityBuffer.userSuppliedCapacity),t=e(t,this.m_colorBuffer.userSuppliedCapacity),t=e(t,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);var i=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,i),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,i),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,i),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}}},{key:"CreateParticleForGroup",value:function(t,e,i){var s=new gn;s.flags=t.flags,Yt.MulXV(e,i,s.position),at.AddVV(t.linearVelocity,at.CrossSV(t.angularVelocity,at.SubVV(s.position,t.position,at.s_t0),at.s_t0),s.velocity),s.color.Copy(t.color),s.lifetime=t.lifetime,s.userData=t.userData,this.CreateParticle(s)}},{key:"CreateParticlesStrokeShapeForGroup",value:function(e,i,s){var n=t.CreateParticlesStrokeShapeForGroup_s_edge,a=t.CreateParticlesStrokeShapeForGroup_s_d,r=t.CreateParticlesStrokeShapeForGroup_s_p,o=i.stride;0===o&&(o=this.GetParticleStride());for(var l=0,u=e.GetChildCount(),m=0;m<u;m++){var _=null;e.GetType()===ms.e_edgeShape?_=e:(Fn(e.GetType()===ms.e_chainShape),_=n,e.GetChildEdge(_,m));var h=at.SubVV(_.m_vertex2,_.m_vertex1,a),c=h.Length();while(l<c){var f=at.AddVMulSV(_.m_vertex1,l/c,h,r);this.CreateParticleForGroup(i,s,f),l+=o}l-=c}}},{key:"CreateParticlesFillShapeForGroup",value:function(e,i,s){var n=t.CreateParticlesFillShapeForGroup_s_aabb,a=t.CreateParticlesFillShapeForGroup_s_p,r=i.stride;0===r&&(r=this.GetParticleStride());var o=Yt.IDENTITY,l=n;Fn(1===e.GetChildCount()),e.ComputeAABB(l,o,0);for(var u=Math.floor(l.lowerBound.y/r)*r;u<l.upperBound.y;u+=r)for(var m=Math.floor(l.lowerBound.x/r)*r;m<l.upperBound.x;m+=r){var _=a.Set(m,u);e.TestPoint(o,_)&&this.CreateParticleForGroup(i,s,_)}}},{key:"CreateParticlesWithShapeForGroup",value:function(t,e,i){switch(t.GetType()){case ms.e_edgeShape:case ms.e_chainShape:this.CreateParticlesStrokeShapeForGroup(t,e,i);break;case ms.e_polygonShape:case ms.e_circleShape:this.CreateParticlesFillShapeForGroup(t,e,i);break;default:Fn(!1);break}}},{key:"CreateParticlesWithShapesForGroup",value:function(e,i,s,n){var a=new t.CompositeShape(e,i);this.CreateParticlesFillShapeForGroup(a,s,n)}},{key:"CloneParticle",value:function(t,e){var i=new gn;i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;var s=this.CreateParticle(i);if(this.m_handleIndexBuffer.data){var n=this.m_handleIndexBuffer.data[t];n&&n.SetIndex(s),this.m_handleIndexBuffer.data[s]=n,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[s]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[s]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[s]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[s].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[s]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[s]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[s]=this.m_expirationTimeBuffer.data[t]),s}},{key:"DestroyParticlesInGroup",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e)}},{key:"DestroyParticleGroup",value:function(t){Fn(this.m_groupCount>0),Fn(null!==t),this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(var e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount}},{key:"UpdatePairsAndTriads",value:function(e,i,s){var n=t.UpdatePairsAndTriads_s_dab,a=t.UpdatePairsAndTriads_s_dbc,r=t.UpdatePairsAndTriads_s_dca,o=this.m_positionBuffer.data;Fn(e<=i);for(var l=0,u=e;u<i;u++)l|=this.m_flagsBuffer.data[u];if(l&t.k_pairFlags)for(var m=0;m<this.m_contactBuffer.count;m++){var _=this.m_contactBuffer.data[m],h=_.indexA,c=_.indexB,f=this.m_flagsBuffer.data[h],d=this.m_flagsBuffer.data[c],v=this.m_groupBuffer[h],y=this.m_groupBuffer[c];if(h>=e&&h<i&&c>=e&&c<i&&!((f|d)&Vn.b2_zombieParticle)&&(f|d)&t.k_pairFlags&&(s.IsNecessary(h)||s.IsNecessary(c))&&t.ParticleCanBeConnected(f,v)&&t.ParticleCanBeConnected(d,y)&&s.ShouldCreatePair(h,c)){var p=this.m_pairBuffer.data[this.m_pairBuffer.Append()];p.indexA=h,p.indexB=c,p.flags=_.flags,p.strength=Y(v?v.m_strength:1,y?y.m_strength:1),p.distance=at.DistanceVV(o[h],o[c])}qn(this.m_pairBuffer.data,0,this.m_pairBuffer.count,t.ComparePairIndices),this.m_pairBuffer.Unique(t.MatchPairIndices)}if(l&t.k_triadFlags){for(var x=new On(i-e),B=e;B<i;B++){var S=this.m_flagsBuffer.data[B],A=this.m_groupBuffer[B];S&Vn.b2_zombieParticle||!t.ParticleCanBeConnected(S,A)||x.AddGenerator(o[B],B,s.IsNecessary(B))}var C=this.GetParticleStride();x.Generate(C/2,2*C);var b=this,V=function(e,i,l){var u=b.m_flagsBuffer.data[e],m=b.m_flagsBuffer.data[i],_=b.m_flagsBuffer.data[l];if((u|m|_)&t.k_triadFlags&&s.ShouldCreateTriad(e,i,l)){var h=o[e],c=o[i],f=o[l],d=at.SubVV(h,c,n),v=at.SubVV(c,f,a),y=at.SubVV(f,h,r),p=R*b.m_squaredDiameter;if(at.DotVV(d,d)>p||at.DotVV(v,v)>p||at.DotVV(y,y)>p)return;var x=b.m_groupBuffer[e],B=b.m_groupBuffer[i],S=b.m_groupBuffer[l],A=b.m_triadBuffer.data[b.m_triadBuffer.Append()];A.indexA=e,A.indexB=i,A.indexC=l,A.flags=u|m|_,A.strength=Y(Y(x?x.m_strength:1,B?B.m_strength:1),S?S.m_strength:1);var C=(h.x+c.x+f.x)/3,V=(h.y+c.y+f.y)/3;A.pa.x=h.x-C,A.pa.y=h.y-V,A.pb.x=c.x-C,A.pb.y=c.y-V,A.pc.x=f.x-C,A.pc.y=f.y-V,A.ka=-at.DotVV(y,d),A.kb=-at.DotVV(d,v),A.kc=-at.DotVV(v,y),A.s=at.CrossVV(h,c)+at.CrossVV(c,f)+at.CrossVV(f,h)}};x.GetNodes(V),qn(this.m_triadBuffer.data,0,this.m_triadBuffer.count,t.CompareTriadIndices),this.m_triadBuffer.Unique(t.MatchTriadIndices)}}},{key:"UpdatePairsAndTriadsWithReactiveParticles",value:function(){var e=new t.ReactiveFilter(this.m_flagsBuffer);this.UpdatePairsAndTriads(0,this.m_count,e);for(var i=0;i<this.m_count;i++)this.m_flagsBuffer.data[i]&=~Vn.b2_reactiveParticle;this.m_allParticleFlags&=~Vn.b2_reactiveParticle}},{key:"MergeParticleListsInContact",value:function(e,i){for(var s=e.GetBufferIndex(),n=0;n<this.m_contactBuffer.count;n++){var a=this.m_contactBuffer.data[n],r=a.indexA,o=a.indexB;if(e.ContainsParticle(r)&&e.ContainsParticle(o)){var l=i[r-s].list,u=i[o-s].list;if(l!==u){if(l.count<u.count){var m=l;l=u,u=m}Fn(l.count>=u.count),t.MergeParticleLists(l,u)}}}}},{key:"MergeZombieParticleListNodes",value:function(e,i,s){for(var n=e.GetParticleCount(),a=0;a<n;a++){var r=i[a];r!==s&&this.m_flagsBuffer.data[r.index]&Vn.b2_zombieParticle&&t.MergeParticleListAndNode(s,r)}}},{key:"CreateParticleGroupsFromParticleList",value:function(t,e,i){var s=t.GetParticleCount(),n=new In;n.groupFlags=t.GetGroupFlags(),n.userData=t.GetUserData();for(var a=0;a<s;a++){var r=e[a];if(r.count&&r!==i){Fn(r.list===r);for(var o=this.CreateParticleGroup(n),l=r;l;l=l.next){var u=l.index,m=this.m_flagsBuffer.data[u];Fn(!(m&Vn.b2_zombieParticle));var _=this.CloneParticle(u,o);this.m_flagsBuffer.data[u]|=Vn.b2_zombieParticle,l.index=_}}}}},{key:"UpdatePairsAndTriadsWithParticleList",value:function(t,e){for(var i=t.GetBufferIndex(),s=0;s<this.m_pairBuffer.count;s++){var n=this.m_pairBuffer.data[s],a=n.indexA,r=n.indexB;t.ContainsParticle(a)&&(n.indexA=e[a-i].index),t.ContainsParticle(r)&&(n.indexB=e[r-i].index)}for(var o=0;o<this.m_triadBuffer.count;o++){var l=this.m_triadBuffer.data[o],u=l.indexA,m=l.indexB,_=l.indexC;t.ContainsParticle(u)&&(l.indexA=e[u-i].index),t.ContainsParticle(m)&&(l.indexB=e[m-i].index),t.ContainsParticle(_)&&(l.indexC=e[_-i].index)}}},{key:"ComputeDepth",value:function(){for(var t=[],e=0,i=0;i<this.m_contactBuffer.count;i++){var s=this.m_contactBuffer.data[i],n=s.indexA,a=s.indexB,r=this.m_groupBuffer[n],o=this.m_groupBuffer[a];r&&r===o&&r.m_groupFlags&kn.b2_particleGroupNeedsUpdateDepth&&(t[e++]=s)}for(var l=[],m=0,_=this.m_groupList;_;_=_.GetNext())if(_.m_groupFlags&kn.b2_particleGroupNeedsUpdateDepth){l[m++]=_,this.SetGroupFlags(_,_.m_groupFlags&~kn.b2_particleGroupNeedsUpdateDepth);for(var h=_.m_firstIndex;h<_.m_lastIndex;h++)this.m_accumulationBuffer[h]=0}for(var c=0;c<e;c++){var f=t[c],d=f.indexA,v=f.indexB,y=f.weight;this.m_accumulationBuffer[d]+=y,this.m_accumulationBuffer[v]+=y}Fn(null!==this.m_depthBuffer);for(var p=0;p<m;p++)for(var x=l[p],B=x.m_firstIndex;B<x.m_lastIndex;B++){var S=this.m_accumulationBuffer[B];this.m_depthBuffer[B]=S<.8?0:u}for(var A=et(this.m_count)>>0,C=0;C<A;C++){for(var b=!1,V=0;V<e;V++){var g=t[V],w=g.indexA,k=g.indexB,M=1-g.weight,I=this.m_depthBuffer[w],P=this.m_depthBuffer[k],G=P+M,D=I+M;I>G&&(this.m_depthBuffer[w]=G,b=!0),P>D&&(this.m_depthBuffer[k]=D,b=!0)}if(!b)break}for(var j=0;j<m;j++)for(var O=l[j],F=O.m_firstIndex;F<O.m_lastIndex;F++)this.m_depthBuffer[F]<u?this.m_depthBuffer[F]*=this.m_particleDiameter:this.m_depthBuffer[F]=0}},{key:"GetInsideBoundsEnumerator",value:function(e){var i=t.computeTag(this.m_inverseDiameter*e.lowerBound.x-1,this.m_inverseDiameter*e.lowerBound.y-1),s=t.computeTag(this.m_inverseDiameter*e.upperBound.x+1,this.m_inverseDiameter*e.upperBound.y+1),n=0,a=this.m_proxyBuffer.count,r=Nn(this.m_proxyBuffer.data,n,a,i,t.Proxy.CompareProxyTag),o=En(this.m_proxyBuffer.data,n,a,s,t.Proxy.CompareTagProxy);return Fn(n<=r),Fn(r<=o),Fn(o<=a),new t.InsideBoundsEnumerator(this,i,s,r,o)}},{key:"UpdateAllParticleFlags",value:function(){this.m_allParticleFlags=0;for(var t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1}},{key:"UpdateAllGroupFlags",value:function(){this.m_allGroupFlags=0;for(var t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1}},{key:"AddContact",value:function(e,i,s){var n=t.AddContact_s_d,a=this.m_positionBuffer.data;Fn(s===this.m_contactBuffer);var r=at.SubVV(a[i],a[e],n),o=at.DotVV(r,r);if(o<this.m_squaredDiameter){var l=tt(o);isFinite(l)||(l=198177537e11);var u=this.m_contactBuffer.data[this.m_contactBuffer.Append()];u.indexA=e,u.indexB=i,u.flags=this.m_flagsBuffer.data[e]|this.m_flagsBuffer.data[i],u.weight=1-o*l*this.m_inverseDiameter,at.MulSV(l,r,u.normal)}}},{key:"FindContacts_Reference",value:function(e){Fn(e===this.m_contactBuffer);var i=0,s=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(var n=i,a=i;n<s;n++){for(var r=t.computeRelativeTag(this.m_proxyBuffer.data[n].tag,1,0),o=n+1;o<s;o++){if(r<this.m_proxyBuffer.data[o].tag)break;this.AddContact(this.m_proxyBuffer.data[n].index,this.m_proxyBuffer.data[o].index,this.m_contactBuffer)}for(var l=t.computeRelativeTag(this.m_proxyBuffer.data[n].tag,-1,1);a<s;a++)if(l<=this.m_proxyBuffer.data[a].tag)break;for(var u=t.computeRelativeTag(this.m_proxyBuffer.data[n].tag,1,1),m=a;m<s;m++){if(u<this.m_proxyBuffer.data[m].tag)break;this.AddContact(this.m_proxyBuffer.data[n].index,this.m_proxyBuffer.data[m].index,this.m_contactBuffer)}}}},{key:"FindContacts",value:function(t){this.FindContacts_Reference(t)}},{key:"UpdateProxies_Reference",value:function(e){Fn(e===this.m_proxyBuffer);for(var i=this.m_positionBuffer.data,s=this.m_inverseDiameter,n=0;n<this.m_proxyBuffer.count;++n){var a=this.m_proxyBuffer.data[n],r=a.index,o=i[r];a.tag=t.computeTag(s*o.x,s*o.y)}}},{key:"UpdateProxies",value:function(t){this.UpdateProxies_Reference(t)}},{key:"SortProxies",value:function(e){Fn(e===this.m_proxyBuffer),Tn(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,t.Proxy.CompareProxyProxy)}},{key:"FilterContacts",value:function(t){var e=this.GetParticleContactFilter();if(null!==e){Fn(t===this.m_contactBuffer);var i=this,s=function(t){return t.flags&Vn.b2_particleContactFilterParticle&&!e.ShouldCollideParticleParticle(i,t.indexA,t.indexB)};this.m_contactBuffer.RemoveIf(s)}}},{key:"NotifyContactListenerPreContact",value:function(t){var e=this.GetParticleContactListener();if(null!==e)throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error}},{key:"NotifyContactListenerPostContact",value:function(t){var e=this.GetParticleContactListener();if(null!==e){for(var i=0;i<this.m_contactBuffer.count;++i){var s=this.m_contactBuffer.data[i],n=-1;n>=0?t.Invalidate(n):e.BeginContactParticleParticle(this,s)}throw new Error}}},{key:"UpdateContacts",value:function(e){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);var i=new t.b2ParticlePairSet;this.NotifyContactListenerPreContact(i),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(i),e&&this.m_contactBuffer.RemoveIf(t.b2ParticleContactIsZombie)}},{key:"NotifyBodyContactListenerPreContact",value:function(t){var e=this.GetFixtureContactListener();if(null!==e)throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error}},{key:"NotifyBodyContactListenerPostContact",value:function(t){var e=this.GetFixtureContactListener();if(null!==e){for(var i=0;i<this.m_bodyContactBuffer.count;i++){var s=this.m_bodyContactBuffer.data[i];Fn(null!==s);var n=-1;n>=0?t.Invalidate(n):e.BeginContactFixtureParticle(this,s)}throw new Error}}},{key:"UpdateBodyContacts",value:function(){var e=t.UpdateBodyContacts_s_aabb,i=new t.FixtureParticleSet;if(this.NotifyBodyContactListenerPreContact(i),this.m_stuckThreshold>0)for(var s=this.GetParticleCount(),n=0;n<s;n++)this.m_bodyContactCountBuffer.data[n]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[n]+1&&(this.m_consecutiveContactStepsBuffer.data[n]=0);this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);var a=e;this.ComputeAABB(a);var r=new t.UpdateBodyContactsCallback(this,this.GetFixtureContactFilter());this.m_world.QueryAABB(r,a),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(i)}},{key:"Solve",value:function(e){var i=t.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(e),this.m_allParticleFlags&Vn.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<e.particleIterations;this.m_iterationIndex++){++this.m_timestamp;var s=i.Copy(e);s.dt/=e.particleIterations,s.inv_dt*=e.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&kn.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&Vn.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(s),this.m_allParticleFlags&Vn.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&Vn.b2_repulsiveParticle&&this.SolveRepulsive(s),this.m_allParticleFlags&Vn.b2_powderParticle&&this.SolvePowder(s),this.m_allParticleFlags&Vn.b2_tensileParticle&&this.SolveTensile(s),this.m_allGroupFlags&kn.b2_solidParticleGroup&&this.SolveSolid(s),this.m_allParticleFlags&Vn.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(s),this.m_allParticleFlags&Vn.b2_staticPressureParticle&&this.SolveStaticPressure(s),this.SolvePressure(s),this.SolveDamping(s),this.m_allParticleFlags&t.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&Vn.b2_elasticParticle&&this.SolveElastic(s),this.m_allParticleFlags&Vn.b2_springParticle&&this.SolveSpring(s),this.LimitVelocity(s),this.m_allGroupFlags&kn.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&Vn.b2_barrierParticle&&this.SolveBarrier(s),this.SolveCollision(s),this.m_allGroupFlags&kn.b2_rigidParticleGroup&&this.SolveRigid(s),this.m_allParticleFlags&Vn.b2_wallParticle&&this.SolveWall();for(var n=0;n<this.m_count;n++)this.m_positionBuffer.data[n].SelfMulAdd(s.dt,this.m_velocityBuffer.data[n])}}},{key:"SolveCollision",value:function(e){var i=t.SolveCollision_s_aabb,s=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,a=i;a.lowerBound.x=+u,a.lowerBound.y=+u,a.upperBound.x=-u,a.upperBound.y=-u;for(var r=0;r<this.m_count;r++){var o=n[r],l=s[r],m=l.x+e.dt*o.x,_=l.y+e.dt*o.y;a.lowerBound.x=Y(a.lowerBound.x,Y(l.x,m)),a.lowerBound.y=Y(a.lowerBound.y,Y(l.y,_)),a.upperBound.x=K(a.upperBound.x,K(l.x,m)),a.upperBound.y=K(a.upperBound.y,K(l.y,_))}var h=new t.SolveCollisionCallback(this,e);this.m_world.QueryAABB(h,a)}},{key:"LimitVelocity",value:function(t){for(var e=this.m_velocityBuffer.data,i=this.GetCriticalVelocitySquared(t),s=0;s<this.m_count;s++){var n=e[s],a=at.DotVV(n,n);a>i&&n.SelfMul(et(i/a))}}},{key:"SolveGravity",value:function(e){for(var i=t.SolveGravity_s_gravity,s=this.m_velocityBuffer.data,n=at.MulSV(e.dt*this.m_def.gravityScale,this.m_world.GetGravity(),i),a=0;a<this.m_count;a++)s[a].SelfAdd(n)}},{key:"SolveBarrier",value:function(e){for(var i=t.SolveBarrier_s_aabb,s=t.SolveBarrier_s_va,n=t.SolveBarrier_s_vb,a=t.SolveBarrier_s_pba,r=t.SolveBarrier_s_vba,o=t.SolveBarrier_s_vc,l=t.SolveBarrier_s_pca,u=t.SolveBarrier_s_vca,m=t.SolveBarrier_s_qba,_=t.SolveBarrier_s_qca,h=t.SolveBarrier_s_dv,c=t.SolveBarrier_s_f,f=this.m_positionBuffer.data,d=this.m_velocityBuffer.data,v=0;v<this.m_count;v++){var y=this.m_flagsBuffer.data[v];0!==(y&t.k_barrierWallFlags)&&d[v].SetZero()}for(var p=q*e.dt,x=this.GetParticleMass(),B=0;B<this.m_pairBuffer.count;B++){var S=this.m_pairBuffer.data[B];if(S.flags&Vn.b2_barrierParticle){var A=S.indexA,C=S.indexB,b=f[A],V=f[C],g=i;at.MinV(b,V,g.lowerBound),at.MaxV(b,V,g.upperBound);var w=this.m_groupBuffer[A],k=this.m_groupBuffer[C],M=this.GetLinearVelocity(w,A,b,s),I=this.GetLinearVelocity(k,C,V,n),P=at.SubVV(V,b,a),G=at.SubVV(I,M,r),D=this.GetInsideBoundsEnumerator(g),j=void 0;while((j=D.GetNext())>=0){var O=f[j],F=this.m_groupBuffer[j];if(w!==F&&k!==F){var L=this.GetLinearVelocity(F,j,O,o),R=at.SubVV(O,b,l),T=at.SubVV(L,M,u),z=at.CrossVV(G,T),N=at.CrossVV(P,T)-at.CrossVV(R,G),E=at.CrossVV(P,R),J=void 0,X=void 0,U=m,W=_;if(0===z){if(0===N)continue;if(X=-E/N,!(X>=0&&X<p))continue;if(at.AddVMulSV(P,X,G,U),at.AddVMulSV(R,X,T,W),J=at.DotVV(U,W)/at.DotVV(U,U),!(J>=0&&J<=1))continue}else{var Z=N*N-4*E*z;if(Z<0)continue;var H=et(Z),Y=(-N-H)/(2*z),K=(-N+H)/(2*z);if(Y>K){var Q=Y;Y=K,K=Q}if(X=Y,at.AddVMulSV(P,X,G,U),at.AddVMulSV(R,X,T,W),J=at.DotVV(U,W)/at.DotVV(U,U),!(X>=0&&X<p&&J>=0&&J<=1)){if(X=K,!(X>=0&&X<p))continue;if(at.AddVMulSV(P,X,G,U),at.AddVMulSV(R,X,T,W),J=at.DotVV(U,W)/at.DotVV(U,U),!(J>=0&&J<=1))continue}}var $=h;$.x=M.x+J*G.x-L.x,$.y=M.y+J*G.y-L.y;var tt=at.MulSV(x,$,c);if(this.IsRigidGroup(F)){var it=F.GetMass(),st=F.GetInertia();it>0&&F.m_linearVelocity.SelfMulAdd(1/it,tt),st>0&&(F.m_angularVelocity+=at.CrossVV(at.SubVV(O,F.GetCenter(),at.s_t0),tt)/st)}else d[j].SelfAdd($);this.ParticleApplyForce(j,tt.SelfMul(-e.inv_dt))}}}}}},{key:"SolveStaticPressure",value:function(t){this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);for(var e=this.GetCriticalPressure(t),i=this.m_def.staticPressureStrength*e,s=O*e,n=this.m_def.staticPressureRelaxation,a=0;a<this.m_def.staticPressureIterations;a++){for(var r=0;r<this.m_count;r++)this.m_accumulationBuffer[r]=0;for(var o=0;o<this.m_contactBuffer.count;o++){var l=this.m_contactBuffer.data[o];if(l.flags&Vn.b2_staticPressureParticle){var u=l.indexA,m=l.indexB,_=l.weight;this.m_accumulationBuffer[u]+=_*this.m_staticPressureBuffer[m],this.m_accumulationBuffer[m]+=_*this.m_staticPressureBuffer[u]}}for(var h=0;h<this.m_count;h++){var c=this.m_weightBuffer[h];if(this.m_flagsBuffer.data[h]&Vn.b2_staticPressureParticle){var f=this.m_accumulationBuffer[h],d=(f+i*(c-j))/(c+n);this.m_staticPressureBuffer[h]=Q(d,0,s)}else this.m_staticPressureBuffer[h]=0}}}},{key:"ComputeWeight",value:function(){for(var t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(var e=0;e<this.m_bodyContactBuffer.count;e++){var i=this.m_bodyContactBuffer.data[e],s=i.index,n=i.weight;this.m_weightBuffer[s]+=n}for(var a=0;a<this.m_contactBuffer.count;a++){var r=this.m_contactBuffer.data[a],o=r.indexA,l=r.indexB,u=r.weight;this.m_weightBuffer[o]+=u,this.m_weightBuffer[l]+=u}}},{key:"SolvePressure",value:function(e){for(var i=t.SolvePressure_s_f,s=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,a=this.GetCriticalPressure(e),r=this.m_def.pressureStrength*a,o=O*a,l=0;l<this.m_count;l++){var u=this.m_weightBuffer[l],m=r*K(0,u-j);this.m_accumulationBuffer[l]=Y(m,o)}if(this.m_allParticleFlags&t.k_noPressureFlags)for(var _=0;_<this.m_count;_++)this.m_flagsBuffer.data[_]&t.k_noPressureFlags&&(this.m_accumulationBuffer[_]=0);if(this.m_allParticleFlags&Vn.b2_staticPressureParticle){Fn(null!==this.m_staticPressureBuffer);for(var h=0;h<this.m_count;h++)this.m_flagsBuffer.data[h]&Vn.b2_staticPressureParticle&&(this.m_accumulationBuffer[h]+=this.m_staticPressureBuffer[h])}for(var c=e.dt/(this.m_def.density*this.m_particleDiameter),f=this.GetParticleInvMass(),d=0;d<this.m_bodyContactBuffer.count;d++){var v=this.m_bodyContactBuffer.data[d],y=v.index,p=v.body,x=v.weight,B=v.mass,S=v.normal,A=s[y],C=this.m_accumulationBuffer[y]+r*x,b=at.MulSV(c*x*B*C,S,i);n[y].SelfMulSub(f,b),p.ApplyLinearImpulse(b,A,!0)}for(var V=0;V<this.m_contactBuffer.count;V++){var g=this.m_contactBuffer.data[V],w=g.indexA,k=g.indexB,M=g.weight,I=g.normal,P=this.m_accumulationBuffer[w]+this.m_accumulationBuffer[k],G=at.MulSV(c*M*P,I,i);n[w].SelfSub(G),n[k].SelfAdd(G)}}},{key:"SolveDamping",value:function(e){for(var i=t.SolveDamping_s_v,s=t.SolveDamping_s_f,n=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,r=this.m_def.dampingStrength,o=1/this.GetCriticalVelocity(e),l=this.GetParticleInvMass(),u=0;u<this.m_bodyContactBuffer.count;u++){var m=this.m_bodyContactBuffer.data[u],_=m.index,h=m.body,c=m.weight,f=m.mass,d=m.normal,v=n[_],y=at.SubVV(h.GetLinearVelocityFromWorldPoint(v,at.s_t0),a[_],i),p=at.DotVV(y,d);if(p<0){var x=K(r*c,Y(-o*p,.5)),B=at.MulSV(x*f*p,d,s);a[_].SelfMulAdd(l,B),h.ApplyLinearImpulse(B.SelfNeg(),v,!0)}}for(var S=0;S<this.m_contactBuffer.count;S++){var A=this.m_contactBuffer.data[S],C=A.indexA,b=A.indexB,V=A.weight,g=A.normal,w=at.SubVV(a[b],a[C],i),k=at.DotVV(w,g);if(k<0){var M=K(r*V,Y(-o*k,.5)),I=at.MulSV(M*k,g,s);a[C].SelfAdd(I),a[b].SelfSub(I)}}}},{key:"SolveRigidDamping",value:function(){for(var e=t.SolveRigidDamping_s_t0,i=t.SolveRigidDamping_s_t1,s=t.SolveRigidDamping_s_p,n=t.SolveRigidDamping_s_v,a=[0],r=[0],o=[0],l=[0],u=[0],m=[0],_=this.m_positionBuffer.data,h=this.m_def.dampingStrength,c=0;c<this.m_bodyContactBuffer.count;c++){var f=this.m_bodyContactBuffer.data[c],d=f.index,v=this.m_groupBuffer[d];if(this.IsRigidGroup(v)){var y=f.body,p=f.normal,x=f.weight,B=_[d],S=at.SubVV(y.GetLinearVelocityFromWorldPoint(B,e),v.GetLinearVelocityFromWorldPoint(B,i),n),A=at.DotVV(S,p);if(A<0){this.InitDampingParameterWithRigidGroupOrParticle(a,r,o,!0,v,d,B,p),this.InitDampingParameter(l,u,m,y.GetMass(),y.GetInertia()-y.GetMass()*y.GetLocalCenter().LengthSquared(),y.GetWorldCenter(),B,p);var C=h*Y(x,1)*this.ComputeDampingImpulse(a[0],r[0],o[0],l[0],u[0],m[0],A);this.ApplyDamping(a[0],r[0],o[0],!0,v,d,C,p),y.ApplyLinearImpulse(at.MulSV(-C,p,at.s_t0),B,!0)}}}for(var b=0;b<this.m_contactBuffer.count;b++){var V=this.m_contactBuffer.data[b],g=V.indexA,w=V.indexB,k=V.normal,M=V.weight,I=this.m_groupBuffer[g],P=this.m_groupBuffer[w],G=this.IsRigidGroup(I),D=this.IsRigidGroup(P);if(I!==P&&(G||D)){var j=at.MidVV(_[g],_[w],s),O=at.SubVV(this.GetLinearVelocity(P,w,j,e),this.GetLinearVelocity(I,g,j,i),n),F=at.DotVV(O,k);if(F<0){this.InitDampingParameterWithRigidGroupOrParticle(a,r,o,G,I,g,j,k),this.InitDampingParameterWithRigidGroupOrParticle(l,u,m,D,P,w,j,k);var L=h*M*this.ComputeDampingImpulse(a[0],r[0],o[0],l[0],u[0],m[0],F);this.ApplyDamping(a[0],r[0],o[0],G,I,g,L,k),this.ApplyDamping(l[0],u[0],m[0],D,P,w,-L,k)}}}}},{key:"SolveExtraDamping",value:function(){for(var e=t.SolveExtraDamping_s_v,i=t.SolveExtraDamping_s_f,s=this.m_velocityBuffer.data,n=this.m_positionBuffer.data,a=this.GetParticleInvMass(),r=0;r<this.m_bodyContactBuffer.count;r++){var o=this.m_bodyContactBuffer.data[r],l=o.index;if(this.m_flagsBuffer.data[l]&t.k_extraDampingFlags){var u=o.body,m=o.mass,_=o.normal,h=n[l],c=at.SubVV(u.GetLinearVelocityFromWorldPoint(h,at.s_t0),s[l],e),f=at.DotVV(c,_);if(f<0){var d=at.MulSV(.5*m*f,_,i);s[l].SelfMulAdd(a,d),u.ApplyLinearImpulse(d.SelfNeg(),h,!0)}}}}},{key:"SolveWall",value:function(){for(var t=this.m_velocityBuffer.data,e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&Vn.b2_wallParticle&&t[e].SetZero()}},{key:"SolveRigid",value:function(e){for(var i=t.SolveRigid_s_position,s=t.SolveRigid_s_rotation,n=t.SolveRigid_s_transform,a=t.SolveRigid_s_velocityTransform,r=this.m_positionBuffer.data,o=this.m_velocityBuffer.data,l=this.m_groupList;l;l=l.GetNext())if(l.m_groupFlags&kn.b2_rigidParticleGroup){l.UpdateStatistics();var u=s;u.SetAngle(e.dt*l.m_angularVelocity);var m=at.AddVV(l.m_center,at.SubVV(at.MulSV(e.dt,l.m_linearVelocity,at.s_t0),Xt.MulRV(u,l.m_center,at.s_t1),at.s_t0),i),_=n;_.SetPositionRotation(m,u),Yt.MulXX(_,l.m_transform,l.m_transform);var h=a;h.p.x=e.inv_dt*_.p.x,h.p.y=e.inv_dt*_.p.y,h.q.s=e.inv_dt*_.q.s,h.q.c=e.inv_dt*(_.q.c-1);for(var c=l.m_firstIndex;c<l.m_lastIndex;c++)Yt.MulXV(h,r[c],o[c])}}},{key:"SolveElastic",value:function(e){for(var i=t.SolveElastic_s_pa,s=t.SolveElastic_s_pb,n=t.SolveElastic_s_pc,a=t.SolveElastic_s_r,r=t.SolveElastic_s_t0,o=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,u=e.inv_dt*this.m_def.elasticStrength,m=0;m<this.m_triadBuffer.count;m++){var _=this.m_triadBuffer.data[m];if(_.flags&Vn.b2_elasticParticle){var h=_.indexA,c=_.indexB,f=_.indexC,d=_.pa,v=_.pb,y=_.pc,p=i.Copy(o[h]),x=s.Copy(o[c]),B=n.Copy(o[f]),S=l[h],A=l[c],C=l[f];p.SelfMulAdd(e.dt,S),x.SelfMulAdd(e.dt,A),B.SelfMulAdd(e.dt,C);var b=(p.x+x.x+B.x)/3,V=(p.y+x.y+B.y)/3;p.x-=b,p.y-=V,x.x-=b,x.y-=V,B.x-=b,B.y-=V;var g=a;g.s=at.CrossVV(d,p)+at.CrossVV(v,x)+at.CrossVV(y,B),g.c=at.DotVV(d,p)+at.DotVV(v,x)+at.DotVV(y,B);var w=g.s*g.s+g.c*g.c,k=tt(w);isFinite(k)||(k=198177537e11),g.s*=k,g.c*=k;var M=u*_.strength;Xt.MulRV(g,d,r),at.SubVV(r,p,r),at.MulSV(M,r,r),S.SelfAdd(r),Xt.MulRV(g,v,r),at.SubVV(r,x,r),at.MulSV(M,r,r),A.SelfAdd(r),Xt.MulRV(g,y,r),at.SubVV(r,B,r),at.MulSV(M,r,r),C.SelfAdd(r)}}}},{key:"SolveSpring",value:function(e){for(var i=t.SolveSpring_s_pa,s=t.SolveSpring_s_pb,n=t.SolveSpring_s_d,a=t.SolveSpring_s_f,r=this.m_positionBuffer.data,o=this.m_velocityBuffer.data,l=e.inv_dt*this.m_def.springStrength,u=0;u<this.m_pairBuffer.count;u++){var m=this.m_pairBuffer.data[u];if(m.flags&Vn.b2_springParticle){var _=m.indexA,h=m.indexB,c=i.Copy(r[_]),f=s.Copy(r[h]),d=o[_],v=o[h];c.SelfMulAdd(e.dt,d),f.SelfMulAdd(e.dt,v);var y=at.SubVV(f,c,n),p=m.distance,x=y.Length(),B=l*m.strength,S=at.MulSV(B*(p-x)/x,y,a);d.SelfSub(S),v.SelfAdd(S)}}}},{key:"SolveTensile",value:function(e){var i=t.SolveTensile_s_weightedNormal,s=t.SolveTensile_s_s,n=t.SolveTensile_s_f,a=this.m_velocityBuffer.data;Fn(null!==this.m_accumulation2Buffer);for(var r=0;r<this.m_count;r++)this.m_accumulation2Buffer[r]=new at,this.m_accumulation2Buffer[r].SetZero();for(var o=0;o<this.m_contactBuffer.count;o++){var l=this.m_contactBuffer.data[o];if(l.flags&Vn.b2_tensileParticle){var u=l.indexA,m=l.indexB,_=l.weight,h=l.normal,c=at.MulSV((1-_)*_,h,i);this.m_accumulation2Buffer[u].SelfSub(c),this.m_accumulation2Buffer[m].SelfAdd(c)}}for(var f=this.GetCriticalVelocity(e),d=this.m_def.surfaceTensionPressureStrength*f,v=this.m_def.surfaceTensionNormalStrength*f,y=F*f,p=0;p<this.m_contactBuffer.count;p++){var x=this.m_contactBuffer.data[p];if(x.flags&Vn.b2_tensileParticle){var B=x.indexA,S=x.indexB,A=x.weight,C=x.normal,b=this.m_weightBuffer[B]+this.m_weightBuffer[S],V=at.SubVV(this.m_accumulation2Buffer[S],this.m_accumulation2Buffer[B],s),g=Y(d*(b-2)+v*at.DotVV(V,C),y)*A,w=at.MulSV(g,C,n);a[B].SelfSub(w),a[S].SelfAdd(w)}}}},{key:"SolveViscous",value:function(){for(var e=t.SolveViscous_s_v,i=t.SolveViscous_s_f,s=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,a=this.m_def.viscousStrength,r=this.GetParticleInvMass(),o=0;o<this.m_bodyContactBuffer.count;o++){var l=this.m_bodyContactBuffer.data[o],u=l.index;if(this.m_flagsBuffer.data[u]&Vn.b2_viscousParticle){var m=l.body,_=l.weight,h=l.mass,c=s[u],f=at.SubVV(m.GetLinearVelocityFromWorldPoint(c,at.s_t0),n[u],e),d=at.MulSV(a*h*_,f,i);n[u].SelfMulAdd(r,d),m.ApplyLinearImpulse(d.SelfNeg(),c,!0)}}for(var v=0;v<this.m_contactBuffer.count;v++){var y=this.m_contactBuffer.data[v];if(y.flags&Vn.b2_viscousParticle){var p=y.indexA,x=y.indexB,B=y.weight,S=at.SubVV(n[x],n[p],e),A=at.MulSV(a*B,S,i);n[p].SelfAdd(A),n[x].SelfSub(A)}}}},{key:"SolveRepulsive",value:function(e){for(var i=t.SolveRepulsive_s_f,s=this.m_velocityBuffer.data,n=this.m_def.repulsiveStrength*this.GetCriticalVelocity(e),a=0;a<this.m_contactBuffer.count;a++){var r=this.m_contactBuffer.data[a];if(r.flags&Vn.b2_repulsiveParticle){var o=r.indexA,l=r.indexB;if(this.m_groupBuffer[o]!==this.m_groupBuffer[l]){var u=r.weight,m=r.normal,_=at.MulSV(n*u,m,i);s[o].SelfSub(_),s[l].SelfAdd(_)}}}}},{key:"SolvePowder",value:function(e){for(var i=t.SolvePowder_s_f,s=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,a=this.m_def.powderStrength*this.GetCriticalVelocity(e),r=1-D,o=this.GetParticleInvMass(),l=0;l<this.m_bodyContactBuffer.count;l++){var u=this.m_bodyContactBuffer.data[l],m=u.index;if(this.m_flagsBuffer.data[m]&Vn.b2_powderParticle){var _=u.weight;if(_>r){var h=u.body,c=u.mass,f=s[m],d=u.normal,v=at.MulSV(a*c*(_-r),d,i);n[m].SelfMulSub(o,v),h.ApplyLinearImpulse(v,f,!0)}}}for(var y=0;y<this.m_contactBuffer.count;y++){var p=this.m_contactBuffer.data[y];if(p.flags&Vn.b2_powderParticle){var x=p.weight;if(x>r){var B=p.indexA,S=p.indexB,A=p.normal,C=at.MulSV(a*(x-r),A,i);n[B].SelfSub(C),n[S].SelfAdd(C)}}}}},{key:"SolveSolid",value:function(e){var i=t.SolveSolid_s_f,s=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);for(var n=e.inv_dt*this.m_def.ejectionStrength,a=0;a<this.m_contactBuffer.count;a++){var r=this.m_contactBuffer.data[a],o=r.indexA,l=r.indexB;if(this.m_groupBuffer[o]!==this.m_groupBuffer[l]){var u=r.weight,m=r.normal,_=this.m_depthBuffer[o]+this.m_depthBuffer[l],h=at.MulSV(n*_*u,m,i);s[o].SelfSub(h),s[l].SelfAdd(h)}}}},{key:"SolveForce",value:function(t){for(var e=this.m_velocityBuffer.data,i=t.dt*this.GetParticleInvMass(),s=0;s<this.m_count;s++)e[s].SelfMulAdd(i,this.m_forceBuffer[s]);this.m_hasForce=!1}},{key:"SolveColorMixing",value:function(){Fn(null!==this.m_colorBuffer.data);var t=.5*this.m_def.colorMixingStrength;if(t)for(var e=0;e<this.m_contactBuffer.count;e++){var i=this.m_contactBuffer.data[e],s=i.indexA,n=i.indexB;if(this.m_flagsBuffer.data[s]&this.m_flagsBuffer.data[n]&Vn.b2_colorMixingParticle){var a=this.m_colorBuffer.data[s],r=this.m_colorBuffer.data[n];se.MixColors(a,r,t)}}}},{key:"SolveZombie",value:function(){for(var t=0,e=[],i=0;i<this.m_count;i++)e[i]=P;Fn(e.length===this.m_count);for(var s=0,n=0;n<this.m_count;n++){var a=this.m_flagsBuffer.data[n];if(a&Vn.b2_zombieParticle){var r=this.m_world.m_destructionListener;if(a&Vn.b2_destructionListenerParticle&&r&&r.SayGoodbyeParticle(this,n),this.m_handleIndexBuffer.data){var o=this.m_handleIndexBuffer.data[n];o&&(o.SetIndex(P),this.m_handleIndexBuffer.data[n]=null)}e[n]=P}else{if(e[n]=t,n!==t){if(this.m_handleIndexBuffer.data){var l=this.m_handleIndexBuffer.data[n];l&&l.SetIndex(t),this.m_handleIndexBuffer.data[t]=l}this.m_flagsBuffer.data[t]=this.m_flagsBuffer.data[n],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[t]=this.m_lastBodyContactStepBuffer.data[n]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[t]=this.m_bodyContactCountBuffer.data[n]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[t]=this.m_consecutiveContactStepsBuffer.data[n]),this.m_positionBuffer.data[t].Copy(this.m_positionBuffer.data[n]),this.m_velocityBuffer.data[t].Copy(this.m_velocityBuffer.data[n]),this.m_groupBuffer[t]=this.m_groupBuffer[n],this.m_hasForce&&this.m_forceBuffer[t].Copy(this.m_forceBuffer[n]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[t]=this.m_staticPressureBuffer[n]),this.m_depthBuffer&&(this.m_depthBuffer[t]=this.m_depthBuffer[n]),this.m_colorBuffer.data&&this.m_colorBuffer.data[t].Copy(this.m_colorBuffer.data[n]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[t]=this.m_userDataBuffer.data[n]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[t]=this.m_expirationTimeBuffer.data[n])}t++,s|=a}}for(var u={IsProxyInvalid:function(t){return t.index<0},IsContactInvalid:function(t){return t.indexA<0||t.indexB<0},IsBodyContactInvalid:function(t){return t.index<0},IsPairInvalid:function(t){return t.indexA<0||t.indexB<0},IsTriadInvalid:function(t){return t.indexA<0||t.indexB<0||t.indexC<0}},m=0;m<this.m_proxyBuffer.count;m++){var _=this.m_proxyBuffer.data[m];_.index=e[_.index]}this.m_proxyBuffer.RemoveIf(u.IsProxyInvalid);for(var h=0;h<this.m_contactBuffer.count;h++){var c=this.m_contactBuffer.data[h];c.indexA=e[c.indexA],c.indexB=e[c.indexB]}this.m_contactBuffer.RemoveIf(u.IsContactInvalid);for(var f=0;f<this.m_bodyContactBuffer.count;f++){var d=this.m_bodyContactBuffer.data[f];d.index=e[d.index]}this.m_bodyContactBuffer.RemoveIf(u.IsBodyContactInvalid);for(var v=0;v<this.m_pairBuffer.count;v++){var y=this.m_pairBuffer.data[v];y.indexA=e[y.indexA],y.indexB=e[y.indexB]}this.m_pairBuffer.RemoveIf(u.IsPairInvalid);for(var p=0;p<this.m_triadBuffer.count;p++){var x=this.m_triadBuffer.data[p];x.indexA=e[x.indexA],x.indexB=e[x.indexB],x.indexC=e[x.indexC]}if(this.m_triadBuffer.RemoveIf(u.IsTriadInvalid),this.m_indexByExpirationTimeBuffer.data)for(var B=0,S=0;S<this.m_count;S++){var A=e[this.m_indexByExpirationTimeBuffer.data[S]];A!==P&&(this.m_indexByExpirationTimeBuffer.data[B++]=A)}for(var C=this.m_groupList;C;C=C.GetNext()){for(var b=t,V=0,g=!1,w=C.m_firstIndex;w<C.m_lastIndex;w++){var k=e[w];k>=0?(b=Y(b,k),V=K(V,k+1)):g=!0}b<V?(C.m_firstIndex=b,C.m_lastIndex=V,g&&C.m_groupFlags&kn.b2_solidParticleGroup&&this.SetGroupFlags(C,C.m_groupFlags|kn.b2_particleGroupNeedsUpdateDepth)):(C.m_firstIndex=0,C.m_lastIndex=0,C.m_groupFlags&kn.b2_particleGroupCanBeEmpty||this.SetGroupFlags(C,C.m_groupFlags|kn.b2_particleGroupWillBeDestroyed))}this.m_count=t,this.m_allParticleFlags=s,this.m_needsUpdateAllParticleFlags=!1;for(var M=this.m_groupList;M;){var I=M.GetNext();M.m_groupFlags&kn.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(M),M=I}}},{key:"SolveLifetimes",value:function(t){Fn(null!==this.m_expirationTimeBuffer.data),Fn(null!==this.m_indexByExpirationTimeBuffer.data),this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);var e=this.GetQuantizedTimeElapsed(),i=this.m_expirationTimeBuffer.data,s=this.m_indexByExpirationTimeBuffer.data,n=this.GetParticleCount();if(this.m_expirationTimeBufferRequiresSorting){var a=function(t,e){var s=i[t],n=i[e],a=s<=0,r=n<=0;return a===r?s>n:a};Tn(s,0,n,a),this.m_expirationTimeBufferRequiresSorting=!1}for(var r=n-1;r>=0;--r){var o=s[r],l=i[o];if(e<l||l<=0)break;this.DestroyParticle(o)}}},{key:"RotateBuffer",value:function(t,e,i){if(t!==e&&e!==i){if(Fn(e>=t&&e<=i),Jn(this.m_flagsBuffer.data,t,e,i),this.m_lastBodyContactStepBuffer.data&&Jn(this.m_lastBodyContactStepBuffer.data,t,e,i),this.m_bodyContactCountBuffer.data&&Jn(this.m_bodyContactCountBuffer.data,t,e,i),this.m_consecutiveContactStepsBuffer.data&&Jn(this.m_consecutiveContactStepsBuffer.data,t,e,i),Jn(this.m_positionBuffer.data,t,e,i),Jn(this.m_velocityBuffer.data,t,e,i),Jn(this.m_groupBuffer,t,e,i),this.m_hasForce&&Jn(this.m_forceBuffer,t,e,i),this.m_staticPressureBuffer&&Jn(this.m_staticPressureBuffer,t,e,i),this.m_depthBuffer&&Jn(this.m_depthBuffer,t,e,i),this.m_colorBuffer.data&&Jn(this.m_colorBuffer.data,t,e,i),this.m_userDataBuffer.data&&Jn(this.m_userDataBuffer.data,t,e,i),this.m_handleIndexBuffer.data){Jn(this.m_handleIndexBuffer.data,t,e,i);for(var s=t;s<i;++s){var n=this.m_handleIndexBuffer.data[s];n&&n.SetIndex(x(n.GetIndex()))}}if(this.m_expirationTimeBuffer.data){Jn(this.m_expirationTimeBuffer.data,t,e,i);for(var a=this.GetParticleCount(),r=this.m_indexByExpirationTimeBuffer.data,o=0;o<a;++o)r[o]=x(r[o])}for(var l=0;l<this.m_proxyBuffer.count;l++){var u=this.m_proxyBuffer.data[l];u.index=x(u.index)}for(var m=0;m<this.m_contactBuffer.count;m++){var _=this.m_contactBuffer.data[m];_.indexA=x(_.indexA),_.indexB=x(_.indexB)}for(var h=0;h<this.m_bodyContactBuffer.count;h++){var c=this.m_bodyContactBuffer.data[h];c.index=x(c.index)}for(var f=0;f<this.m_pairBuffer.count;f++){var d=this.m_pairBuffer.data[f];d.indexA=x(d.indexA),d.indexB=x(d.indexB)}for(var v=0;v<this.m_triadBuffer.count;v++){var y=this.m_triadBuffer.data[v];y.indexA=x(y.indexA),y.indexB=x(y.indexB),y.indexC=x(y.indexC)}for(var p=this.m_groupList;p;p=p.GetNext())p.m_firstIndex=x(p.m_firstIndex),p.m_lastIndex=x(p.m_lastIndex-1)+1}function x(s){return s<t?s:s<e?s+i-e:s<i?s+t-e:s}}},{key:"GetCriticalVelocity",value:function(t){return this.m_particleDiameter*t.inv_dt}},{key:"GetCriticalVelocitySquared",value:function(t){var e=this.GetCriticalVelocity(t);return e*e}},{key:"GetCriticalPressure",value:function(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)}},{key:"GetParticleStride",value:function(){return D*this.m_particleDiameter}},{key:"GetParticleMass",value:function(){var t=this.GetParticleStride();return this.m_def.density*t*t}},{key:"GetParticleInvMass",value:function(){var t=this.m_inverseDiameter*(1/D);return this.m_inverseDensity*t*t}},{key:"GetFixtureContactFilter",value:function(){return this.m_allParticleFlags&Vn.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}},{key:"GetParticleContactFilter",value:function(){return this.m_allParticleFlags&Vn.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}},{key:"GetFixtureContactListener",value:function(){return this.m_allParticleFlags&Vn.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}},{key:"GetParticleContactListener",value:function(){return this.m_allParticleFlags&Vn.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}},{key:"SetUserOverridableBuffer",value:function(t,e,i){Fn(null!==e&&i>0||null===e&&0===i),t.data=e,t.userSuppliedCapacity=i}},{key:"SetGroupFlags",value:function(t,e){var i=t.m_groupFlags;(i^e)&kn.b2_solidParticleGroup&&(e|=kn.b2_particleGroupNeedsUpdateDepth),i&~e&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&e&&(e&kn.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=e),t.m_groupFlags=e}},{key:"RemoveSpuriousBodyContacts",value:function(){Tn(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,t.BodyContactCompare);var e=t.RemoveSpuriousBodyContacts_s_n,i=t.RemoveSpuriousBodyContacts_s_pos,s=t.RemoveSpuriousBodyContacts_s_normal,n=3,a=this,r=-1,o=0,l=function(t){if(t.index!==r&&(o=0,r=t.index),o++>n)return!0;var l=e.Copy(t.normal);l.SelfMul(a.m_particleDiameter*(1-t.weight));var u=at.AddVV(a.m_positionBuffer.data[t.index],l,i);if(!t.fixture.TestPoint(u)){for(var m=t.fixture.GetShape().GetChildCount(),_=0;_<m;_++){var h=s,c=t.fixture.ComputeDistance(u,h,_);if(c<y)return!1}return!0}return!1};this.m_bodyContactBuffer.count=zn(this.m_bodyContactBuffer.data,l,this.m_bodyContactBuffer.count)}},{key:"DetectStuckParticle",value:function(t){this.m_stuckThreshold<=0||(++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp)}},{key:"ValidateParticleIndex",value:function(t){return t>=0&&t<this.GetParticleCount()&&t!==P}},{key:"GetQuantizedTimeElapsed",value:function(){return Math.floor(this.m_timeElapsed/4294967296)}},{key:"LifetimeToExpirationTime",value:function(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)}},{key:"ForceCanBeApplied",value:function(t){return!(t&Vn.b2_wallParticle)}},{key:"PrepareForceBuffer",value:function(){if(!this.m_hasForce){for(var t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}}},{key:"IsRigidGroup",value:function(t){return null!==t&&0!==(t.m_groupFlags&kn.b2_rigidParticleGroup)}},{key:"GetLinearVelocity",value:function(t,e,i,s){return this.IsRigidGroup(t)?t.GetLinearVelocityFromWorldPoint(i,s):s.Copy(this.m_velocityBuffer.data[e])}},{key:"InitDampingParameter",value:function(t,e,i,s,n,a,r,o){t[0]=s>0?1/s:0,e[0]=n>0?1/n:0,i[0]=at.CrossVV(at.SubVV(r,a,at.s_t0),o)}},{key:"InitDampingParameterWithRigidGroupOrParticle",value:function(t,e,i,s,n,a,r,o){if(s)this.InitDampingParameter(t,e,i,n.GetMass(),n.GetInertia(),n.GetCenter(),r,o);else{var l=this.m_flagsBuffer.data[a];this.InitDampingParameter(t,e,i,l&Vn.b2_wallParticle?0:this.GetParticleMass(),0,r,r,o)}}},{key:"ComputeDampingImpulse",value:function(t,e,i,s,n,a,r){var o=t+e*i*i+s+n*a*a;return o>0?r/o:0}},{key:"ApplyDamping",value:function(t,e,i,s,n,a,r,o){s?(n.m_linearVelocity.SelfMulAdd(r*t,o),n.m_angularVelocity+=r*i*e):this.m_velocityBuffer.data[a].SelfMulAdd(r*t,o)}}],[{key:"computeTag",value:function(e,i){return(i+t.yOffset>>>0<<t.yShift)+(t.xScale*e+t.xOffset>>>0)>>>0}},{key:"computeRelativeTag",value:function(e,i,s){return e+(s<<t.yShift)+(i<<t.xShift)>>>0}},{key:"IsSignificantForce",value:function(t){return 0!==t.x||0!==t.y}},{key:"ParticleCanBeConnected",value:function(t,e){return 0!==(t&(Vn.b2_wallParticle|Vn.b2_springParticle|Vn.b2_elasticParticle))||null!==e&&0!==(e.GetGroupFlags()&kn.b2_rigidParticleGroup)}},{key:"ComparePairIndices",value:function(t,e){var i=t.indexA-e.indexA;return 0!==i?i<0:t.indexB<e.indexB}},{key:"MatchPairIndices",value:function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB}},{key:"CompareTriadIndices",value:function(t,e){var i=t.indexA-e.indexA;if(0!==i)return i<0;var s=t.indexB-e.indexB;return 0!==s?s<0:t.indexC<e.indexC}},{key:"MatchTriadIndices",value:function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC}},{key:"InitializeParticleLists",value:function(t,e){for(var i=t.GetBufferIndex(),s=t.GetParticleCount(),n=0;n<s;n++){var a=e[n];a.list=a,a.next=null,a.count=1,a.index=n+i}}},{key:"MergeParticleLists",value:function(t,e){Fn(t!==e);for(var i=e;;){i.list=t;var s=i.next;if(!s){i.next=t.next;break}i=s}t.next=e,t.count+=e.count,e.count=0}},{key:"FindLongestParticleList",value:function(t,e){for(var i=t.GetParticleCount(),s=e[0],n=0;n<i;n++){var a=e[n];s.count<a.count&&(s=a)}return s}},{key:"MergeParticleListAndNode",value:function(t,e){Fn(e!==t),Fn(e.list===e),Fn(1===e.count),e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0}},{key:"b2ParticleContactIsZombie",value:function(t){return(t.flags&Vn.b2_zombieParticle)===Vn.b2_zombieParticle}},{key:"BodyContactCompare",value:function(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index}}]),t}();$n.xTruncBits=12,$n.yTruncBits=12,$n.tagBits=32,$n.yOffset=1<<$n.yTruncBits-1,$n.yShift=$n.tagBits-$n.yTruncBits,$n.xShift=$n.tagBits-$n.yTruncBits-$n.xTruncBits,$n.xScale=1<<$n.xShift,$n.xOffset=$n.xScale*(1<<$n.xTruncBits-1),$n.yMask=(1<<$n.yTruncBits)-1<<$n.yShift,$n.xMask=~$n.yMask,$n.DestroyParticlesInShape_s_aabb=new De,$n.CreateParticleGroup_s_transform=new Yt,$n.ComputeCollisionEnergy_s_v=new at,$n.QueryShapeAABB_s_aabb=new De,$n.QueryPointAABB_s_aabb=new De,$n.RayCast_s_aabb=new De,$n.RayCast_s_p=new at,$n.RayCast_s_v=new at,$n.RayCast_s_n=new at,$n.RayCast_s_point=new at,$n.k_pairFlags=Vn.b2_springParticle,$n.k_triadFlags=Vn.b2_elasticParticle,$n.k_noPressureFlags=Vn.b2_powderParticle|Vn.b2_tensileParticle,$n.k_extraDampingFlags=Vn.b2_staticPressureParticle,$n.k_barrierWallFlags=Vn.b2_barrierParticle|Vn.b2_wallParticle,$n.CreateParticlesStrokeShapeForGroup_s_edge=new xs,$n.CreateParticlesStrokeShapeForGroup_s_d=new at,$n.CreateParticlesStrokeShapeForGroup_s_p=new at,$n.CreateParticlesFillShapeForGroup_s_aabb=new De,$n.CreateParticlesFillShapeForGroup_s_p=new at,$n.UpdatePairsAndTriads_s_dab=new at,$n.UpdatePairsAndTriads_s_dbc=new at,$n.UpdatePairsAndTriads_s_dca=new at,$n.AddContact_s_d=new at,$n.UpdateBodyContacts_s_aabb=new De,$n.Solve_s_subStep=new fn,$n.SolveCollision_s_aabb=new De,$n.SolveGravity_s_gravity=new at,$n.SolveBarrier_s_aabb=new De,$n.SolveBarrier_s_va=new at,$n.SolveBarrier_s_vb=new at,$n.SolveBarrier_s_pba=new at,$n.SolveBarrier_s_vba=new at,$n.SolveBarrier_s_vc=new at,$n.SolveBarrier_s_pca=new at,$n.SolveBarrier_s_vca=new at,$n.SolveBarrier_s_qba=new at,$n.SolveBarrier_s_qca=new at,$n.SolveBarrier_s_dv=new at,$n.SolveBarrier_s_f=new at,$n.SolvePressure_s_f=new at,$n.SolveDamping_s_v=new at,$n.SolveDamping_s_f=new at,$n.SolveRigidDamping_s_t0=new at,$n.SolveRigidDamping_s_t1=new at,$n.SolveRigidDamping_s_p=new at,$n.SolveRigidDamping_s_v=new at,$n.SolveExtraDamping_s_v=new at,$n.SolveExtraDamping_s_f=new at,$n.SolveRigid_s_position=new at,$n.SolveRigid_s_rotation=new Xt,$n.SolveRigid_s_transform=new Yt,$n.SolveRigid_s_velocityTransform=new Yt,$n.SolveElastic_s_pa=new at,$n.SolveElastic_s_pb=new at,$n.SolveElastic_s_pc=new at,$n.SolveElastic_s_r=new Xt,$n.SolveElastic_s_t0=new at,$n.SolveSpring_s_pa=new at,$n.SolveSpring_s_pb=new at,$n.SolveSpring_s_d=new at,$n.SolveSpring_s_f=new at,$n.SolveTensile_s_weightedNormal=new at,$n.SolveTensile_s_s=new at,$n.SolveTensile_s_f=new at,$n.SolveViscous_s_v=new at,$n.SolveViscous_s_f=new at,$n.SolveRepulsive_s_f=new at,$n.SolvePowder_s_f=new at,$n.SolveSolid_s_f=new at,$n.RemoveSpuriousBodyContacts_s_n=new at,$n.RemoveSpuriousBodyContacts_s_pos=new at,$n.RemoveSpuriousBodyContacts_s_normal=new at,function(t){var e=function t(){Object(r["a"])(this,t),this.data=null,this.userSuppliedCapacity=0};t.UserOverridableBuffer=e;var i=function(){function t(){Object(r["a"])(this,t),this.index=P,this.tag=0}return Object(o["a"])(t,null,[{key:"CompareProxyProxy",value:function(t,e){return t.tag<e.tag}},{key:"CompareTagProxy",value:function(t,e){return t<e.tag}},{key:"CompareProxyTag",value:function(t,e){return t.tag<e}}]),t}();t.Proxy=i;var s=function(){function e(i,s,n,a,o){Object(r["a"])(this,e),this.m_system=i,this.m_xLower=(s&t.xMask)>>>0,this.m_xUpper=(n&t.xMask)>>>0,this.m_yLower=(s&t.yMask)>>>0,this.m_yUpper=(n&t.yMask)>>>0,this.m_first=a,this.m_last=o,Fn(this.m_first<=this.m_last)}return Object(o["a"])(e,[{key:"GetNext",value:function(){while(this.m_first<this.m_last){var e=(this.m_system.m_proxyBuffer.data[this.m_first].tag&t.xMask)>>>0;if(e>=this.m_xLower&&e<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return P}}]),e}();t.InsideBoundsEnumerator=s;var n=function t(){Object(r["a"])(this,t),this.list=null,this.next=null,this.count=0,this.index=0};t.ParticleListNode=n;var a=function(){function t(){Object(r["a"])(this,t)}return Object(o["a"])(t,[{key:"Allocate",value:function(t,e){return e}},{key:"Clear",value:function(){}},{key:"GetCount",value:function(){return 0}},{key:"Invalidate",value:function(t){}},{key:"GetValidBuffer",value:function(){return[]}},{key:"GetBuffer",value:function(){return[]}},{key:"SetCount",value:function(t){}}]),t}();t.FixedSetAllocator=a;var l=function t(e,i){Object(r["a"])(this,t),this.first=null,this.second=P,this.first=e,this.second=i};t.FixtureParticle=l;var m=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(){return Object(r["a"])(this,i),e.apply(this,arguments)}return Object(o["a"])(i,[{key:"Initialize",value:function(t,e){}},{key:"Find",value:function(t){return P}}]),i}(t.FixedSetAllocator);t.FixtureParticleSet=m;var _=function t(e,i){Object(r["a"])(this,t),this.first=P,this.second=P,this.first=e,this.second=i};t.ParticlePair=_;var h=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(){return Object(r["a"])(this,i),e.apply(this,arguments)}return Object(o["a"])(i,[{key:"Initialize",value:function(t,e){}},{key:"Find",value:function(t){return P}}]),i}(t.FixedSetAllocator);t.b2ParticlePairSet=h;var c=function(){function t(){Object(r["a"])(this,t)}return Object(o["a"])(t,[{key:"IsNecessary",value:function(t){return!0}},{key:"ShouldCreatePair",value:function(t,e){return!0}},{key:"ShouldCreateTriad",value:function(t,e,i){return!0}}]),t}();t.ConnectionFilter=c;var f=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t,s,n,a){var o;return Object(r["a"])(this,i),o=e.call(this),o.m_system=null,o.m_shape=null,o.m_xf=null,o.m_callDestructionListener=!1,o.m_destroyed=0,o.m_system=t,o.m_shape=s,o.m_xf=n,o.m_callDestructionListener=a,o.m_destroyed=0,o}return Object(o["a"])(i,[{key:"ReportFixture",value:function(t){return!1}},{key:"ReportParticle",value:function(t,e){return t===this.m_system&&(Fn(e>=0&&e<this.m_system.m_count),this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0)}},{key:"Destroyed",value:function(){return this.m_destroyed}}]),i}(mn);t.DestroyParticlesInShapeCallback=f;var d=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this),s.m_threshold=0,s.m_threshold=t,s}return Object(o["a"])(i,[{key:"ShouldCreatePair",value:function(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t}},{key:"ShouldCreateTriad",value:function(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i)}}]),i}(t.ConnectionFilter);t.JoinParticleGroupsFilter=d;var v=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t,s){var n;return Object(r["a"])(this,i),n=e.call(this,ms.e_unknown,0),n.m_shapes=null,n.m_shapeCount=0,n.m_shapes=t,n.m_shapeCount=s,n}return Object(o["a"])(i,[{key:"Clone",value:function(){return Fn(!1),null}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){for(var i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1}},{key:"ComputeDistance",value:function(t,e,i,s){return Fn(!1),0}},{key:"RayCast",value:function(t,e,i,s){return Fn(!1),!1}},{key:"ComputeAABB",value:function(t,e,i){var s=new De;t.lowerBound.x=+u,t.lowerBound.y=+u,t.upperBound.x=-u,t.upperBound.y=-u,Fn(0===i);for(var n=0;n<this.m_shapeCount;n++)for(var a=this.m_shapes[n].GetChildCount(),r=0;r<a;r++){var o=s;this.m_shapes[n].ComputeAABB(o,e,r),t.Combine1(o)}}},{key:"ComputeMass",value:function(t,e){Fn(!1)}},{key:"SetupDistanceProxy",value:function(t,e){Fn(!1)}},{key:"ComputeSubmergedArea",value:function(t,e,i,s){return Fn(!1),0}},{key:"Dump",value:function(t){Fn(!1)}}]),i}(hs);t.CompositeShape=v;var p=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this),s.m_flagsBuffer=null,s.m_flagsBuffer=t,s}return Object(o["a"])(i,[{key:"IsNecessary",value:function(t){return 0!==(this.m_flagsBuffer.data[t]&Vn.b2_reactiveParticle)}}]),i}(t.ConnectionFilter);t.ReactiveFilter=p;var x=function(e){Object(ds["a"])(s,e);var i=Object(vs["a"])(s);function s(t,e){var n;return Object(r["a"])(this,s),n=i.call(this,t),n.m_contactFilter=e,n}return Object(o["a"])(s,[{key:"ShouldCollideFixtureParticle",value:function(t,e,i){if(this.m_contactFilter){var s=this.m_system.GetFlagsBuffer();if(s[i]&Vn.b2_fixtureContactFilterParticle)return this.m_contactFilter.ShouldCollideFixtureParticle(t,this.m_system,i)}return!0}},{key:"ReportFixtureAndParticle",value:function(e,i,s){var n=t.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n,a=t.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp,r=this.m_system.m_positionBuffer.data[s],o=n,l=e.ComputeDistance(r,o,i);if(l<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(e,this.m_system,s)){var u=e.GetBody(),m=u.GetWorldCenter(),_=u.GetMass(),h=u.GetInertia()-_*u.GetLocalCenter().LengthSquared(),c=_>0?1/_:0,f=h>0?1/h:0,d=this.m_system.m_flagsBuffer.data[s]&Vn.b2_wallParticle?0:this.m_system.GetParticleInvMass(),v=at.SubVV(r,m,a),y=at.CrossVV(v,o),p=d+c+f*y*y,x=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];x.index=s,x.body=u,x.fixture=e,x.weight=1-l*this.m_system.m_inverseDiameter,x.normal.Copy(o.SelfNeg()),x.mass=p>0?1/p:0,this.m_system.DetectStuckParticle(s)}}}]),s}(Wn);x.ReportFixtureAndParticle_s_n=new at,x.ReportFixtureAndParticle_s_rp=new at,t.UpdateBodyContactsCallback=x;var B=function(e){Object(ds["a"])(s,e);var i=Object(vs["a"])(s);function s(t,e){var n;return Object(r["a"])(this,s),n=i.call(this,t),n.m_step=e,n}return Object(o["a"])(s,[{key:"ReportFixtureAndParticle",value:function(e,i,s){var n=t.SolveCollisionCallback.ReportFixtureAndParticle_s_p1,a=t.SolveCollisionCallback.ReportFixtureAndParticle_s_output,r=t.SolveCollisionCallback.ReportFixtureAndParticle_s_input,o=t.SolveCollisionCallback.ReportFixtureAndParticle_s_p,l=t.SolveCollisionCallback.ReportFixtureAndParticle_s_v,u=t.SolveCollisionCallback.ReportFixtureAndParticle_s_f,m=e.GetBody(),_=this.m_system.m_positionBuffer.data[s],h=this.m_system.m_velocityBuffer.data[s],c=a,f=r;if(0===this.m_system.m_iterationIndex){var d=Yt.MulTXV(m.m_xf0,_,n);e.GetShape().GetType()===ms.e_circleShape&&(d.SelfSub(m.GetLocalCenter()),Xt.MulRV(m.m_xf0.q,d,d),Xt.MulTRV(m.m_xf.q,d,d),d.SelfAdd(m.GetLocalCenter())),Yt.MulXV(m.m_xf,d,f.p1)}else f.p1.Copy(_);if(at.AddVMulSV(_,this.m_step.dt,h,f.p2),f.maxFraction=1,e.RayCast(c,f,i)){var v=c.normal,p=o;p.x=(1-c.fraction)*f.p1.x+c.fraction*f.p2.x+y*v.x,p.y=(1-c.fraction)*f.p1.y+c.fraction*f.p2.y+y*v.y;var x=l;x.x=this.m_step.inv_dt*(p.x-_.x),x.y=this.m_step.inv_dt*(p.y-_.y),this.m_system.m_velocityBuffer.data[s].Copy(x);var B=u;B.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(h.x-x.x),B.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(h.y-x.y),this.m_system.ParticleApplyForce(s,B)}}},{key:"ReportParticle",value:function(t,e){return!1}}]),s}(Wn);B.ReportFixtureAndParticle_s_p1=new at,B.ReportFixtureAndParticle_s_output=new Ge,B.ReportFixtureAndParticle_s_input=new Pe,B.ReportFixtureAndParticle_s_p=new at,B.ReportFixtureAndParticle_s_v=new at,B.ReportFixtureAndParticle_s_f=new at,t.SolveCollisionCallback=B}($n||($n={}));var ta=function(){function t(e){Object(r["a"])(this,t),this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new hn,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new at,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new cn,this.m_island=new bn,this.s_stack=[],this.m_gravity.Copy(e)}return Object(o["a"])(t,[{key:"SetDestructionListener",value:function(t){this.m_destructionListener=t}},{key:"SetContactFilter",value:function(t){this.m_contactManager.m_contactFilter=t}},{key:"SetContactListener",value:function(t){this.m_contactManager.m_contactListener=t}},{key:"SetDebugDraw",value:function(t){this.m_debugDraw=t}},{key:"CreateBody",value:function(t){if(this.IsLocked())return null;var e=new Ms(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}},{key:"DestroyBody",value:function(t){if(!this.IsLocked()){var e=t.m_jointList;while(e){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;var s=t.m_contactList;while(s){var n=s;s=s.next,this.m_contactManager.Destroy(n.contact)}t.m_contactList=null;var a=t.m_fixtureList;while(a){var r=a;a=a.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(r),r.DestroyProxies(this.m_contactManager.m_broadPhase),r.Destroy(),t.m_fixtureList=a,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}}},{key:"CreateJoint",value:function(t){if(this.IsLocked())return null;var e=Us.Create(t,null);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.joint=e,e.m_edgeA.other=e.m_bodyB,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.joint=e,e.m_edgeB.other=e.m_bodyA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;var i=t.bodyA,s=t.bodyB;if(!t.collideConnected){var n=s.GetContactList();while(n)n.other===i&&n.contact.FlagForFiltering(),n=n.next}return e}},{key:"DestroyJoint",value:function(t){if(!this.IsLocked()){var e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_bodyA,s=t.m_bodyB;if(i.SetAwake(!0),s.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===s.m_jointList&&(s.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,Us.Destroy(t,null),--this.m_jointCount,!e){var n=s.GetContactList();while(n)n.other===i&&n.contact.FlagForFiltering(),n=n.next}}}},{key:"CreateParticleSystem",value:function(t){if(this.IsLocked())return null;var e=new $n(t,this);return e.m_prev=null,e.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=e),this.m_particleSystemList=e,e}},{key:"DestroyParticleSystem",value:function(t){this.IsLocked()||(t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next))}},{key:"CalculateReasonableParticleIterations",value:function(t){if(null===this.m_particleSystemList)return 1;function e(t){for(var e=u,i=t.GetParticleSystemList();null!==i;i=i.m_next)e=Y(e,i.GetRadius());return e}return wn(this.m_gravity.Length(),e(this),t)}},{key:"Step",value:function(e,i,s){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.CalculateReasonableParticleIterations(e),a=t.Step_s_stepTimer.Reset();this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0;var r=t.Step_s_step;r.dt=e,r.velocityIterations=i,r.positionIterations=s,r.particleIterations=n,r.inv_dt=e>0?1/e:0,r.dtRatio=this.m_inv_dt0*e,r.warmStarting=this.m_warmStarting;var o=t.Step_s_timer.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=o.GetMilliseconds(),this.m_stepComplete&&r.dt>0){for(var l=t.Step_s_timer.Reset(),u=this.m_particleSystemList;u;u=u.m_next)u.Solve(r);this.Solve(r),this.m_profile.solve=l.GetMilliseconds()}if(this.m_continuousPhysics&&r.dt>0){var m=t.Step_s_timer.Reset();this.SolveTOI(r),this.m_profile.solveTOI=m.GetMilliseconds()}r.dt>0&&(this.m_inv_dt0=r.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=a.GetMilliseconds()}},{key:"ClearForces",value:function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0}},{key:"DrawParticleSystem",value:function(t){var e=t.GetParticleCount();if(e){var i=t.GetRadius(),s=t.GetPositionBuffer();if(t.m_colorBuffer.data){var n=t.GetColorBuffer();this.m_debugDraw.DrawParticles(s,i,n,e)}else this.m_debugDraw.DrawParticles(s,i,null,e)}}},{key:"DrawDebugData",value:function(){if(null!==this.m_debugDraw){var e=this.m_debugDraw.GetFlags(),i=t.DrawDebugData_s_color.SetRGB(0,0,0);if(e&ee.e_shapeBit)for(var s=this.m_bodyList;s;s=s.m_next){var n=s.m_xf;this.m_debugDraw.PushTransform(n);for(var a=s.GetFixtureList();a;a=a.m_next)s.IsActive()?s.GetType()===Ss.b2_staticBody?(i.SetRGB(.5,.9,.5),this.DrawShape(a,i)):s.GetType()===Ss.b2_kinematicBody?(i.SetRGB(.5,.5,.9),this.DrawShape(a,i)):s.IsAwake()?(i.SetRGB(.9,.7,.7),this.DrawShape(a,i)):(i.SetRGB(.6,.6,.6),this.DrawShape(a,i)):(i.SetRGB(.5,.5,.3),this.DrawShape(a,i));this.m_debugDraw.PopTransform(n)}if(e&ee.e_particleBit)for(var r=this.m_particleSystemList;r;r=r.m_next)this.DrawParticleSystem(r);if(e&ee.e_jointBit)for(var o=this.m_jointList;o;o=o.m_next)this.DrawJoint(o);if(e&ee.e_aabbBit){i.SetRGB(.9,.3,.9);for(var l=this.m_contactManager.m_broadPhase,u=t.DrawDebugData_s_vs,m=this.m_bodyList;m;m=m.m_next)if(m.IsActive())for(var _=m.GetFixtureList();_;_=_.m_next)for(var h=0;h<_.m_proxyCount;++h){var c=_.m_proxies[h],f=l.GetFatAABB(c.proxy);u[0].Set(f.lowerBound.x,f.lowerBound.y),u[1].Set(f.upperBound.x,f.lowerBound.y),u[2].Set(f.upperBound.x,f.upperBound.y),u[3].Set(f.lowerBound.x,f.upperBound.y),this.m_debugDraw.DrawPolygon(u,4,i)}}if(e&ee.e_centerOfMassBit)for(var d=this.m_bodyList;d;d=d.m_next){var v=t.DrawDebugData_s_xf;v.q.Copy(d.m_xf.q),v.p.Copy(d.GetWorldCenter()),this.m_debugDraw.DrawTransform(v)}}}},{key:"QueryAABB",value:function(t,e){var i=this.m_contactManager.m_broadPhase;function s(e){var s=i.GetUserData(e),n=s.fixture;return t instanceof mn?t.ReportFixture(n):t(n)}if(i.Query(s,e),t instanceof mn)for(var n=this.m_particleSystemList;n;n=n.m_next)t.ShouldQueryParticleSystem(n)&&n.QueryAABB(t,e)}},{key:"QueryShape",value:function(e,i,s){var n=this.m_contactManager.m_broadPhase;function a(t){var a=n.GetUserData(t),r=a.fixture;return!Te(i,0,r.GetShape(),0,s,r.GetBody().GetTransform())||(e instanceof mn?e.ReportFixture(r):e(r))}var r=t.QueryShape_s_aabb;if(i.ComputeAABB(r,s,0),n.Query(a,r),e instanceof mn)for(var o=this.m_particleSystemList;o;o=o.m_next)e.ShouldQueryParticleSystem(o)&&o.QueryAABB(e,r)}},{key:"QueryPoint",value:function(e,i){var s=this.m_contactManager.m_broadPhase;function n(t){var n=s.GetUserData(t),a=n.fixture;return!a.TestPoint(i)||(e instanceof mn?e.ReportFixture(a):e(a))}var a=t.QueryPoint_s_aabb;if(a.lowerBound.Set(i.x-y,i.y-y),a.upperBound.Set(i.x+y,i.y+y),s.Query(n,a),e instanceof mn)for(var r=this.m_particleSystemList;r;r=r.m_next)e.ShouldQueryParticleSystem(r)&&r.QueryAABB(e,a)}},{key:"RayCast",value:function(e,i,s){var n=this.m_contactManager.m_broadPhase;function a(a,r){var o=n.GetUserData(r),l=o.fixture,u=o.childIndex,m=t.RayCast_s_output,_=l.RayCast(m,a,u);if(_){var h=m.fraction,c=t.RayCast_s_point;return c.Set((1-h)*i.x+h*s.x,(1-h)*i.y+h*s.y),e instanceof _n?e.ReportFixture(l,c,m.normal,h):e(l,c,m.normal,h)}return a.maxFraction}var r=t.RayCast_s_input;if(r.maxFraction=1,r.p1.Copy(i),r.p2.Copy(s),n.RayCast(a,r),e instanceof _n)for(var o=this.m_particleSystemList;o;o=o.m_next)e.ShouldQueryParticleSystem(o)&&o.RayCast(e,i,s)}},{key:"RayCastOne",value:function(t,e){var i=null,s=1;function n(t,e,n,a){return a<s&&(s=a,i=t),s}return this.RayCast(n,t,e),i}},{key:"RayCastAll",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];function s(t,e,s,n){return i.push(t),1}return this.RayCast(s,t,e),i}},{key:"GetBodyList",value:function(){return this.m_bodyList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetParticleSystemList",value:function(){return this.m_particleSystemList}},{key:"GetContactList",value:function(){return this.m_contactManager.m_contactList}},{key:"SetAllowSleeping",value:function(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)}},{key:"GetAllowSleeping",value:function(){return this.m_allowSleep}},{key:"SetWarmStarting",value:function(t){this.m_warmStarting=t}},{key:"GetWarmStarting",value:function(){return this.m_warmStarting}},{key:"SetContinuousPhysics",value:function(t){this.m_continuousPhysics=t}},{key:"GetContinuousPhysics",value:function(){return this.m_continuousPhysics}},{key:"SetSubStepping",value:function(t){this.m_subStepping=t}},{key:"GetSubStepping",value:function(){return this.m_subStepping}},{key:"GetProxyCount",value:function(){return this.m_contactManager.m_broadPhase.GetProxyCount()}},{key:"GetBodyCount",value:function(){return this.m_bodyCount}},{key:"GetJointCount",value:function(){return this.m_jointCount}},{key:"GetContactCount",value:function(){return this.m_contactManager.m_contactCount}},{key:"GetTreeHeight",value:function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}},{key:"GetTreeBalance",value:function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}},{key:"GetTreeQuality",value:function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}},{key:"SetGravity",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!at.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(var i=this.m_bodyList;i;i=i.m_next)i.SetAwake(!0)}},{key:"GetGravity",value:function(){return this.m_gravity}},{key:"IsLocked",value:function(){return this.m_locked}},{key:"SetAutoClearForces",value:function(t){this.m_clearForces=t}},{key:"GetAutoClearForces",value:function(){return this.m_clearForces}},{key:"ShiftOrigin",value:function(t){if(!this.IsLocked()){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}}},{key:"GetContactManager",value:function(){return this.m_contactManager}},{key:"GetProfile",value:function(){return this.m_profile}},{key:"Dump",value:function(t){if(!this.m_locked){t("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),t("this.m_world.SetGravity(g);\n"),t("const bodies: b2Body[] = [];\n"),t("const joints: b2Joint[] = [];\n");for(var e=0,i=this.m_bodyList;i;i=i.m_next)i.m_islandIndex=e,i.Dump(t),++e;e=0;for(var s=this.m_jointList;s;s=s.m_next)s.m_index=e,++e;for(var n=this.m_jointList;n;n=n.m_next)n.m_type!==gs.e_gearJoint&&(t("{\n"),n.Dump(t),t("}\n"));for(var a=this.m_jointList;a;a=a.m_next)a.m_type===gs.e_gearJoint&&(t("{\n"),a.Dump(t),t("}\n"))}}},{key:"DrawJoint",value:function(e){var i=e.GetBodyA(),s=e.GetBodyB(),n=i.m_xf,a=s.m_xf,r=n.p,o=a.p,l=e.GetAnchorA(t.DrawJoint_s_p1),u=e.GetAnchorB(t.DrawJoint_s_p2),m=t.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(e.m_type){case gs.e_distanceJoint:this.m_debugDraw.DrawSegment(l,u,m);break;case gs.e_pulleyJoint:var _=e,h=_.GetGroundAnchorA(),c=_.GetGroundAnchorB();this.m_debugDraw.DrawSegment(h,l,m),this.m_debugDraw.DrawSegment(c,u,m),this.m_debugDraw.DrawSegment(h,c,m);break;case gs.e_mouseJoint:this.m_debugDraw.DrawSegment(l,u,m);break;default:this.m_debugDraw.DrawSegment(r,l,m),this.m_debugDraw.DrawSegment(l,u,m),this.m_debugDraw.DrawSegment(o,u,m)}}},{key:"DrawShape",value:function(t,e){var i=t.GetShape();switch(i.m_type){case ms.e_circleShape:var s=i,n=s.m_p,a=s.m_radius,r=at.UNITX;this.m_debugDraw.DrawSolidCircle(n,a,r,e);break;case ms.e_edgeShape:var o=i,l=o.m_vertex1,u=o.m_vertex2;this.m_debugDraw.DrawSegment(l,u,e);break;case ms.e_chainShape:var m=i,_=m.m_count,h=m.m_vertices,c=h[0];this.m_debugDraw.DrawCircle(c,.05,e);for(var f=1;f<_;++f){var d=h[f];this.m_debugDraw.DrawSegment(c,d,e),this.m_debugDraw.DrawCircle(d,.05,e),c=d}break;case ms.e_polygonShape:var v=i,y=v.m_count,p=v.m_vertices;this.m_debugDraw.DrawSolidPolygon(p,y,e);break}}},{key:"Solve",value:function(t){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf0.Copy(e.m_xf);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var i=this.m_island;i.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener);for(var s=this.m_bodyList;s;s=s.m_next)s.m_islandFlag=!1;for(var n=this.m_contactManager.m_contactList;n;n=n.m_next)n.m_islandFlag=!1;for(var a=this.m_jointList;a;a=a.m_next)a.m_islandFlag=!1;for(var r=this.s_stack,o=this.m_bodyList;o;o=o.m_next)if(!o.m_islandFlag&&o.IsAwake()&&o.IsActive()&&o.GetType()!==Ss.b2_staticBody){i.Clear();var l=0;r[l++]=o,o.m_islandFlag=!0;while(l>0){var u=r[--l];if(i.AddBody(u),u.SetAwake(!0),u.GetType()!==Ss.b2_staticBody){for(var m=u.m_contactList;m;m=m.next){var _=m.contact;if(!_.m_islandFlag&&(_.IsEnabled()&&_.IsTouching())){var h=_.m_fixtureA.m_isSensor,c=_.m_fixtureB.m_isSensor;if(!h&&!c){i.AddContact(_),_.m_islandFlag=!0;var f=m.other;f.m_islandFlag||(r[l++]=f,f.m_islandFlag=!0)}}}for(var d=u.m_jointList;d;d=d.next)if(!d.joint.m_islandFlag){var v=d.other;v.IsActive()&&(i.AddJoint(d.joint),d.joint.m_islandFlag=!0,v.m_islandFlag||(r[l++]=v,v.m_islandFlag=!0))}}}var y=new cn;i.Solve(y,t,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=y.solveInit,this.m_profile.solveVelocity+=y.solveVelocity,this.m_profile.solvePosition+=y.solvePosition;for(var p=0;p<i.m_bodyCount;++p){var x=i.m_bodies[p];x.GetType()===Ss.b2_staticBody&&(x.m_islandFlag=!1)}}for(var B=0;B<r.length;++B){if(!r[B])break;r[B]=null}for(var S=new ne,A=this.m_bodyList;A;A=A.m_next)A.m_islandFlag&&A.GetType()!==Ss.b2_staticBody&&A.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=S.GetMilliseconds()}},{key:"SolveTOI",value:function(e){var i=this.m_island;if(i.Initialize(2*S,S,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var s=this.m_bodyList;s;s=s.m_next)s.m_islandFlag=!1,s.m_sweep.alpha0=0;for(var n=this.m_contactManager.m_contactList;n;n=n.m_next)n.m_toiFlag=!1,n.m_islandFlag=!1,n.m_toiCount=0,n.m_toi=1}for(;;){for(var a=null,r=1,o=this.m_contactManager.m_contactList;o;o=o.m_next)if(o.IsEnabled()&&!(o.m_toiCount>B)){var l=1;if(o.m_toiFlag)l=o.m_toi;else{var u=o.GetFixtureA(),_=o.GetFixtureB();if(u.IsSensor()||_.IsSensor())continue;var h=u.GetBody(),c=_.GetBody(),f=h.m_type,d=c.m_type,v=h.IsAwake()&&f!==Ss.b2_staticBody,y=c.IsAwake()&&d!==Ss.b2_staticBody;if(!v&&!y)continue;var p=h.IsBullet()||f!==Ss.b2_dynamicBody,x=c.IsBullet()||d!==Ss.b2_dynamicBody;if(!p&&!x)continue;var A=h.m_sweep.alpha0;h.m_sweep.alpha0<c.m_sweep.alpha0?(A=c.m_sweep.alpha0,h.m_sweep.Advance(A)):c.m_sweep.alpha0<h.m_sweep.alpha0&&(A=h.m_sweep.alpha0,c.m_sweep.Advance(A));var C=o.GetChildIndexA(),b=o.GetChildIndexB(),V=t.SolveTOI_s_toi_input;V.proxyA.SetShape(u.GetShape(),C),V.proxyB.SetShape(_.GetShape(),b),V.sweepA.Copy(h.m_sweep),V.sweepB.Copy(c.m_sweep),V.tMax=1;var g=t.SolveTOI_s_toi_output;di(g,V);var w=g.t;l=g.state===Xe.e_touching?Y(A+(1-A)*w,1):1,o.m_toi=l,o.m_toiFlag=!0}l<r&&(a=o,r=l)}if(null===a||1-10*m<r){this.m_stepComplete=!0;break}var k=a.GetFixtureA(),M=a.GetFixtureB(),I=k.GetBody(),P=M.GetBody(),G=t.SolveTOI_s_backup1.Copy(I.m_sweep),D=t.SolveTOI_s_backup2.Copy(P.m_sweep);if(I.Advance(r),P.Advance(r),a.Update(this.m_contactManager.m_contactListener),a.m_toiFlag=!1,++a.m_toiCount,a.IsEnabled()&&a.IsTouching()){I.SetAwake(!0),P.SetAwake(!0),i.Clear(),i.AddBody(I),i.AddBody(P),i.AddContact(a),I.m_islandFlag=!0,P.m_islandFlag=!0,a.m_islandFlag=!0;for(var j=0;j<2;++j){var O=0===j?I:P;if(O.m_type===Ss.b2_dynamicBody)for(var F=O.m_contactList;F;F=F.next){if(i.m_bodyCount===i.m_bodyCapacity)break;if(i.m_contactCount===i.m_contactCapacity)break;var L=F.contact;if(!L.m_islandFlag){var R=F.other;if(R.m_type!==Ss.b2_dynamicBody||O.IsBullet()||R.IsBullet()){var T=L.m_fixtureA.m_isSensor,q=L.m_fixtureB.m_isSensor;if(!T&&!q){var z=t.SolveTOI_s_backup.Copy(R.m_sweep);R.m_islandFlag||R.Advance(r),L.Update(this.m_contactManager.m_contactListener),L.IsEnabled()&&L.IsTouching()?(L.m_islandFlag=!0,i.AddContact(L),R.m_islandFlag||(R.m_islandFlag=!0,R.m_type!==Ss.b2_staticBody&&R.SetAwake(!0),i.AddBody(R))):(R.m_sweep.Copy(z),R.SynchronizeTransform())}}}}}var N=t.SolveTOI_s_subStep;N.dt=(1-r)*e.dt,N.inv_dt=1/N.dt,N.dtRatio=1,N.positionIterations=20,N.velocityIterations=e.velocityIterations,N.particleIterations=e.particleIterations,N.warmStarting=!1,i.SolveTOI(N,I.m_islandIndex,P.m_islandIndex);for(var E=0;E<i.m_bodyCount;++E){var J=i.m_bodies[E];if(J.m_islandFlag=!1,J.m_type===Ss.b2_dynamicBody){J.SynchronizeFixtures();for(var X=J.m_contactList;X;X=X.next)X.contact.m_toiFlag=!1,X.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else a.SetEnabled(!1),I.m_sweep.Copy(G),P.m_sweep.Copy(D),I.SynchronizeTransform(),P.SynchronizeTransform()}}}]),t}();ta.Step_s_step=new fn,ta.Step_s_stepTimer=new ne,ta.Step_s_timer=new ne,ta.DrawDebugData_s_color=new se(0,0,0),ta.DrawDebugData_s_vs=at.MakeArray(4),ta.DrawDebugData_s_xf=new Yt,ta.QueryShape_s_aabb=new De,ta.QueryPoint_s_aabb=new De,ta.RayCast_s_input=new Pe,ta.RayCast_s_output=new Ge,ta.RayCast_s_point=new at,ta.DrawJoint_s_p1=new at,ta.DrawJoint_s_p2=new at,ta.DrawJoint_s_color=new se(.5,.8,.8),ta.SolveTOI_s_subStep=new fn,ta.SolveTOI_s_backup=new ie,ta.SolveTOI_s_backup1=new ie,ta.SolveTOI_s_backup2=new ie,ta.SolveTOI_s_toi_input=new ii,ta.SolveTOI_s_toi_output=new ni;var ea=function(){function t(){Object(r["a"])(this,t),this.m_count=0,this.m_ps=null,this.m_p0s=null,this.m_vs=null,this.m_ims=null,this.m_Ls=null,this.m_as=null,this.m_gravity=new at,this.m_damping=0,this.m_k2=1,this.m_k3=.1}return Object(o["a"])(t,[{key:"GetVertexCount",value:function(){return this.m_count}},{key:"GetVertices",value:function(){return this.m_ps}},{key:"Initialize",value:function(t){this.m_count=t.count,this.m_ps=at.MakeArray(this.m_count),this.m_p0s=at.MakeArray(this.m_count),this.m_vs=at.MakeArray(this.m_count),this.m_ims=W(this.m_count);for(var e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();var i=t.masses[e];this.m_ims[e]=i>0?1/i:0}var s=this.m_count-1,n=this.m_count-2;this.m_Ls=W(s),this.m_as=W(n);for(var a=0;a<s;++a){var r=this.m_ps[a],o=this.m_ps[a+1];this.m_Ls[a]=at.DistanceVV(r,o)}for(var l=0;l<n;++l){var u=this.m_ps[l],m=this.m_ps[l+1],_=this.m_ps[l+2],h=at.SubVV(m,u,at.s_t0),c=at.SubVV(_,m,at.s_t1),f=at.CrossVV(h,c),d=at.DotVV(h,c);this.m_as[l]=nt(f,d)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3}},{key:"Step",value:function(t,e){if(0!==t){for(var i=Math.exp(-t*this.m_damping),s=0;s<this.m_count;++s)this.m_p0s[s].Copy(this.m_ps[s]),this.m_ims[s]>0&&this.m_vs[s].SelfMulAdd(t,this.m_gravity),this.m_vs[s].SelfMul(i),this.m_ps[s].SelfMulAdd(t,this.m_vs[s]);for(var n=0;n<e;++n)this.SolveC2(),this.SolveC3(),this.SolveC2();for(var a=1/t,r=0;r<this.m_count;++r)at.MulSV(a,at.SubVV(this.m_ps[r],this.m_p0s[r],at.s_t0),this.m_vs[r])}}},{key:"SolveC2",value:function(){for(var e=this.m_count-1,i=0;i<e;++i){var s=this.m_ps[i],n=this.m_ps[i+1],a=at.SubVV(n,s,t.s_d),r=a.Normalize(),o=this.m_ims[i],l=this.m_ims[i+1];if(o+l!==0){var u=o/(o+l),m=l/(o+l);s.SelfMulSub(this.m_k2*u*(this.m_Ls[i]-r),a),n.SelfMulAdd(this.m_k2*m*(this.m_Ls[i]-r),a)}}}},{key:"SetAngle",value:function(t){for(var e=this.m_count-2,i=0;i<e;++i)this.m_as[i]=t}},{key:"SolveC3",value:function(){for(var e=this.m_count-2,i=0;i<e;++i){var s=this.m_ps[i],n=this.m_ps[i+1],a=this.m_ps[i+2],r=this.m_ims[i],o=this.m_ims[i+1],l=this.m_ims[i+2],u=at.SubVV(n,s,t.s_d1),m=at.SubVV(a,n,t.s_d2),_=u.LengthSquared(),c=m.LengthSquared();if(_*c!==0){var f=at.CrossVV(u,m),d=at.DotVV(u,m),v=nt(f,d),y=at.MulSV(-1/_,u.SelfSkew(),t.s_Jd1),p=at.MulSV(1/c,m.SelfSkew(),t.s_Jd2),x=at.NegV(y,t.s_J1),B=at.SubVV(y,p,t.s_J2),S=p,A=r*at.DotVV(x,x)+o*at.DotVV(B,B)+l*at.DotVV(S,S);if(0!==A){A=1/A;var C=v-this.m_as[i];while(C>h)v-=2*h,C=v-this.m_as[i];while(C<-h)v+=2*h,C=v-this.m_as[i];var b=-this.m_k3*A*C;s.SelfMulAdd(r*b,x),n.SelfMulAdd(o*b,B),a.SelfMulAdd(l*b,S)}}}}},{key:"Draw",value:function(t){for(var e=new se(.4,.5,.7),i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e)}}]),t}();ea.s_d=new at,ea.s_d1=new at,ea.s_d2=new at,ea.s_Jd1=new at,ea.s_Jd2=new at,ea.s_J1=new at,ea.s_J2=new at;var ia;i("cb29");(function(t){t[t["DEFAULT"]=0]="DEFAULT",t[t["BALL"]=1]="BALL",t[t["GOAL"]=2]="GOAL",t[t["BULLET"]=101]="BULLET"})(ia||(ia={}));var sa=function(){function t(){Object(r["a"])(this,t),this.markedForDeletion=!1}return Object(o["a"])(t,[{key:"tick",value:function(){}}]),t}(),na=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this),s.scene=t.scene,s.body=s.createBody(t),s}return Object(o["a"])(i,[{key:"createBody",value:function(t){var e=new ks,i=new Cs;i.density=1,i.friction=.6,i.restitution=.9;var s=new ys(t.r);i.shape=s,e.position.Set(t.x,t.y),e.linearDamping=.8,e.angularDamping=1,e.type=Ss.b2_dynamicBody;var n={gameObject:this,collisionType:ia.BALL};e.userData=n;var a=this.scene.world.CreateBody(e);return a.CreateFixture(i),a}},{key:"render",value:function(t){var e=t.context;e.fillStyle="rgb(200, 0, 0)";var i=this.body.GetFixtureList().GetShape(),s=this.body,n=s.GetPosition();e.beginPath(),e.arc(n.x,n.y,i.m_radius,0,2*Math.PI,!0),e.fill()}}]),i}(sa),aa=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this),s.scene=t.scene,s.body=s.createBody(t),s}return Object(o["a"])(i,[{key:"createBody",value:function(t){var e=new ks,i=new Cs;i.isSensor=!0,i.shape=(new ps).SetAsBox(t.w/2,t.h/2),e.position.Set(t.x+t.w/2,t.y+t.h/2),e.type=Ss.b2_staticBody;var s={gameObject:this,collisionType:ia.GOAL};e.userData=s;var n=this.scene.world.CreateBody(e);return n.CreateFixture(i),n}},{key:"render",value:function(t){var e=t.context;e.fillStyle="rgb(16, 121, 89)";var i=this.body.GetFixtureList().GetShape(),s=this.body,n=(s.GetPosition(),i.m_vertices);e.beginPath();for(var a=0;a<i.m_count;a++){var r=new at(0,0);s.GetWorldPoint(n[a],r),0===a?e.moveTo(r.x,r.y):e.lineTo(r.x,r.y)}e.fill()}}]),i}(sa),ra=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this),s.scene=t.scene,s.body=s.createBody(t),s}return Object(o["a"])(i,[{key:"createBody",value:function(t){var e=new ks,i=new Cs;i.density=1,i.friction=0,i.restitution=.5,i.shape=(new ps).SetAsBox(t.w/2,t.h/2),e.position.Set(t.x+t.w/2,t.y+t.h/2),e.type=Ss.b2_staticBody;var s={gameObject:this,collisionType:ia.DEFAULT};e.userData=s;var n=this.scene.world.CreateBody(e);return n.CreateFixture(i),n}},{key:"render",value:function(t){var e=t.context;e.fillStyle="rgb(209, 225, 235)";var i=this.body.GetFixtureList().GetShape(),s=this.body,n=(s.GetPosition(),i.m_vertices);e.beginPath();for(var a=0;a<i.m_count;a++){var r=new at(0,0);s.GetWorldPoint(n[a],r),0===a?e.moveTo(r.x,r.y):e.lineTo(r.x,r.y)}e.fill()}}]),i}(sa),oa=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(){return Object(r["a"])(this,i),e.apply(this,arguments)}return Object(o["a"])(i,[{key:"EndContact",value:function(t){var e=t.m_fixtureA.m_body,i=t.m_fixtureB.m_body;if(this.isBodyOfCollisionType(e,ia.BULLET)){var s=this.getBodyGameObject(e);s.afterCollisionWithAny()}if(this.isBodyOfCollisionType(i,ia.BULLET)){var n=this.getBodyGameObject(i);n.afterCollisionWithAny()}}},{key:"isBodyOfCollisionType",value:function(t,e){var i=t.m_userData.collisionType;return i===e}},{key:"getBodyGameObject",value:function(t){return t.m_userData.gameObject}}]),i}(un),la=new oa,ua=function(){function t(e){Object(r["a"])(this,t),this.canvas=e.canvas,this.world=e.world,this.unitWidth=e.unitWidth,this.unitHeight=e.unitHeight,this.gameObjects=e.gameObjects,this.setup()}return Object(o["a"])(t,[{key:"setup",value:function(){this.world.SetContactListener(la);var t=this.canvas.pixelWidth/this.unitWidth,e=this.canvas.pixelHeight/this.unitHeight,i=Math.min(t,e);this.canvas.context.scale(i,i)}},{key:"render",value:function(){this.renderBackground(),this.renderGameObjects()}},{key:"addGameObject",value:function(t){this.gameObjects.push(t)}},{key:"renderGameObjects",value:function(){var t=this;this.gameObjects.forEach((function(e){e.render(t.canvas)}))}},{key:"renderBackground",value:function(){var t=this.canvas.context;t.fillStyle="rgb(42, 43, 49)",t.fillRect(0,0,this.canvas.pixelWidth,this.canvas.pixelHeight)}}]),t}(),ma=16,_a=9,ha=1,ca=_a-ha,fa=15,da=7.8,va=4,ya=.4,pa=(ma-fa)/2,xa=(ca-da)/2,Ba=(da-va)/2,Sa=.1;function Aa(t){var e=new ta(new at(0,0)),i=new l,s=new ua({world:e,canvas:i,unitWidth:ma,unitHeight:_a,gameObjects:[]}),n=t.players[0];return n&&n.createObjects(s,4,4),s.addGameObject(new na({scene:s,x:8,y:7,r:.12})),s.addGameObject(new ra({scene:s,x:pa,y:xa,w:fa,h:Sa})),s.addGameObject(new ra({scene:s,x:pa,y:xa+da-Sa,w:fa,h:Sa})),s.addGameObject(new ra({scene:s,x:pa,y:xa,w:Sa,h:Ba})),s.addGameObject(new ra({scene:s,x:pa,y:xa+Ba+va,w:Sa,h:Ba})),s.addGameObject(new aa({scene:s,x:pa-ya+Sa,y:xa+Ba,w:ya,h:va})),s.addGameObject(new ra({scene:s,x:pa-ya,y:xa+Ba-Sa,w:ya+Sa,h:Sa})),s.addGameObject(new ra({scene:s,x:pa-ya,y:xa+Ba+va,w:ya+Sa,h:Sa})),s.addGameObject(new ra({scene:s,x:pa-ya,y:xa+Ba-Sa,w:Sa,h:va+2*Sa})),s.addGameObject(new ra({scene:s,x:pa+fa-Sa,y:xa,w:Sa,h:Ba})),s.addGameObject(new ra({scene:s,x:pa+fa-Sa,y:xa+Ba+va,w:Sa,h:Ba})),s.addGameObject(new aa({scene:s,x:pa+fa-Sa,y:xa+Ba,w:ya,h:va})),s.addGameObject(new ra({scene:s,x:pa+fa-Sa,y:xa+Ba-Sa,w:ya+Sa,h:Sa})),s.addGameObject(new ra({scene:s,x:pa+fa-Sa,y:xa+Ba+va,w:ya+Sa,h:Sa})),s.addGameObject(new ra({scene:s,x:pa+fa+ya-Sa,y:xa+Ba-Sa,w:Sa,h:va+2*Sa})),s}var Ca=function(){function t(e){Object(r["a"])(this,t),this.config=e,this.lastLogTime=Date.now(),this.logBlock=[],this.isHiding=!1,this.notifiedUserOfSuppressing=!1}return Object(o["a"])(t,[{key:"log",value:function(t){var e=Date.now();if(this.isHiding){if(e-this.lastLogTime<this.config.TIMEOUT_MS)return;this.isHiding=!1,this.logBlock=[]}this.logBlock.push(t),this.logBlock.length>this.config.MAX_LOGS_BEFORE_SUPPRESSING?(this.isHiding=!0,this.notifiedUserOfSuppressing||(console.log("TOO MANY CONSOLE LOGS! SUPPRESSING...."),this.notifiedUserOfSuppressing=!0)):(console.log(t),this.lastLogTime=e)}},{key:"setConfig",value:function(t){this.config=t}}]),t}(),ba=new Ca({TIMEOUT_MS:200,MAX_LOGS_BEFORE_SUPPRESSING:4}),Va=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this),s.scene=t.scene,s.body=s.createBody(t),s}return Object(o["a"])(i,[{key:"createBody",value:function(t){var e=1,i=new ks,s=new Cs;s.density=1,s.friction=0,s.restitution=.5,i.linearDamping=0,i.angularDamping=0,s.shape=(new ps).SetAsBox(t.w/2,t.h/2),i.angle=t.angle,i.position.Set(t.x+t.w/2,t.y+t.h/2),ba.log(i.position.x),ba.log(i.position.y),i.type=Ss.b2_dynamicBody;var n={gameObject:this,collisionType:ia.BULLET};i.userData=n;var a=this.scene.world.CreateBody(i);a.CreateFixture(s);var r=new at(Math.cos(t.angle),Math.sin(t.angle));return a.ApplyLinearImpulseToCenter(r.SelfMul(e)),a}},{key:"afterCollisionWithAny",value:function(){this.markedForDeletion=!0}},{key:"render",value:function(t){var e=t.context;e.fillStyle="rgb(209, 225, 235)";var i=this.body.GetFixtureList().GetShape(),s=this.body,n=(s.GetPosition(),i.m_vertices);e.beginPath();for(var a=0;a<i.m_count;a++){var r=new at(0,0);s.GetWorldPoint(n[a],r),0===a?e.moveTo(r.x,r.y):e.lineTo(r.x,r.y)}e.fill()}}]),i}(sa),ga=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this),s.scene=t.scene,s.body=s.createBody(t),s.props=t,s}return Object(o["a"])(i,[{key:"createBody",value:function(t){var e=new ks,i=new Cs,s=new Cs;i.density=t.density,i.friction=t.friction,i.restitution=t.restitution;var n=new ps;n.Set([new at(0,0),new at(t.noseLength,0),new at(t.noseLength,t.noseWidth/2),new at(-t.tailLength,t.tailWidth/2)]),i.shape=n,s.density=t.density,s.friction=t.friction,s.restitution=t.restitution;var a=new ps;a.Set([new at(0,0),new at(t.noseLength,0),new at(t.noseLength,-t.noseWidth/2),new at(-t.tailLength,-t.tailWidth/2)]),s.shape=a,e.position.Set(t.x,t.y),e.linearDamping=1,e.angularDamping=0,e.type=Ss.b2_dynamicBody;var r={gameObject:this,collisionType:ia.DEFAULT};e.userData=r;var o=this.scene.world.CreateBody(e);return o.CreateFixture(i),o.CreateFixture(s),o}},{key:"handleRotation",value:function(t){var e=4,i=this.body,s=t*e,n=i.GetAngularVelocity();i.ApplyTorque(-s-n)}},{key:"thrust",value:function(){var t=.025,e=this.body,i=e.GetTransform().GetRotation(),s=new at(i.c*t,i.s*t);e.ApplyLinearImpulseToCenter(s)}},{key:"createBullet",value:function(){var t=.2,e=.1,i=new at(0,0);this.body.GetWorldPoint(new at(this.props.noseLength+e,-t/2),i),ba.log(i);var s=new Va({scene:this.scene,x:i.x,y:i.y,w:.25,h:.2,angle:this.body.GetAngle()});return this.scene.addGameObject(s),s}},{key:"render",value:function(t){var e=t.context;e.fillStyle="rgb(126, 226, 151)";var i=this.body,s=(i.GetPosition(),i.GetTransform(),this.body.GetFixtureList());while(null!==s){var n=s.GetShape();e.beginPath();for(var a=n.m_vertices,r=0;r<n.m_count;r++){var o=new at(0,0);i.GetWorldPoint(a[r],o),0===r?e.moveTo(o.x,o.y):e.lineTo(o.x,o.y)}e.fill(),s=s.m_next}}}]),i}(sa),wa={button1Index:0,button2Index:1,button3Index:2,button4Index:3,leftStickXAxisIndex:0,leftStickYAxisIndex:1,rightStickXAxisIndex:2,rightStickYAxisIndex:3,leftTriggerAxisIndex:4,rightTriggerAxisIndex:5},ka={button1Key:0,button2Key:1,button3Key:2,button4Key:3},Ma={gamepadInputMapping:wa,keyboardMouseInputMapping:ka,leftStickDeadzone:.15,rightStickDeadzone:.15},Ia={button1:!1,button2:!1,button3:!1,button4:!1,leftStickXAxis:0,leftStickYAxis:0,rightStickXAxis:0,rightStickYAxis:0,leftTriggerAxis:0,rightTriggerAxis:0},Pa={key1:!1,key2:!1,key3:!1,key4:!1,mouseXAxis:0,mouseYAxis:0},Ga=function(){function t(){Object(r["a"])(this,t)}return Object(o["a"])(t,[{key:"getGamepadInput",value:function(t,e){var i=navigator.getGamepads()[t];if(!i)return Ia;var s=e.gamepadInputMapping,n=Math.sqrt(Math.pow(Math.abs(i.axes[s.leftStickXAxisIndex]),2)+Math.pow(Math.abs(i.axes[s.leftStickYAxisIndex]),2)),a=Math.sqrt(Math.pow(Math.abs(i.axes[s.rightStickXAxisIndex]),2)+Math.pow(Math.abs(i.axes[s.rightStickYAxisIndex]),2)),r=n<e.leftStickDeadzone,o=a<e.rightStickDeadzone,l={button1:i.buttons[s.button1Index].pressed,button2:i.buttons[s.button2Index].pressed,button3:i.buttons[s.button3Index].pressed,button4:i.buttons[s.button4Index].pressed,leftStickXAxis:r?0:i.axes[s.leftStickXAxisIndex],leftStickYAxis:r?0:-i.axes[s.leftStickYAxisIndex],rightStickXAxis:o?0:i.axes[s.rightStickXAxisIndex],rightStickYAxis:o?0:-i.axes[s.rightStickYAxisIndex],leftTriggerAxis:i.axes[s.leftTriggerAxisIndex],rightTriggerAxis:i.axes[s.rightTriggerAxisIndex]};return l}},{key:"getKeyboardMouseInput",value:function(t){return Pa}}]),t}(),Da=new Ga,ja=function(){function t(e){Object(r["a"])(this,t),this.state={playerDict:{}}}return Object(o["a"])(t,[{key:"addPlayer",value:function(t){s["a"].set(this.state.playerDict,t.index,t)}},{key:"setPlayerResourceMeter",value:function(t,e){s["a"].set(this.state.playerDict[t],"resourceMeter",e)}}]),t}(),Oa=new ja({placeholder:"uh ok"}),Fa=function(){function t(e){Object(r["a"])(this,t),this.RESOURCE_METER_MAXIMUM=101,this.RESOURCE_METER_BEGIN=50,this.playerIndex=e.playerIndex,this.gamepadIndex=e.gamepadIndex,this.resourceMeter=this.RESOURCE_METER_BEGIN}return Object(o["a"])(t,[{key:"getInput",value:function(){return Da.getGamepadInput(this.gamepadIndex,Ma)}},{key:"setResourceMeter",value:function(t){var e=Math.min(t,this.RESOURCE_METER_MAXIMUM);this.resourceMeter=e,Oa.setPlayerResourceMeter(this.playerIndex,e)}}]),t}(),La=function(t){Object(ds["a"])(i,t);var e=Object(vs["a"])(i);function i(t){var s;return Object(r["a"])(this,i),s=e.call(this,{playerIndex:t.playerIndex,gamepadIndex:t.gamepadIndex}),s.DENSITY=t.DENSITY,s.FRICTION=t.FRICTION,s.RESTITUTION=t.RESTITUTION,s.NOSE_LENGTH=t.NOSE_LENGTH,s.NOSE_WIDTH=t.NOSE_WIDTH,s.TAIL_LENGTH=t.TAIL_LENGTH,s.TAIL_WIDTH=t.TAIL_WIDTH,s.SHOOT_COST=t.SHOOT_COST,s}return Object(o["a"])(i,[{key:"createObjects",value:function(t,e,i){this.shipObject=new ga({scene:t,x:e,y:i,density:this.DENSITY,friction:this.FRICTION,restitution:this.RESTITUTION,noseLength:this.NOSE_LENGTH,noseWidth:this.NOSE_WIDTH,tailLength:this.TAIL_LENGTH,tailWidth:this.TAIL_WIDTH}),t.addGameObject(this.shipObject)}},{key:"tick",value:function(){var t=this.getInput();this.handleRotation(t),this.handleThrust(t),this.handleShoot(t)}},{key:"handleRotation",value:function(t){var e=t.leftStickXAxis;this.shipObject.handleRotation(e)}},{key:"handleThrust",value:function(t){t.button1&&this.shipObject.thrust()}},{key:"handleShoot",value:function(t){var e;null!==(e=this.bulletObject)&&void 0!==e&&e.markedForDeletion&&(this.bulletObject=void 0),t.button2&&!this.bulletObject&&this.resourceMeter>=this.SHOOT_COST&&(this.setResourceMeter(this.resourceMeter-this.SHOOT_COST),this.bulletObject=this.shipObject.createBullet())}}]),i}(Fa),Ra=function(){function t(){Object(r["a"])(this,t),this.previousTimestamp=0,this.players=[this.initPlayerOne()],this.scene=Aa({players:this.players}),window.requestAnimationFrame(this.gameLoop.bind(this))}return Object(o["a"])(t,[{key:"gameLoop",value:function(t){var e=17,i=t-this.previousTimestamp;this.tickWorld(i),this.deleteGameObjects(),this.previousTimestamp=t;Math.round(1e3/i);for(var s=this.previousTimestamp%e+i%e>=e,n=Math.floor(i/e)+(s?1:0),a=0;a<n;a++)this.tickGameObjects(),this.tickPlayers();this.scene.render(),window.requestAnimationFrame(this.gameLoop.bind(this))}},{key:"tickGameObjects",value:function(){this.scene.gameObjects.forEach((function(t){t.tick()}))}},{key:"tickPlayers",value:function(){this.players.forEach((function(t){t.tick()}))}},{key:"tickWorld",value:function(t){this.scene.world.Step(t/1e3,8,3)}},{key:"deleteGameObjects",value:function(){for(var t=this.scene.gameObjects.length-1;t>=0;t--){var e=this.scene.gameObjects[t];e.markedForDeletion&&(this.scene.gameObjects.splice(t,1),this.scene.world.DestroyBody(e.body))}}},{key:"initPlayerOne",value:function(){var t=0,e=new La({playerIndex:0,gamepadIndex:0,DENSITY:2,FRICTION:.5,RESTITUTION:0,NOSE_LENGTH:.4,NOSE_WIDTH:.1,TAIL_LENGTH:.12,TAIL_WIDTH:.5,SHOOT_COST:5}),i={index:t,resourceMeter:e.resourceMeter};return Oa.addPlayer(i),e}}]),t}(),Ta=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"aspectRatioWrapper",class:this.shouldUseHorizontalLetterbox?"aspect-ratio-wrapper-h":"aspect-ratio-wrapper-v"},[i("div",{class:this.shouldUseHorizontalLetterbox?"aspect-ratio-div-h":"aspect-ratio-div-v"},[i("div",{staticClass:"content-wrapper"},[i("game-canvas")],1)])])},qa=[],za=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"canvas-wrapper"},[i("canvas-overlay",{staticClass:"canvas-overlay-from-parent"}),t._m(0)],1)},Na=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("canvas",{attrs:{id:"game-canvas"}})}],Ea=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"canvas-overlay"},[i("hud-section",{staticClass:"hud-section-from-parent"})],1)},Ja=[],Xa=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"hud-section"},t._l(t.players,(function(t){return i("player-meter",{key:t.index,attrs:{playerIndex:t.index}})})),1)},Ua=[],Wa=(i("07ac"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"player-meter-wrapper"},[i("div",{staticClass:"player-meter"},[i("div",{staticClass:"meter-bg"},[i("div",{staticClass:"meter-fg",style:t.injectBarWidthStyle()})])]),i("div",{staticClass:"amount-text"},[t._v(" "+t._s(t.displayNumber)+" ")])])}),Za=[],Ha=(i("a9e3"),s["a"].extend({name:"PlayerMeter",props:{playerIndex:Number},data:function(){return{vueService:Oa}},computed:{player:function(){return this.vueService.state.playerDict[this.playerIndex]},displayNumber:function(){return Math.min(100,Math.floor(this.player.resourceMeter))}},methods:{injectBarWidthStyle:function(){return{width:this.displayNumber+"%"}}}})),Ya=Ha,Ka=(i("bc4e"),i("2877")),Qa=Object(Ka["a"])(Ya,Wa,Za,!1,null,"177ca2c8",null),$a=Qa.exports,tr=s["a"].extend({name:"HudSection",components:{PlayerMeter:$a},data:function(){return{vueService:Oa}},computed:{players:function(){return Object.values(this.vueService.state.playerDict)}}}),er=tr,ir=(i("7dd7"),Object(Ka["a"])(er,Xa,Ua,!1,null,"0c1a4603",null)),sr=ir.exports,nr=s["a"].extend({name:"CanvasOverlay",components:{HudSection:sr}}),ar=nr,rr=(i("cfe4"),Object(Ka["a"])(ar,Ea,Ja,!1,null,"752d579a",null)),or=rr.exports,lr=s["a"].extend({name:"GameCanvas",components:{CanvasOverlay:or}}),ur=lr,mr=(i("b5c5"),Object(Ka["a"])(ur,za,Na,!1,null,"5f898446",null)),_r=mr.exports,hr=s["a"].extend({name:"AspectRatioLetterbox",components:{GameCanvas:_r},data:function(){return{shouldUseHorizontalLetterbox:!0}},methods:{detectWidth:function(){var t=this.$refs.aspectRatioWrapper,e=t.clientWidth/t.clientHeight;this.shouldUseHorizontalLetterbox=e>=16/9}},mounted:function(){this.detectWidth(),window.onresize=this.detectWidth.bind(this)}}),cr=hr,fr=(i("2305"),Object(Ka["a"])(cr,Ta,qa,!1,null,"35caae9d",null)),dr=fr.exports,vr=s["a"].extend({name:"App",components:{AspectRatioLetterbox:dr},mounted:function(){new Ra}}),yr=vr,pr=(i("a9ea"),Object(Ka["a"])(yr,n,a,!1,null,null,null)),xr=pr.exports;s["a"].config.productionTip=!1,new s["a"]({render:function(t){return t(xr)}}).$mount("#app")},cfe4:function(t,e,i){"use strict";i("b8a1")}});
//# sourceMappingURL=app.9390d65c.js.map