(function(){var t={5784:function(t){function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=function(){return[]},e.resolve=e,e.id=5784,t.exports=e},8038:function(t,e,s){"use strict";s.d(e,{Z:function(){return i}});var n=s(3796);class i{constructor(){(0,n.Z)(this,"markedForDeletion",!1)}tick(){}}},1877:function(t,e,s){"use strict";s.a(t,(async function(t,n){try{s.d(e,{Z:function(){return l}});var i=s(3796),r=s(5759),o=s(276),a=s(8038),c=t([r,o]);[r,o]=c.then?(await c)():c;class l extends a.Z{constructor(t){super(),(0,i.Z)(this,"scene",void 0),(0,i.Z)(this,"colliderHandle",void 0),(0,i.Z)(this,"body",void 0),this.scene=t.scene,this.colliderHandle=this.createCollider(t)}createCollider(t){const e=r.xr.dynamic(),s=this.scene.world.createRigidBody(e),n=o.ic.ball(t.r).setTranslation(t.x+t.r,t.y+t.r),i=this.scene.world.createCollider(n,s.handle).handle;return i}render(t){const e=t.getContext("2d");e.fillStyle="rgb(200, 0, 0)";const s=this.scene.world.getCollider(this.colliderHandle),{x:n,y:i}=s.translation(),r=s.radius();e.beginPath(),e.arc(n,i,r,0,2*Math.PI,!0),e.fill()}}n()}catch(l){n(l)}}))},4185:function(t,e,s){"use strict";s.a(t,(async function(t,n){try{s.d(e,{Z:function(){return h}});var i=s(3796),r=s(8038),o=s(4730),a=s.n(o),c=s(5759),l=s(276),u=t([c,l]);[c,l]=u.then?(await u)():u;class h extends r.Z{constructor(t){super(),(0,i.Z)(this,"scene",void 0),(0,i.Z)(this,"colliderHandle",void 0),(0,i.Z)(this,"body",void 0),this.scene=t.scene,this.colliderHandle=this.createCollider(t)}createCollider(t){const e=c.xr.dynamic(),s=this.scene.world.createRigidBody(e),n=l.ic.ball(t.r).setTranslation(t.x+t.r,t.y+t.r),i=this.scene.world.createCollider(n,s.handle).handle;return i}handleMovement(t,e){const s=3,n=3,i=this.scene.world.getCollider(this.colliderHandle),r=this.scene.world.getRigidBody(i.parent()),o=r.linvel();let a=t*s,c=e*n;a-=o.x,c-=o.y;const l=r.mass()*a,u=r.mass()*c,h={x:l,y:u};r.applyImpulse(h,!0)}pulse(){new(a())(0,0,0,0,0,0,0,0)}render(t){const e=t.getContext("2d");e.fillStyle="rgb(126, 226, 151)";const s=this.scene.world.getCollider(this.colliderHandle),{x:n,y:i}=s.translation(),r=s.radius();e.beginPath(),e.arc(n,i,r,0,2*Math.PI,!0),e.fill()}}n()}catch(h){n(h)}}))},6203:function(t,e,s){"use strict";s.a(t,(async function(t,n){try{s.d(e,{Z:function(){return c}});var i=s(3796),r=s(276),o=s(8038),a=t([r]);r=(a.then?(await a)():a)[0];class c extends o.Z{constructor(t){super(),(0,i.Z)(this,"scene",void 0),(0,i.Z)(this,"colliderHandle",void 0),(0,i.Z)(this,"body",void 0),this.scene=t.scene,this.colliderHandle=this.createCollider(t)}createCollider(t){const e=r.ic.cuboid(t.w/2,t.h/2).setTranslation(t.x+t.w/2,t.y+t.h/2).setRotation((t.rotation??0)*Math.PI/180),s=this.scene.world.createCollider(e).handle;return s}render(t){const e=t.getContext("2d");e.fillStyle="rgb(209, 225, 235)",console.log(this.colliderHandle);const s=this.scene.world.getCollider(this.colliderHandle),{x:n,y:i}=s.halfExtents(),{x:r,y:o}=s.translation();s.rotation();console.log(`colliderHandle: ${s.handle}, halfX: ${n}, halfY: ${i}, xPosition: ${r}, yPosition: ${o}`),e.rect(r-n,o-i,2*n,2*i),e.fill()}}n()}catch(c){n(c)}}))},1250:function(t,e,s){"use strict";s.d(e,{J:function(){return l}});var n=s(3796),i=s(7545);const r={button1:!1,button2:!1,button3:!1,button4:!1,leftStickXAxis:0,leftStickYAxis:0,rightStickXAxis:0,rightStickYAxis:0,leftTriggerAxis:0,rightTriggerAxis:0};class o{constructor(){}getGamepadInput(t,e,s){const n=t.gamepads[e];if(!n)return r;const i=s.gamepadInputMapping,o=Math.sqrt(Math.pow(Math.abs(n.axes[i.leftStickXAxisIndex]),2)+Math.pow(Math.abs(n.axes[i.leftStickYAxisIndex]),2)),a=Math.sqrt(Math.pow(Math.abs(n.axes[i.rightStickXAxisIndex]),2)+Math.pow(Math.abs(n.axes[i.rightStickYAxisIndex]),2)),c=o<s.leftStickDeadzone,l=a<s.rightStickDeadzone,u={button1:n.buttons[i.button1Index].pressed,button2:n.buttons[i.button2Index].pressed,button3:n.buttons[i.button3Index].pressed,button4:n.buttons[i.button4Index].pressed,leftStickXAxis:c?0:n.axes[i.leftStickXAxisIndex],leftStickYAxis:c?0:-n.axes[i.leftStickYAxisIndex],rightStickXAxis:l?0:n.axes[i.rightStickXAxisIndex],rightStickYAxis:l?0:-n.axes[i.rightStickYAxisIndex],leftTriggerAxis:n.axes[i.leftTriggerAxisIndex],rightTriggerAxis:n.axes[i.rightTriggerAxisIndex]};return u}getKeyboardMouseInput(t,e){const s=e.keyboardMouseInputMapping,n={button1:!!t.pressed[s.button1Key],button2:!!t.pressed[s.button2Key],button3:!!t.pressed[s.button3Key],button4:!!t.pressed[s.button4Key],buttonUp:!!t.pressed[s.buttonUpKey],buttonRight:!!t.pressed[s.buttonRightKey],buttonDown:!!t.pressed[s.buttonDownKey],buttonLeft:!!t.pressed[s.buttonLeftKey]};return n}}const a=new o;var c=s(1223);class l{constructor(t){(0,n.Z)(this,"playerIndex",void 0),(0,n.Z)(this,"netplayPlayerIndex",void 0),(0,n.Z)(this,"gamepadIndex",void 0),(0,n.Z)(this,"inputConfig",void 0),(0,n.Z)(this,"resourceMeter",void 0),(0,n.Z)(this,"RESOURCE_METER_MAXIMUM",101),(0,n.Z)(this,"RESOURCE_METER_BEGIN",50),this.playerIndex=t.playerIndex,this.netplayPlayerIndex=t.netplayPlayerIndex,this.gamepadIndex=t.gamepadIndex,this.inputConfig=t.inputConfig,this.resourceMeter=this.RESOURCE_METER_BEGIN}getInput(t){return-1===this.gamepadIndex?a.getKeyboardMouseInput(t,this.inputConfig??i.H):a.getGamepadInput(t,this.gamepadIndex,this.inputConfig??i.H)}setResourceMeter(t){const e=Math.min(t,this.RESOURCE_METER_MAXIMUM);this.resourceMeter=e,c.q.setPlayerResourceMeter(this.playerIndex,e)}}},8906:function(t,e,s){"use strict";s.a(t,(async function(t,n){try{s.d(e,{D:function(){return l}});var i=s(3796),r=s(3765),o=s(4185),a=s(1250),c=t([o]);o=(c.then?(await c)():c)[0];class l extends a.J{constructor(t){super({playerIndex:t.playerIndex,netplayPlayerIndex:t.netplayPlayerIndex,gamepadIndex:t.gamepadIndex}),(0,i.Z)(this,"RADIUS",void 0),(0,i.Z)(this,"pulseObject",void 0),this.RADIUS=t.RADIUS,this.pulseObject=void 0}createObjects(t,e,s){this.pulseObject=new o.Z({scene:t,x:e,y:s,r:this.RADIUS}),t.addGameObject(this.pulseObject)}tick(t){this.handleMovement(this.getInput(t))}handleMovement(t){let e=0,s=0;(0,r.B)(t)?(e=t.leftStickXAxis,s=t.leftStickYAxis):(console.log(t.buttonUp),t.buttonLeft&&(e-=1),t.buttonRight&&(e+=1),t.buttonUp&&(s+=1),t.buttonDown&&(s-=1)),this.pulseObject.handleMovement(e,s)}}n()}catch(l){n(l)}}))},2174:function(t,e,s){"use strict";s.d(e,{x:function(){return i}});var n=s(3796);class i{constructor(t){(0,n.Z)(this,"world",void 0),(0,n.Z)(this,"unitWidth",void 0),(0,n.Z)(this,"unitHeight",void 0),(0,n.Z)(this,"gameObjects",void 0),this.world=t.world,this.unitWidth=t.unitWidth,this.unitHeight=t.unitHeight,this.gameObjects=t.gameObjects,this.setup()}setup(){}render(t){const e=t.getBoundingClientRect().width,s=t.getBoundingClientRect().height;t.width=e,t.height=s,t.getContext("2d").transform(1,0,0,-1,0,t.height);const n=t.width/this.unitWidth,i=t.height/this.unitHeight,r=Math.min(n,i);t.getContext("2d").scale(r,r),this.renderBackground(t),this.renderGameObjects(t)}addGameObject(t){this.gameObjects.push(t)}renderGameObjects(t){console.log(this.gameObjects),this.gameObjects.forEach((e=>{e.render(t)}))}renderBackground(t){const e=t.getContext("2d");e.fillStyle="rgb(42, 43, 49)",e.fillRect(0,0,t.width,t.height)}}},986:function(t,e,s){"use strict";s.a(t,(async function(t,n){try{s.d(e,{Z:function(){return b}});var i=s(5088),r=s(1877),o=s(6203),a=s(2174),c=t([i,r,o]);[i,r,o]=c.then?(await c)():c;const u=16,h=9,d=1,p=h-d,y=15,f=7.8,v=(u-y)/2,g=(p-f)/2,m=.1;function b(t){const e={x:0,y:0},s=new i.q(e),n=new a.x({world:s,unitWidth:u,unitHeight:h,gameObjects:[]}),c=t.players[0];c&&c.createObjects(n,4,4);const l=t.players[1];return l&&l.createObjects(n,8,4),console.log(l),n.addGameObject(new r.Z({scene:n,x:8,y:7,r:.5})),n.addGameObject(new o.Z({scene:n,x:v,y:g+f,w:y,h:m})),n.addGameObject(new o.Z({scene:n,x:v+y,y:g,w:m,h:f})),n.addGameObject(new o.Z({scene:n,x:v,y:g,w:y,h:m})),n.addGameObject(new o.Z({scene:n,x:v,y:g,w:m,h:f})),n}n()}catch(l){n(l)}}))},4983:function(t,e,s){"use strict";s.a(t,(async function(t,n){try{s.r(e),s.d(e,{MyGame:function(){return d}});var i=s(3796),r=(s(8675),s(3462),s(9854)),o=s(986),a=s(523),c=s(5088),l=s(8906),u=s(7545),h=t([o,l,c]);[o,l,c]=h.then?(await h)():h;class d extends r.lA{constructor(...t){super(...t),(0,i.Z)(this,"players",[new l.D({playerIndex:0,netplayPlayerIndex:0,gamepadIndex:-1,RADIUS:.24}),new l.D({playerIndex:1,netplayPlayerIndex:1,gamepadIndex:-1,inputConfig:{keyboardMouseInputMapping:{buttonUpKey:"W",buttonRightKey:"D",buttonDownKey:"S",buttonLeftKey:"A",...u.H.keyboardMouseInputMapping},...u.H},RADIUS:.24})]),(0,i.Z)(this,"scene",(0,o.Z)({players:this.players})),(0,i.Z)(this,"previousTimestamp",0),(0,i.Z)(this,"someTestCopyOfThis",null)}serialize(){return{snapshot:this.scene.world.takeSnapshot().toString()}}deserialize(t){const e=t["snapshot"],s=e.split(","),n=new Uint8Array(s);this.scene.world=c.q.restoreSnapshot(n)}tick(t){this.tickWorld(),this.tickPlayers(t),this.scene.world.colliders.forEachCollider((t=>{console.log(`x: ${t.translation().x}, y: ${t.translation().y}, hw: ${t.halfExtents().x}, hh: ${t.halfExtents().y}`)}))}draw(t){this.scene.render(t)}tickPlayers(t){this.players.forEach((e=>{for(const[s,n]of t.entries())s.getID()===e.netplayPlayerIndex&&e.tick(n)}))}tickWorld(){this.scene.world.step()}}(0,i.Z)(d,"timestep",1e3/60),(0,i.Z)(d,"canvasSize",{width:-1,height:-1}),new a.C(d).start(),n()}catch(d){n(d)}}))},523:function(t,e,s){"use strict";s.d(e,{C:function(){return g}});var n=s(3796),i=(s(6699),s(5391)),r=s.n(i),o=s(1062);class a{constructor(t){(0,n.Z)(this,"discount",void 0),(0,n.Z)(this,"est_average",void 0),(0,n.Z)(this,"est_variance",void 0),(0,n.Z)(this,"initialized",void 0),this.discount=t,this.est_average=0,this.est_variance=0,this.initialized=!1}update(t){if(this.initialized){const e=t-this.est_average;this.est_variance=(1-this.discount)*(this.est_variance+this.discount*e*e),this.est_average=this.discount*t+(1-this.discount)*this.est_average}else this.est_average=t,this.initialized=!0}average(){return this.est_average}variance(){return this.est_variance}stddev(){return Math.sqrt(this.est_variance)}}var c=s(6249),l=s(7597),u=s(9854);class h extends u.Ay{constructor(...t){super(...t),(0,n.Z)(this,"gamepads",[])}}class d extends u.F0{getInput(){const t=new h;for(const e in this.PRESSED_KEYS)this.PRESSED_KEYS[e]&&(t.pressed[e]=!0);return t.gamepads=navigator.getGamepads(),console.log(t.pressed),t}}var p=s(7563),y=s(2757),f=s(1223);const v=100;class g{isChannelOrdered(t){return t.ordered}isChannelReliable(t){return null===t.maxPacketLifeTime&&null===t.maxRetransmits}checkChannel(t){y.hu.isTrue(this.isChannelOrdered(t),"Data Channel must be ordered."),y.hu.isTrue(this.isChannelReliable(t),"Channel must be reliable.")}constructor(t){if((0,n.Z)(this,"gameClass",void 0),(0,n.Z)(this,"canvas",void 0),(0,n.Z)(this,"vueService",f.q),(0,n.Z)(this,"inputReader",void 0),(0,n.Z)(this,"stateSyncPeriod",void 0),(0,n.Z)(this,"pingMeasure",new a(.2)),(0,n.Z)(this,"game",void 0),(0,n.Z)(this,"rollbackNetcode",void 0),(0,n.Z)(this,"peer",void 0),this.gameClass=t,this.stateSyncPeriod=this.gameClass.stateSyncPeriod||1,this.canvas=document.getElementById("game-canvas"),this.gameClass.touchControls&&window.navigator.userAgent.toLowerCase().includes("mobile"))for(const[e,s]of Object.entries(this.gameClass.touchControls))s.show();this.inputReader=new d(this.canvas,this.gameClass.pointerLock||!1,this.gameClass.touchControls||{})}start(){console.info("Creating a PeerJS instance."),this.vueService.setNetplayConnectingToServer(!0),this.peer=new(r()),this.peer.on("error",(t=>{this.vueService.setNetplayErrorMessage(JSON.stringify(t)),console.error(t)})),this.peer.on("open",(t=>{this.vueService.setNetplayConnectingToServer(!1);const e=p.parse(window.location.hash),s=!!e.room;if(s){this.vueService.setNetplayConnectedToPeer(!0),console.info(`Connecting to room ${e.room}.`);const t=this.peer.connect(e.room,{serialization:"json",reliable:!0,_payload:{originator:!0,reliable:!0}});t.on("error",(t=>{this.vueService.setNetplayErrorMessage(JSON.stringify(t)),console.error(t)}));const s=[new c.tK(0,!1,!0),new c.tK(1,!0,!1)];this.startClient(s,t)}else{console.info("Showing join link.");const e=`${window.location.href}#room=${t}`;this.vueService.setNetplayJoinUrl(e);const s=[new c.tK(0,!0,!0),new c.tK(1,!1,!1)];this.peer.on("connection",(t=>{this.vueService.setNetplayConnectedToPeer(!0),t.on("error",(t=>{this.vueService.setNetplayErrorMessage(JSON.stringify(t)),console.error(t)})),this.startHost(s,t)}))}}))}getInitialInputs(t){const e=new Map;for(const s of t)e.set(s,new o.A);return e}startHost(t,e){console.info("Starting a rollback host."),this.game=new this.gameClass(this.canvas,t),this.rollbackNetcode=new l.B(!0,this.game,t,this.getInitialInputs(t),10,this.pingMeasure,this.gameClass.timestep,(()=>this.inputReader.getInput()),((t,s)=>{e.send({type:"input",frame:t,input:s.serialize()})}),((t,s)=>{e.send({type:"state",frame:t,state:s})})),e.on("data",(s=>{if("input"===s.type){const e=new o.A;e.deserialize(s.input),this.rollbackNetcode.onRemoteInput(s.frame,t[1],e)}else"ping-req"==s.type?e.send({type:"ping-resp",sent_time:s.sent_time}):"ping-resp"==s.type&&this.pingMeasure.update(Date.now()-s.sent_time)})),e.on("open",(()=>{console.log("Client has connected... Starting game..."),this.checkChannel(e.dataChannel),setInterval((()=>{e.send({type:"ping-req",sent_time:Date.now()})}),v),this.startGameLoop()}))}startClient(t,e){console.info("Starting a lockstep client."),this.game=new this.gameClass(this.canvas,t),this.rollbackNetcode=new l.B(!1,this.game,t,this.getInitialInputs(t),10,this.pingMeasure,this.gameClass.timestep,(()=>this.inputReader.getInput()),((t,s)=>{e.send({type:"input",frame:t,input:s.serialize()})})),e.on("data",(s=>{if("input"===s.type){const e=new o.A;e.deserialize(s.input),this.rollbackNetcode.onRemoteInput(s.frame,t[0],e)}else"state"===s.type?this.rollbackNetcode.onStateSync(s.frame,s.state):"ping-req"==s.type?e.send({type:"ping-resp",sent_time:s.sent_time}):"ping-resp"==s.type&&this.pingMeasure.update(Date.now()-s.sent_time)})),e.on("open",(()=>{console.log("Successfully connected to server... Starting game..."),this.checkChannel(e.dataChannel),setInterval((()=>{e.send({type:"ping-req",sent_time:Date.now()})}),v),this.startGameLoop()}))}startGameLoop(){this.rollbackNetcode.start();const t=e=>{this.game.draw(this.canvas),this.vueService.setNetplayPing(this.pingMeasure.average().toFixed(2)),this.vueService.setNetplayPingStdDev(this.pingMeasure.stddev().toFixed(2)),this.vueService.setNetplayHistoryLength(this.rollbackNetcode.history.length),this.vueService.setNetplayFrame(this.rollbackNetcode.currentFrame()),this.vueService.setNetplayLargestFutureSize(this.rollbackNetcode.largestFutureSize()),this.vueService.setNetplayPredictedFrames(this.rollbackNetcode.predictedFrames()),this.vueService.setNetplayStalling(this.rollbackNetcode.shouldStall()),requestAnimationFrame(t)};requestAnimationFrame(t)}}},7545:function(t,e,s){"use strict";s.d(e,{H:function(){return r}});const n={button1Index:0,button2Index:1,button3Index:2,button4Index:3,leftStickXAxisIndex:0,leftStickYAxisIndex:1,rightStickXAxisIndex:2,rightStickYAxisIndex:3,leftTriggerAxisIndex:4,rightTriggerAxisIndex:5},i={button1Key:"Z",button2Key:"X",button3Key:"C",button4Key:"V",buttonUpKey:"ArrowUp",buttonRightKey:"ArrowRight",buttonDownKey:"ArrowDown",buttonLeftKey:"ArrowLeft"},r={gamepadInputMapping:n,keyboardMouseInputMapping:i,leftStickDeadzone:.15,rightStickDeadzone:.15}},3765:function(t,e,s){"use strict";s.d(e,{B:function(){return n}});const n=t=>"leftStickXAxis"in t},1223:function(t,e,s){"use strict";s.d(e,{q:function(){return o}});var n=s(3796),i=s(144);class r{constructor(t){(0,n.Z)(this,"state",void 0),this.state={netplay:{connectingToServer:!1,connectedToPeer:!1,joinUrl:null,errorMessage:null,ping:null,pingStdDev:null,historyLength:null,frame:null,largestFutureSize:null,predictedFrames:null,stalling:!1},playerDict:{}}}addPlayer(t){i.Z.set(this.state.playerDict,t.index,t)}setPlayerResourceMeter(t,e){i.Z.set(this.state.playerDict[t],"resourceMeter",e)}setNetplayConnectingToServer(t){i.Z.set(this.state.netplay,"connectingToServer",t)}setNetplayConnectedToPeer(t){i.Z.set(this.state.netplay,"connectedToPeer",t)}setNetplayErrorMessage(t){i.Z.set(this.state.netplay,"errorMessage",t)}setNetplayJoinUrl(t){i.Z.set(this.state.netplay,"joinUrl",t)}setNetplayPing(t){i.Z.set(this.state.netplay,"ping",t)}setNetplayPingStdDev(t){i.Z.set(this.state.netplay,"pingStdDev",t)}setNetplayHistoryLength(t){i.Z.set(this.state.netplay,"historyLength",t)}setNetplayFrame(t){i.Z.set(this.state.netplay,"frame",t)}setNetplayLargestFutureSize(t){i.Z.set(this.state.netplay,"futureSize",t)}setNetplayPredictedFrames(t){i.Z.set(this.state.netplay,"predictedFrames",t)}setNetplayStalling(t){i.Z.set(this.state.netplay,"stalling",t)}}const o=new r({placeholderSetting:"uh ok"})},1062:function(t,e,s){"use strict";s.d(e,{A:function(){return o},F:function(){return a}});var n=s(3796),i=s(6249),r=s(7739);class o extends i.M7{constructor(...t){super(...t),(0,n.Z)(this,"pressed",{}),(0,n.Z)(this,"mousePosition",void 0),(0,n.Z)(this,"touches",[]),(0,n.Z)(this,"touchControls",void 0)}}class a{getCanvasScale(){const t=this.canvas.getBoundingClientRect();return{x:this.canvas.width/t.width,y:this.canvas.height/t.height}}projectClientPosition(t,e){const s=this.canvas.getBoundingClientRect(),n=this.getCanvasScale();return{x:(t-s.left)*n.x,y:(e-s.top)*n.y}}constructor(t,e,s){(0,n.Z)(this,"canvas",void 0),(0,n.Z)(this,"PRESSED_KEYS",{}),(0,n.Z)(this,"mousePosition",null),(0,n.Z)(this,"mouseDelta",null),(0,n.Z)(this,"touches",[]),(0,n.Z)(this,"touchControls",void 0),this.canvas=t,this.touchControls=s,document.addEventListener("keydown",(t=>{this.PRESSED_KEYS[t.key]=!0}),!1),document.addEventListener("keyup",(t=>{this.PRESSED_KEYS[t.key]=!1}),!1),t.addEventListener("mouseenter",(t=>this.updateMousePosition(t)),!1),t.addEventListener("mousemove",(t=>this.updateMousePosition(t)),!1),t.addEventListener("mouseleave",(t=>{this.mousePosition=null}),!1),t.addEventListener("touchstart",(t=>this.updateTouches(t)),!1),t.addEventListener("touchmove",(t=>this.updateTouches(t)),!1),t.addEventListener("touchend",(t=>this.updateTouches(t)),!1),t.addEventListener("mousedown",(()=>{e&&t.requestPointerLock()}))}updateMousePosition(t){if(document.pointerLockElement===this.canvas)if(this.mousePosition){const e=this.getCanvasScale();this.mousePosition.x+=t.movementX*e.x,this.mousePosition.y+=t.movementY*e.y}else this.mousePosition=this.projectClientPosition(t.clientX,t.clientY);else this.mousePosition=this.projectClientPosition(t.clientX,t.clientY)}updateTouches(t){this.touches.length=t.targetTouches.length;for(let e=0;e<t.targetTouches.length;++e)this.touches[e]=this.projectClientPosition(t.targetTouches[e].clientX,t.targetTouches[e].clientY)}getInput(){const t=new o;for(const e in this.PRESSED_KEYS)this.PRESSED_KEYS[e]&&(t.pressed[e]=!0);this.mousePosition&&(t.mousePosition=r.d9(this.mousePosition)),t.touches=r.d9(this.touches);for(const[e,s]of Object.entries(this.touchControls))t.touchControls=t.touchControls||{},t.touchControls[e]=r.d9(s.getValue());return t}}},9854:function(t,e,s){"use strict";s.d(e,{Ay:function(){return n.A},F0:function(){return n.F},lA:function(){return r}});var n=s(1062);s(6699),s(5391),s(7563),s(2757);s(1703),s(7739);s(7597);var i=s(6249);class r extends i.Uo{}},7597:function(t,e,s){"use strict";s.d(e,{B:function(){return c}});var n=s(3796),i=(s(1703),s(7739));const r=!1;var o=s(2757);class a{constructor(t,e,s){(0,n.Z)(this,"frame",void 0),(0,n.Z)(this,"state",void 0),(0,n.Z)(this,"inputs",void 0),this.frame=t,this.state=e,this.inputs=s}isPlayerInputPredicted(t){return(0,i.U2)(this.inputs,t).isPrediction}anyInputPredicted(){for(const[t,{isPrediction:e}]of this.inputs.entries())if(e)return!0;return!1}allInputsSynced(){return!this.anyInputPredicted()}}class c{onStateSync(t,e){r&&o.hu.isFalse(this.isHost,"Only clients recieve state syncs.");let s=0;while(this.history.length>1){if(r&&o.hu.isTrue(this.history[0].allInputsSynced()),!(this.history[0].frame<t))break;(0,i.uY)(this.history),s++}r&&console.debug(`Cleaned up ${s} states.`),r&&o.hu.equal(this.history[0].frame,t),this.history[0].state=e,this.state.deserialize(e);for(let n=1;n<this.history.length;++n){const t=this.history[n];this.state.tick(this.getStateInputs(t.inputs)),t.state=(0,i.d9)(this.state.serialize())}r&&console.debug(`Resimulated ${this.history.length-1} states after state sync.`)}onRemoteInput(t,e,s){r&&o.hu.isTrue(e.isRemotePlayer(),"'player' must be a remote player."),r&&o.hu.isNotEmpty(this.history,"'history' cannot be empty.");const n=(0,i.U2)(this.highestFrameReceived,e)+1;if(r&&o.hu.equal(n,t),this.highestFrameReceived.set(e,n),t>this.history[this.history.length-1].frame)return void(0,i.U2)(this.future,e).push({frame:t,input:s});let a=null;for(let i=0;i<this.history.length;++i)if(this.history[i].isPlayerInputPredicted(e)){a=i;break}r&&o.hu.exists(a),r&&o.hu.equal(this.history[a].frame,t);const c=this.history[a-1];this.state.deserialize(c.state);for(let l=a;l<this.history.length;++l){const n=this.history[l],c=(0,i.U2)(n.inputs,e);if(r&&o.hu.isTrue(c.isPrediction),l===a)r&&o.hu.equal(n.frame,t),c.isPrediction=!1,c.input=s;else{const t=this.history[l-1],s=(0,i.U2)(t.inputs,e);c.input=s.input.predictNext()}this.state.tick(this.getStateInputs(n.inputs)),n.state=(0,i.d9)(this.state.serialize())}if(r&&console.debug(`Resimulated ${this.history.length-a} states after rollback.`),this.isHost){let t=0;while(this.history.length>=2){const e=this.history[0],s=this.history[1];if(r&&o.hu.isTrue(e.allInputsSynced()),!s.allInputsSynced())break;{const e=(0,i.uY)(this.history);t++,this.broadcastState(e.frame,e.state)}}r&&console.debug(`Cleaned up ${t} states.`)}}constructor(t,e,s,r,o,c,l,u,h,d){if((0,n.Z)(this,"history",void 0),(0,n.Z)(this,"maxPredictedFrames",void 0),(0,n.Z)(this,"future",void 0),(0,n.Z)(this,"highestFrameReceived",void 0),(0,n.Z)(this,"isHost",void 0),(0,n.Z)(this,"broadcastInput",void 0),(0,n.Z)(this,"broadcastState",void 0),(0,n.Z)(this,"pingMeasure",void 0),(0,n.Z)(this,"timestep",void 0),(0,n.Z)(this,"state",void 0),(0,n.Z)(this,"pollInput",void 0),(0,n.Z)(this,"players",void 0),this.isHost=t,this.state=e,this.players=s,this.maxPredictedFrames=o,this.broadcastInput=h,this.pingMeasure=c,this.timestep=l,this.pollInput=u,t){if(!d)throw new Error("Expected a broadcast state function.");this.broadcastState=d}const p=new Map;for(const[n,i]of r.entries())p.set(n,{input:i,isPrediction:!1});this.history=[new a(0,(0,i.d9)(this.state.serialize()),p)],this.future=new Map,this.highestFrameReceived=new Map;for(const n of this.players)this.future.set(n,[]),this.highestFrameReceived.set(n,0)}currentFrame(){return r&&o.hu.isNotEmpty(this.history,"'history' cannot be empty."),this.history[this.history.length-1].frame}largestFutureSize(){return Math.max(...Array.from(this.future.values()).map((t=>t.length)))}predictedFrames(){for(let t=0;t<this.history.length;++t)if(!this.history[t].allInputsSynced())return this.history.length-t;return 0}shouldStall(){return this.predictedFrames()>this.maxPredictedFrames}tick(){if(r&&o.hu.isNotEmpty(this.history,"'history' cannot be empty."),this.shouldStall())return;const t=this.history[this.history.length-1],e=new Map;for(const[s,n]of t.inputs.entries())if(s.isLocalPlayer()){const n=this.pollInput();e.set(s,{input:n,isPrediction:!1}),this.broadcastInput(t.frame+1,n)}else if((0,i.U2)(this.future,s).length>0){const n=(0,i.uY)((0,i.U2)(this.future,s));r&&o.hu.equal(t.frame+1,n.frame),e.set(s,{input:n.input,isPrediction:!1})}else e.set(s,{input:n.input.predictNext(),isPrediction:!0});this.state.tick(this.getStateInputs(e)),this.history.push(new a(t.frame+1,(0,i.d9)(this.state.serialize()),e))}getStateInputs(t){const e=new Map;for(const[s,{input:n}]of t.entries())e.set(s,n);return e}start(){setInterval((()=>{let t=1;this.largestFutureSize()>0&&(t=2);for(let e=0;e<t;++e)this.tick()}),this.timestep)}}},6249:function(t,e,s){"use strict";s.d(e,{M7:function(){return a},tK:function(){return c},Uo:function(){return o}});var n=s(3796);function i(t){return JSON.parse(JSON.stringify(t))}function r(t,e){const s=JSON.parse(JSON.stringify(t));for(const[n,i]of Object.entries(s))e[n]=s[n]}class o{serialize(){return i(this)}deserialize(t){r(t,this)}}class a{predictNext(){return this}serialize(){return i(this)}deserialize(t){r(t,this)}}class c{constructor(t,e,s){(0,n.Z)(this,"id",void 0),(0,n.Z)(this,"isLocal",void 0),(0,n.Z)(this,"isHost",void 0),this.id=t,this.isLocal=e,this.isHost=s}isLocalPlayer(){return this.isLocal}isRemotePlayer(){return!this.isLocal}isServer(){return this.isHost}isClient(){return!this.isHost}getID(){return this.id}}},7739:function(t,e,s){"use strict";s.d(e,{U2:function(){return n},d9:function(){return i},uY:function(){return r}});s(1703);function n(t,e){const s=t.get(e);if(void 0!==s)return s;throw new Error(`Key ${String(e)} not in Map ${t.toString()}`)}function i(t){return JSON.parse(JSON.stringify(t))}function r(t){const e=t.shift();if(void 0!==e)return e;throw new Error(`Shift returned undefined from Array ${t.toString()}`)}},1851:function(t,e,s){"use strict";var n=s(144),i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("main-layout")],1)},r=[],o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"main-layout"},[s("aspect-ratio-letterbox",[s("game-canvas")],1),this.shouldShowNetplayMenu?s("netplay-menu"):t._e(),this.shouldShowNetplayStats?s("netplay-stats"):t._e()],1)},a=[],c=s(1223),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"aspectRatioWrapper",class:this.shouldUseHorizontalLetterbox?"aspect-ratio-wrapper-h":"aspect-ratio-wrapper-v"},[s("div",{class:this.shouldUseHorizontalLetterbox?"aspect-ratio-div-h":"aspect-ratio-div-v"},[s("div",{staticClass:"content-wrapper"},[t._t("default")],2)])])},u=[],h=n.Z.extend({name:"AspectRatioLetterbox",data:function(){return{shouldUseHorizontalLetterbox:!0}},methods:{detectWidth(){const t=this.$refs.aspectRatioWrapper,e=t.clientWidth/t.clientHeight;this.shouldUseHorizontalLetterbox=e>=16/9}},mounted(){this.detectWidth(),window.onresize=this.detectWidth.bind(this)}}),d=h,p=s(1001),y=(0,p.Z)(d,l,u,!1,null,"f8cb903a",null),f=y.exports,v=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"canvas-wrapper"},[s("canvas-overlay",{staticClass:"canvas-overlay-from-parent"}),t._m(0)],1)},g=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("canvas",{attrs:{id:"game-canvas"}})}],m=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"canvas-overlay"},[s("hud-section",{staticClass:"hud-section-from-parent"})],1)},b=[],x=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"hud-section"},t._l(t.players,(function(t){return s("player-meter",{key:t.index,attrs:{playerIndex:t.index}})})),1)},S=[],w=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"player-meter-wrapper"},[s("div",{staticClass:"player-meter"},[s("div",{staticClass:"meter-bg"},[s("div",{staticClass:"meter-fg",style:t.injectBarWidthStyle()})])]),s("div",{staticClass:"amount-text"},[t._v(" "+t._s(t.displayNumber)+" ")])])},C=[],Z=n.Z.extend({name:"PlayerMeter",props:{playerIndex:Number},data:function(){return{vueService:c.q}},computed:{player(){return this.vueService.state.playerDict[this.playerIndex]},displayNumber(){return Math.min(100,Math.floor(this.player.resourceMeter))}},methods:{injectBarWidthStyle(){return{width:this.displayNumber+"%"}}}}),I=Z,_=(0,p.Z)(I,w,C,!1,null,"1fa2f416",null),M=_.exports,P=n.Z.extend({name:"HudSection",components:{PlayerMeter:M},data:function(){return{vueService:c.q}},computed:{players(){return Object.values(this.vueService.state.playerDict)}}}),k=P,E=(0,p.Z)(k,x,S,!1,null,"0c1a4603",null),N=E.exports,O=n.Z.extend({name:"CanvasOverlay",components:{HudSection:N}}),R=O,A=(0,p.Z)(R,m,b,!1,null,"4e4af283",null),T=A.exports,j=n.Z.extend({name:"GameCanvas",components:{CanvasOverlay:T}}),D=j,L=(0,p.Z)(D,v,g,!1,null,"5f898446",null),U=L.exports,F=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"netplay-menu-wrapper"},[s("card-box",[s("div",{staticClass:"netplay-menu-column"},[s("button",{on:{click:t.copyToClipboard}},[t._v(" Copy Player 2 Link to Clipboard ")]),s("a",{attrs:{href:this.vueService.state.netplay.joinUrl,target:"_blank"}},[t._v(" Open Player 2 Tab ")])])])],1)},H=[],z=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"card"},[t._t("default")],2)},K=[],$=n.Z.extend({name:"CardBox"}),Y=$,q=(0,p.Z)(Y,z,K,!1,null,"2d925e7c",null),B=q.exports,G=n.Z.extend({components:{CardBox:B},name:"NetplayMenu",data:function(){return{vueService:c.q}},computed:{displayNumber(){return console.log(this.vueService.state.netplay),"some value"}},methods:{copyToClipboard(){window.navigator.clipboard.writeText(this.vueService.state.netplay.joinUrl)}}}),X=G,W=(0,p.Z)(X,F,H,!1,null,"323814d5",null),J=W.exports,V=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"netplay-stats-wrapper"},[s("card-box",[s("table",{staticClass:"netplay-stats-table"},[this.vueService.state.netplay.errorMessage?s("span",[t._v(" "+t._s(this.vueService.state.netplay.errorMessage)+" ")]):t._e(),s("tr",[s("td",[t._v("Ping")]),s("td",[t._v(t._s(this.ping))])]),s("tr",[s("td",[t._v("History Length")]),s("td",[t._v(t._s(this.vueService.state.netplay.historyLength))])]),s("tr",[s("td",[t._v("Frame")]),s("td",[t._v(t._s(this.vueService.state.netplay.frame))])]),s("tr",[s("td",[t._v("Largest Future Size")]),s("td",[t._v(t._s(this.vueService.state.netplay.largestFutureSize))])]),s("tr",[s("td",[t._v("Predicted Frames")]),s("td",[t._v(t._s(this.vueService.state.netplay.predictedFrames))])]),s("tr",[s("td",[t._v("Stalling")]),s("td",[t._v(t._s(this.vueService.state.netplay.stalling))])])])])],1)},Q=[],tt=n.Z.extend({components:{CardBox:B},name:"NetplayStats",data:function(){return{vueService:c.q}},computed:{ping(){const t=this.vueService.state.netplay.ping;return null!==t?`${t}ms +/- ${this.vueService.state.netplay.pingStdDev}ms`:null}}}),et=tt,st=(0,p.Z)(et,V,Q,!1,null,"64f04334",null),nt=st.exports,it=s(7563),rt=n.Z.extend({components:{AspectRatioLetterbox:f,NetplayMenu:J,NetplayStats:nt,GameCanvas:U},name:"MainLayout",data:function(){return{vueService:c.q}},computed:{shouldShowNetplayMenu(){const t=it.parse(window.location.hash),e=!t.room;return null!==this.vueService.state.netplay.joinUrl&&e&&!this.vueService.state.netplay.connectedToPeer},shouldShowNetplayStats(){return this.vueService.state.netplay.connectedToPeer||this.vueService.state.netplay.errorMessage}}}),ot=rt,at=(0,p.Z)(ot,o,a,!1,null,"c2b29102",null),ct=at.exports,lt=n.Z.extend({name:"App",components:{MainLayout:ct},mounted(){s(4983)}}),ut=lt,ht=(0,p.Z)(ut,i,r,!1,null,null,null),dt=ht.exports;n.Z.config.productionTip=!1,new n.Z({render:t=>t(dt)}).$mount("#app")},6952:function(){}},e={};function s(n){var i=e[n];if(void 0!==i)return i.exports;var r=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(r.exports,r,r.exports,s),r.loaded=!0,r.exports}s.m=t,function(){var t="function"===typeof Symbol?Symbol("webpack then"):"__webpack_then__",e="function"===typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"===typeof Symbol?Symbol("webpack error"):"__webpack_error__",i=function(t){t&&(t.forEach((function(t){t.r--})),t.forEach((function(t){t.r--?t.r++:t()})))},r=function(t){!--t.r&&t()},o=function(t,e){t?t.push(e):r(e)},a=function(s){return s.map((function(s){if(null!==s&&"object"===typeof s){if(s[t])return s;if(s.then){var a=[];s.then((function(t){c[e]=t,i(a),a=0}),(function(t){c[n]=t,i(a),a=0}));var c={};return c[t]=function(t,e){o(a,t),s["catch"](e)},c}}var l={};return l[t]=function(t){r(t)},l[e]=s,l}))};s.a=function(s,c,l){var u,h,d,p=l&&[],y=s.exports,f=!0,v=!1,g=function(e,s,n){v||(v=!0,s.r+=e.length,e.map((function(e,i){e[t](s,n)})),v=!1)},m=new Promise((function(t,e){d=e,h=function(){t(y),i(p),p=0}}));m[e]=y,m[t]=function(t,e){if(f)return r(t);u&&g(u,t,e),o(p,t),m["catch"](e)},s.exports=m,c((function(t){var s;u=a(t);var i=function(){return u.map((function(t){if(t[n])throw t[n];return t[e]}))},r=new Promise((function(t,e){s=function(){t(i)},s.r=0,g(u,s,e)}));return s.r?r:i()}),(function(t){t&&d(m[n]=t),h()})),f=!1}}(),function(){var t=[];s.O=function(e,n,i,r){if(!n){var o=1/0;for(u=0;u<t.length;u++){n=t[u][0],i=t[u][1],r=t[u][2];for(var a=!0,c=0;c<n.length;c++)(!1&r||o>=r)&&Object.keys(s.O).every((function(t){return s.O[t](n[c])}))?n.splice(c--,1):(a=!1,r<o&&(o=r));if(a){t.splice(u--,1);var l=i();void 0!==l&&(e=l)}}return e}r=r||0;for(var u=t.length;u>0&&t[u-1][2]>r;u--)t[u]=t[u-1];t[u]=[n,i,r]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.hmd=function(t){return t=Object.create(t),t.children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t}}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.v=function(t,e,n,i){var r=fetch(s.p+""+n+".module.wasm");return"function"===typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(r,i).then((function(e){return Object.assign(t,e.instance.exports)})):r.then((function(t){return t.arrayBuffer()})).then((function(t){return WebAssembly.instantiate(t,i)})).then((function(e){return Object.assign(t,e.instance.exports)}))}}(),function(){s.p=""}(),function(){var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,n){var i,r,o=n[0],a=n[1],c=n[2],l=0;if(o.some((function(e){return 0!==t[e]}))){for(i in a)s.o(a,i)&&(s.m[i]=a[i]);if(c)var u=c(s)}for(e&&e(n);l<o.length;l++)r=o[l],s.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return s.O(u)},n=self["webpackChunkgame"]=self["webpackChunkgame"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=s.O(void 0,[998],(function(){return s(1851)}));n=s.O(n)})();
//# sourceMappingURL=app.97595cef.js.map